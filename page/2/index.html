<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.0.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Hexo, NexT" />


<meta name="description" content="äººè‹¦ä¸çŸ¥è¶³ï¼Œæ—¢å¾—é™‡ï¼Œå¤æœ›èœ€">
<meta property="og:type" content="website">
<meta property="og:title" content="ä¿®å­èŒƒè¯­">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="ä¿®å­èŒƒè¯­">
<meta property="og:description" content="äººè‹¦ä¸çŸ¥è¶³ï¼Œæ—¢å¾—é™‡ï¼Œå¤æœ›èœ€">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä¿®å­èŒƒè¯­">
<meta name="twitter:description" content="äººè‹¦ä¸çŸ¥è¶³ï¼Œæ—¢å¾—é™‡ï¼Œå¤æœ›èœ€">






  <link rel="canonical" href="http://yoursite.com/page/2/"/>


  <title>ä¿®å­èŒƒè¯­</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ä¿®å­èŒƒè¯­</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Alfredo's Notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />é¦–é¡µ</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />æ ‡ç­¾</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />åˆ†ç±»</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />å½’æ¡£</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/11/Enzymeä½¿ç”¨æŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/11/Enzymeä½¿ç”¨æŒ‡å—/" itemprop="url">Enzymeä½¿ç”¨æŒ‡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-11T00:00:00+08:00">2018-02-11</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/11/Enzymeä½¿ç”¨æŒ‡å—/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/11/Enzymeä½¿ç”¨æŒ‡å—/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Enzyme æ˜¯ä¸€æ¬¾ react ç»„ä»¶æµ‹è¯•å·¥å…·ã€‚</p>
<p>Enzyme åŸºäº <a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="noopener">cheerio</a> å®ç°è™šæ‹Ÿ dom çš„æŸ¥æ‰¾å’Œéå†ï¼›è€Œ cheerio å·ç§°ä¸ºæœåŠ¡å™¨ç«¯çš„ jquery å®ç°ã€‚</p>
<p>Enzyme æœ¬èº«ä¸å®ç°æµ‹è¯•å’Œæ–­è¨€åº“ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ Mocha/chai, Jasmine, Jest ç­‰æµ‹è¯•æˆ–æ–­è¨€åº“ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><ol>
<li>å®‰è£… npm i â€“save-dev enzymeã€‚</li>
<li>é’ˆå¯¹é¡¹ç›®ä¸­ä½¿ç”¨çš„ react ç‰ˆæœ¬ï¼Œå®‰è£… enzyme-adapter-react-16, enzyme-adapter-react-15ï¼ˆ15.5.0 ç‰ˆæœ¬èµ·ï¼‰, enzyme-adapter-react-15.4ï¼ˆ15.0.0 ~ 15.4.xï¼‰, enzyme-adapter-react-14, enzyme-adapter-react-13 é€‚é…å™¨ã€‚</li>
<li><p>é…ç½® enzyme ä»¥ä½¿ç”¨é€‚é…å™¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Enzyme <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> Adapter <span class="keyword">from</span> <span class="string">'enzyme-adapter-react-16'</span>;</span><br><span class="line"></span><br><span class="line">Enzyme.configure(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> Adapter() &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; expect &#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> sinon <span class="keyword">from</span> <span class="string">'sinon'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MyComponent <span class="keyword">from</span> <span class="string">'./MyComponent'</span>;</span><br><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">'./Foo'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'&lt;MyComponent /&gt;'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'renders three &lt;Foo /&gt; components'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = shallow(&lt;MyComponent /&gt;);</span><br><span class="line">    expect(wrapper.find(Foo)).to.have.length(3);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it('renders an `.icon-star`', () =&gt; &#123;</span><br><span class="line">    const wrapper = shallow(&lt;MyComponent /&gt;);</span><br><span class="line">    expect(wrapper.find('.icon-star')).to.have.length(1);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it('renders children when passed in', () =&gt; &#123;</span><br><span class="line">    const wrapper = shallow((</span><br><span class="line">      &lt;MyComponent&gt;</span><br><span class="line">        &lt;div className="unique" /&gt;</span><br><span class="line">      &lt;/MyComponent&gt;</span><br><span class="line">    ));</span><br><span class="line">    expect(wrapper.contains(&lt;div className="unique" /&gt;)).to.equal(true);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it('simulates click events', () =&gt; &#123;</span><br><span class="line">    const onButtonClick = sinon.spy();</span><br><span class="line">    const wrapper = shallow(&lt;Foo onButtonClick=&#123;onButtonClick&#125; /&gt;);</span><br><span class="line">    wrapper.find('button').simulate('click');</span><br><span class="line">    expect(onButtonClick).to.have.property('callCount', 1);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="api-æ‰‹å†Œ"><a href="#api-æ‰‹å†Œ" class="headerlink" title="api æ‰‹å†Œ"></a>api æ‰‹å†Œ</h2><h3 id="æ¸²æŸ“æ¨¡å¼"><a href="#æ¸²æŸ“æ¨¡å¼" class="headerlink" title="æ¸²æŸ“æ¨¡å¼"></a>æ¸²æŸ“æ¨¡å¼</h3><ol>
<li>æµ…æ¸²æŸ“ï¼šshallow(node[, options]) =&gt; ShallowWrapperã€‚å‚æ•° node ä¸º ReactElementï¼Œoptions.context ä¼ å…¥ç»„ä»¶çš„contextï¼Œoptions.disableLifecycleMethods ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯å¦æœ‰æ•ˆã€‚</li>
<li>å®Œæ•´æ¸²æŸ“ï¼šmount(node[, options]) =&gt; ReactWrapperã€‚options.context ä¼ å…¥ç»„ä»¶çš„contextï¼Œoptions.attachTo ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯å¦æœ‰æ•ˆã€‚éœ€è¦å®Œæ•´çš„ dom apiï¼Œæ‰€ä»¥éœ€è¦å®‰è£… <a href="https://github.com/jsdom/jsdom" target="_blank" rel="noopener">jsdom</a> åº“ã€‚</li>
<li>é™æ€æ¸²æŸ“ï¼šrender(node[, options]) =&gt; CheerioWrapperï¼Œæ¸²æŸ“ä¸º htmlï¼Œé€šè¿‡ cheerio è§£æ htmlã€‚</li>
</ol>
<h3 id="wrapper-api"><a href="#wrapper-api" class="headerlink" title="wrapper api"></a>wrapper api</h3><ol>
<li>.find(selector) =&gt; Wrapper</li>
<li>.findWhere(predicate) =&gt; Wrapper</li>
<li>.filter(selector) =&gt; Wrapper</li>
<li>.filterWhere(predicate) =&gt; Wrapper</li>
<li>.hostNodes() =&gt; Wrapperï¼Œäº‹å…ˆå­˜åœ¨äºæ–‡æ¡£ä¸­ host èŠ‚ç‚¹</li>
<li>.contains(nodeOrNodes) =&gt; Boolean</li>
<li>.containsMatchingElement(node) =&gt; Boolean</li>
<li>.containsAllMatchingElements(nodes) =&gt; Boolean</li>
<li>.containsAnyMatchingElements(nodes) =&gt; Boolean</li>
<li>.equals(node) =&gt; Boolean</li>
<li>.matchesElement(node) =&gt; Boolean</li>
<li>.hasClass(className) =&gt; Boolean</li>
<li>.is(selector) =&gt; Boolean</li>
<li>.exists() =&gt; Boolean</li>
<li>.isEmpty() =&gt; Boolean</li>
<li>.isEmptyRender() =&gt; Boolean</li>
<li>.not(selector) =&gt; Wrapper</li>
<li>.children() =&gt; Wrapper</li>
<li>.childAt(index) =&gt; Wrapper</li>
<li>.parents() =&gt; Wrapper</li>
<li>.parent() =&gt; Wrapper</li>
<li>.closest(selector) =&gt; Wrapper</li>
<li>.shallow([options]) =&gt; Wrapperï¼ŒShallowWrapper ç‹¬æœ‰</li>
<li>.render() =&gt; CheerioWrapper</li>
<li>.unmount() =&gt; Wrapperã€‚ReactWrapper ç‹¬æœ‰ .mount() =&gt; Wrapper æ–¹æ³•</li>
<li>.text() =&gt; String</li>
<li>.html() =&gt; String</li>
<li>.get(index) =&gt; ReactElement</li>
<li>.getElement() =&gt; ReactElementã€‚ReactWrapper ä¸­ä¸º .getNode() =&gt; ReactElement æ–¹æ³•</li>
<li>.getElements() =&gt; Array<reactelement>ã€‚ReactWrapper ä¸­ä¸º .getNodes() =&gt; Array<reactelement> æ–¹æ³•ã€‚ReactWrapper ç‹¬æœ‰ .getDOMNode() =&gt; DOMComponent æ–¹æ³•ã€‚</reactelement></reactelement></li>
<li>.at(index) =&gt; Wrapper</li>
<li>.first() =&gt; Wrapper</li>
<li>.last() =&gt; Wrapper</li>
<li>.state([key]) =&gt; Any</li>
<li>.context([key]) =&gt; Any</li>
<li>.props() =&gt; Object</li>
<li>.prop(key) =&gt; Any</li>
<li>.key() =&gt; String</li>
<li>.simulate(event[, data]) =&gt; Wrapperï¼Œæ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ç­‰</li>
<li>.setState(nextState) =&gt; Wrapper</li>
<li>.setProps(nextProps) =&gt; Wrapper</li>
<li>.setContext(context) =&gt; Wrapper</li>
<li>.instance() =&gt; ReactComponent</li>
<li>.update() =&gt; Wrapperï¼Œè°ƒç”¨ forceUpdate æ–¹æ³•å¼ºåˆ¶æ›´æ–°ç»„ä»¶å®ä¾‹ã€‚è°ƒç”¨å®ä¾‹æ–¹æ³•åï¼Œéœ€è¦è°ƒç”¨ .update å¼ºåˆ¶åˆ·æ–° propsã€‚</li>
<li>.debug() =&gt; Stringï¼Œ.children è¿”å›å·²æ¸²æŸ“çš„èŠ‚ç‚¹ï¼Œ.children().debug() è¿”å›æ¸²æŸ“å®é™…é…ç½®æ ¼å¼</li>
<li>.type() =&gt; String|Function|null</li>
<li>.name() =&gt; String</li>
<li>.forEach(fn) =&gt; Wrapper</li>
<li>.map(fn) =&gt; Array</li>
<li>.reduce(fn[, initialValue]) =&gt; Any</li>
<li>.reduceRight(fn[, initialValue]) =&gt; Any</li>
<li>.slice([begin[, end]]) =&gt; Wrapper</li>
<li>.tap(intercepter) =&gt; Self</li>
<li>.some(selector) =&gt; Boolean</li>
<li>.someWhere(predicate) =&gt; Boolean</li>
<li>.every(selector) =&gt; Boolean</li>
<li>.everyWhere(predicate) =&gt; Boolean</li>
<li>.dive([options]) =&gt; Wrapperï¼ŒShallowWrapper ç‹¬æœ‰</li>
<li>.ref(refName) =&gt; Wrapperï¼ŒReactWrapper ç‹¬æœ‰</li>
<li>.detach() =&gt; voidï¼ŒReactWrapper ç‹¬æœ‰</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/10/storybookä½¿ç”¨æŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/10/storybookä½¿ç”¨æŒ‡å—/" itemprop="url">storybookä½¿ç”¨æŒ‡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-10T20:44:57+08:00">2018-02-10</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/10/storybookä½¿ç”¨æŒ‡å—/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/10/storybookä½¿ç”¨æŒ‡å—/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>storybook åœ¨åº”ç”¨ä¹‹å¤–ï¼Œä¸º UI ç»„ä»¶æä¾›äº†ç‹¬ç«‹çš„å¼€å‘ã€è°ƒè¯•ç¯å¢ƒã€‚react-transition-group ç±»åº“çš„æµ‹è¯•å·¥ä½œå³é€šè¿‡ storybook å®ç°ã€‚</p>
<p>storybook æ”¯æŒè°ƒè¯• react, vue, angular, react-native ç»„ä»¶ã€‚<a href="https://storybook.js.org/" target="_blank" rel="noopener">storybookå®˜ç½‘</a></p>
<h2 id="æ“ä½œæŒ‡å—"><a href="#æ“ä½œæŒ‡å—" class="headerlink" title="æ“ä½œæŒ‡å—"></a>æ“ä½œæŒ‡å—</h2><ol>
<li>å…¨å±€å®‰è£… @storybook/cli</li>
<li>é¡¹ç›®ç›®å½•å®‰è£…ä¾èµ–ï¼šreact é¡¹ç›®ä¸º @storybook/reactï¼Œvue é¡¹ç›®ä¸º @storybook/vueï¼Œangular é¡¹ç›®ä¸º @storybook/angularã€‚åŒæ—¶éœ€è¦å®‰è£… babel-coreã€‚</li>
<li><p>package.json æ·»åŠ </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// -h é€‰é¡¹ æŒ‡å®šä»¥ 127.0.0.1 ä½œä¸ºä¸»æœº</span><br><span class="line">// -p é€‰é¡¹ æŒ‡å®šä»¥ 9001 ä½œä¸ºç«¯å£å·</span><br><span class="line">// -s é€‰é¡¹ æŒ‡å®š public ä½œä¸ºä¸ºé™æ€æ–‡ä»¶ç›®å½•</span><br><span class="line">// -c é€‰é¡¹ æŒ‡å®šä»¥ .storybook ä½œä¸ºé…ç½®ç›®å½•</span><br><span class="line">// -o é€‰é¡¹ æŒ‡å®šä»¥ .out ä½œä¸ºæ‰“åŒ…æ–‡ä»¶ç›®å½•</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"storybook"</span>: <span class="string">"start-storybook -h 127.0.0.1 -p 9001 -s ./public -c .storybook"</span>,</span><br><span class="line">    <span class="attr">"build:storybook"</span>: <span class="string">"build-storybook -s ./public -c .storybook -o .out"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºé…ç½®æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .storybook/config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadStories</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'../stories/index.js'</span>);</span><br><span class="line">  <span class="comment">// You can require as many stories as you need.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configure(loadStories, <span class="built_in">module</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–å†™ storyã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stories/index.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; action &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'../components/Button'</span>;<span class="comment">// æ¥è‡ªäºå·¥ç¨‹ç›®å½•</span></span><br><span class="line"></span><br><span class="line">storiesOf(<span class="string">'Button'</span>, <span class="built_in">module</span>)</span><br><span class="line">  .add(<span class="string">'with text'</span>, () =&gt; (</span><br><span class="line">    &lt;Button onClick=&#123;action(<span class="string">'clicked'</span>)&#125;&gt;Hello Button&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">  ))</span></span><br><span class="line"><span class="regexp">  .add('with some emoji', () =&gt; (</span></span><br><span class="line"><span class="regexp">    &lt;Button onClick=&#123;action('clicked')&#125;&gt;ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯&lt;/</span>Button&gt;</span><br><span class="line">  ));</span><br></pre></td></tr></table></figure>
</li>
<li><p>npm run storybookï¼Œå°†åœ¨ 9001 ç«¯å£å¯åŠ¨æœåŠ¡ï¼ŒButton æŒ‰é’®ä¸‹æœ‰ with text, with some emoji ä¸¤ä¸ª storyã€‚</p>
</li>
<li>npm run build:storybookï¼Œæ‰“åŒ…è¾“å‡ºé™æ€æ–‡ä»¶ã€‚é€šè¿‡ storybook-deployer å·¥å…·å¯ä»¥å°†é™æ€æ–‡ä»¶å‘å¸ƒåˆ° github ä¸Šï¼Œæˆ–è€…é€šè¿‡ build-storybook å‘½ä»¤å°†æ–‡ä»¶æ‰“åŒ…åˆ° docs ç›®å½•ä¸­ï¼Œä½œä¸º github pages çš„æ ¹ç›®å½•ã€‚</li>
</ol>
<h3 id="è´´ç¤º"><a href="#è´´ç¤º" class="headerlink" title="è´´ç¤º"></a>è´´ç¤º</h3><ol>
<li><p>storybook å†…éƒ¨é›†æˆ webpackï¼Œé€šè¿‡ babel ç¼–è¯‘ jsï¼Œ.babelrc æ–‡ä»¶å¯æ›¿ä»£ storybook çš„é»˜è®¤é…ç½®ï¼›æ”¯æŒ css, json, å›¾ç‰‡ç­‰é™æ€æ–‡ä»¶çš„åŠ è½½ã€‚<br>è‡ªå®šä¹‰ webpack é…ç½®é€šè¿‡åœ¨ .storybook ç›®å½•ä¸­æ·»åŠ  webpack.config.js å®ç°ï¼Œå¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é™¤äº† babel-loader å¤–ï¼Œé»˜è®¤é…ç½®ä¸­çš„å…¶ä½™åŠ è½½å™¨å…¨éƒ¨åœç”¨</span></span><br><span class="line"><span class="comment">// è¿™ç§é…ç½®æ–¹å¼ä¸èƒ½ç”¨äºé…ç½® babel-loaderï¼ˆç¬¬ä¸€ä¸ªåŠ è½½å™¨ï¼‰, entry, output</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        loaders: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>],</span><br><span class="line">        include: path.resolve(__dirname, <span class="string">'../'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line"><span class="comment">// è¿™ç§é…ç½®æ–¹å¼ä¸èƒ½ç”¨äºæ›¿æ¢ babel-loaderï¼ˆç¬¬ä¸€ä¸ªåŠ è½½å™¨ï¼‰, entry, outputï¼Œæ‰€æœ‰å·²å­˜åœ¨çš„æ’ä»¶</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">storybookBaseConfig, configType, defaultConfig</span>) =&gt;</span> &#123;</span><br><span class="line">  storybookBaseConfig.module.rules.push(&#123;</span><br><span class="line">    test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">    loaders: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>],</span><br><span class="line">    include: path.resolve(__dirname, <span class="string">'../'</span>)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> storybookBaseConfig;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>htmlï¼Œhead å¤´éƒ¨æ·»åŠ æ ‡ç­¾ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// .storybook/preview-head.html é…ç½®æ–‡ä»¶å°†å¦‚ä¸‹æ ‡ç­¾æ³¨å…¥åˆ°æ¸²æŸ“å¯¼å…¥ç»„ä»¶çš„ iframe ä¸­ï¼Œä¸å½±å“ storybook ä¸»ç•Œé¢</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://use.typekit.net/xxxyyy.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">try</span>&#123; Typekit.load(); &#125; <span class="keyword">catch</span>(e)&#123; &#125;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// .storybook/preview-head.html é…ç½®æ–‡ä»¶ï¼Œå°†å½±å“ storybook ä¸»ç•Œé¢</span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡è®¿é—® <a href="http://localhost:9009/iframe.html?selectedKind=Button&amp;selectedStory=with+text&amp;dataId=0" target="_blank" rel="noopener">http://localhost:9009/iframe.html?selectedKind=Button&amp;selectedStory=with+text&amp;dataId=0</a> å¯ä»¥è®¿é—® Button ä¸‹çš„ with text è¿™ä¸ª storyï¼Œæµè§ˆå™¨æ˜¾ç¤ºå°†ä¸å¸¦å·¦è¾¹æ ã€‚</p>
</li>
</ol>
<h2 id="è¾…åŠ©æµ‹è¯•"><a href="#è¾…åŠ©æµ‹è¯•" class="headerlink" title="è¾…åŠ©æµ‹è¯•"></a>è¾…åŠ©æµ‹è¯•</h2><h3 id="Structural-Testing"><a href="#Structural-Testing" class="headerlink" title="Structural Testing"></a>Structural Testing</h3><p>Structural Testing ç»“æ„æµ‹è¯•çš„ç›®çš„æ˜¯åˆ¤æ–­é¡µé¢å…ƒç´ æ˜¯å¦å¼‚å¸¸ï¼Œç¼ºå¤±æˆ–å¢åŠ ç­‰ã€‚</p>
<p>åœ¨ storybook ä¸­ï¼Œå€ŸåŠ© <a href="https://facebook.github.io/jest/blog/2016/07/27/jest-14.html" target="_blank" rel="noopener">Jestâ€™s snapshot testing</a> å®ç°ç»“æ„æµ‹è¯•ã€‚é’ˆå¯¹ reactï¼ŒJest å°†ä¸ºè™šæ‹Ÿ DOM æ‹æ‘„å¿«ç…§ï¼Œå°†å…¶è½¬åŒ–ä¸º json æ•°æ®ï¼Œåœ¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶æ¯”å¯¹ä¸¤å¼ å¿«ç…§æ˜¯å¦æœ‰åå·®ã€‚</p>
<p>å…·ä½“æ­¥éª¤ä¸ºï¼š</p>
<ol>
<li>å®‰è£… @storybook/addon-storyshots æ’ä»¶ã€‚</li>
<li><p>ç¼–å†™ storyshots.test.js æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> initStoryshots <span class="keyword">from</span> <span class="string">'@storybook/addon-storyshots'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getStorybook() å‡½æ•°è·å–æ‰€æœ‰ story</span></span><br><span class="line">initStoryshots(&#123; <span class="comment">/* configuration options */</span> &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰§è¡Œ storyshots.test.js è„šæœ¬ï¼Œå¯ç”¨äºæµ‹è¯•ç»„ä»¶é€»è¾‘æ˜¯å¦å´©ç›˜ã€‚</p>
</li>
</ol>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="http://onetwo.ren/ReactStorybook%E7%9A%84%E5%90%84%E7%A7%8D%E6%95%85%E4%BA%8B/" target="_blank" rel="noopener">ReactStorybook çš„å„ç§æ•…äº‹</a></p>
<h3 id="interaction-testing"><a href="#interaction-testing" class="headerlink" title="interaction testing"></a>interaction testing</h3><p>å…³äº interaction testing äº¤äº’æµ‹è¯•ï¼Œå¯ä»¥é€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥ï¼Œåœ¨ <a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener">Enzyme</a> æµ‹è¯•æ¡†æ¶ Jest, Mocha å®ç°ã€‚</p>
<p>åœ¨ storybook ä¸­ï¼Œäº¤äº’æµ‹è¯•å¯é€šè¿‡ <a href="https://github.com/mthuret/storybook-addon-specifications" target="_blank" rel="noopener">storybook-addon-specifications</a> æ’ä»¶å®ç°ã€‚</p>
<p>å…·ä½“æ­¥éª¤ä¸ºï¼š</p>
<ol>
<li>å®‰è£… storybook-addon-specifications æ’ä»¶ã€‚</li>
<li><p>ç¼–å†™ .storybook/addons.js é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'storybook-addon-specifications/register'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ·»åŠ æµ‹è¯•æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@kadira/storybook'</span></span><br><span class="line"><span class="keyword">import</span> &#123; specs, describe, it &#125; <span class="keyword">from</span> <span class="string">'storybook-addon-specifications'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;mount&#125; <span class="keyword">from</span> <span class="string">"enzyme"</span>;</span><br><span class="line"><span class="keyword">import</span> expect <span class="keyword">from</span> <span class="string">"expect"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stories = storiesOf(<span class="string">'Button'</span>, <span class="built_in">module</span>);</span><br><span class="line"></span><br><span class="line">stories.add(<span class="string">'Hello World'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> story =</span><br><span class="line">    &lt;button onClick=&#123;action(<span class="string">'Hello World'</span>)&#125;&gt;</span><br><span class="line">      Hello World</span><br><span class="line">    &lt;<span class="regexp">/button&gt;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ describe é¦–å‚å¿…é¡»ä¸ story åå­—ç›¸åŒ</span></span><br><span class="line"><span class="regexp">  specs(() =&gt; describe('Hello World', function () &#123;</span></span><br><span class="line"><span class="regexp">    it('Should have the Hello World label', function () &#123;</span></span><br><span class="line"><span class="regexp">      let output = mount(story);</span></span><br><span class="line"><span class="regexp">      expect(output.text()).toContain('Hello World');</span></span><br><span class="line"><span class="regexp">    &#125;);</span></span><br><span class="line"><span class="regexp">  &#125;));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return story;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><h3 id="ä½¿ç”¨æ’ä»¶"><a href="#ä½¿ç”¨æ’ä»¶" class="headerlink" title="ä½¿ç”¨æ’ä»¶"></a>ä½¿ç”¨æ’ä»¶</h3><p>åœ¨ storybook ä¸­ï¼Œæ’ä»¶åˆ†ä¸ºä¸¤ç±»ï¼Œè£…é¥°å™¨ Decoratorï¼ˆé€šè¿‡å°è£… react ç»„ä»¶å®ç°ï¼Œå¦‚ storybook-routerï¼‰ æˆ– ä»¥é¢æ¿å½¢å¼æ³¨å…¥çš„ Native Addonï¼ˆå¦‚ addon-actionsï¼‰ã€‚</p>
<ol>
<li><p>æ·»åŠ  .storybook/addons.js é…ç½®æ–‡ä»¶ç”¨äºå‘é¡µé¢æ·»åŠ å³ä¸‹æ–¹æ’ä»¶é¢æ¿ã€‚å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'@storybook/addon-actions/register'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'@storybook/addon-links/register'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'@storybook/addon-notes/register'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–å†™ stroy</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; action &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; WithNotes &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-notes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'./Button'</span>;</span><br><span class="line"></span><br><span class="line">storiesOf(<span class="string">'Button'</span>, <span class="built_in">module</span>)</span><br><span class="line">  .add(<span class="string">'with some emoji'</span>, () =&gt; (</span><br><span class="line">    &lt;WithNotes notes=&#123;<span class="string">'Here we use some emoji as the Button text. Doesn&amp;apos;t it look nice?'</span>&#125;&gt;</span><br><span class="line">      &lt;Button onClick=&#123;action(<span class="string">'clicked'</span>)&#125;&gt;ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>WithNotes&gt;</span><br><span class="line">  ));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è£…é¥°å™¨ 1</span></span><br><span class="line"><span class="keyword">import</span> &#123; storiesOf &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; action &#125; <span class="keyword">from</span> <span class="string">'@storybook/addon-actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'./button'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> styles = &#123;</span><br><span class="line">  textAlign: <span class="string">'center'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> CenterDecorator = <span class="function">(<span class="params">storyFn</span>) =&gt;</span> (</span><br><span class="line">  &lt;div style=&#123;styles&#125;&gt;</span><br><span class="line">    &#123; storyFn() &#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">storiesOf('Button', module)</span></span><br><span class="line"><span class="regexp">  .addDecorator(CenterDecorator)</span></span><br><span class="line"><span class="regexp">  .add('with text', () =&gt; (</span></span><br><span class="line"><span class="regexp">    &lt;Button onClick=&#123;action('clicked')&#125;&gt;Hello Button&lt;/</span>Button&gt;</span><br><span class="line">  ))</span><br><span class="line">  .add(<span class="string">'with some emojies'</span>, () =&gt; (</span><br><span class="line">    &lt;Button onClick=&#123;action(<span class="string">'clicked'</span>)&#125;&gt;ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">  ));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ä½¿ç”¨è£…é¥°å™¨ 2</span></span><br><span class="line"><span class="regexp">import &#123; storiesOf, addDecorator &#125; from '@storybook/</span>react<span class="string">';</span></span><br><span class="line"><span class="string">import &#123; action &#125; from '</span>@storybook/addon-actions<span class="string">';</span></span><br><span class="line"><span class="string">import &#123; linkTo &#125; from '</span>@storybook/addon-links<span class="string">';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import Button from '</span>./button<span class="string">';</span></span><br><span class="line"><span class="string">import Welcome from '</span>./welcome<span class="string">';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const styles = &#123;</span></span><br><span class="line"><span class="string">  textAlign: '</span>center<span class="string">',</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">const CenterDecorator = (storyFn) =&gt; (</span></span><br><span class="line"><span class="string">  &lt;div style=&#123;styles&#125;&gt;</span></span><br><span class="line"><span class="string">    &#123; storyFn() &#125;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">addDecorator(CenterDecorator);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">storiesOf('</span>Welcome<span class="string">', module)</span></span><br><span class="line"><span class="string">  .add('</span>to Storybook<span class="string">', () =&gt; (</span></span><br><span class="line"><span class="string">    &lt;Welcome showApp=&#123;linkTo('</span>Button<span class="string">')&#125;/&gt;</span></span><br><span class="line"><span class="string">  ));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">storiesOf('</span>Button<span class="string">', module)</span></span><br><span class="line"><span class="string">  .add('</span><span class="keyword">with</span> text<span class="string">', () =&gt; (</span></span><br><span class="line"><span class="string">    &lt;Button onClick=&#123;action('</span>clicked<span class="string">')&#125;&gt;Hello Button&lt;/Button&gt;</span></span><br><span class="line"><span class="string">  ))</span></span><br><span class="line"><span class="string">  .add('</span><span class="keyword">with</span> some emojies<span class="string">', () =&gt; (</span></span><br><span class="line"><span class="string">    &lt;Button onClick=&#123;action('</span>clicked<span class="string">')&#125;&gt;ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯&lt;/Button&gt;</span></span><br><span class="line"><span class="string">  ));</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="æ’ä»¶æ¸…å•"><a href="#æ’ä»¶æ¸…å•" class="headerlink" title="æ’ä»¶æ¸…å•"></a>æ’ä»¶æ¸…å•</h3><ol>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/storyshots" target="_blank" rel="noopener">Storyshots</a>: å¿«ç…§æµ‹è¯•ã€‚</li>
<li><a href="https://github.com/mthuret/storybook-addon-specifications" target="_blank" rel="noopener">Specs</a>: äº¤äº’æµ‹è¯•ã€‚</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/notes" target="_blank" rel="noopener">Notes</a>: åœ¨ story ä¸­æ·»åŠ å¤‡æ³¨ã€‚</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/info" target="_blank" rel="noopener">Info</a>: ç”¨äºåˆ›å»º css æ¡†æ¶æ‰‹å†Œã€‚</li>
<li><a href="https://github.com/tuchk4/storybook-readme" target="_blank" rel="noopener">Readme</a>: å°† markdown å¯¼å…¥ä¸º storyã€‚</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/actions" target="_blank" rel="noopener">actions</a>: æ˜¾ç¤ºäº‹ä»¶çš„ event å¯¹è±¡ã€‚</li>
<li><a href="https://github.com/truffls/storybook-addon-intl" target="_blank" rel="noopener">Intl</a>: æ·»åŠ  locales é¢æ¿ï¼Œç”¨äºåˆ‡æ¢è¯­è¨€ã€‚</li>
<li><a href="https://github.com/Sambego/storybook-state" target="_blank" rel="noopener">State</a>: æ·»åŠ  state é¢æ¿ï¼Œå±•ç¤ºæˆ–æ›´æ–° stateï¼Œé‡ç»˜è§†å›¾ã€‚</li>
<li><a href="https://github.com/evgenykochetkov/react-storybook-addon-props-combinations" target="_blank" rel="noopener">Props Combinations</a>: é…ç½®å¯èƒ½æœ‰çš„propsï¼Œä¸€æ¬¡æ€§ç»˜å‡ºå¤šä¸ªç»„ä»¶ä½œå¯¹æ¯”ã€‚</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/knobs" target="_blank" rel="noopener">Knobs</a>: é¡µé¢ä¸Šå˜æ›´ props é‡ç»˜è§†å›¾ã€‚</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/links" target="_blank" rel="noopener">Links</a>: é€šè¿‡ linkTo å‡½æ•°æˆ– LinkTo ç»„ä»¶é“¾æ¥å¤šä¸ª storyï¼Œæ”¯æŒç‚¹å‡»è·³è½¬ã€‚</li>
<li><a href="https://github.com/gvaldambrini/storybook-router" target="_blank" rel="noopener">Story-router</a>: è£…é¥°å™¨ï¼Œæ”¯æŒ storybook ä½¿ç”¨ react-router ç­‰è·¯ç”±ç»„ä»¶ã€‚</li>
<li><a href="https://github.com/storybook-eol/addon-backgrounds" target="_blank" rel="noopener">Backgrounds</a>: åˆ‡æ¢èƒŒæ™¯å›¾æˆ–èƒŒæ™¯é¢œè‰²ã€‚</li>
<li><a href="https://github.com/joscha/storybook-addon-i18n-tools" target="_blank" rel="noopener">i18n tools</a>: åˆ‡æ¢æ–‡å­—å¯¹é½æ–¹å¼ï¼Œå·¦å¯¹é½æˆ–å³å¯¹é½ã€‚</li>
<li><a href="https://github.com/react-theming/storybook-addon-material-ui" target="_blank" rel="noopener">Material-UI</a>: æ·»åŠ å¹¶åˆ‡æ¢è‡ªå®šä¹‰ä¸»é¢˜ã€‚</li>
<li><a href="https://github.com/philcockfield/storybook-host" target="_blank" rel="noopener">Host</a>: è£…é¥°å™¨ï¼Œåœ¨é¡µé¢ä¸Šä»¥ç›’æ¨¡å¼å±•ç¤ºç»„ä»¶ã€‚</li>
<li><a href="https://github.com/Checkfront/react-storybook-addon-chapters" target="_blank" rel="noopener">Chapters</a>: åœ¨åŒä¸€ä¸ª story ä¸­ä»¥ç« èŠ‚å½¢å¼å±•ç¤ºå¤šä¸ªç»„ä»¶ã€‚</li>
<li><a href="https://github.com/storybooks/storybook/tree/master/addons/options" target="_blank" rel="noopener">Options</a>: è°ƒæ•´ storybook é¡µé¢å¤–è§‚ï¼Œåˆ‡æ¢ä¸ºå…¨å±ç­‰ã€‚</li>
<li><a href="https://github.com/storybooks/storybook-addon-console" target="_blank" rel="noopener">Console</a>: å°†æµè§ˆå™¨æ§åˆ¶å° console ä¿¡æ¯è¾“å‡ºåˆ° storybook log é¢æ¿ã€‚</li>
<li><a href="https://github.com/storybooks/addon-jsx" target="_blank" rel="noopener">JSX preview</a>: å±•ç¤ºåŠæ‹·è´ JSX ä»£ç ã€‚</li>
<li><a href="https://github.com/buildit/storybook-addon-versions" target="_blank" rel="noopener">Versions</a>: æ·»åŠ ç‰ˆæœ¬å·ï¼ŒæŸ¥çœ‹å„ç‰ˆæœ¬çš„å˜åŒ–ã€‚</li>
<li><a href="https://github.com/abhiaiyer91/apollo-storybook-decorator" target="_blank" rel="noopener">Apollo</a>: æ·»åŠ  Apollo clientï¼Œæ¨¡æ‹Ÿ GraphQL æŸ¥è¯¢ã€‚</li>
<li><a href="https://github.com/tsuyoshiwada/storybook-chrome-screenshot" target="_blank" rel="noopener">Screenshot</a>: ä¿å­˜ç½‘é¡µæˆªå›¾ã€‚</li>
<li><a href="https://storybook.js.org/addons/addon-gallery/" target="_blank" rel="noopener">Styles</a>: storybook é¢„è§ˆç•Œé¢æ·»åŠ è‡ªå®šä¹‰æ ·å¼ã€‚</li>
<li><a href="https://github.com/hharnisc/storybook-addon-figma" target="_blank" rel="noopener">Figma</a>: æ·»åŠ  Figma è®¾è®¡é¢æ¿ã€‚</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/07/æµ…æreact-transition-groupæºç /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/07/æµ…æreact-transition-groupæºç /" itemprop="url">æµ…æreact-transition-groupæºç </a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-07T23:19:17+08:00">2018-02-07</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/react/" itemprop="url" rel="index"><span itemprop="name">react</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/07/æµ…æreact-transition-groupæºç /#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/07/æµ…æreact-transition-groupæºç /" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="react-transition-group-1-ç‰ˆæœ¬å›é¡¾"><a href="#react-transition-group-1-ç‰ˆæœ¬å›é¡¾" class="headerlink" title="react-transition-group 1 ç‰ˆæœ¬å›é¡¾"></a>react-transition-group 1 ç‰ˆæœ¬å›é¡¾</h2><p>react-transition-group 1 ç‰ˆæœ¬åœ¨å­ç»„ä»¶åˆ›å»ºã€åˆ é™¤è¿‡ç¨‹é€šè¿‡æ·»åŠ  class æ§åˆ¶ css åŠ¨æ•ˆã€‚</p>
<p>ä»‹äº css transition åŠ¨æ•ˆåœ¨å…ƒç´ æ·»åŠ åˆ°é¡µé¢è¿‡ç¨‹å°±ä¼šæ‰§è¡Œï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹æ— éœ€è°ƒæ§åŠ¨æ•ˆçš„æ‰§è¡Œã€‚è€Œå½“æœ‰å…ƒç´ è¢«ç§»é™¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®¹å™¨ç»„ä»¶é©»ç•™è¢«åˆ é™¤çš„å­ç»„ä»¶ï¼Œç­‰åˆ°åŠ¨æ•ˆæ‰§è¡Œå®Œæˆåï¼Œæ‰å®é™…åˆ é™¤è¯¥å­ç»„ä»¶ã€‚</p>
<p>é’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œreact-transition-group æä¾›äº† TransitionGroup å®¹å™¨ç»„ä»¶ã€‚å…¶ state.children å±æ€§ä¸ºå®é™…å¾…ç»˜åˆ¶çš„ç»„ä»¶ï¼Œå½“ç»„ä»¶æ›´æ–°æ—¶ï¼Œé€šè¿‡æ¯”å¯¹ state.children, props.childrenï¼Œå°±å¯ä»¥è·çŸ¥æ–°å¢äº†å“ªäº›ç»„ä»¶ã€ç§»é™¤äº†å“ªäº›ç»„ä»¶ï¼ˆç”¨æˆ·é…ç½®çš„å­ç»„ä»¶é€šè¿‡ key é”®å­˜å‚¨æˆæ˜ å°„ç»“æ„ï¼‰ã€‚å½“å­ç»„ä»¶è¢«ç§»é™¤æ—¶ï¼Œè§¦å‘ performLeave æ–¹æ³•ï¼Œä»¥è°ƒç”¨å­ç»„ä»¶çš„ componentWillLeave æ–¹æ³•æ·»åŠ æ ·å¼ç±»ã€æ‰§è¡ŒåŠ¨æ•ˆï¼›å†é€šè¿‡ componentWillLeave æ–¹æ³•çš„å›è°ƒå‡½æ•°ï¼Œæ›´æ–° TransitionGroup å®¹å™¨çš„ state.childrenï¼Œè§¦å‘å­ç»„ä»¶çš„å®é™…ç§»é™¤è¡Œä¸ºã€‚</p>
<p>å½“é‡‡ç”¨ä¸Šè¿°é€»è¾‘å¤„ç†å­ç»„ä»¶çš„ç§»é™¤åŠ¨æ•ˆæ—¶ï¼Œä¸ºç€å¤„ç†é€»è¾‘çš„ç»Ÿä¸€ï¼Œreact-transition-group é’ˆå¯¹ componentDidMount æˆ– componentDidUpdate æ—¶åˆ›å»ºçš„å­ç»„ä»¶ä¹Ÿé‡‡ç”¨ç›¸åŒçš„å¤„ç†é€»è¾‘ã€‚å­ç»„ä»¶çš„é’©å­å‡½æ•° componentWillAppear, componentDidAppear, componentWillEnter, componentDidEnter, componentWillLeave, componentDidLeave å°†åˆ†åˆ«å¾—åˆ°æ‰§è¡Œã€‚å½“ç‹¬ç«‹ä½¿ç”¨  TransitionGroup å®¹å™¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™äº›é’©å­å‡½æ•°æ“æ§èŠ‚ç‚¹çš„æ ·å¼ä»¥è§¦å‘ css åŠ¨æ•ˆï¼Œæˆ–è€…ç»„ç»‡ js åŠ¨æ•ˆï¼Œæˆ–è€…å®ç°æ‡’åŠ è½½ç­‰ç­‰ã€‚</p>
<p>åœ¨ TransitionGroup å®¹å™¨çš„åŸºç¡€ä¸Šï¼ŒCSSTransitionGroupChild ç»„ä»¶ç”¨äºè£…é¥°å­ç»„ä»¶ï¼Œåœ¨ componentWillAppear ç­‰é’©å­å‡½æ•°æ·»åŠ æ ·å¼ç±»ä»¥æ‰§è¡Œ css åŠ¨æ•ˆï¼Œé€šè¿‡ setTimeout æˆ– transitionEnd äº‹ä»¶æ›´æ–° TransitionGroup å®¹å™¨çš„ state.children å±æ€§ã€‚CSSTransitionGroup ç»„ä»¶ç”¨äºå°† props é…ç½®ä¸Šæï¼Œè€Œä¸æ˜¯é€šè¿‡ CSSTransitionGroupChild ç»™æ¯ä¸ªå­ç»„ä»¶å¤–åŠ ä¸€ä¸ªå£³å­ã€‚</p>
<h2 id="react-transition-group-2-ç‰ˆæœ¬"><a href="#react-transition-group-2-ç‰ˆæœ¬" class="headerlink" title="react-transition-group 2 ç‰ˆæœ¬"></a>react-transition-group 2 ç‰ˆæœ¬</h2><h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p>ç›¸æ¯”äº 1 ç‰ˆæœ¬é€šè¿‡åˆ¤æ–­å­ç»„ä»¶çš„æœ‰æ— æ·»åŠ åŠ¨æ•ˆï¼Œreact-transition-group 2 ç‰ˆæœ¬å¯é€šè¿‡å‘å­ç»„ä»¶ä¼ é€’çŠ¶æ€å€¼ï¼ˆprops.children ä»¥å‡½æ•°å½¢å¼é…ç½®ï¼›è‹¥ä¸ºReactElementï¼Œåˆ™æ— ä»»ä½•ä½œç”¨ï¼‰æ§åˆ¶å­ç»„ä»¶çš„åˆ›å»ºå’Œåˆ é™¤è¿‡ç¨‹ï¼Œè¿™ä¸€ç‚¹å’Œ react-motion ç±»åº“ç›¸ä»¿ã€‚å…³äº react-motionï¼Œç¬”è€…å°†åœ¨åç»­æ–‡ç« ä¸­åŠ ä»¥åˆ†æã€‚</p>
<p>ä¸Šè¿°æ€è·¯çš„ç®€å•å®ç°æ˜¯é€šè¿‡å®¹å™¨ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’ props.statusï¼Œç”¨äºåˆ¤æ–­åŠ¨æ•ˆæ˜¯åœ¨æ‰§è¡Œä¸­ transitionExcuteï¼Œè¿˜æ˜¯æ‰§è¡Œå®Œæˆ transitionEndã€‚è‹¥æ‰§è¡Œå®Œæˆï¼Œå°†è§¦å‘ç§»é™¤ç»„ä»¶çš„æ“ä½œã€‚ä¸ºæ­¤ï¼Œreact-transition-group 2 æä¾›äº† Transition å®¹å™¨ç»„ä»¶ï¼Œprops.status çŠ¶æ€åˆ†åˆ«åœ¨å­ç»„ä»¶åˆ›å»ºå’Œç§»é™¤é˜¶æ®µæ·»ç½®äº†ä¸¤ä¸ªå€¼ï¼Œåˆè®¡å››ç§çŠ¶æ€ï¼Œå³ ENTERING, ENTERED, EXITING, EXITED ã€‚ENTERING, ENTERED çŠ¶æ€é’ˆå¯¹æ–°åˆ›å»ºçš„å­ç»„ä»¶ï¼ŒEXITING, EXITED çŠ¶æ€é’ˆå¯¹å¾…ç§»é™¤çš„å­ç»„ä»¶ã€‚Transition ç»„ä»¶å†…éƒ¨å®ç°çš„ä¸»è¦ä¸šåŠ¡é€»è¾‘å°±æ˜¯åè°ƒ ENTERING åˆ° ENTEREDï¼ŒEXITING åˆ° EXITED çŠ¶æ€çš„è‡ªåŠ¨å˜æ›´ã€‚å¯¹äºä¸éœ€è¦åŠ¨æ•ˆçš„åœºæ™¯ï¼ŒçŠ¶æ€å°†ç›´æ¥ç½®ä¸º ENTERED, EXITEDï¼›åœ¨ Transition ç»„ä»¶ä¸­ï¼Œä½œä¸ºåŠ¨æ•ˆå¼€å…³çš„æ˜¯ props.appear, props.enter, props.exit å±æ€§ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæœ‰å¿…è¦åŒºåˆ†ç»„ä»¶åœ¨åˆ›å»ºè¿‡ç¨‹ onEnter è¿˜æ˜¯åœ¨ç§»é™¤è¿‡ç¨‹ onExitï¼Œä»¥ä¾¿äºæ§åˆ¶ç»„ä»¶çš„æŒ‚è½½çŠ¶æ€ã€‚ç„¶è€Œ onEnter, onExit ä¸¤ä¸ªçŠ¶æ€å€¼ä¸é€‚ç”¨äºåŠ¨æ•ˆç»“æŸæ—¶ä»ä¿ç•™ç»„ä»¶çš„åœºæ™¯ã€‚ä¸ºæ­¤ï¼ŒTransition ç»„ä»¶ä½¿ç”¨ props.in å±æ€§è¡¨ç¤ºç»„ä»¶çš„æ˜¾ç¤ºçŠ¶æ€ï¼Œç»“åˆ props.unmountOnExit å±æ€§å³è¡¨ç¤ºåœ¨åŠ¨æ•ˆæ‰§è¡Œå®Œæˆåï¼Œä¸å¿…ç§»é™¤ç»„ä»¶ã€‚å­ç»„ä»¶ä¸èƒ½é€šè¿‡è·å¾—çš„ status å€¼æ§åˆ¶è‡ªèº«çš„æŒ‚è½½çŠ¶æ€ï¼ŒTransition å®¹å™¨é€šè¿‡å°† status ç½®ä¸º UNMOUNTEDï¼Œå¹¶åœ¨å…¶ render æ–¹æ³•ä¸­è¾“å‡º nullï¼Œä»¥æ§åˆ¶å­ç»„ä»¶çš„æ˜¾éšã€‚è¿™æ ·çš„è®¾è®¡ä¹Ÿæ»¡è¶³äº†å¯¹å­ç»„ä»¶æŒ‚è½½æ—¶æœºçš„å¾®è°ƒã€‚åƒ 1 ç‰ˆæœ¬ä¸­é‚£æ ·ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå­ç»„ä»¶å¾€å¾€è€Œåœ¨ã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶é€šè¿‡å°† props.mountOnEnter å±æ€§ç½®ä¸ºçœŸå€¼ï¼Œä¸” props.in ä¸ºå¦å€¼ï¼Œå­ç»„ä»¶å°†ä¸åœ¨è§†å›¾æ˜¾ç¤ºï¼›å½“æ›´æ–°ç»„ä»¶æ—¶ï¼Œprops.in å±æ€§é¦–æ¬¡åˆ‡æ¢ä¸ºçœŸå€¼æ—¶ï¼Œæ‰å°† status ç½®ä¸º EXITEDï¼Œä»¥ä¾¿åœ¨å®é™…è§†å›¾ä¸­åˆ›å»ºå­ç»„ä»¶ï¼Œä»è€Œå¯åŠ¨åŠ¨æ•ˆã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">  <span class="keyword">super</span>(props, context);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> parentGroup = context.transitionGroup;</span><br><span class="line">  <span class="comment">// In the context of a TransitionGroup all enters are really appears</span></span><br><span class="line">  <span class="keyword">let</span> appear = parentGroup &amp;&amp; !parentGroup.isMounting ?</span><br><span class="line">    props.enter :</span><br><span class="line">    props.appear;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> initialStatus;</span><br><span class="line">  <span class="keyword">this</span>.nextStatus = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (props.in) &#123;<span class="comment">// in ä¸ºçœŸå€¼ï¼Œåˆ›å»ºå¹¶æ˜¾ç¤ºç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (appear) &#123;<span class="comment">// appear ä¸ºçœŸå€¼ï¼Œæ‰§è¡ŒåŠ¨æ•ˆ</span></span><br><span class="line">      initialStatus = EXITED;<span class="comment">// updateStatus æ–¹æ³•ä¸­æ»¡è¶³ initialStatus é null æ ¡éªŒï¼Œä»¥æ‰§è¡Œ performEnter æ–¹æ³•</span></span><br><span class="line">      <span class="keyword">this</span>.nextStatus = ENTERING;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">// appear ä¸ºå¦å€¼ï¼Œä¸æ‰§è¡ŒåŠ¨æ•ˆ</span></span><br><span class="line">      initialStatus = ENTERED;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// mountOnEnter ä¸ºçœŸå€¼ï¼Œæ„å‘³ç€å»¶è¿ŸæŒ‚è½½ï¼›unmountOnExit ä¸ºå¦å€¼çš„æƒ…å½¢ï¼Œä¸»è¦ä¸ºç€é¿è¿‡ updateStatus ä¸­å¯¹ &#123; state: EXITED &#125; çš„å¤„ç†é€»è¾‘ï¼Œå³åŠ¨æ•ˆæ‰§è¡Œç»“æŸåç§»é™¤ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (props.unmountOnExit || props.mountOnEnter) &#123;</span><br><span class="line">      initialStatus = UNMOUNTED;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ‚¬ç©º</span></span><br><span class="line">      initialStatus = EXITED;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.state = &#123; <span class="attr">status</span>: initialStatus &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.nextCallback = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">this</span>.updateStatus(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; status &#125; = <span class="keyword">this</span>.pendingState || <span class="keyword">this</span>.state;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (nextProps.in) &#123;</span><br><span class="line">    <span class="comment">// å­ç»„ä»¶å·²è¢«ç§»é™¤æˆ–åˆå§‹åŒ–æœªè¢«æŒ‚è½½ï¼Œstatus ç½®ä¸º EXITEDï¼Œä¾¿äºæ·»åŠ å­ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (status === UNMOUNTED) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">status</span>: EXITED &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å­ç»„ä»¶å°šæœªåœ¨è§†å›¾ä¸­ï¼Œæ‰§è¡Œæ˜¾ç¤ºåŠ¨æ•ˆ</span></span><br><span class="line">    <span class="keyword">if</span> (status !== ENTERING &amp;&amp; status !== ENTERED) &#123;</span><br><span class="line">      <span class="keyword">this</span>.nextStatus = ENTERING;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å­ç»„ä»¶å·²åœ¨è§†å›¾ä¸­ï¼Œæ‰§è¡Œç§»é™¤åŠ¨æ•ˆ</span></span><br><span class="line">    <span class="keyword">if</span> (status === ENTERING || status === ENTERED) &#123;</span><br><span class="line">      <span class="keyword">this</span>.nextStatus = EXITING;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  <span class="keyword">this</span>.updateStatus();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateStatus(mounting = <span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> nextStatus = <span class="keyword">this</span>.nextStatus;<span class="comment">// åªæœ‰ä¸¤ç§å¯èƒ½ï¼ŒENTERING æˆ– EXITING</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (nextStatus !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.nextStatus = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.cancelNextCallback();</span><br><span class="line">    <span class="keyword">const</span> node = ReactDOM.findDOMNode(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nextStatus === ENTERING) &#123;</span><br><span class="line">      <span class="keyword">this</span>.performEnter(node, mounting);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.performExit(node);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="comment">// åŠ¨æ•ˆæ‰§è¡Œå®Œæˆå state ç½®ä¸º EXITED æ—¶ï¼Œä¸” unmountOnExit ä¸ºçœŸï¼Œç§»é™¤å­ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">this</span>.props.unmountOnExit &amp;&amp;</span><br><span class="line">    <span class="keyword">this</span>.state.status === EXITED</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">status</span>: UNMOUNTED &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆå½“åˆå§‹åŒ–æ—¶ï¼Œprops.in ç½®ä¸ºå¦å€¼ï¼Œå­ç»„ä»¶å°†ä¸äºˆæ¸²æŸ“æˆ–æ¸²æŸ“åæ— åŠ¨æ•ˆï¼›å½“æ›´æ–°æ—¶ç½®ä¸ºå¦å€¼ï¼Œå­ç»„ä»¶å·²åœ¨è§†å›¾ä¸­ï¼Œæ‰§è¡Œ performExit æ–¹æ³•ï¼Œå¥½å¯åŠ¨ exit åŠ¨æ•ˆã€‚ï¼‰</p>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒperformEnter, performExit æ–¹æ³•ç”¨äºæ“æ§å®¹å™¨ç»„ä»¶åœ¨ props.timeout æ—¶é—´åè‡ªåŠ¨ä» ENTERING åˆ‡æ¢åˆ° ENTERED çŠ¶æ€ï¼Œæˆ–è€…ä» EXITING åˆ‡æ¢åˆ° EXITED çŠ¶æ€ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å‡è°ƒç”¨äº† safeSetState æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„æ„ä¹‰æ˜¯è®¾ç½® pendingState å±æ€§ï¼Œä»¥é¿å…åŠ¨æ•ˆçš„å¤šæ¬¡æ‰§è¡Œï¼›ä»¥åŠé€šè¿‡è°ƒç”¨ onTransitionEnd æ–¹æ³•æ‰§è¡Œå˜æ›´ status çš„é€»è¾‘ã€‚onTransitionEnd æ–¹æ³•çš„å»¶è¿Ÿæœºåˆ¶é€šè¿‡ç›‘å¬ transitionEnd äº‹ä»¶ï¼ˆå€ŸåŠ©äº props.addEventLinstener é…ç½®ï¼‰æˆ–è€…ä½¿ç”¨ setTimeout æ‰§è¡Œå›è°ƒå®ç°ï¼Œå˜æ›´ status çŠ¶æ€çš„å›è°ƒé€šè¿‡ setNextCallback æ–¹æ³•å…äºå¤šæ¬¡æ‰§è¡Œã€‚</p>
<p>Transition å®¹å™¨åœ¨æ ¹æ® props.in, props.appear, props.enter, props.exit, props.mountOnEnter, props.unmountOnExit å±æ€§è‡ªåŠ¨å¤„ç† status çŠ¶æ€çš„åŒæ—¶ï¼Œè¿˜è®¾ç½®äº†å¤šä¸ªåœ¨é€‚å½“æ—¶æœºæ‰§è¡Œçš„é’©å­å‡½æ•°ï¼ŒåŒ…å« props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited é…ç½®é¡¹ã€‚</p>
<h3 id="CSSTransition"><a href="#CSSTransition" class="headerlink" title="CSSTransition"></a>CSSTransition</h3><p>åœ¨ react-transition-group 2 ç‰ˆæœ¬å†…éƒ¨ï¼Œprops.onEnter ç­‰é’©å­åœ¨å®ç° CSSTransition ç»„ä»¶æ—¶ææœ‰æ„ä¹‰ã€‚å› ä¸º Transition å®¹å™¨ä¼ ç»™ props.children å‡½æ•°çš„ status åªåŒ…å« enter, exit ç›¸å…³çŠ¶æ€ï¼Œæ²¡æœ‰ appear çŠ¶æ€ã€‚è€Œ onEnter, onEntering, onEntered é’©å­çš„æ¬¡å‚å³ä¸ºæ˜¯å¦åœ¨ appear çŠ¶æ€ä¸­ï¼ˆé€šè¿‡ context.transitionGroup.isMounting æˆ– mounting è·çŸ¥ï¼‰ï¼ŒCSSTransition ç»„ä»¶å³åœ¨æ­¤åŸºç¡€ä¸Šå®ç°ï¼Œé€šè¿‡é’©å­æ›´æ–° props.children å¯¹åº”èŠ‚ç‚¹çš„ classï¼ˆä¾æ¬¡ç”± <em>-appear, </em>-appear-active, <em>-enter, </em>-enter-active, <em>-enter-done, </em>-exit, <em>-exit-active, </em>-exit-done å˜æ›´ï¼Œ* é€šè¿‡ props.classNames è®¾ç½®ï¼Œè¯¥å±æ€§ä¹Ÿè®¾ç½®ä¸ºå¯¹è±¡ï¼‰ã€‚ä¸ 1 ç‰ˆæœ¬ç›¸åŒï¼Œ2 ç‰ˆæœ¬åœ¨ç±»åå˜æ›´çš„åŒæ—¶ï¼Œè®¿é—®äº† node.scrollTop ä¿ƒä½¿æµè§ˆå™¨é‡ç»˜ï¼›ä¹Ÿå¯ä»¥åœ¨ props.children ä¸­æ‰§è¡Œ onEnter ç­‰æ–¹æ³•é˜»æ­¢ js åŠ¨æ•ˆæˆ–æ‡’åŠ è½½ç­‰é€»è¾‘ã€‚CSSTransition ç»„ä»¶åŒæ ·å‘ä¸ŠæŠ›å‡º props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited é’©å­ã€‚</p>
<h3 id="TransitionGroup"><a href="#TransitionGroup" class="headerlink" title="TransitionGroup"></a>TransitionGroup</h3><p>TransitionGroup çš„å¤„ç†é€»è¾‘å’Œ 1 ç‰ˆæœ¬ç›¸åŒï¼Œå³é€šè¿‡ state.children æ§åˆ¶å¾…æ¸²æŸ“çš„å…ƒç´ ï¼Œä»¥å®ç° exit åŠ¨æ•ˆæ‰§è¡Œæ—¶ä»é©»ç•™å­ç»„ä»¶çš„åœºæ™¯ã€‚ä¸åŒçš„æ˜¯ï¼Œ1 ç‰ˆæœ¬ä¼šç”¨ CSSTransitionGroupChild åŒ…è£…å­ç»„ä»¶ï¼Œ2 ç‰ˆæœ¬éœ€è¦ç”¨æˆ·ä¼ å…¥ Transition ç»„ä»¶ä½œä¸º TransitionGroup çš„å­ç»„ä»¶ã€‚å½“ç„¶ï¼Œå› ä¸º 2 ç‰ˆæœ¬ä¸­ï¼ŒTransition ç»„ä»¶åŠ¨æ•ˆæ‰§è¡Œæ—¶æœºå’Œç»„ä»¶æ¸²æŸ“çŠ¶æ€çš„å¼±å…³è”ï¼Œä¿ƒä½¿ TransitionGroup å®¹å™¨çš„ componentWillReceiveProps æ–¹æ³•ä¸­æ›´æ–° state.children çš„é€»è¾‘ä¹Ÿä¸ä¸€æ ·ã€‚</p>
<p>TransitionGroup çš„ä¸€èˆ¬é€‚ç”¨åœºæ™¯ä¸ºå½“å­ç»„ä»¶æ·»åŠ æ—¶ï¼Œæ‰§è¡Œ enter åŠ¨æ•ˆï¼›å½“å­ç»„ä»¶ç§»é™¤æ—¶ï¼Œæ‰§è¡Œ exit åŠ¨æ•ˆã€‚åœ¨è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œå­ç»„ä»¶çš„æ¸²æŸ“çŠ¶æ€ä¸å— TransitionGroup æ§åˆ¶ï¼Œä¹Ÿå³ TransitionGroup å®¹å™¨å¯¹å­ç»„ä»¶çš„ props.in å±æ€§çš„è°ƒæ§å¿…é¡»ä¸å­ç»„ä»¶çš„æ¸²æŸ“çŠ¶æ€å‘åŒ¹é…ã€‚åœ¨ TransitionGroup å®¹å™¨åˆå§‹åŒ–é˜¶æ®µï¼Œä¼ å…¥å­ç»„ä»¶çš„ props.in å±æ€§å¿…ç„¶ä¸ºçœŸå€¼ï¼Œå› ä¸ºåœ¨è¿™é˜¶æ®µï¼Œå­ç»„ä»¶éƒ½ä¼šå¾—åˆ°æ¸²æŸ“ã€‚åœ¨æ›´æ–°é˜¶æ®µï¼Œå½“å­ç»„ä»¶ç§»é™¤æ—¶ï¼Œé€šè¿‡è®¾ç½® props.in ä¸ºå¦å€¼ï¼Œè§¦å‘ exit åŠ¨æ•ˆï¼›å½“å­ç»„ä»¶ exit åŠ¨æ•ˆæ‰§è¡Œé˜¶æ®µï¼Œå­ç»„ä»¶åˆè¢«æ·»åŠ ï¼Œé€šè¿‡è®¾ç½® props.in ä¸ºçœŸå€¼ï¼Œä½¿ enter, exit åŠ¨æ•ˆå¾—ä»¥æ‰§è¡Œï¼›å½“å­ç»„ä»¶ exit åŠ¨æ•ˆæ‰§è¡Œå®Œæˆã€ä¸”ç»„ä»¶å·²ç§»é™¤åï¼Œå¤„ç†é€»è¾‘åŒ exit åŠ¨æ•ˆæ‰§è¡Œé˜¶æ®µï¼›å½“å­ç»„ä»¶ç»´æŒåŸæ ·ï¼Œä¼ å…¥å­ç»„ä»¶çš„ props.in å±æ€§ç»´æŒåŸå€¼ï¼Œprops.oEnter, props.onExit å±æ€§åˆ™åŒæ­¥ä¸ºå­ç»„ä»¶æœ€æ–°çš„ props å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">  <span class="keyword">super</span>(props, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initial children should all be entering, dependent on appear</span></span><br><span class="line">  <span class="keyword">this</span>.state = &#123;</span><br><span class="line">    children: getChildMapping(props.children, child =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> cloneElement(child, &#123;</span><br><span class="line">        onExited: <span class="keyword">this</span>.handleExited.bind(<span class="keyword">this</span>, child),</span><br><span class="line">        <span class="keyword">in</span>: <span class="literal">true</span>,</span><br><span class="line">        appear: <span class="keyword">this</span>.getProp(child, <span class="string">'appear'</span>),</span><br><span class="line">        enter: <span class="keyword">this</span>.getProp(child, <span class="string">'enter'</span>),</span><br><span class="line">        exit: <span class="keyword">this</span>.getProp(child, <span class="string">'exit'</span>),</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">  <span class="keyword">let</span> prevChildMapping = <span class="keyword">this</span>.state.children;</span><br><span class="line">  <span class="keyword">let</span> nextChildMapping = getChildMapping(nextProps.children);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> children = mergeChildMappings(prevChildMapping, nextChildMapping);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.keys(children).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> child = children[key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isValidElement(child)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hasPrev = key <span class="keyword">in</span> prevChildMapping;</span><br><span class="line">    <span class="keyword">const</span> hasNext = key <span class="keyword">in</span> nextChildMapping;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> prevChild = prevChildMapping[key];</span><br><span class="line">    <span class="comment">// child åœ¨ç§»é™¤è¿‡ç¨‹ä¸­</span></span><br><span class="line">    <span class="keyword">const</span> isLeaving = isValidElement(prevChild) &amp;&amp; !prevChild.props.in;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// child æ–°æ·»åŠ æˆ–è€…ç§»é™¤åŠ¨æ•ˆå°šæœªæ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œ enter åŠ¨æ•ˆ</span></span><br><span class="line">    <span class="keyword">if</span> (hasNext &amp;&amp; (!hasPrev || isLeaving)) &#123;</span><br><span class="line">      <span class="comment">// console.log('entering', key)</span></span><br><span class="line">      children[key] = cloneElement(child, &#123;</span><br><span class="line">        onExited: <span class="keyword">this</span>.handleExited.bind(<span class="keyword">this</span>, child),</span><br><span class="line">        <span class="keyword">in</span>: <span class="literal">true</span>,</span><br><span class="line">        exit: <span class="keyword">this</span>.getProp(child, <span class="string">'exit'</span>, nextProps),</span><br><span class="line">        enter: <span class="keyword">this</span>.getProp(child, <span class="string">'enter'</span>, nextProps),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»„ä»¶å·²ç§»é™¤ï¼Œæ‰§è¡Œ exit åŠ¨æ•ˆ</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!hasNext &amp;&amp; hasPrev &amp;&amp; !isLeaving) &#123;</span><br><span class="line">      <span class="comment">// console.log('leaving', key)</span></span><br><span class="line">      children[key] = cloneElement(child, &#123; <span class="attr">in</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»„ä»¶åŠ¨æ•ˆç‰¹æ€§æœªä½œæ”¹å˜ï¼Œä¿ç•™åŸå€¼</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (hasNext &amp;&amp; hasPrev &amp;&amp; isValidElement(prevChild)) &#123;</span><br><span class="line">      <span class="comment">// console.log('unchanged', key)</span></span><br><span class="line">      children[key] = cloneElement(child, &#123;</span><br><span class="line">        onExited: <span class="keyword">this</span>.handleExited.bind(<span class="keyword">this</span>, child),</span><br><span class="line">        <span class="keyword">in</span>: prevChild.props.in,</span><br><span class="line">        exit: <span class="keyword">this</span>.getProp(child, <span class="string">'exit'</span>, nextProps),</span><br><span class="line">        enter: <span class="keyword">this</span>.getProp(child, <span class="string">'enter'</span>, nextProps),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; children &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>handleExited æ–¹æ³•ç”¨äºå½“å­ç»„ä»¶ exit åŠ¨æ•ˆæ‰§è¡Œå®Œæˆä¸”ç§»é™¤åï¼Œæ›´æ–° TransitionGroup å®¹å™¨çš„ state.children å±æ€§ï¼Œé™„å¸¦è°ƒç”¨åŸå§‹ä¼ å…¥å­ç»„ä»¶çš„ props.onExited æ–¹æ³•ï¼ˆå®é™…ä¼ å…¥å­ç»„ä»¶çš„ props.onExited æ–¹æ³•è¢«æ”¹å†™ä¸º handleExited æ–¹æ³•ï¼‰ã€‚</p>
<p>åœ¨å˜æ›´ state.children çš„å¤„ç†é€»è¾‘ä¹‹å¤–ï¼ŒTransitionGroup å‘å¤–æä¾› props.appear, props.enter, props.exit, props.component, props.childFactory é…ç½®é¡¹ã€‚props.appear, props.enter, props.exit ä¸ºå½“å­ç»„ä»¶å…ƒç´ æ²¡æœ‰åŒå props å±æ€§æ—¶ï¼Œä½¿ç”¨ TransitionGroup å®¹å™¨çš„ props å±æ€§ï¼›props.component ä¸ºå¤–å±‚åŒ…è£¹å…ƒç´ ï¼ˆé€‚é… react ä¸­ props.children ä¸èƒ½ç½®ä¸ºæ•°ç»„çš„ç‰¹æ€§ï¼Œreact 16 å¯èƒ½ä¸éœ€è¦ï¼‰ï¼›props.childFactory ç”¨äºè£…é¥°å­å…ƒç´ ã€‚</p>
<p>2 ç‰ˆæœ¬æ²¡æœ‰æä¾› CSSTransitionGroup ç»„ä»¶ï¼Œå› ä¸ºåœ¨ TransitionGroup ç»„ä»¶ä¸‹æŒ‚è½½ CSSTransition ç»„ä»¶å³èƒ½å®ç°ä¸ 1 ç‰ˆæœ¬ä¸­ CSSTransitionGroup ç›¸åŒçš„æ•ˆæœï¼Œé€šè¿‡è°ƒæ•´èŠ‚ç‚¹çš„ class å®ç°åŠ¨æ•ˆã€‚åœ¨è¿™é‡Œï¼ŒCSSTransition ç»„ä»¶ä½œä¸ºç‰¹æ®Šçš„ Transition ç»„ä»¶ã€‚é™¤æ­¤è€Œå¤–ï¼ŒTransition, CSSTransition ç»„ä»¶éƒ½å‘å¤–æš´éœ² props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited é…ç½®é’©å­ï¼Œå› æ­¤ç›¸è¾ƒäº 1 ç‰ˆæœ¬ä¸­é€šè¿‡ CSSTransitionGroup è‡ªåº”ç”¨çš„ CSSTransitionGroupChild ç»„ä»¶ï¼Œ2 ç‰ˆæœ¬èƒ½å¯¹ css åŠ¨æ•ˆå®ç°æ›´ç»†å¾®çš„æ§åˆ¶ã€‚</p>
<p>æ­¤å¤–ï¼ŒTransitionGroup ç»„ä»¶ä¼šé€šè¿‡ context å±æ€§å‘ Transition å­ç»„ä»¶ä¼ é€’ transitionGroup å±æ€§ï¼Œä»¥ä½¿ Transition å­ç»„ä»¶èƒ½å¤Ÿæ„ŸçŸ¥åŠ¨æ•ˆå¤„äº appear é˜¶æ®µè¿˜æ˜¯ enter é˜¶æ®µã€‚Transition ç»„ä»¶åˆé€šè¿‡ getChildContext æ–¹æ³•ï¼Œå°†å…¶å­å­™ç»„ä»¶çš„ transitionGroup å±æ€§ç½®ä¸º nullï¼Œå…¶æ„ä¹‰æ—¶ï¼Œå½“çˆ¶ Transition åµŒå¥—å­ Transition æ—¶ï¼Œå­ Transition ä¸è‡³äºå°è¯•é€šè¿‡ context.transitionGroup å±æ€§åˆ¤æ–­åŠ¨æ•ˆåœ¨ appear é˜¶æ®µè¿˜æ˜¯ enter é˜¶æ®µã€‚</p>
<h3 id="ReplaceTransition"><a href="#ReplaceTransition" class="headerlink" title="ReplaceTransition"></a>ReplaceTransition</h3><p>2 ç‰ˆæœ¬ä¸­ï¼ŒReplaceTransition ç”¨äºé€šè¿‡æ§åˆ¶ props.in åˆ‡æ¢æ˜¾ç¤ºä¸¤ä¸ªå­ç»„ä»¶ä¸­çš„ä¸€ä¸ªã€‚å› æ­¤å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æœ‰å®¹å™¨åŒ…è£¹ï¼Œé€šè¿‡å®¹å™¨æ›´æ–°ä¼ å…¥ ReplaceTransition ç»„ä»¶ä¸­çš„props.inï¼›å¾ªç¯åˆ‡æ¢éœ€è¦åœ¨å®¹å™¨ä¸­è®¾ç½®å®šæ—¶å™¨ï¼ˆå¾ªç¯åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œä¸æ”¯æŒå…¶ä¸­ä»»æ„ä¸€ä¸ªå­ç»„ä»¶ exit åŠ¨æ•ˆï¼Œé€‚ç”¨åœºæ™¯ç›¸å¯¹è¾ƒå°ï¼‰ã€‚ReplaceTransition ç»„ä»·å‘å¤–æä¾› props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExited ç­‰é…ç½®å±æ€§ï¼Œå‰ä¸‰ä¸ªä¸ºç¬¬ä¸€ä¸ªå­ç»„ä»¶ enter åŠ¨æ•ˆç›¸å…³é’©å­ï¼Œåä¸‰ä¸ªä¸ºç¬¬äºŒä¸ªå­ç»„ä»¶ enter åŠ¨æ•ˆç›¸å…³é’©å­ã€‚å…¶ ReplaceTransition ç»„ä»·æ”¯æŒåœ¨ enter å‘ç”Ÿè¿‡ç¨‹ä¸­è°ƒç”¨å­ç»„ä»¶çš„ props.onEnter, props.onEntering, props.onEntered, props.onExit, props.onExiting, props.onExitedï¼Œå‰ä¸‰ä¸ªé’©å­ä¸ºç¬¬ä¸€ä¸ªå­ç»„ä»¶ç‹¬æœ‰ï¼Œåä¸‰ä¸ªä¸ºç¬¬äºŒä¸ªå­ç»„ä»¶ç‹¬æœ‰ã€‚æºç ä¸ä½œèµ˜è¿°ã€‚</p>
<h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><p>æ— è®º 1 ç‰ˆæœ¬çš„æ ¸å¿ƒæ¨¡å— TransitionGroupï¼Œè¿˜æ˜¯ 2 ç‰ˆæœ¬çš„æ ¸å¿ƒæ¨¡å— Transitionï¼Œéƒ½é€šè¿‡å®¹å™¨ç®¡ç†å­ç»„ä»¶çš„åŠ¨æ•ˆæ‰§è¡Œè¿‡ç¨‹ã€‚1 ç‰ˆæœ¬åˆ‡å…¥çš„è§†è§’åœ¨äºé€šè¿‡åˆ¤æ–­å­ç»„ä»¶ä»åˆ—è¡¨ä¸­åˆ›å»ºã€ç§»é™¤çš„è¿‡ç¨‹ï¼Œè§¦å‘è°ƒç”¨å­ç»„ä»¶çš„ componentWillAppear ç­‰æ–¹æ³•ï¼Œä»¥ç®¡ç†åŠ¨æ•ˆã€‚å¯¹äº css åŠ¨æ•ˆï¼Œ1 ç‰ˆæœ¬åˆé€šè¿‡åŒ…å«ç‰¹å®š componentWillAppear ç­‰å®ä¾‹æ–¹æ³•çš„ CSSTransitionGroupChild åŒ…è£…ç”¨æˆ·å®é™…å¼€å‘çš„å­ç»„ä»¶ï¼Œä»è€Œå¯¹æ¥ä¸Š TransitionGroup å®¹å™¨ï¼Œä½¿å­ç»„ä»¶ä¸­çš„åŠ¨æ•ˆå¾—åˆ°ç®¡ç†ã€‚2 ç‰ˆæœ¬åœ¨å¤„ç†ä¸Šæ›´ä¸ºç»†è‡´ï¼Œç‹¬ç«‹å¯¹å¾…ç”¨æˆ·å¼€å‘çš„åŠ¨æ•ˆç»„ä»¶ï¼Œè€Œä¸æ˜¯è§†ä¸ºåˆ—è¡¨å½¢å¼ã€‚2 ç‰ˆæœ¬é€šè¿‡ Transition å®¹å™¨å°†å­ç»„ä»¶å¯èƒ½åŒ…å«çš„ enter, exit åŠ¨æ•ˆæŠ½è±¡ä¸º state.statusï¼Œå¹¶ä¼ å…¥å­ç»„ä»¶ï¼Œç”±å­ç»„ä»¶è‡ªèº«é€šè¿‡ status å¯ç”¨ç‰¹å®šçš„åŠ¨æ•ˆï¼›å¹¶ä¸”åŒæ ·æä¾›äº†ä»¥é’©å­æ–¹å¼ï¼ˆprops.onEnter ç­‰é…ç½®æ–¹æ³•ï¼‰ç®¡ç†åŠ¨æ•ˆçš„å®ç°ï¼Œ2 ç‰ˆæœ¬è‡ªèº«çš„ CSSTransition ç»„ä»¶å³é€šè¿‡é’©å­è°ƒèŠ‚æ·»åŠ åˆ°èŠ‚ç‚¹ä¸Šçš„ classã€‚è‹¥è¯´ 1 ç‰ˆæœ¬è¿˜æ»ç•™äºå­ç»„ä»¶ä»åˆ—è¡¨ä¸­ç§»å…¥ç§»å‡ºçš„è§†ç‚¹ï¼Œ2 ç‰ˆæœ¬çš„è§‚å¯Ÿè§’åº¦åˆ™ä»åˆ—è¡¨ä¸­è„±ç¦»ï¼Œå®æ‰“å®åœ°ä»‹å…¥äº†å­ç»„ä»¶åŠ¨æ•ˆæ‰§è¡Œå‘¨æœŸçš„ç®¡ç†ï¼Œwill - excute - didï¼Œå¹¶å‘ä¸‹æ³¨å…¥æ‰§è¡ŒçŠ¶æ€ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/06/webpack/webpackæ’ä»¶æŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/06/webpack/webpackæ’ä»¶æŒ‡å—/" itemprop="url">webpackæ’ä»¶æŒ‡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-06T23:38:53+08:00">2018-02-06</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a></span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/06/webpack/webpackæ’ä»¶æŒ‡å—/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/06/webpack/webpackæ’ä»¶æŒ‡å—/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HotModuleReplacementPlugin"><a href="#HotModuleReplacementPlugin" class="headerlink" title="HotModuleReplacementPlugin"></a>HotModuleReplacementPlugin</h2><p>å†…ç½®ä¸º webpack.HotModuleReplacementPluginï¼Œçƒ­æ›¿æ¢æ’ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.HotModuleReplacementPlugin(&#123;</span><br><span class="line">  multiStep: boolean,<span class="comment">// è®¾ç½®ä¸º true æ—¶ï¼Œæ’ä»¶ä¼šåˆ†æˆä¸¤æ­¥æ„å»ºæ–‡ä»¶ã€‚é¦–å…ˆç¼–è¯‘çƒ­åŠ è½½ chunksï¼Œä¹‹åå†ç¼–è¯‘å‰©ä½™çš„é€šå¸¸çš„èµ„æº</span></span><br><span class="line">  fullBuildTimeout: number,<span class="comment">// å½“ multiStep å¯ç”¨æ—¶ï¼Œè¡¨ç¤ºä¸¤æ­¥æ„å»ºä¹‹é—´çš„å»¶æ—¶</span></span><br><span class="line">  requestTimeout: number<span class="comment">// ä¸‹è½½ manifest çš„å»¶æ—¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="DllPlugin-DLLReferencePlugin"><a href="#DllPlugin-DLLReferencePlugin" class="headerlink" title="DllPlugin, DLLReferencePlugin"></a>DllPlugin, DLLReferencePlugin</h2><p>å†…ç½®ä¸º webpack.DllPlugin, webpack.DllReferencePluginï¼Œç”¨äºæå‡ç¼–è¯‘é€Ÿåº¦ã€‚</p>
<p>DllPlugin æ’ä»¶ä¼šç”Ÿæˆä¸€ä¸ª manifest.json æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†ä» require å’Œ import çš„ request åˆ°æ¨¡å— id çš„æ˜ å°„ï¼Œç”¨äºè®© DLLReferencePlugin æ˜ å°„åˆ°ç›¸å…³çš„ä¾èµ–ä¸Šå»ã€‚é€šè¿‡å¼•ç”¨ manifest.json æ–‡ä»¶æ¥æŠŠä¾èµ–çš„åç§°æ˜ å°„åˆ°æ¨¡å—çš„ id ä¸Šï¼Œä¹‹åå†åœ¨éœ€è¦çš„æ—¶å€™é€šè¿‡å†…ç½®çš„ <strong>webpack_require</strong> å‡½æ•°æ¥ require ä»–ä»¬ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.vendor.config.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">  context: __dirname,<span class="comment">// manifest æ–‡ä»¶ä¸­è¯·æ±‚çš„ä¸Šä¸‹æ–‡(context)(é»˜è®¤å€¼ä¸º webpack çš„ä¸Šä¸‹æ–‡(context))</span></span><br><span class="line">  name: <span class="string">"[name]_[hash]"</span>,<span class="comment">// æš´éœ²å‡ºçš„ DLL çš„å‡½æ•°å</span></span><br><span class="line">  path: path.join(__dirname, <span class="string">"manifest.json"</span>),<span class="comment">// manifest.json æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.app.config.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">  context: __dirname,<span class="comment">// ç»å¯¹è·¯å¾„ï¼Œ manifest.json (æˆ–è€…æ˜¯å†…å®¹å±æ€§)ä¸­è¯·æ±‚çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">  manifest: <span class="built_in">require</span>(<span class="string">"./manifest.json"</span>),<span class="comment">// åŒ…å« content å’Œ name çš„å¯¹è±¡</span></span><br><span class="line">  content: <span class="built_in">require</span>(<span class="string">"./manifest.json"</span>).content,<span class="comment">// è¯·æ±‚åˆ°æ¨¡å— id çš„æ˜ å°„ (é»˜è®¤å€¼ä¸º manifest.content)</span></span><br><span class="line">  name: manifest.name,<span class="comment">// dll è„šæœ¬çš„åç§° (é»˜è®¤å€¼ä¸º manifest.name)</span></span><br><span class="line">  scope: <span class="literal">undefined</span>,<span class="comment">// å¼€å¯ä½œç”¨åŸŸæ¨¡å—ï¼Œå¦‚ scope = "xyz"ï¼Œ dll ä¸­çš„åä¸º abc çš„æ–‡ä»¶å¯é€šè¿‡ require("xyz/abc") åŠ è½½ã€‚é»˜è®¤ä¸ºæ˜ å°„æ¨¡å¼ï¼Œå³é€šè¿‡ require("abc") åŠ è½½ã€‚ä¸” dll æ–‡ä»¶ä¸ä¼šè¢«æ‰“åŒ…åˆ° bundle ä¸­</span></span><br><span class="line">  sourceType: <span class="string">"commonsjs2"</span><span class="comment">// dll å¦‚ä½•å‘å¤–æä¾›å…¨å±€å‡½æ•°</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="DefinePlugin"><a href="#DefinePlugin" class="headerlink" title="DefinePlugin"></a>DefinePlugin</h2><p>å†…ç½®ä¸º webpack.DefinePluginï¼Œå®šä¹‰å…¨å±€å˜é‡ã€‚ä½¿ç”¨åœºæ™¯å¦‚ï¼Œç”±å˜é‡åŒºåˆ†å¼€å‘ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒï¼Œå¼€å‘ç¯å¢ƒæ‰“å°æ—¥å¿—ï¼Œç”Ÿäº§ç¯å¢ƒä¸æ‰“å°ã€‚å˜é‡çš„å€¼å°†è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä¸”ä»¥æ–‡æœ¬æ›¿æ¢çš„å½¢å¼ä¼ å…¥ä»£ç ä¸­ï¼Œæ‰€ä»¥éœ€è¦åŒ…è£¹å•åŒå¼•å·æˆ–ä½¿ç”¨ JSON.stringifyï¼Œå¦‚ â€˜â€œproductionâ€â€˜, JSON.stringify(â€˜productionâ€™)ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">  PRODUCTION: <span class="built_in">JSON</span>.stringify(<span class="literal">true</span>),<span class="comment">// ä»¥æ–‡æœ¬å½¢å¼ä¼ å…¥ true</span></span><br><span class="line">  VERSION: <span class="built_in">JSON</span>.stringify(<span class="string">"5fa3b9"</span>),</span><br><span class="line">  BROWSER_SUPPORTS_HTML5: <span class="literal">true</span>,</span><br><span class="line">  TWO: <span class="string">"1+1"</span>,</span><br><span class="line">  <span class="string">"typeof window"</span>: <span class="built_in">JSON</span>.stringify(<span class="string">"object"</span>),<span class="comment">// æ›¿æ¢ typeof window æ–‡æœ¬</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠŸèƒ½æ ‡è®°</span></span><br><span class="line">  <span class="string">'NICE_FEATURE'</span>: <span class="built_in">JSON</span>.stringify(<span class="literal">true</span>),</span><br><span class="line">  <span class="string">'EXPERIMENTAL_FEATURE'</span>: <span class="built_in">JSON</span>.stringify(<span class="literal">false</span>),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æœåŠ¡ Url</span></span><br><span class="line">  <span class="string">'SERVICE_URL'</span>: <span class="built_in">JSON</span>.stringify(<span class="string">"http://dev.example.com"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="EnvironmentPlugin"><a href="#EnvironmentPlugin" class="headerlink" title="EnvironmentPlugin"></a>EnvironmentPlugin</h2><p>å†…ç½®ä¸º webpack.EnvironmentPluginï¼Œä½¿ç”¨ DefinePlugin å¿«æ·è®¾ç½® process.env ç¯å¢ƒå˜é‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç­‰åŒäº new webpack.DefinePlugin(&#123;</span></span><br><span class="line"><span class="comment">  'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV),</span></span><br><span class="line"><span class="comment">  'process.env.DEBUG': JSON.stringify(process.env.DEBUG)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">new</span> webpack.EnvironmentPlugin([<span class="string">'NODE_ENV'</span>, <span class="string">'DEBUG'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">new</span> webpack.EnvironmentPlugin(&#123;</span><br><span class="line">  NODE_ENV: <span class="string">'development'</span>, <span class="comment">// é™¤éæœ‰å®šä¹‰ process.env.NODE_ENVï¼Œå¦åˆ™å°±ä½¿ç”¨ 'development'</span></span><br><span class="line">  DEBUG: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ProvidePlugin"><a href="#ProvidePlugin" class="headerlink" title="ProvidePlugin"></a>ProvidePlugin</h2><p>å†…ç½®ä¸º webpack.ProvidePluginï¼Œå½“æŸå˜é‡æ²¡æœ‰èµ‹å€¼æ—¶ï¼Œè‡ªåŠ¨ import æˆ– require ç›¸åº”çš„æ¨¡å—ï¼Œå¹¶å¯¼å‡ºå…¶ä¸­çš„æ–¹æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªåŠ¨åŠ è½½ jquery</span></span><br><span class="line"><span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">  $: <span class="string">'jquery'</span>,</span><br><span class="line">  jQuery: <span class="string">'jquery'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å…¥ lodash.map æ–¹æ³•</span></span><br><span class="line"><span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">  _map: [<span class="string">'lodash'</span>, <span class="string">'map'</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="CommonsChunkPlugin"><a href="#CommonsChunkPlugin" class="headerlink" title="CommonsChunkPlugin"></a>CommonsChunkPlugin</h2><p>å†…ç½®ä¸º webpack.optimize.CommonsChunkPluginï¼Œæå–å…¬å…±ä»£ç ï¼Œç»“åˆ entry å±æ€§ä½¿ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [<span class="string">"jquery"</span>, <span class="string">"other-lib"</span>],</span><br><span class="line">    app: <span class="string">"./entry"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: string|string[],<span class="comment">// å­—ç¬¦ä¸²æˆ–æ•°ç»„ï¼Œè‹¥è®¾ä¸ºå·²ç»å­˜åœ¨çš„æ‰“åŒ…æ–‡ä»¶ chunk åç§°ï¼Œå°†æŠŠè¯¥ chunk æå–åˆ°å…¬å…±æ–‡ä»¶ä¸­ã€‚å¦‚æœè¯¥é€‰é¡¹è¢«å¿½ç•¥ï¼ŒåŒæ—¶ `options.async` æˆ–è€… `options.children` è¢«è®¾ç½®ï¼Œæ‰€æœ‰çš„ chunk éƒ½ä¼šè¢«ä½¿ç”¨ï¼Œå¦åˆ™ `options.filename` ä¼šç”¨äºä½œä¸º chunk å</span></span><br><span class="line">      filename: string,<span class="comment">// å…¬å…±æ–‡ä»¶åæ¨¡æ¿ï¼Œä½¿ç”¨å’Œ output.filename ç›¸åŒçš„å ä½ç¬¦ã€‚ä¸è®¾ç½®ï¼Œå°†ä¿ç•™åŸ chunk çš„åç§°</span></span><br><span class="line">      minChunks: number|<span class="literal">Infinity</span>|<span class="function">(<span class="params"><span class="built_in">module</span>, count</span>) =&gt;</span> boolean,<span class="comment">// ç”Ÿæˆå…¬å…±æ–‡ä»¶å‰ï¼Œéœ€è¦ä¼ å…¥çš„ chunk æ•°é‡ã€‚è®¾ä¸º Infinityï¼Œä¼šé©¬ä¸Šç”Ÿæˆ å…¬å…±chunkï¼Œä½†é‡Œé¢æ²¡æœ‰æ¨¡å—ã€‚é»˜è®¤æ˜¯ chunk çš„æ•°é‡</span></span><br><span class="line">      chunks: string[],<span class="comment">// é€‰æ‹© chunk çš„æ¥æºã€‚å¦‚æœè¢«å¿½ç•¥ï¼Œæ‰€æœ‰çš„å…¥å£ chunk éƒ½ä¼šè¢«é€‰æ‹©</span></span><br><span class="line">      children: boolean,<span class="comment">// å¦‚æœè®¾ç½®ä¸º trueï¼Œå…¥å£ chunk çš„ä¾èµ–éƒ½ä¼šè¢«å¹¶å…¥å…¬å…±æ–‡ä»¶ä¸­ï¼Œä»¥é¿å… chunk çš„ä¾èµ–åŒ…å«é‡å¤ä»£ç </span></span><br><span class="line">      <span class="keyword">async</span>: boolean|string,<span class="comment">// å¦‚æœè®¾ç½®ä¸º trueï¼Œä¸ä¸Šé¢ç›¸åŒï¼Œå…¥å£ chunk çš„ä¾èµ–è¢«å¹¶å…¥å…¬å…±æ–‡ä»¶ä¸­ï¼Œä¸”ä½¿ç”¨å¼‚æ­¥åŠ è½½</span></span><br><span class="line">      minSize: number<span class="comment">// åœ¨ å…¬å…±chunk è¢«åˆ›å»ºç«‹ä¹‹å‰ï¼Œæ‰€æœ‰å…¬å…±æ¨¡å—çš„æœ€å°‘å¤§å°</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¥å£ chunk ä¾èµ–è·¯å¾„ä¸­åŒ…å« "somelib" å­—æ ·çš„è„šæœ¬ï¼Œè¿™äº›è„šæœ¬å°†è¢«è§†ä¸ºä¸€ä¸ª chunkï¼Œchunk çš„ keyname æ˜¯ "my-single-lib-chunk"ï¼Œæœ€ç»ˆæ‰“åŒ…åˆ° "my-single-lib-chunk.js" ä¸­</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">"vendor"</span>,</span><br><span class="line">  minChunks: ffunction(<span class="built_in">module</span>, count) &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.resource &amp;&amp; (<span class="regexp">/somelib/</span>).test(<span class="built_in">module</span>.resource) &amp;&amp; count === <span class="number">3</span>; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¿å…æå– css, scss æ–‡ä»¶ï¼Œä¸”å…¬å…±æ–‡ä»¶åªèƒ½åœ¨ node_modules ä¸‹</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">"vendor"</span>,</span><br><span class="line">  minChunks: <span class="function"><span class="keyword">function</span> (<span class="params">module</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">module</span>.resource &amp;&amp; (<span class="regexp">/^.*\.(css|scss)$/</span>).test(<span class="built_in">module</span>.resource)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.context &amp;&amp; <span class="built_in">module</span>.context.indexOf(<span class="string">"node_modules"</span>) !== <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† webpack æ³¨å…¥é¡µé¢çš„è„šæœ¬æå–åˆ°å…¬å…±æ–‡ä»¶ï¼Œæ–‡ä»¶å "manifest" ä¸èƒ½å’Œå…¥å£ chunk é‡å</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">"manifest"</span>,</span><br><span class="line">  minChunks: <span class="literal">Infinity</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line">[</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">"vendor"</span>,</span><br><span class="line">    minChunks: <span class="function"><span class="keyword">function</span>(<span class="params">module</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">module</span>.context &amp;&amp; <span class="built_in">module</span>.context.indexOf(<span class="string">"node_modules"</span>) !== <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">"manifest"</span>,</span><br><span class="line">    minChunks: <span class="literal">Infinity</span></span><br><span class="line">  &#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="SourceMapDevToolPlugin"><a href="#SourceMapDevToolPlugin" class="headerlink" title="SourceMapDevToolPlugin"></a>SourceMapDevToolPlugin</h2><p>å†…ç½®ä¸º webpack.SourceMapDevToolPluginï¼Œå¯¹ webpackConfig.devtool æ·»åŠ çš„ SourceMap äºˆä»¥æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.SourceMapDevToolPlugin(&#123;</span><br><span class="line">  test,<span class="comment">// æŒ‡å®šèµ„æºï¼Œtest é»˜è®¤æ˜¯ .js å’Œ .css æ–‡ä»¶</span></span><br><span class="line">  include,</span><br><span class="line">  exclude,</span><br><span class="line">  filename: <span class="string">'[name].js.map'</span>,<span class="comment">// SourceMap çš„è¾“å‡ºæ–‡ä»¶åã€‚å¦‚æœæ²¡æœ‰æä¾›å€¼ï¼Œåˆ™ source map æ˜¯å†…è”çš„</span></span><br><span class="line">  append,<span class="comment">// è¿½åŠ åˆ°åŸå§‹èµ„æºã€‚é€šå¸¸ä»¥ #sourceMappingURL æ³¨é‡Šã€‚[url] æ›¿æ¢ä¸º source map æ–‡ä»¶çš„ URLã€‚false ç¦æ­¢è¿½åŠ </span></span><br><span class="line">  moduleFilenameTemplate,<span class="comment">// SourceMap çš„è¾“å‡ºæ–‡ä»¶åæ¨¡æ¿</span></span><br><span class="line">  fallbackModuleFilenameTemplate,<span class="comment">// SourceMap çš„è¾“å‡ºæ–‡ä»¶ååå¤‡æ–¹æ¡ˆ</span></span><br><span class="line">  <span class="built_in">module</span>: <span class="literal">true</span>,<span class="comment">// ä¸º false æ—¶ï¼Œ loader ä¸å†ç”Ÿæˆ source mapï¼Œå¹¶ä¸”è½¬æ¢è¿‡çš„ä»£ç è¢«ç”¨ä½œæºç </span></span><br><span class="line">  columns: <span class="literal">true</span>,<span class="comment">//  ä¸º false æ—¶ï¼Œsource map ä¸­çš„åˆ—æ˜ å°„(column mapping)è¢«å¿½ç•¥ï¼Œå¹¶ä¸”ä½¿ç”¨æ›´å¿«é€Ÿçš„ source map å®ç°</span></span><br><span class="line">  lineToLine: &#123;<span class="comment">// åŒ¹é…çš„æ¨¡å—ä½¿ç”¨ç®€å•å¿«é€Ÿçš„è¡Œåˆ°è¡Œ source map</span></span><br><span class="line">    test,</span><br><span class="line">    include,</span><br><span class="line">    exclude</span><br><span class="line">  &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="MinChunkSizePlugin"><a href="#MinChunkSizePlugin" class="headerlink" title="MinChunkSizePlugin"></a>MinChunkSizePlugin</h2><p>å†…ç½®ä¸º webpack.optimize.MinChunkSizePluginï¼Œé€šè¿‡åˆå¹¶å°äº minChunkSize å¤§å°çš„ chunkï¼Œå°† chunk ä½“ç§¯ä¿æŒåœ¨æŒ‡å®šå¤§å°é™åˆ¶ä»¥ä¸Šã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.MinChunkSizePlugin(&#123;</span><br><span class="line">  minChunkSize: <span class="number">10000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="BannerPlugin"><a href="#BannerPlugin" class="headerlink" title="BannerPlugin"></a>BannerPlugin</h2><p>å†…ç½®ä¸º webpack.BannerPluginï¼Œä¸ºæ¯ä¸ª chunk æ–‡ä»¶å¤´éƒ¨æ·»åŠ  bannerã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.BannerPlugin(banner)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="keyword">new</span> webpack.BannerPlugin(&#123;</span><br><span class="line">  banner: <span class="string">"hash:[hash], chunkhash:[chunkhash], name:[name], filebase:[filebase], query:[query], file:[file]"</span>,</span><br><span class="line">  raw: <span class="literal">false</span>,<span class="comment">// å¦‚æœå€¼ä¸º trueï¼Œå°†ç›´å‡ºï¼Œä¸ä½œä¸ºæ³¨é‡Š</span></span><br><span class="line">  entryOnly: <span class="literal">false</span>,<span class="comment">// å¦‚æœå€¼ä¸º trueï¼Œå°†åªåœ¨å…¥å£ chunks æ–‡ä»¶ä¸­æ·»åŠ </span></span><br><span class="line">  test: <span class="literal">null</span>,</span><br><span class="line">  include: <span class="literal">null</span>,</span><br><span class="line">  exclude: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="IgnorePlugin"><a href="#IgnorePlugin" class="headerlink" title="IgnorePlugin"></a>IgnorePlugin</h2><p>å†…ç½®ä¸º webpack.IgnorePluginï¼Œæ‰“åŒ…æ—¶é¿è¿‡æŒ‡å®šèµ„æºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.IgnorePlugin(</span><br><span class="line">  requestRegExp,<span class="comment">// æµ‹è¯•èµ„æºè¯·æ±‚è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">  [contextRegExp]<span class="comment">// (å¯é€‰) æµ‹è¯•èµ„æºä¸Šä¸‹æ–‡(ç›®å½•)çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹ï¼Œmoment ç±»åº“ä¸­ locale èµ„æºå°†ä¸äºˆæ‰“åŒ…</span></span><br><span class="line"><span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, /moment$/)</span><br></pre></td></tr></table></figure>
<h2 id="NormalModuleReplacementPlugin"><a href="#NormalModuleReplacementPlugin" class="headerlink" title="NormalModuleReplacementPlugin"></a>NormalModuleReplacementPlugin</h2><p>å†…ç½®ä¸º webpack.NormalModuleReplacementPluginï¼Œæ›¿æ¢æŒ‡å®šèµ„æºï¼Œé€‚ç”¨åœºæ™¯ä¸ºç”Ÿäº§ç¯å¢ƒä¸‹çš„æŸé…ç½®æ–‡ä»¶æ¯”å¼€å‘ç¯å¢ƒçš„é…ç½®æ–‡ä»¶æœ‰æ›´é«˜ä¼˜å…ˆçº§ã€‚é«˜çº§ç”¨æ³•æ˜¯æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šå¾…åŠ è½½çš„èµ„æºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§ç¯å¢ƒä¿®æ”¹ webpack.config.jsï¼ŒåŠ è½½ './config.production.js' æ–‡ä»¶ï¼›å¼€å‘ç¯å¢ƒä¸ä½¿ç”¨ NormalModuleReplacementPlugin æ’ä»¶ï¼ŒåŠ è½½ 'some/path/config.development.js' æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">new</span> webpack.NormalModuleReplacementPlugin(</span><br><span class="line">  /some\/path\/config\.development\.js/,</span><br><span class="line">  <span class="string">'./config.production.js'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜çº§ç”¨æ³•ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡åŠ è½½æ–‡ä»¶ï¼Œå¼€å‘ç¯å¢ƒé»˜è®¤åŠ è½½å¸¦ VERSION_A å­—æ ·æ–‡ä»¶ï¼›ç”Ÿäº§ç¯å¢ƒè®¾ env.APP_TARGET = 'VERSION_B'ï¼ŒåŠ è½½ VERSION_B æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">env</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> appTarget = env.APP_TARGET || <span class="string">'VERSION_A'</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> webpack.NormalModuleReplacementPlugin(<span class="regexp">/(.*)-APP_TARGET(\.*)/</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resource</span>) </span>&#123;</span><br><span class="line">        resource.request = resource.request.replace(<span class="regexp">/-APP_TARGET/</span>, <span class="string">`-<span class="subst">$&#123;appTarget&#125;</span>`</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ContextReplacementPlugin"><a href="#ContextReplacementPlugin" class="headerlink" title="ContextReplacementPlugin"></a>ContextReplacementPlugin</h2><p>å†…ç½®ä¸º webpack.ContextReplacementPluginï¼Œæ›¿æ¢ webpack æ–‡ä»¶æŸ¥æ‰¾è§„åˆ™ã€‚åœ¨ webpack ä¸­ï¼Œå½“ require(â€˜./locale/â€˜ + name + â€˜.jsonâ€™)ï¼Œwebpack å°†æŸ¥æ‰¾ç›®å½• (â€˜./locale/â€˜) ä¸‹ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ (/^.*.json$/)çš„æ–‡ä»¶ï¼Œç”±äº name åœ¨ç¼–è¯‘æ—¶(compile time)è¿˜æ˜¯æœªçŸ¥çš„ï¼Œwebpack ä¼šå°†æ¯ä¸ªæ–‡ä»¶éƒ½ä½œä¸ºæ¨¡å—å¼•å…¥åˆ° bundle ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPluginï¼Œæ›¿æ¢(</span><br><span class="line">  resourceRegExp: <span class="built_in">RegExp</span>,<span class="comment">// å¦‚æœèµ„æºï¼ˆæˆ–ç›®å½•ï¼‰ç¬¦åˆ resourceRegExp æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ’ä»¶ä¼šæ›¿æ¢é»˜è®¤èµ„æºä¸º newContentResource</span></span><br><span class="line">  newContentResource?: string,<span class="comment">// å¦‚æœ newContentResource ä¸ºç›¸å¯¹è·¯å¾„ï¼Œä¼šç›¸å¯¹äºå‰ä¸€åŒ¹é…èµ„æºè·¯å¾„å»è§£æ</span></span><br><span class="line">  newContentRecursive?: boolean,<span class="comment">// æ˜¯å¦ä½¿ç”¨é€’å½’æŸ¥æ‰¾</span></span><br><span class="line">  newContentRegExp?: <span class="built_in">RegExp</span>,<span class="comment">// ç”¨äºç­›é€‰æ–°ä¸Šä¸‹æ–‡é‡Œçš„èµ„æº</span></span><br><span class="line">  newContentCallback?: <span class="function"><span class="params">data</span> =&gt;</span> <span class="keyword">void</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin(<span class="regexp">/moment[\/\\]locale$/</span>, /de|fr|hu/)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPluginï¼Œæ›¿æ¢(</span><br><span class="line">  resourceRegExp: <span class="built_in">RegExp</span>,</span><br><span class="line">  newContentCallback?: <span class="function"><span class="params">data</span> =&gt;</span> <span class="keyword">void</span><span class="comment">// é¦–å‚ä¸ºä¸ºä¸Šä¸‹æ–‡æ¨¡å—å·¥å‚(ContextModuleFactory)çš„ data å¯¹è±¡ï¼Œéœ€è¦è¦†å†™è¯¥å¯¹è±¡çš„ request å±æ€§</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin(<span class="regexp">/^\.\/locale$/</span>, (context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/\/moment\//</span>.test(context.context)) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">  <span class="built_in">Object</span>.assign(context, &#123;</span><br><span class="line">    regExp: <span class="regexp">/^\.\/\w+/</span>,</span><br><span class="line">    request: <span class="string">'../../locale'</span>, <span class="comment">// ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin(</span><br><span class="line">  resourceRegExp: <span class="built_in">RegExp</span>,</span><br><span class="line">  newContentResource: string,</span><br><span class="line">  newContentCreateContextMap: object <span class="comment">// å°†è¿è¡Œæ—¶è¯·æ±‚(runtime-request)æ˜ å°„åˆ°ç¼–è¯‘æ—¶è¯·æ±‚(compile-time request)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">new</span> ContextReplacementPlugin(<span class="regexp">/selector/</span>, <span class="string">'./folder'</span>, &#123;</span><br><span class="line">  <span class="string">'./request'</span>: <span class="string">'./request'</span>,</span><br><span class="line">  <span class="string">'./other-request'</span>: <span class="string">'./new-request'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="HtmlWebpackPlugin"><a href="#HtmlWebpackPlugin" class="headerlink" title="HtmlWebpackPlugin"></a>HtmlWebpackPlugin</h2><p>html-webpack-plugin æ’ä»¶ï¼Œåˆ›å»º html æ–‡ä»¶ï¼Œè‡ªåŠ¨åŠ è½½æ‰“åŒ…èµ„æºã€‚</p>
<p>æ³¨å…¥ html æ¨¡æ¿çš„å˜é‡åŒ…å«ï¼ŒhtmlWebpackPlugin = { files, options }, webpack, webpackConfigã€‚</p>
<p>æ”¯æŒçš„äº‹ä»¶åŒ…å«ï¼Œhtml-webpack-plugin-before-html-generation, html-webpack-plugin-before-html-processing, html-webpack-plugin-alter-asset-tags, html-webpack-plugin-after-html-processing, html-webpack-plugin-after-emit, åŒæ­¥äº‹ä»¶ tml-webpack-plugin-alter-chunksã€‚åœ¨è‡ªå®šä¹‰æ’ä»¶ä¸­ä½¿ç”¨ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://github.com/jantimon/html-webpack-plugin" target="_blank" rel="noopener">https://github.com/jantimon/html-webpack-plugin</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  title: <span class="string">''</span>,<span class="comment">// æ³¨å…¥ html çš„ title</span></span><br><span class="line">  filename: <span class="string">'index.html'</span>,<span class="comment">// å½±å“åŠ è½½èµ„æºçš„ä½ç½®</span></span><br><span class="line">  template: <span class="string">''</span>,<span class="comment">// html, ejs, jade æ¨¡æ¿çš„è·¯å¾„</span></span><br><span class="line">  inject: <span class="literal">true</span> | <span class="string">'head'</span> | <span class="string">'body'</span> | <span class="literal">false</span>,<span class="comment">// é™æ€èµ„æºæ³¨å…¥ä½ç½®ï¼Œé»˜è®¤åœ¨ body åº•å±‚</span></span><br><span class="line">  favicon: <span class="string">''</span>,<span class="comment">// å›¾æ ‡è·¯å¾„</span></span><br><span class="line">  minify: &#123;&#125;,<span class="comment">// ä¼ é€’ç»™ html-minifier çš„é€‰é¡¹ï¼Œç”¨äºä¼˜åŒ–è¾“å‡º</span></span><br><span class="line">  hash: <span class="literal">true</span> | <span class="literal">false</span>,<span class="comment">// è®¾ä¸ºçœŸæ—¶ï¼Œjs, css èµ„æºåå°†åŠ ä¸Š hash å€¼ï¼Œç”¨äºåˆ·æ–°ç¼“å­˜</span></span><br><span class="line">  cache: <span class="literal">true</span>,<span class="comment">// è®¾ä¸ºçœŸæ—¶ï¼Œåªæœ‰æ–‡ä»¶å˜æ›´æ—¶ï¼Œæ‰é‡æ–°è¯·æ±‚</span></span><br><span class="line">  showErrors: <span class="literal">true</span>,<span class="comment">// æ˜¾ç¤ºé”™è¯¯</span></span><br><span class="line">  chunks: [],<span class="comment">// æ·»åŠ  chunkï¼Œå¦‚ç”¨äºå•å…ƒæµ‹è¯•çš„è„šæœ¬</span></span><br><span class="line">  chunksSortMode: <span class="string">'auto'</span>,<span class="comment">// chunk æ’åºæ–¹å¼ï¼Œå¯é€‰å€¼ 'none' | 'auto' | 'dependency' |'manual' | &#123;function&#125; </span></span><br><span class="line">  excludeChunks: [],<span class="comment">// é¿å…å¼•ç”¨æŸäº› chunk</span></span><br><span class="line">  xhtml: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="UglifyjsWebpackPlugin"><a href="#UglifyjsWebpackPlugin" class="headerlink" title="UglifyjsWebpackPlugin"></a>UglifyjsWebpackPlugin</h2><p>uglifyjs-webpack-plugin æ’ä»¶ï¼Œå‹ç¼© js è„šæœ¬ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> UglifyJSPlugin(&#123;</span><br><span class="line">  test,<span class="comment">// å®šä½èµ„æº</span></span><br><span class="line">  include,</span><br><span class="line">  exclude,</span><br><span class="line">  parallel: <span class="literal">false</span>,<span class="comment">// ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œå’Œæ–‡ä»¶ç¼“å­˜æ¥æé«˜æ„å»ºé€Ÿåº¦ï¼Œå¦‚ &#123; cache: true, workers: 2 &#125;ï¼Œparallel.workers ä¸º cpu æ ¸æ•°</span></span><br><span class="line">  sourceMap: <span class="literal">false</span>,<span class="comment">// ç”Ÿæˆ source mapï¼Œä¼šå‡æ…¢ç¼–è¯‘çš„é€Ÿåº¦ã€‚cheap-source-map é€‰é¡¹ä¸é€‚ç”¨äºæ­¤æ’ä»¶</span></span><br><span class="line">  uglifyOptions: &#123;<span class="comment">// å‹ç¼©é€‰é¡¹ï¼Œä¾› uglifyJs ä½¿ç”¨</span></span><br><span class="line">    ie8: <span class="literal">false</span>,<span class="comment">// æ”¯æŒ ie8</span></span><br><span class="line">    ecma: <span class="number">8</span>,<span class="comment">// es è¯­æ³•ç‰ˆæœ¬å·ï¼Œå¯é€‰é¡¹ 5, 6, 7, 8ï¼Œå½±å“ parse, compress, output é€‰é¡¹</span></span><br><span class="line">    parse: &#123;&#125;,<span class="comment">// parse é€‰é¡¹</span></span><br><span class="line">    mangle: &#123;&#125;,<span class="comment">// åç§°çŸ«æ­£??? </span></span><br><span class="line">    output: &#123;<span class="comment">// é»˜è®¤æœ€ä½³å‹ç¼©</span></span><br><span class="line">      comments: <span class="literal">false</span>,</span><br><span class="line">      beautify: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    compress: &#123;&#125;,<span class="comment">// parse é€‰é¡¹</span></span><br><span class="line">    warnings: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extractComments: <span class="literal">true</span>,<span class="comment">// å‡½æ•°ï¼Œæå–æ³¨é‡Š</span></span><br><span class="line">  warningsFilter: <span class="literal">undefined</span><span class="comment">// è¿‡æ»¤è­¦å‘Šï¼Œå¦‚ source =&gt; Boolean</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ExtractTextWebpackPlugin"><a href="#ExtractTextWebpackPlugin" class="headerlink" title="ExtractTextWebpackPlugin"></a>ExtractTextWebpackPlugin</h2><p>extract-text-webpack-plugin æ’ä»¶ï¼Œæå– css æ–‡ä»¶ã€‚</p>
<p>ExtractTextPlugin.extract åœ¨å·²ç»å­˜åœ¨çš„ loader ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæå– css çš„ loaderã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ExtractTextWebpackPlugin(filename | &#123; </span><br><span class="line">  id: string,<span class="comment">// æ­¤æ’ä»¶å®ä¾‹çš„å”¯ä¸€ identï¼ˆä»…é™é«˜çº§ç”¨é€”ï¼Œé»˜è®¤æƒ…å†µä¸‹è‡ªåŠ¨ç”Ÿæˆï¼‰</span></span><br><span class="line">  filename: string,<span class="comment">// ç”Ÿæˆæ–‡ä»¶çš„æ–‡ä»¶åï¼Œå ä½ç¬¦åŒ…å« [name], [id], [contenthash]ã€‚ExtractTextPlugin å¯¹ æ¯ä¸ªå…¥å£ chunk éƒ½ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶</span></span><br><span class="line">  allChunks: <span class="literal">false</span>,<span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œä»å…¥å£ chunk æå– cssã€‚å½“ä½¿ç”¨ CommonsChunkPluginï¼Œä¸”ä½¿ç”¨ ExtractTextPlugin.extract åœ¨å…¬å…± chunk ä¸­æœ‰æå– css æ—¶ï¼ŒallChunks é¡»ç½®ä¸ºçœŸ</span></span><br><span class="line">  disable: <span class="literal">false</span>,<span class="comment">// ç¦ç”¨æ’ä»¶</span></span><br><span class="line">  ignoreOrder: <span class="literal">false</span>,<span class="comment">// ç¦ç”¨æ£€æŸ¥</span></span><br><span class="line">  threshold: <span class="number">0</span>,<span class="comment">// å¤§äºè¯¥å€¼çš„æ–‡ä»¶å°†è¢«å‹ç¼©</span></span><br><span class="line">  minRatio: <span class="number">0.8</span>,<span class="comment">// å‹ç¼©æ¯”å¤§äºè¯¥å€¼çš„å°†è¢«å‹ç¼©</span></span><br><span class="line">  deleteOriginalAssets: <span class="literal">false</span><span class="comment">// æ˜¯å¦åˆ é™¤åŸå§‹èµ„æº</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ExtractTextPlugin.extract</span></span><br><span class="line">ExtractTextPlugin.extract(&#123;</span><br><span class="line">  loader: <span class="string">'[name]-loader'</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    use: [<span class="string">'css-loader'</span>, <span class="string">'sass-loader'</span>],<span class="comment">// æå– css æ–‡ä»¶ï¼Œä½¿ç”¨è¿™äº› loader è·å¾— css æ¨¡å—</span></span><br><span class="line">    fallback: <span class="string">'style-loader'</span>,<span class="comment">// css æ¨¡å—å·²å–å¾—ï¼Œå°šæœªæå–å‰åº”ç”¨</span></span><br><span class="line">    publicPath: <span class="comment">// é‡å†™æ­¤ loader çš„ publicPath é…ç½®</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> extractCSS = <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'stylesheets/[name]-one.css'</span>);</span><br><span class="line"><span class="keyword">const</span> extractLESS = <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'stylesheets/[name]-two.css'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: extractCSS.extract([ <span class="string">'css-loader'</span>, <span class="string">'postcss-loader'</span> ])</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">        use: extractLESS.extract([ <span class="string">'css-loader'</span>, <span class="string">'less-loader'</span> ])</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    extractCSS,</span><br><span class="line">    extractLESS</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="NpmInstallWebpackPlugin"><a href="#NpmInstallWebpackPlugin" class="headerlink" title="NpmInstallWebpackPlugin"></a>NpmInstallWebpackPlugin</h2><p>npm-install-webpack-plugin æ’ä»¶ï¼ŒåŠ è½½ç¼ºå¤±çš„ä¾èµ–ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> NpmInstallPlugin(&#123;</span><br><span class="line">  dev: <span class="literal">false</span>,<span class="comment">// ä½¿ç”¨ --save æˆ–è€… --save-dev</span></span><br><span class="line">  peerDependencies: <span class="literal">true</span>,<span class="comment">// å®‰è£…ç¼ºå°‘çš„ peerDependencies</span></span><br><span class="line">  quiet: <span class="literal">false</span>,<span class="comment">// å‡å°‘æ§åˆ¶å°æ—¥å¿—è®°å½•çš„æ•°é‡</span></span><br><span class="line">  npm: <span class="string">'tnpm'</span><span class="comment">// åŒ…åŠ è½½æ–¹å¼ï¼Œé»˜è®¤ 'npm'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="I18nWebpackPlugin"><a href="#I18nWebpackPlugin" class="headerlink" title="I18nWebpackPlugin"></a>I18nWebpackPlugin</h2><p>i18n-webpack-plugin æ’ä»¶ï¼Œå›½é™…åŒ–???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> I18nWebpackPlugin(&#123;</span><br><span class="line">  functionName: <span class="string">'__'</span>,<span class="comment">// å‡½æ•°å</span></span><br><span class="line">  failOnMissing: <span class="literal">false</span>,<span class="comment">// æ‰¾ä¸åˆ°æ˜ å°„æ–‡ä»¶æ—¶ç»™äºˆè­¦å‘Š</span></span><br><span class="line">  hideMessage: <span class="literal">false</span><span class="comment">// éšè—è­¦å‘Š/é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="BabiliWebpackPlugin"><a href="#BabiliWebpackPlugin" class="headerlink" title="BabiliWebpackPlugin"></a>BabiliWebpackPlugin</h2><p>babili-webpack-plugin æ’ä»¶ï¼Œä½¿ç”¨ babel-minify æ ¹æ®æµè§ˆå™¨æ˜¯å¦æ”¯æŒ es5 æœ€æ–°ç‰¹æ€§ï¼Œä¼˜åŒ–å‹ç¼©ä»£ç ã€‚ä¹Ÿå¯ä»¥åœ¨ babel-loader é…ç½®ä¸­ä½¿ç”¨ babel-preset-minify ã€‚æ¯”èµ· babel-loader é…ç½®ï¼Œbabili-webpack-plugin æ’ä»¶èƒ½ä¼˜åŒ–å…¨æ–‡ä»¶ï¼ŒåŒ…å«ä¸é€šè¿‡ babel-loader åŠ è½½çš„æ–‡ä»¶ï¼Œå³ node_modules ä¸‹çš„æ–‡ä»¶ï¼Œä»¥åŠç”± webpack ç”Ÿæˆçš„æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> BabiliPlugin(</span><br><span class="line">  babiliOptions = &#123; </span><br><span class="line">    plugins:[], </span><br><span class="line">    presets:[] </span><br><span class="line">  &#125;, </span><br><span class="line">  overrides = &#123;</span><br><span class="line">    test: <span class="regexp">/\.js($|\?)/i</span>,<span class="comment">// å¾…åŒ…å«çš„æ–‡ä»¶</span></span><br><span class="line">    comments: <span class="regexp">/@preserve|@licen(s|c)e/</span>,<span class="comment">// ç½®ä¸º falseï¼Œå°†ç§»é™¤æ³¨é‡Š</span></span><br><span class="line">    sourceMap: webpackConfig.devtool,</span><br><span class="line">    parserOpts: &#123;&#125;,</span><br><span class="line">    babel: <span class="built_in">require</span>(<span class="string">"babel-core"</span>),<span class="comment">// ç”¨äºæ›¿ä»£ babel-core</span></span><br><span class="line">    babili: <span class="built_in">require</span>(<span class="string">'babel-preset-minify'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="CompressionWebpackPlugin"><a href="#CompressionWebpackPlugin" class="headerlink" title="CompressionWebpackPlugin"></a>CompressionWebpackPlugin</h2><p>compression-webpack-plugin æ’ä»¶ï¼Œå‹ç¼©é™æ€èµ„æºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> CompressionWebpackPlugin(&#123; </span><br><span class="line">  test: <span class="string">'.'</span>, </span><br><span class="line">  include: <span class="literal">undefined</span>,</span><br><span class="line">  exclude: <span class="literal">undefined</span>,</span><br><span class="line">  cache: <span class="literal">false</span>,<span class="comment">// å¼€å¯æ–‡ä»¶ç¼“å­˜</span></span><br><span class="line">  asset: [path].gz[query],<span class="comment">// ç›®æ ‡èµ„æºåç§°ã€‚[file] ä¼šè¢«æ›¿æ¢æˆåŸå§‹èµ„æºï¼Œ[path] ä¼šè¢«æ›¿æ¢æˆåŸå§‹èµ„æºçš„è·¯å¾„ï¼Œ[query] ä¼šè¢«æ›¿æ¢æˆæŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class="line">  filename: <span class="literal">false</span>,<span class="comment">// å‡½æ•°ï¼Œå¦‚ (asset) =&gt; asset</span></span><br><span class="line">  algorithm: <span class="string">'gzip'</span>,<span class="comment">// å‹ç¼©ç®—æ³•æˆ–ç®—æ³•åï¼Œå¦‚ (buffer, cb) =&gt; cb(buffer)</span></span><br><span class="line">  threshold: <span class="number">0</span>,<span class="comment">// å¤§äºè¯¥å€¼çš„æ–‡ä»¶å°†è¢«å‹ç¼©</span></span><br><span class="line">  minRatio: <span class="number">0.8</span>,<span class="comment">// å‹ç¼©æ¯”å¤§äºè¯¥å€¼çš„å°†è¢«å‹ç¼©</span></span><br><span class="line">  deleteOriginalAssets: <span class="literal">false</span><span class="comment">// æ˜¯å¦åˆ é™¤åŸå§‹èµ„æº</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ZopfliWebpackPlugin"><a href="#ZopfliWebpackPlugin" class="headerlink" title="ZopfliWebpackPlugin"></a>ZopfliWebpackPlugin</h2><p>zopfli-webpack-plugin æ’ä»¶ï¼Œå‹ç¼©èµ„æºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ZopfliWebpackPlugin(&#123; </span><br><span class="line">  asset: [path].gz[query],<span class="comment">// ç›®æ ‡èµ„æºåç§°ã€‚[file] ä¼šè¢«æ›¿æ¢æˆåŸå§‹èµ„æºï¼Œ[path] ä¼šè¢«æ›¿æ¢æˆåŸå§‹èµ„æºçš„è·¯å¾„ï¼Œ[query] ä¼šè¢«æ›¿æ¢æˆæŸ¥è¯¢å­—ç¬¦ä¸²</span></span><br><span class="line">  filename: <span class="literal">false</span>,<span class="comment">// å‡½æ•°ï¼Œå¦‚ (asset) =&gt; asset</span></span><br><span class="line">  algorithm: <span class="string">'gzip'</span>,<span class="comment">// å‹ç¼©ç®—æ³•æˆ–ç®—æ³•åï¼Œå¦‚ (buffer, cb) =&gt; cb(buffer)</span></span><br><span class="line">  threshold: <span class="number">0</span>,<span class="comment">// å¤§äºè¯¥å€¼çš„æ–‡ä»¶å°†è¢«å‹ç¼©</span></span><br><span class="line">  minRatio: <span class="number">0.8</span>,<span class="comment">// å‹ç¼©æ¯”å¤§äºè¯¥å€¼çš„å°†è¢«å‹ç¼©</span></span><br><span class="line">  deleteOriginalAssets: <span class="literal">false</span><span class="comment">// æ˜¯å¦åˆ é™¤åŸå§‹èµ„æº</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ComponentWebpackPlugin"><a href="#ComponentWebpackPlugin" class="headerlink" title="ComponentWebpackPlugin"></a>ComponentWebpackPlugin</h2><p>ä¸è¯¦ã€‚ã€‚ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/04/webpack/webpackåŠ è½½å™¨æŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/04/webpack/webpackåŠ è½½å™¨æŒ‡å—/" itemprop="url">webpackåŠ è½½å™¨æŒ‡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-04T00:00:00+08:00">2018-02-04</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a></span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/04/webpack/webpackåŠ è½½å™¨æŒ‡å—/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/04/webpack/webpackåŠ è½½å™¨æŒ‡å—/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åŠ è½½å™¨åœ¨ webpack ç¼–è¯‘å‰é¢„å¤„ç†æ–‡ä»¶ï¼Œé“¾å¼è°ƒç”¨å¤šä¸ªåŠ è½½å™¨ã€‚</p>
<h2 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h2><p>babel-loaderå°† es6 é™çº§ä¸º es5ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<p><a href="https://www.cnblogs.com/tugenhua0707/p/7863616.html" target="_blank" rel="noopener">Babelæ˜¯å¦‚ä½•ç¼–è¯‘JSä»£ç çš„åŠç†è§£æŠ½è±¡è¯­æ³•æ ‘(AST)</a></p>
<h3 id="options-é€‰é¡¹"><a href="#options-é€‰é¡¹" class="headerlink" title="options é€‰é¡¹"></a>options é€‰é¡¹</h3><p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<p><a href="https://babeljs.cn/docs/usage/api/" target="_blank" rel="noopener">babel options</a>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤é…ç½®</span></span><br><span class="line">&#123;</span><br><span class="line">  plugins:[],<span class="comment">//	éœ€è¦åŠ è½½å’Œä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨</span></span><br><span class="line">  presets: [],<span class="comment">//	éœ€è¦åŠ è½½å’Œä½¿ç”¨çš„ presets (ä¸€ç»„æ’ä»¶) åˆ—è¡¨</span></span><br><span class="line">  generatorOpts: &#123;&#125;,<span class="comment">// åŒ…å«è¦ä¼ é€’ç»™ babel ä»£ç ç”Ÿæˆå™¨(babel-generator)çš„é€‰é¡¹å¯¹è±¡</span></span><br><span class="line">  parserOpts:&#123;&#125;,<span class="comment">// éœ€è¦ä¼ é€’ç»™ babel è§£æå™¨ï¼Œbabylon çš„é€‰é¡¹å¯¹è±¡</span></span><br><span class="line">  only: <span class="literal">null</span>,<span class="comment">// å¾…ç¼–è¯‘çš„æ–‡ä»¶ï¼Œæ­£åˆ™ï¼Œå­—ç¬¦ä¸²æˆ–æ•°ç»„å½¢å¼</span></span><br><span class="line">  ignore: <span class="literal">null</span>,<span class="comment">// æ— éœ€ç¼–è¯‘çš„æ–‡ä»¶</span></span><br><span class="line">  minified: <span class="literal">false</span>,<span class="comment">// ä¿è¯è¾“å‡ºæœ€å°åŒ–(ä¸è¾“å‡ºä»£ç å—æœ€åä¸€ä¸ªåˆ†å·ï¼Œè¾“å‡ºæ–‡å­—ä¸ºå­—ç¬¦ä¸²è€Œä¸æ˜¯è½¬ä¹‰å­—ç¬¦ä¸²ï¼Œå®‰å…¨æƒ…å†µä¸‹ new åçš„ () ä¼šè¢«å»é™¤)</span></span><br><span class="line">  babelrc: <span class="literal">true</span>,<span class="comment">// æŒ‡å®šæ˜¯å¦ä½¿ç”¨ .babelrc å’Œ babelignore é…ç½®æ–‡ä»¶ï¼Œå‘½ä»¤è¡Œä½¿ç”¨ --no-babelrc ä»£æ›¿</span></span><br><span class="line">  extends: <span class="literal">null</span>,<span class="comment">// æ‰©å±• .babelrc æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">  sourceType:	<span class="string">"module"</span>,<span class="comment">//	è®¾ç½® babel è§£æä»£ç çš„æ¨¡å¼ã€‚å¯ä»¥è®¾ç½®ä¸º â€œscriptâ€ æˆ– â€œmoduleâ€ </span></span><br><span class="line">  sourceRoot:	(moduleRoot),<span class="comment">//	æ‰€æœ‰ source éƒ½æ˜¯ç›¸å¯¹äº root çš„</span></span><br><span class="line">  retainLines: <span class="literal">false</span>,<span class="comment">// ä¿ç•™è¡Œå·ã€‚è¿™å°†å¯¼è‡´ä»£ç å˜å¾—å¾ˆå¤æ€ªï¼Œé€‚ç”¨äºä¸èƒ½ä½¿ç”¨ source map çš„åœºæ™¯</span></span><br><span class="line">  sourceMaps: <span class="literal">false</span>,<span class="comment">//	å¦‚æœä¸º true ï¼Œæ·»åŠ ä¸€ä¸ª map å±æ€§åœ¨è¾“å‡ºçš„è¿”å›å€¼ä¸­ã€‚å¦‚æœè®¾ç½®ä¸º "inline" ï¼Œå¸¦æœ‰ sourceMappingURL æŒ‡ä»¤çš„æ³¨é‡Šè¢«æ·»åŠ åˆ°è¿”å›ä»£ç çš„åº•éƒ¨ã€‚å¦‚æœè®¾ç½®ä¸º "both" ï¼Œåˆ™ä¼šè¿”å› map å±æ€§å¹¶è¿½åŠ  source map æ³¨é‡Šã€‚å‘½ä»¤è¡Œä½¿ç”¨ --source-maps</span></span><br><span class="line">  sourceMapTarget: (filenameRelative),<span class="comment">//	åœ¨è¿”å› souremap æ—¶è®¾ç½® file</span></span><br><span class="line">  inputSourceMap: <span class="literal">null</span>,<span class="comment">// è¾“å‡ºçš„ source map å°†åŸºäºè¯¥ source map å¯¹è±¡</span></span><br><span class="line">  sourceFileName: (filenameRelative),<span class="comment">// åœ¨è¿”å›çš„ source map ä¸Šè®¾ç½® sources[0]</span></span><br><span class="line">  auxiliaryCommentAfter: <span class="literal">null</span>,<span class="comment">// åœ¨æ‰€æœ‰éç”¨æˆ·ç¼–å†™ä»£ç åæ·»åŠ æ³¨é‡Š</span></span><br><span class="line">  auxiliaryCommentBefore: <span class="literal">null</span>,<span class="comment">// åœ¨æ‰€æœ‰éç”¨æˆ·ç¼–å†™ä»£ç å‰æ·»åŠ æ³¨é‡Š</span></span><br><span class="line">  commets: <span class="literal">true</span>,<span class="comment">// æ˜¯å¦åœ¨ç”Ÿæˆçš„ä»£ç ä¸­æ·»åŠ æ³¨é‡Š</span></span><br><span class="line">  shouldPrintComment: <span class="literal">null</span>,<span class="comment">// æ˜¯å¦éœ€è¦è¾“å‡ºæ³¨é‡Šã€‚å…·ä½“è°ƒç”¨ä¸º shouldPrintComment(commentContents)ã€‚å°†è¦†ç›– commets é€‰é¡¹</span></span><br><span class="line">  compact: <span class="string">'auto'</span>,<span class="comment">// æ˜¯å¦åŒ…å«å¤šä½™çš„ç©ºæ ¼ç¬¦å’Œæ¢è¡Œç¬¦ï¼Œå½“è¾“å…¥å¤§äº 500KB æ—¶ï¼Œcompact å±æ€§è‡ªåŠ¨è®¾ç½®ä¸ºçœŸå€¼</span></span><br><span class="line">  ast: <span class="literal">true</span><span class="comment">// æ˜¯å¦åœ¨è¿”å›å¯¹è±¡åŒ…å« ast æŠ½è±¡è¯­æ³•æ ‘ abstract syntax tree</span></span><br><span class="line">  code: <span class="literal">true</span>,<span class="comment">// æ˜¯å¦å¯ç”¨ä»£ç ç”Ÿæˆé€‰é¡¹</span></span><br><span class="line">  env: &#123;&#125;,<span class="comment">// é…ç½®ç»™ä¸åŒç¯å¢ƒçš„é€‰é¡¹ã€‚ç¯å¢ƒé…ç½®çš„ä¼˜å…ˆçº§ä¾æ¬¡ä¸º BABEL_ENV, NODE_ENVï¼Œé»˜è®¤'development'ç¯å¢ƒã€‚env é…ç½®å¦‚ &#123; env: &#123; 'product': /* options */ &#125; &#125;</span></span><br><span class="line">  filename: <span class="string">'unknown'</span>,<span class="comment">// åœ¨é”™è¯¯ä¿¡æ¯æ˜¯ä½¿ç”¨çš„æ–‡ä»¶åç­‰</span></span><br><span class="line">  filenameRelative: (filename),<span class="comment">//	ç›¸å¯¹äº sourceRoot çš„æ–‡ä»¶å</span></span><br><span class="line">  moduleId: <span class="literal">null</span>,<span class="comment">// æŒ‡å®šæ¨¡å— ID çš„è‡ªå®šä¹‰åç§°</span></span><br><span class="line">  moduleIds: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦ä¸ºæ¨¡å—æŒ‡å®šæ˜ç¡®çš„ IDã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ¨¡å—éƒ½æ˜¯åŒ¿åçš„(ä¸é€‚ç”¨äº common æ¨¡å—)</span></span><br><span class="line">  moduleRoot: (sourceRoot),<span class="comment">// AMD æ¨¡å—æ ¼å¼åŒ–ç¨‹åºçš„å¯é€‰å‰ç¼€ï¼Œå¯ä»¥è¢«é¢„å…ˆæ·»åŠ åˆ°æ¨¡å—å®šä¹‰çš„æ–‡ä»¶åå½“ä¸­</span></span><br><span class="line">  getModuleId: <span class="literal">null</span>,<span class="comment">// æŒ‡å®šå›è°ƒå‡½æ•° getModuleId(moduleName) ç”Ÿæˆæ¨¡å— IDã€‚è¿”å›falseï¼Œæ„å‘³æ¨¡å— ID å·²è¢«ä½¿ç”¨</span></span><br><span class="line">  highlightCode: <span class="literal">true</span>,<span class="comment">// ANSI é”™è¯¯è¯­æ³•é«˜äº®æ˜¾ç¤º</span></span><br><span class="line">  resolveModuleSource: <span class="literal">null</span>,<span class="comment">// è§£ææ¨¡å—å…¥å£ï¼Œä¾‹å¦‚ import "SOURCE"; å¼•å…¥è‡ªå®šä¹‰å€¼ã€‚å…·ä½“è°ƒç”¨ä¸º resolveModuleSource(source, filename)</span></span><br><span class="line">  wrapPluginVisitorMethod: <span class="literal">null</span>,<span class="comment">// å¯ç”¨äºåŒ…è£…è®¿é—®è€…æ¨¡å¼çš„å¯é€‰å›è°ƒã€‚æ³¨æ„: è¿™å¯¹äºè‡ªæˆ‘æ£€æŸ¥è¿™æ ·çš„äº‹æ˜¯æœ‰å¿…è¦çš„ï¼Œå¹¶ä¸”ä¸éœ€è¦å®ç°ä»»ä½•æ–¹æ³•ã€‚å…·ä½“è°ƒç”¨ä¸º wrapPluginVisitorMethod(pluginAlias, visitorType, callback)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="plugins-presets-æ’ä»¶"><a href="#plugins-presets-æ’ä»¶" class="headerlink" title="plugins presets æ’ä»¶"></a>plugins presets æ’ä»¶</h3><p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<p><a href="https://babeljs.cn/docs/plugins/" target="_blank" rel="noopener">babel plugins</a>ã€‚</p>
<p>plugins ä¸ºç¼–è¯‘æ—¶è°ƒç”¨çš„æ’ä»¶ï¼Œpresets ä¸ºå®˜æ–¹å°è£…çš„æ’ä»¶é›†åˆã€‚ç¼–è¯‘æ—¶ï¼Œplugin è¿è¡Œåœ¨ preset å‰ï¼Œplugin é¡ºåºæ‰§è¡Œï¼Œpreset ååºæ‰§è¡Œã€‚é…ç½®æ—¶ï¼Œâ€™babel-plugin-â€˜, â€˜babel-preset-â€˜ å‰ç¼€å¯ä»¥å¿½ç•¥ï¼Œbabel å°†è‡ªåŠ¨æ‹¼æ¥ï¼Œå¹¶åœ¨ node_modules ç›®å½•ä¸­æŸ¥æ‰¾ã€‚å½“ babel æ’ä»¶ä¸åœ¨å·¥ç¨‹ç›®å½•ä¸­æ—¶ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶çš„ç»å¯¹è·¯å¾„åŠ ä»¥é…ç½®ï¼Œå¦‚ â€œpluginsâ€: [â€œ./node_modules/asdf/pluginâ€]ã€‚æ’ä»¶é€‰é¡¹é…ç½®é€šè¿‡å°†æ’ä»¶åç§°å’Œé€‰é¡¹å¯¹è±¡æ”¾ç½®åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸­å®ç°ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// æ‰§è¡Œé¡ºåºä¸º "transform-decorators-legacy", "transform-class-properties"</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    <span class="string">"transform-decorators-legacy"</span>,</span><br><span class="line">    <span class="string">"transform-class-properties"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ‰§è¡Œé¡ºåºä¸º "stage-2", "react", "es2015"</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    <span class="string">"es2015"</span>,</span><br><span class="line">    <span class="string">"react"</span>,</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é…ç½®é€‰é¡¹</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"transform-async-to-module-method"</span>, &#123;</span><br><span class="line">      <span class="attr">"module"</span>: <span class="string">"bluebird"</span>,</span><br><span class="line">      <span class="attr">"method"</span>: <span class="string">"coroutine"</span></span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="presets-å®˜æ–¹æ’ä»¶é›†åˆ"><a href="#presets-å®˜æ–¹æ’ä»¶é›†åˆ" class="headerlink" title="presets å®˜æ–¹æ’ä»¶é›†åˆ"></a>presets å®˜æ–¹æ’ä»¶é›†åˆ</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  // env åŒ…å«es2015, es2016, es2017 åŠæœ€æ–°ç‰ˆæœ¬</span><br><span class="line">  // å‚è€ƒæ–‡æ¡£ï¼š[](https://babeljs.cn/docs/plugins/preset-env/)</span><br><span class="line">  [<span class="string">"babel-preset-env"</span>,&#123;</span><br><span class="line">    "targets": &#123;&#125;,// è®¾å®šé€‚é…ç¯å¢ƒï¼Œå¦‚ &#123; node: "6.10" &#125;ã€‚æ”¯æŒçš„ç¯å¢ƒæœ‰ browsers, chrome, opera, edge, firefox, safari, ie, ios, android, node, electronã€‚æµè§ˆå™¨ç«¯æ¸…å• https://github.com/ai/browserslistï¼Œå¦‚ &#123; "chrome": 52, "browsers": ["last 2 versions", "safari 7"] &#125;ã€‚uglify å±æ€§è®¾ç½®ä¸º trueï¼Œuglify-js å‹ç¼©è„šæœ¬æ—¶å·²ç¼–è¯‘ä¸º es5 è¯­æ³•</span><br><span class="line">    "spec": false,// æ˜¯å¦å…è®¸æ’ä»¶å¯ç”¨ "spec" è½¬æ¢ï¼Œæ›´ç¬¦åˆè§„èŒƒï¼Œç¼–è¯‘è¾ƒæ…¢</span><br><span class="line">    "loose": false,// æ˜¯å¦å…è®¸æ’ä»¶å¯ç”¨ "loose" è½¬æ¢</span><br><span class="line">    "modules": "commonjs",// å°†es6æ¨¡å—è¯­æ³•è½¬æ¢ä¸ºå¦ä¸€ä¸ªæ¨¡å—ç±»å‹ã€‚å¯é€‰å€¼ä¸º "amd" | "umd" | "systemjs" | "commonjs" | falseã€‚false å°†ä¸ä¼šè½¬æ¢ä»»ä½•æ¨¡å—</span><br><span class="line">    "include": [],// åŒ…å«çš„æ’ä»¶ã€‚include ä¸ exclude é€‰é¡¹ä»…ä»…é€‚ç”¨äº preset ä¸­åŒ…å«çš„æ’ä»¶ã€‚å¯é…ç½®ä¸º ["transform-es2015-arrow-functions", "es6.map"]ã€‚"es6.map" ä¸º [Built-ins](https://github.com/babel/babel-preset-env/blob/master/data/built-in-features.js)</span><br><span class="line">    "exclude": [],// ç§»é™¤çš„æ’ä»¶</span><br><span class="line">    "useBuiltIns": false// æ˜¯å¦åœ¨ env ä¸­å¼•å…¥ babel-ployfillï¼Œä»¥é¿å…åœ¨æ¨¡å—ä¸­è°ƒç”¨ import "babel-polyfill"ã€‚npm &gt; 3ï¼Œbabel 6</span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  [<span class="string">"babel-preset-es2015"</span>,&#123;</span><br><span class="line">    <span class="attr">"loose"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"spec"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"modules"</span>: <span class="string">"commonjs"</span></span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-es2016",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-es2017",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-react",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  ["babel-preset-flow",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 3 å€™é€‰ï¼šå®Œæˆè§„èŒƒå’Œæµè§ˆå™¨åˆæ­¥å®ç°ã€‚Stage 4 å°†åˆ°ä¸‹ä¸€å¹´åº¦å‘è¡Œ</span><br><span class="line">  ["babel-preset-stage-3",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 2  åˆç¨¿: å®Œæˆåˆæ­¥è§„èŒƒã€‚åŒ…å« preset-stage-3 æ‰€æœ‰æ’ä»¶</span><br><span class="line">  ["babel-preset-stage-2",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 1  ææ¡ˆ: åˆæ­¥å°è¯•ã€‚åŒ…å« preset-stage-2, preset-stage-3 æ‰€æœ‰æ’ä»¶</span><br><span class="line">  ["babel-preset-stage-1",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">  // stage 0  ç¨»è‰äºº: åªæ˜¯ä¸€ä¸ªæƒ³æ³•ã€‚åŒ…å« preset-stage-1, preset-stage-2, preset-stage-3 æ‰€æœ‰æ’ä»¶</span><br><span class="line">  ["babel-preset-stage-0",&#123; &#125;],</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="plugin-æ’ä»¶"><a href="#plugin-æ’ä»¶" class="headerlink" title="plugin æ’ä»¶"></a>plugin æ’ä»¶</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  // es3</span><br><span class="line">  [<span class="string">"babel-plugin-transform-es3-property-literals"</span>,&#123; &#125;],// å®šä¹‰å¯¹è±¡å±æ€§æ—¶åŒ…è£¹ä¸ŠåŒå¼•å·</span><br><span class="line">  [<span class="string">"babel-plugin-transform-es3-member-expression-literals"</span>,&#123; &#125;],// ä½¿ç”¨å¯¹è±¡å±æ€§æ—¶åŒ…è£¹ä¸ŠåŒå¼•å·</span><br><span class="line"></span><br><span class="line">  // es5</span><br><span class="line">  [<span class="string">"abel-plugin-transform-es5-property-mutators"</span>,&#123; &#125;],// å¯¹è±¡è®¿é—®å™¨å±æ€§ get, set æ–¹æ³•</span><br><span class="line"></span><br><span class="line">  // es2015</span><br><span class="line">  [<span class="string">"check-es2015-constants"</span>,&#123; &#125;],// å¸¸é‡åªè¯»æ£€æŸ¥</span><br><span class="line">  [<span class="string">"transform-es2015-block-scoped-functions"</span>,&#123; &#125;],// åœ¨å—ä¸­å£°æ˜çš„å‡½æ•°åªåœ¨å—ä¸­å¯ç”¨</span><br><span class="line">  ["transform-es2015-block-scoping",&#123;// let å—çº§ä½œç”¨åŸŸ</span><br><span class="line">    "throwIfClosureRequired": false// for() è¯­å¥ä¸­å®šä¹‰çš„ let åœ¨ &#123;&#125; ä¸­ä½¿ç”¨ï¼Œæ˜¯å¦ç›´æ¥æŠ¥é”™</span><br><span class="line">  &#125;],</span><br><span class="line">  [<span class="string">"transform-es2015-arrow-functions"</span>,&#123; </span><br><span class="line">    <span class="attr">"spec"</span>: <span class="literal">false</span></span><br><span class="line">  &#125;],// ç®­å¤´å‡½æ•°è½¬æ¢</span><br><span class="line">  ["transform-es2015-classes",&#123;// ç±»è½¬æ¢</span><br><span class="line">    "loose": false// loose æ¨¡å¼ä¸‹ï¼ŒåŸå‹æ–¹æ³•å¯æšä¸¾ï¼Œä¸”ä¸èƒ½åœ¨å­ç±»ä¸­é‡å¤å®šä¹‰</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-es2015-computed-properties",&#123; &#125;],// å¯¹è±¡è®¡ç®—å±æ€§è½¬æ¢ï¼Œå¦‚ [x + 'foo'] å±æ€§</span><br><span class="line">  ["transform-es2015-destructuring",&#123; &#125;],// è§£æ„</span><br><span class="line">  ["transform-es2015-duplicate-keys",&#123; &#125;],// å°†åŒåå±æ€§è½¬æ¢ä¸ºè®¡ç®—å±æ€§ï¼Œå†ç”± transform-es2015-computed-properties æ’ä»¶å¤„ç†</span><br><span class="line">  ["transform-es2015-for-of",&#123; &#125;],// for of è¯­æ³•</span><br><span class="line">  ["transform-es2015-function-name",&#123; &#125;],// function.name</span><br><span class="line">  ["transform-es2015-literals",&#123; &#125;],// äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶æ•´æ•°ï¼Œunicode å­—é¢é‡</span><br><span class="line">  ["transform-es2015-modules-commonjs",&#123; &#125;],// è½¬æ¢æˆ commonjs æ¨¡å—ã€‚ä½¿ç”¨ babel-plugin-add-module-exports æ’ä»¶ï¼Œé¿å…ä½¿ç”¨ require("your-module").default è°ƒç”¨æ¨¡å—ï¼Œå¯ç›´æ¥ä½¿ç”¨ require("your-module")</span><br><span class="line">  ["transform-es2015-object-super",&#123; &#125;],// super çˆ¶ç±»è½¬æ¢???</span><br><span class="line">  ["transform-es2015-parameters",&#123; &#125;],// è§£æ„å‡½æ•°å‚æ•°ï¼Œè®¾ç½®é»˜è®¤å€¼ï¼Œ...arræ”¯æŒã€‚é»˜è®¤ä½¿ç”¨ let å¤„ç†å‚æ•°ï¼Œéœ€è¦é…åˆä½¿ç”¨ transform-es2015-block-scoping æ’ä»¶</span><br><span class="line">  ["transform-es2015-shorthand-properties",&#123; &#125;],// å…è®¸ &#123; a &#125; æ–¹å¼èµ‹å€¼å¯¹è±¡ï¼Œè½¬æ¢ä¸º &#123; a: a &#125;</span><br><span class="line">  ["transform-es2015-spread",&#123;// ...a</span><br><span class="line">    "loose": false</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-es2015-sticky-regex",&#123; &#125;],// æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºæ­£åˆ™æ„é€ å‡½æ•°å½¢å¼</span><br><span class="line">  [<span class="string">"transform-es2015-template-literals"</span>,&#123; </span><br><span class="line">    "loose": false,// è®¾ç½®ä¸ºtrueæ—¶ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å¯¹è±¡ä¸ä¼šè¢« frozen</span><br><span class="line">    "spec": false// æ˜¯å¦ç”¨ String å‡½æ•°åŒ…è£¹æ¨¡æ¿å­—ç¬¦ä¸²å†…å˜é‡</span><br><span class="line">  &#125;],// æ¨¡æ¿å­—ç¬¦ä¸²</span><br><span class="line">  ["transform-es2015-typeof-symbol",&#123; &#125;],// typeof Symbol() === "symbol" è¯­æ³•æ”¯æŒ</span><br><span class="line">  ["transform-es2015-unicode-regex",&#123; &#125;],// unicode æ­£åˆ™???</span><br><span class="line">  ["transform-regenerator",&#123;// ç”Ÿæˆå™¨å‡½æ•°ï¼Œé¡µé¢éœ€è¦å¼•å…¥ babel-ployfill æˆ– regenerator-runtime è¿è¡Œæ—¶è„šæœ¬ã€‚ä½¿ç”¨ async å‡½æ•°ï¼Œéœ€è¦æ·»åŠ  syntax-async-functions æ’ä»¶</span><br><span class="line">    "asyncGenerators": true,</span><br><span class="line">    "generators": true,</span><br><span class="line">    "async": true</span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  // es2016</span><br><span class="line">  ["transform-exponentiation-operator",&#123; &#125;],// ** æ±‚å¹‚</span><br><span class="line"></span><br><span class="line">  // es2017</span><br><span class="line">  ["syntax-trailing-function-commas",&#123; &#125;],// å‡½æ•°å‚æ•°ååŠ ','ï¼Œæ·»åŠ å‚æ•°æ—¶åªæœ‰ä¸€è¡Œæ”¹å˜ï¼Œæ–¹ä¾¿git diff</span><br><span class="line">  ["transform-async-to-generator",&#123; &#125;],// å°† acync å‡½æ•°è½¬åŒ–ä¸ºç”Ÿæˆå™¨å‡½æ•°</span><br><span class="line"></span><br><span class="line">  // react åŒ…å« preset-flow, babel-plugin-syntax-jsx, babel-plugin-transform-react-jsx, babel-plugin-transform-react-display-name</span><br><span class="line">  // preset-flow åŒ…å« transform-flow-strip-types æ’ä»¶ï¼Œå…¶ä½™å‡ä¸ºæ’ä»¶</span><br><span class="line">  ["transform-flow-strip-types",&#123; &#125;],// ç§»é™¤ flow ç±»å‹ï¼Œä½†ä¸ä½œç±»å‹æ ¡éªŒï¼Œç±»å‹æ ¡éªŒéœ€è¦ä½¿ç”¨ flow æˆ–å¦å¤–çš„æ’ä»¶ã€‚å¦‚ function foo(one: any, two: number, three?): string &#123;&#125; å°†è½¬æ¢ä¸º function foo(one, two, three) &#123;&#125;</span><br><span class="line">  ["babel-plugin-syntax-jsx",&#123; &#125;],// è§£æ JSX</span><br><span class="line">  ["babel-plugin-transform-react-jsx",&#123; &#125;],// å°† JSX è½¬æ¢ä¸º react å‡½æ•°</span><br><span class="line">  ["babel-plugin-transform-react-display-name",&#123; &#125;],// è°ƒç”¨ React.createClass æˆ– createReactClass å‡½æ•°æ—¶è‡ªåŠ¨æ·»åŠ  displayNameï¼Œå¦‚ var bar = createReactClass(&#123;&#125;) å°†è½¬æ¢ä¸º var bar = createReactClass(&#123; displayName: "bar" &#125;)</span><br><span class="line"></span><br><span class="line">  // flow</span><br><span class="line">  ["transform-flow-strip-types",&#123; &#125;],// react preset åŒ…å«</span><br><span class="line"></span><br><span class="line">  // stage 3</span><br><span class="line">  ["transform-object-rest-spread",&#123; &#125;],// ...a è¯­æ³•æ”¯æŒ</span><br><span class="line">  ["transform-async-generator-functions",&#123; &#125;],// async å‡½æ•°è½¬æ¢ä¸ºç”Ÿæˆå™¨å‡½æ•°</span><br><span class="line"></span><br><span class="line">  // stage 2</span><br><span class="line">  ["syntax-dynamic-import",&#123; &#125;],// import() æ”¯æŒå˜é‡</span><br><span class="line">  ["transform-class-properties",&#123; &#125;],// ç±»é™æ€å±æ€§ï¼Œå®ä¾‹å±æ€§ã€æ–¹æ³•ç­‰</span><br><span class="line"></span><br><span class="line">  // stage 1</span><br><span class="line">  ["transform-class-constructor-call",&#123; &#125;],// ç±»ä½œä¸ºæ™®é€šå‡½æ•°ä½¿ç”¨</span><br><span class="line">  ["transform-export-extensions",&#123; &#125;],// export * as ns from 'mod'; export v from 'mod'; è¯­æ³•æ”¯æŒ</span><br><span class="line"></span><br><span class="line">  // stage 0</span><br><span class="line">  ["transform-do-expressions",&#123; &#125;],// do &#123;&#125; è¯­æ³•æ”¯æŒï¼Œæ„é€ å—çº§ä½œç”¨åŸŸï¼Œæœ€ç»ˆæ‰§è¡Œè¯­å¥ä½œä¸ºè¿”å›å€¼</span><br><span class="line">  ["transform-function-bind",&#123; &#125;],// obj::func è½¬æ¢ä¸º func.bind(obj)ï¼›::obj.func è½¬æ¢ä¸º obj.func.bind(obj)ï¼›obj::func(val) è½¬æ¢ä¸º func.call(obj, val)ï¼›::obj.func(val) è½¬æ¢ä¸º obj.func.call(obj, val)</span><br><span class="line">  </span><br><span class="line">  // æ¨¡å—</span><br><span class="line">  ["es2015-modules-amd",&#123; &#125;],// å°†æ¨¡å—å¯¼å‡ºä¸º amd æ¨¡å—</span><br><span class="line">  ["es2015-modules-commonjs",&#123;// å°†æ¨¡å—å¯¼å‡ºä¸º commonjs æ¨¡å—</span><br><span class="line">    "loose": false,// loose æ¨¡å¼ä¸‹ï¼Œimport, export å¯åœ¨å…¨å±€ä½¿ç”¨ï¼›é loose æ¨¡å¼ä¸‹ï¼Œåªèƒ½åœ¨å¤–å±‚ä½¿ç”¨ã€‚é loose æ¨¡å¼ä¸‹ï¼Œé€šè¿‡ defineProperty è¯­å¥æ³¨å…¥ä¸å¯æšä¸¾çš„ __esModule å±æ€§ï¼›loose æ¨¡å¼ä¸‹ï¼Œé€šè¿‡èµ‹å€¼æ³¨å…¥ __esModule å±æ€§</span><br><span class="line">    "strict": false,// strict å±æ€§ç½®ä¸ºçœŸï¼Œå°†é˜»æ­¢å¯¼å‡º __esModule å±æ€§</span><br><span class="line">    "noInterop": false// åŠ è½½æ¨¡å—æ—¶ï¼Œæ˜¯å¦ä¸ä½¿ç”¨ function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;ï¼Œé€‚ç”¨äºä¸éœ€è¦ default å±æ€§çš„åœºæ™¯</span><br><span class="line">  &#125;],</span><br><span class="line">  ["es2015-modules-systemjs",&#123;// å°†æ¨¡å—å¯¼å‡ºä¸º SystemJS æ¨¡å—</span><br><span class="line">    "systemGlobal": "SystemJS"</span><br><span class="line">  &#125;],</span><br><span class="line">  ["es2015-modules-umd",&#123;// ä¾æ® define, exports å˜é‡æœ‰æ— ï¼Œåˆ†åˆ«å¯¼å‡º amd, commonjs ç­‰æ¨¡å—</span><br><span class="line">     "globals": &#123;&#125;,// ç”¨äºè®¾ç½®å¯¼å‡ºå˜é‡åï¼Œå¦‚ "globals": &#123; "es6-promise": "Promise" &#125;</span><br><span class="line">     "exactGlobals": true// è§„èŒƒåŒ–æ³¨å…¥çš„å…¨å±€å˜é‡???</span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">  // å®éªŒé˜¶æ®µ</span><br><span class="line">  ["async-generator-functions",&#123; &#125;],// stage 3 åŒ…å«</span><br><span class="line">  ["transform-async-to-module-method",&#123; &#125;],// å°† async å‡½æ•°è½¬æ¢ä¸º Bluebird coroutine</span><br><span class="line">  ["class-properties",&#123; &#125;],// stage 2 åŒ…å«</span><br><span class="line">  ["transform-decorators-legacy",&#123; &#125;],// è£…é¥°å™¨ï¼Œbabel 7 åŒ…å«åœ¨ stage 0 ä¸­ã€‚å¹³å¸¸å¼€å‘æ—¶ï¼Œéœ€è¦é€šè¿‡ plugins é…ç½®æ³¨å…¥</span><br><span class="line">  ["do-expressions",&#123; &#125;],// stage 0 åŒ…å«</span><br><span class="line">  ["export-extensions",&#123; &#125;],// stage 1 åŒ…å«</span><br><span class="line">  ["function-bind",&#123; &#125;],// stage 0 åŒ…å«</span><br><span class="line">  ["object-rest-spread",&#123; &#125;],// stage 3 åŒ…å«</span><br><span class="line"></span><br><span class="line">  // Minification</span><br><span class="line">  ["transform-inline-environment-variables",&#123;// å°†ç¯å¢ƒå˜é‡ä»¥å­—ç¬¦ä¸²å½¢å¼æ³¨å…¥æ¨¡å—</span><br><span class="line">    "include": [],// æ³¨å…¥çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚ "include": [ "NODE_ENV" ]</span><br><span class="line">    "exclude": []// ç§»é™¤çš„ç¯å¢ƒå˜é‡</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-inline-consecutive-adds",&#123; &#125;],// å°†å¯¹è±¡å±æ€§çš„èµ‹å€¼å’Œæ•°ç»„ push æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ç§»å…¥å£°æ˜ä¸­ï¼Œå‰æèµ‹å€¼å’Œ push ç´§è·Ÿåœ¨å£°æ˜å</span><br><span class="line">  ["member-expression-literals",&#123;&#125;],// å¯¹è±¡å±æ€§åå«å…³é”®å­—ï¼Œä»¥è®¡ç®—å±æ€§ [''] è¡¨ç¤ºï¼›ä¸å«ï¼Œé‡‡ç”¨ . åˆ†å‰²å½¢å¼</span><br><span class="line">  ["transform-minify-booleans",&#123;&#125;],// ä»¥ !0 ä»£æ›¿ trueï¼Œ!1 ä»£æ›¿ false</span><br><span class="line">  ["minify-dead-code-elimination",&#123;// ç²¾ç®€æ— ç”¨ä»£ç </span><br><span class="line">    "keepFnName": true,// é˜²æ­¢æ’ä»¶åˆ é™¤å‡½æ•°å</span><br><span class="line">    "keepFnArgs": true,// é˜²æ­¢æ’ä»¶åˆ é™¤å‡½æ•°å‚æ•°</span><br><span class="line">    "keepClassName": true,// é˜²æ­¢æ’ä»¶åˆ é™¤ç±»å</span><br><span class="line">  &#125;],</span><br><span class="line">  ["minify-flip-comparisons",&#123;&#125;],// ç²¾ç®€ç¿»è½¬è¾“å‡ºï¼ŒåŸºäºé‡å¤çš„å†…å®¹è¿›è¡Œå‹ç¼©ç®—æ³•ä¼˜åŒ–ï¼Œä¾‹å¦‚ gzipã€‚bar !== null è½¬æ¢ä¸º null !== bar</span><br><span class="line">  ["minify-guarded-expressions",&#123;&#125;],// ç²¾ç®€å®ˆæŠ¤è¡¨è¾¾å¼ï¼Œé’ˆå¯¹ &amp;&amp;, ||ï¼Œ0 &amp;&amp; new Foo() è½¬æ¢ä¸º 0</span><br><span class="line">  ["minify-infinity",&#123;&#125;],// ç²¾ç®€æ— ç©·å¤§ï¼ŒInfinity è½¬æ¢ä¸º 1/0</span><br><span class="line">  ["minify-mangle-names",&#123;&#125;],// æ ¹æ®ä½œç”¨åŸŸç²¾ç®€ä¸€æ¬¡æ€§ä½¿ç”¨çš„å˜é‡å</span><br><span class="line">  ["minify-numeric-literals",&#123;&#125;],// é€šè¿‡ç§‘å­¦è®¡æ•°æ³•ç²¾ç®€æ•°å€¼å­—é¢é‡</span><br><span class="line">  ["minify-replace",&#123;// ç”¨ç»™å®šèŠ‚ç‚¹æ›¿æ¢å˜é‡</span><br><span class="line">    "identifierName": null,// å¾…æ›¿æ¢çš„å˜é‡åï¼Œå¦‚ __DEV__</span><br><span class="line">    "replacement": &#123;&#125;// æ›¿æ¢è§„åˆ™ï¼Œå¦‚ &#123; type: "numericLiteral", value: 0, &#125;ï¼Œæ•ˆæœæ˜¯å°† __DEV__ è½¬æ¢ä¸º 0</span><br><span class="line">  &#125;],</span><br><span class="line">  ["minify-simplify",&#123;&#125;],// ç®€åŒ–ï¼Œif (x) a(); å°†è½¬æ¢ä¸º x &amp;&amp; a()ï¼ŒNumber(foo) å°†è½¬æ¢ä¸º +foo</span><br><span class="line">  ["minify-type-constructors",&#123;// å°†æ„é€ å‡½æ•°è½¬åŒ–ä¸ºå­—é¢é‡ï¼Œä¸æ¨èåœ¨ IE8 ä¸­ä½¿ç”¨</span><br><span class="line">    "array": true,// æ˜¯å¦å¯ç”¨ Array æ„é€ å‡½æ•°</span><br><span class="line">    "boolean": true,// æ˜¯å¦å¯ç”¨ Boolean æ„é€ å‡½æ•°</span><br><span class="line">    "number": true,// æ˜¯å¦å¯ç”¨ Number æ„é€ å‡½æ•°</span><br><span class="line">    "object": true,// æ˜¯å¦å¯ç”¨ Object æ„é€ å‡½æ•°</span><br><span class="line">    "string": true// æ˜¯å¦å¯ç”¨ String æ„é€ å‡½æ•°</span><br><span class="line">  &#125;],</span><br><span class="line">  ["transform-node-env-inline",&#123;&#125;],// å°† process.env.NODE_ENV === "development"; è½¬æ¢ä¸º true | false</span><br><span class="line">  ["transform-property-literals",&#123;&#125;],// å¯¹éå…³é”®å­—å±æ€§å–å‡ºåŒå¼•å·</span><br><span class="line">  ["transform-regexp-constructors",&#123;&#125;],// æ­£åˆ™æ„é€ å‡½æ•°è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">  ["transform-remove-console",&#123;&#125;],// ç§»é™¤console</span><br><span class="line">  ["transform-remove-debugger",&#123;&#125;],// ç§»é™¤debugger</span><br><span class="line">  ["simplify-comparison-operators",&#123;&#125;],// å½“æ¯”è¾ƒç±»å‹ç›¸åŒæ—¶ï¼Œå°† ===, !== è½¬æ¢ä¸º ==, !=</span><br><span class="line">  ["transform-undefined-to-void",&#123;&#125;],// å°† undefined è½¬æ¢ä¸º void 0</span><br><span class="line"></span><br><span class="line">  // react</span><br><span class="line">  ["transform-react-constant-elements",&#123;&#125;],// å°†å¸¸é‡å…ƒç´ (ä½œä¸ºè¿”å›å€¼)æå–åˆ°æœ€å¤–å±‚ï¼Œå¦‚ const Hr = () =&gt; &#123; return &lt;hr className="hr" /&gt;; &#125;; å°†è½¬æ¢ä¸º const _ref = &lt;hr className="hr" /&gt;; const Hr = () =&gt; &#123; return _ref; &#125;; è‹¥å…ƒç´ åŒ…å« ...props æˆ– ref å±æ€§ï¼Œå°†ä¸äºˆè½¬æ¢</span><br><span class="line">  ["transform-react-display-name",&#123;&#125;],// react preset åŒ…å«</span><br><span class="line">  ["transform-react-inline-elements",&#123;&#125;],// å°† React.createElement è½¬æ¢ä¸º babelHelpers.jsxï¼Œå¦‚ &lt;Baz foo="bar" key="1"&gt;&lt;/Baz&gt;; å°†è½¬æ¢ä¸º babelHelpers.jsx(Baz, &#123; foo: "bar" &#125;, "1"); è‹¥å…ƒç´ åŒ…å« ...props æˆ– ref å±æ€§ï¼Œå°†ä¸äºˆè½¬æ¢</span><br><span class="line">  ["transform-react-jsx",&#123;&#125;],// react preset åŒ…å«</span><br><span class="line">  ["transform-react-jsx-compat",&#123;&#125;],// å°† JSX è½¬æ¢ä¸º React Pre-0.12 å‡½æ•°ï¼Œå¦‚ var profile = &lt;div&gt;&lt;img src="avatar.png" class="profile" /&gt;&lt;/div&gt;; å°†è½¬æ¢ä¸º var profile = React.DOM.div(null, React.DOM.img(&#123; src: "avatar.png", "class": "profile" &#125;) );</span><br><span class="line">  ["transform-react-jsx-self",&#123;&#125;],// JSX å…ƒç´ ä¸­æ·»åŠ  __self å±æ€§ä¸º thisï¼Œä»¥ä¾¿äº react è¿è¡Œæ—¶æŠ¥é”™</span><br><span class="line">  ["transform-react-jsx-source",&#123;&#125;],// JSX å…ƒç´ ä¸­æ·»åŠ  __source å±æ€§ä¸º &#123; fileName: 'this/file.js', lineNumber: 10 &#125; ç­‰ï¼Œä»¥ä¾¿äº react è¿è¡Œæ—¶æŠ¥é”™</span><br><span class="line"></span><br><span class="line">  // å…¶ä»–</span><br><span class="line">  ["transform-eval",&#123;&#125;],// eval("(() =&gt; 'foo')"); å°†è½¬æ¢ä¸º eval("(function () &#123; return 'foo'; &#125;)");</span><br><span class="line">  ["transform-flow-comments",&#123;&#125;],// å°† flow ç±»å‹è¯´æ˜è½¬æ¢ä¸ºæ³¨é‡Š???</span><br><span class="line">  ["transform-flow-strip-types",&#123;&#125;],// react, flow preset åŒ…å«</span><br><span class="line">  ["transform-jscript",&#123;&#125;],// å°†å‡½æ•°è¡¨è¾¾å¼é€šè¿‡è‡ªè°ƒç”¨åŒ¿åå‡½æ•°èµ‹å€¼</span><br><span class="line">  ["transform-object-assign",&#123;&#125;],// å°† Object.assign å‡½æ•°è½¬æ¢ä¸º ... è¯­å¥ï¼Œä¸é€‚ç”¨äº const &#123; assign &#125; = Objectåœºæ™¯</span><br><span class="line">  ["transform-object-set-prototype-of-to-assign",&#123;&#125;],// å°† Object.setPrototypeOf è½¬æ¢ä¸º ... è¯­å¥</span><br><span class="line">  ["transform-proto-to-assign",&#123;&#125;],// å¯¹è±¡ __proto__ èµ‹å€¼è½¬æ¢ä¸º ... è¯­å¥</span><br><span class="line">  ["transform-regenerator",&#123;&#125;],// es2015 åŒ…å«</span><br><span class="line">  ["transform-runtime",&#123;// æ— éœ€é€šè¿‡æ±¡æŸ“å…¨å±€å¯¹è±¡è°ƒç”¨æœ€æ–°çš„ apiï¼Œæ¨¡å—éœ€è¦æ³¨å…¥ babel-runtimeã€‚å‚è€ƒæ–‡æ¡£ï¼š[tranform-runtime](https://babeljs.cn/docs/plugins/transform-runtime/)</span><br><span class="line">    "helpers": true,// æ˜¯å¦å†…ç½® classCallCheck, extends ç­‰ã€‚æ¨¡å—ä¸º babel-runtime/helpers</span><br><span class="line">    "polyfill": true,// æ˜¯å¦å†…ç½® Promise, Set, Map, Symbol ç­‰ã€‚æ¨¡å—ä¸º babel-runtime/core-js</span><br><span class="line">    "regenerator": true,// æ˜¯å¦å†…ç½®ç”Ÿæˆå™¨å‡½æ•°ï¼Œasync å‡½æ•°ã€‚æ¨¡å—ä¸º babel-runtime/regenerator</span><br><span class="line">    "moduleName": "babel-runtime"// æ”¹å˜æ¨¡å—åï¼Œimport ç›¸åº”ä½œæ”¹å˜</span><br><span class="line">  &#125;],// JSX å…ƒç´ ä¸­æ·»åŠ  __self å±æ€§ä¸º thisï¼Œä»¥ä¾¿äº react è¿è¡Œæ—¶æŠ¥é”™</span><br><span class="line">  ["transform-strict-mode",&#123;&#125;],// è½¬æ¢ä¸ºä¸¥æ ¼æ¨¡å¼</span><br><span class="line">  ["external-helpers",&#123;&#125;],// å°† babel ä¸­çš„ helpers é€šè¿‡ babel-cli å¯¼å‡ºä¸ºç‹¬ç«‹æ–‡ä»¶ï¼Œç„¶ååœ¨é¡µé¢ç›´æ¥åŠ è½½</span><br><span class="line"></span><br><span class="line">  // ant-design</span><br><span class="line">  [<span class="string">"babel-plugin-import"</span>,&#123;</span><br><span class="line">    <span class="attr">"libraryName"</span>: <span class="string">"antd"</span>,</span><br><span class="line">    <span class="attr">"style"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;],</span><br><span class="line">  [<span class="string">"babel-plugin-import"</span>,&#123;</span><br><span class="line">    <span class="attr">"libraryName"</span>: <span class="string">"antd-mobile"</span>,</span><br><span class="line">    <span class="attr">"style"</span>: <span class="string">"css"</span></span><br><span class="line">  &#125;],</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="awesome-typescript-loader"><a href="#awesome-typescript-loader" class="headerlink" title="awesome-typescript-loader"></a>awesome-typescript-loader</h2><p>ç¼–è¯‘ typescriptã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">      loader: <span class="string">'awesome-typescript-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        silent: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦æ‰“å°æ—¥å¿—</span></span><br><span class="line">        compiler: <span class="string">'typescript'</span>,<span class="comment">// é€‰æ‹©ç¼–è¯‘å™¨</span></span><br><span class="line">        useTranspileModule: <span class="literal">false</span>,<span class="comment">// å¯ç”¨ transpileModule æ¨¡å¼???</span></span><br><span class="line">        instance: <span class="string">'at-loader'</span>,<span class="comment">// ä½¿ç”¨å¤šä¸ªç¼–è¯‘å™¨???</span></span><br><span class="line">        configFileName: <span class="string">'tsconfig.json'</span>,<span class="comment">// é…ç½®æ–‡ä»¶å</span></span><br><span class="line">        transpileOnly: <span class="literal">false</span>,<span class="comment">// ç½®ä¸ºçœŸï¼Œè·³è¿‡ç±»å‹æ ¡éªŒ</span></span><br><span class="line">        errorsAsWarnings: <span class="literal">false</span>,<span class="comment">// ä»¥è­¦å‘Šæ–¹å¼å¯¹å¾…é”™è¯¯</span></span><br><span class="line">        forceIsolatedModules: <span class="literal">false</span>,<span class="comment">// æ¨¡å—ä¸èƒ½åŒ…å«ä¾èµ–</span></span><br><span class="line">        ignoreDiagnostics: [],<span class="comment">// è·³è¿‡é”™è¯¯ï¼Œå¦‚ [8014] å°†è·³è¿‡ stage-1 é”™è¯¯</span></span><br><span class="line">        useBabel: <span class="literal">false</span>,<span class="comment">// ä½¿ç”¨ babel-loader</span></span><br><span class="line">        babelOptions: &#123;&#125;,<span class="comment">// é…ç½® babel-loader é€‰é¡¹</span></span><br><span class="line">        babelCore: <span class="literal">undefined</span>,<span class="comment">// @babel/core è·¯å¾„ã€‚@babel/core ä¸åœ¨ node_modules ä¸­éœ€è¦é…ç½®ï¼›babel 7 éœ€è¦é…ç½®ä¸º "@babel/core"</span></span><br><span class="line">        useCache: <span class="literal">false</span>,<span class="comment">// ä½¿ç”¨ç¼“å­˜ï¼Œæå‡é€Ÿåº¦ï¼Œä¾› babel-loader ä½¿ç”¨</span></span><br><span class="line">        usePrecompiledFiles: <span class="literal">false</span>,<span class="comment">// å¯ç”¨é¢„ç¼–è¯‘æ–‡ä»¶</span></span><br><span class="line">        cacheDirectory: <span class="string">'.awcache'</span>,<span class="comment">// ç¼“å­˜ç›®å½•</span></span><br><span class="line">        reportFiles: []<span class="comment">// è¯Šæ–­æŠ¥é“???ï¼Œå¦‚ [ "src/**/*.&#123;ts,tsx&#125;" ]</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="vue-loader"><a href="#vue-loader" class="headerlink" title="vue-loader"></a>vue-loader</h2><p>ç¼–è¯‘ vue ç»„ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.vue?$/</span>,</span><br><span class="line">      loader: <span class="string">'awesome-typescript-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        loaders: &#123;<span class="comment">// ç»„ä»¶å„éƒ¨åˆ†åŠ è½½å™¨</span></span><br><span class="line">          js: <span class="string">'babel-loader!eslint-loader'</span>,</span><br><span class="line">          template: <span class="string">'html-loader'</span>,</span><br><span class="line">          css: <span class="string">'style-loader!css-loader!less-loader'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        preLoaders: &#123;&#125;,<span class="comment">// åœ¨ loaders ä¹‹å‰å¤„ç†</span></span><br><span class="line">        postLoaders: &#123;&#125;,</span><br><span class="line">        postcss: [],<span class="comment">// æŒ‡å®šè¦åº”ç”¨äº .vue æ–‡ä»¶ä¸­ CSS çš„è‡ªå®šä¹‰ PostCSS æ’ä»¶ã€‚åœ¨ 11.0.0+ ç‰ˆæœ¬ä¸­ï¼Œæ¨èä½¿ç”¨ PostCSS é…ç½®æ–‡ä»¶ä»£æ›¿ã€‚ä¹Ÿå¯ä½¿ç”¨å¯¹è±¡é…ç½®ï¼Œå¦‚ &#123; plugins: [...],  options: &#123; parser: 'sugarss' &#125;, config: &#123; path: path.resolve('./src') &#125;, useConfigFile: false &#125;ï¼Œconfig.path æŒ‡å®šåŠ è½½ PostCSS é…ç½®æ–‡ä»¶çš„è·¯å¾„æˆ–ç›®å½•ï¼Œconfig.ctx æŒ‡å®šä¸º PostCSS æ’ä»¶æä¾›çš„ä¸Šä¸‹æ–‡ï¼ŒuseConfigFile æ˜¯å¦ç¦ç”¨é…ç½®æ–‡ä»¶</span></span><br><span class="line">        cssSourceMap: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦å¼€å¯ CSS çš„ source mapsï¼Œå…³é—­å¯æå‡ç¼–è¯‘é€Ÿåº¦ï¼Œé¿å… css-loader çš„ some relative path related bugsã€‚webpack é…ç½®ä¸­æ²¡æœ‰ devtool çš„æƒ…å†µä¸‹è‡ªåŠ¨è®¾ç½®ä¸º false</span></span><br><span class="line">        esModule: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦å¯¼å‡ºå…¼å®¹ esModule çš„ä»£ç ã€‚é»˜è®¤å¯¼å‡º commonjs æ ¼å¼ï¼Œåƒ module.exports = ....ã€‚esModule ä¸ºçœŸæ—¶ï¼Œå¯¼å‡º exports.__esModule = true; exports = ...ï¼Œé€‚ç”¨äºä¸ Babel ä»¥å¤–çš„ transpiler äº’æ“ä½œï¼Œæ¯”å¦‚ TypeScript</span></span><br><span class="line">        preserveWhitespace: <span class="literal">true</span>,<span class="comment">// ç½®ä¸ºå¦å€¼ï¼Œæ¨¡ç‰ˆä¸­ HTML æ ‡ç­¾ä¹‹é—´çš„ç©ºæ ¼å°†ä¼šè¢«å¿½ç•¥</span></span><br><span class="line">        compilerModules: [],<span class="comment">// ä¸º vue-template-compiler é…ç½® modules é€‰é¡¹</span></span><br><span class="line">        compilerDirectives: [],<span class="comment">// ä¸º vue-template-compiler é…ç½® directives é€‰é¡¹</span></span><br><span class="line">        transformToRequire: &#123; <span class="attr">img</span>: <span class="string">'src'</span>, <span class="attr">image</span>: <span class="string">'xlink:href'</span> &#125;,<span class="comment">// åœ¨æ¨¡ç‰ˆç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å¯ä»¥å°†æŸäº›å±æ€§ï¼Œå¦‚ src è·¯å¾„ï¼Œè½¬æ¢ä¸º require è°ƒç”¨ã€‚ä¾› html-loader ä½¿ç”¨</span></span><br><span class="line">        buble: &#123;&#125;,<span class="comment">// é…ç½® buble-loader çš„é€‰é¡¹ (å¦‚æœå­˜åœ¨)ï¼Œå¹¶ä¸” buble ç¼–è¯‘ä¼ é€’æ¨¡æ¿æ¸²æŸ“å‡½æ•°???</span></span><br><span class="line">        extractCSS: <span class="literal">true</span>,<span class="comment">// ä½¿ç”¨ extract-text-webpack-plugin è‡ªåŠ¨æå– CSSã€‚å€¼å¯ä»¥ä¸ºçœŸï¼Œæˆ– ExtractTextPlugin æ’ä»¶çš„ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">        optimizeSSR: <span class="literal">false</span><span class="comment">// æ¸²æŸ“å‡½æ•°å°†ä¼šæŠŠè¿”å›çš„ vdom æ ‘çš„ä¸€éƒ¨åˆ†ç¼–è¯‘ä¸ºå­—ç¬¦ä¸²ï¼Œé€‚ç”¨äºæœåŠ¡å™¨ç«¯æ¸²æŸ“</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="style-loader"><a href="#style-loader" class="headerlink" title="style-loader"></a>style-loader</h2><p>é…åˆ css-loader ä¸€èµ·ä½¿ç”¨ã€‚style-loader ç”¨äºå°†æ ·å¼ä»¥ style æ ‡ç­¾æ³¨å…¥åˆ°é¡µé¢ä¸­ï¼ŒåŒæ—¶ import æ—¶å°†ç”Ÿæˆç±»åçš„ hash å€¼(æ ‡è¯†ç¬¦)å¯¹è±¡ï¼›style-loader/url æ¨¡å—å°†ä»¥ link æ³¨å…¥åˆ°é¡µé¢ä¸­ã€‚style-loader/useable æ¨¡å—å°†å»¶è¿Ÿæ³¨å…¥é¡µé¢ï¼Œç›´åˆ° import style from â€˜./file.cssâ€™; style.use();// =style.ref() ä¸­ use, ref æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ‰æ³¨å…¥åˆ°é¡µé¢ä¸­ã€‚å½“è°ƒç”¨unuse, unref æ–¹æ³•æ—¶ï¼Œå°†ä»é¡µé¢ä¸Šåˆ é™¤ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; </span><br><span class="line">            loader: <span class="string">"style-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              base: <span class="literal">true</span>,<span class="comment">// è®¾ç½®æ¨¡å— ID åŸºç¡€ï¼Œç”Ÿæˆ ID å¤§äºè¯¥å€¼ã€‚å½“ä½¿ç”¨ DllPlugin ç¼–è¯‘ css æ—¶ï¼Œç”¨äºé¿å…å¤šä¸ªç¼–è¯‘ç»“æœçš„ ID å†²çªï¼Œå®ç°æ˜¯ å¤šä¸ªç¼–è¯‘é…ç½®è®¾ç½®ä¸åŒçš„ ID èŒƒå›´å€¼</span></span><br><span class="line">              attrs: &#123;&#125;,<span class="comment">// æ·»åŠ è‡ªå®šä¹‰å±æ€§åˆ°æ³¨å…¥é¡µé¢çš„ style, link æ ‡ç­¾ä¸­</span></span><br><span class="line">              transform: <span class="literal">false</span>,<span class="comment">// è½¬æ¢/æ¡ä»¶åŠ è½½ CSSï¼Œé€šè¿‡ä¼ é€’è½¬æ¢/æ¡ä»¶å‡½æ•°ã€‚ç”¨äºè½½å…¥é¡µé¢å‰ä¿®æ”¹ cssï¼Œå‡½æ•°è¿”å› false å°†ä¸ä¼šåŠ è½½ css ã€‚é…ç½®å¦‚ css =&gt; css.replace('.classNameA', '.classNameB')ã€‚transform ä¹Ÿå¯é…ç½®ä¸ºè„šæœ¬çš„è·¯å¾„</span></span><br><span class="line">              insertAt: <span class="string">"bottom"</span>,<span class="comment">// åœ¨ç»™å®šä½ç½®æ’å…¥ style èŠ‚ç‚¹ï¼Œå¯é€‰å€¼ "bottom", "top"</span></span><br><span class="line">              insertInto: <span class="string">"&lt;head&gt;"</span>,<span class="comment">// åœ¨ç»™å®šæ ‡ç­¾å¤„æ’å…¥ style èŠ‚ç‚¹ï¼Œå€¼å¯ä»¥æ˜¯ css é€‰æ‹©å™¨ï¼Œæˆ– ShadowRoot???</span></span><br><span class="line">              singleton: <span class="literal">true</span>,<span class="comment">// é‡ç”¨ style æ ‡ç­¾æ’å…¥ css è„šæœ¬ï¼Œå¦åˆ™æ¯ä¸ªæ ·å¼æ–‡ä»¶æ’å…¥ä¸€ä¸ª style æ ‡ç­¾</span></span><br><span class="line">              sourceMap: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦å¯ç”¨ SourceMapï¼Œcss è„šæœ¬å°†ç”Ÿæˆ Blobï¼Œç›¸å¯¹è·¯å¾„å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚è§£å†³æ–¹æ³•æ˜¯è®¾ç½® publicPath å±æ€§æˆ–å°† convertToAbsoluteUrls ç½®ä¸ºçœŸ???</span></span><br><span class="line">              convertToAbsoluteUrls: <span class="literal">false</span><span class="comment">// å¯ç”¨ SourceMap åï¼Œå°†ç›¸å¯¹ url è½¬æ¢ä¸ºç»å¯¹ url</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"css-loader"</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.url\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"style-loader/url"</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"css-loader"</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.useable\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"style-loader/useable"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">"css-loader"</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a>css-loader</h2><p>ç”¨äºè§£æ css è„šæœ¬ä¸­çš„ @import, url() è¯­å¥ï¼Œé™„åŠ çš„èµ„æºæ–‡ä»¶è°ƒç”¨ import, require åŠ è½½å¹¶è§£æã€‚import, url() è¯­å¥è§£ææ—¶ï¼Œæ ¹æ® webpack é…ç½®å°†è°ƒç”¨å¯¹åº”çš„ file-loader, url-loader åŠ è½½å™¨ã€‚å› æ­¤ css-loader åŸºäº file-loader, url-loader åŠ è½½å™¨ã€‚</p>
<p>å¯ä»¥ç›´æ¥å°† css-loader çš„ç»“æœä½œä¸ºå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œä¾‹å¦‚ Angular çš„ç»„ä»¶æ ·å¼???ã€‚å¦‚æœæœ‰ SourceMapï¼Œå®ƒä»¬ä¹Ÿå°†åŒ…å«åœ¨å­—ç¬¦ä¸²ç»“æœä¸­ã€‚</p>
<p>å¯¹ä½¿ç”¨ extract-text-webpack-plugin é¢„æ¸²æŸ“çš„åœºæ™¯ï¼Œåº”ä½¿ç”¨ css-loader/localsï¼Œè€Œä¸æ˜¯ style-loader!css-loaderã€‚å®ƒä¸ä¼šåµŒå…¥ CSSï¼Œä½†åªå¯¼å‡ºæ ‡è¯†ç¬¦æ˜ å°„ï¼›ç”± extract-text-webpack-plugin æå– css åï¼Œå†é€šè¿‡ link æ ‡ç­¾åµŒå…¥é¡µé¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 'css-loader' å¯¼å…¥èµ„æºè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œç”±å¼€å‘è€…åœ¨é¡µé¢ä¸­æ·»åŠ  link æ ‡ç­¾åä½¿ç”¨</span></span><br><span class="line">&#123;</span><br><span class="line">   test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">   use: [</span><br><span class="line">     <span class="string">'to-string-loader'</span>,</span><br><span class="line">     <span class="string">'css-loader'</span></span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="built_in">require</span>(<span class="string">'./test.css'</span>).toString();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line">&#123;</span><br><span class="line">   test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">   use: [</span><br><span class="line">     <span class="string">'file-loader?name=[name].[ext]'</span></span><br><span class="line">     <span class="string">'handlebars-loader'</span>, <span class="comment">// handlebars loader expects raw resource string</span></span><br><span class="line">     <span class="string">'extract-loader'</span>,<span class="comment">// å°† html, css æå–ä¸ºçº¯ç²¹çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡ handlebars å¤„ç†ï¼Œç”± file æ³¨å…¥é¡µé¢</span></span><br><span class="line">     &#123;</span><br><span class="line">       loader: <span class="string">'css-loader'</span>,</span><br><span class="line">       options: &#123;</span><br><span class="line">         root: <span class="string">"/"</span>,<span class="comment">// ä»¥ / å¼€å¤´çš„ URL é»˜è®¤ä¸ä¼šè¢«è½¬è¯‘ï¼Œè®¾ç½® root ä¸º "."ï¼Œå°† /image.png è½¬æ¢ä¸º ./image.png</span></span><br><span class="line">         url: <span class="literal">true</span>,<span class="comment">// æ˜¯å¦ç¼–è¯‘ css æ–‡ä»¶ä¸­ url() è¯­å¥</span></span><br><span class="line">         alias: &#123;&#125;,<span class="comment">// åˆ«åï¼Œä¾¿äº import å¯¼å…¥</span></span><br><span class="line">         <span class="keyword">import</span>: <span class="literal">true</span>,<span class="comment">// æ˜¯å¦ç¼–è¯‘ css æ–‡ä»¶ä¸­ @import è¯­å¥</span></span><br><span class="line">         modules: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦å¯ç”¨ css-modules</span></span><br><span class="line">         minimize: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦å¯ç”¨å‹ç¼©ï¼Œå‹ç¼©é€šè¿‡ cssnano å®ç°ã€‚[cssnano æ–‡æ¡£](http://cssnano.co/guides/)</span></span><br><span class="line">         sourceMap: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦å¯ç”¨SourceMap</span></span><br><span class="line">         camelCase: <span class="literal">false</span>,<span class="comment">// ä»¥é©¼å³°åŒ–å¼ç±»åå¯¼å‡ºç±»åã€‚å¯é€‰å€¼æœ‰ true ç±»åå°†è¢«é©¼å³°åŒ–ï¼Œ'dashes' åªæœ‰ç ´æŠ˜å·è¢«é©¼å³°åŒ–ï¼Œ'only' ç±»åå°†è¢«é©¼å³°åŒ–ï¼Œåˆå§‹ç±»åä»æ˜ å°„ä¸­ç§»é™¤ï¼Œ'dashesOnly' åªæœ‰ç ´æŠ˜å·è¢«é©¼å³°åŒ–ï¼Œåˆå§‹ç±»åä»æ˜ å°„ä¸­ç§»é™¤</span></span><br><span class="line">         importLoaders: <span class="number">0</span>,<span class="comment">// åœ¨ css-loader å‰åº”ç”¨çš„åŠ è½½å™¨æ•°é‡ã€‚css-loader å‰æœ‰ postcss-loader æ—¶ï¼Œè®¾ç½®ä¸º 1ï¼›css-loader å‰æœ‰ postcss-loader, sass-loaderï¼Œè®¾ç½®ä¸º 2</span></span><br><span class="line">         localIdentName: [hash:base64],<span class="comment">// é…ç½®ç”Ÿæˆçš„æ ‡è¯†ç¬¦ï¼Œimport style from 'a.css' åŠ è½½æ—¶ï¼Œä½œä¸ºstyle å±æ€§çš„å€¼ï¼Œå¦‚ '[path][name]__[local]--[hash:base64:5]'</span></span><br><span class="line">         getLocalIdent: <span class="literal">false</span>,<span class="comment">// æŒ‡å®šç”Ÿæˆæ ‡è¯†ç¬¦çš„å‡½æ•°ï¼Œå¦‚ (context, localIdentName, localName, options) =&gt; &#123; return 'whatever_random_class_name' &#125;</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="built_in">require</span>(<span class="string">'./test.css'</span>).toString();</span><br></pre></td></tr></table></figure>
<h3 id="css-modules"><a href="#css-modules" class="headerlink" title="css-modules"></a>css-modules</h3><p>å¯ç”¨å¯ç”¨ css-modules æ—¶ï¼Œä¼šäº§ç”Ÿå±€éƒ¨ä½œç”¨åŸŸ CSSï¼Œä½¿ç”¨ :global(â€¦) æˆ– :global è®¾ç½®ä¸ºå…¨å±€ä½œç”¨åŸŸï¼Œç±»åå°†ä¸ä¼šè½¬æ¢ä¸ºæ ‡è¯†ç¬¦ï¼›ä½¿ç”¨ :local(â€¦) æˆ– :locale è®¾ç½®ä¸ºå±€éƒ¨ï¼Œç±»åå°†è½¬æ¢ä¸ºæ ‡è¯†ç¬¦ã€‚å±€éƒ¨ä½œç”¨åŸŸçš„ç±»åå»ºè®®ä½¿ç”¨é©¼å³°å¼ä¹¦å†™ã€‚</p>
<p>æ ·å¼å±æ€§ä¸­å¯ä½¿ç”¨ composes å±æ€§ï¼Œç”¨äºå‘ä¸€ä¸ªç±»æ³¨å…¥å¦ä¸€ä¸ªç±»(è¯¥ç±»å¯ä»¥æ˜¯å¦ä¸€ä¸ª css æ–‡ä»¶ä¸­çš„ç±»)çš„æ ·å¼ã€‚ä¸€ä¸ªç±»ä¸‹ï¼Œcomposes å±æ€§å¯è®¾ç½®å¤šä¸ªã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// :local ä¸ºå±€éƒ¨ä½œç”¨åŸŸï¼Œç±»åå°†è½¬æ¢ä¸ºæ ‡è¯†ç¬¦ï¼Œimport åŠ è½½æ—¶ç”Ÿæˆæ˜ å°„å½¢å¼ï¼›:globalä¸ºå…¨å±€ä½œç”¨åŸŸï¼Œç±»åä¿æŒä¸å˜</span><br><span class="line"><span class="selector-pseudo">:local(.className)</span> &#123;</span><br><span class="line">  <span class="attribute">composes</span>: edit hightlight from <span class="string">'./edit.css'</span>;</span><br><span class="line">  <span class="attribute">composes</span>: button from <span class="string">'module/button.css'</span>;</span><br><span class="line">  <span class="attribute">composes</span>: classFromThisModule;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:local(.subClass)</span> &#123;</span><br><span class="line">  <span class="attribute">composes</span>: className;</span><br><span class="line">  <span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:local</span> <span class="selector-class">.className</span> <span class="selector-class">.subClass</span> <span class="selector-pseudo">:global(.global-class-name)</span> &#123; <span class="attribute">color</span>: blue; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="postcss-loader"><a href="#postcss-loader" class="headerlink" title="postcss-loader"></a>postcss-loader</h2><p>å¯¹ css æ–‡ä»¶è‡ªåŠ¨æ‹¼æ¥æµè§ˆå™¨å…¼å®¹æ€§å‰ç¼€ç­‰ã€‚å‚è€ƒæ–‡æ¡£ï¼š<a href="https://github.com/postcss/postcss-loaderã€‚" target="_blank" rel="noopener">https://github.com/postcss/postcss-loaderã€‚</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.style.js$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        <span class="string">'style-loader'</span>,</span><br><span class="line">        &#123; <span class="attr">loader</span>: <span class="string">'css-loader'</span>, <span class="attr">options</span>: &#123; <span class="attr">importLoaders</span>: <span class="number">1</span> &#125; &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          loader: <span class="string">'postcss-loader'</span>, </span><br><span class="line">          options: &#123; </span><br><span class="line">            parser: <span class="literal">undefined</span>,<span class="comment">// è®¾ç½® PostCSS è§£æå™¨ï¼Œå¯é€‰å€¼ 'sugarss'ï¼Œå¯é…ç½®ä¸ºå‡½æ•°</span></span><br><span class="line">            syntax: <span class="literal">undefined</span>,<span class="comment">// è®¾ç½® PostCSS è¯­æ³•è§£æå™¨ï¼Œå¯é€‰å€¼ 'sugarss'ï¼Œå¯é…ç½®ä¸ºå‡½æ•°</span></span><br><span class="line">            stringifier: <span class="literal">undefined</span>,<span class="comment">// è®¾ç½® PostCSS å­—ç¬¦ä¸²åŒ–ï¼Œå¯é€‰å€¼ 'midas'ï¼Œå¯é…ç½®ä¸ºå‡½æ•°</span></span><br><span class="line">            exec: <span class="literal">true</span>,<span class="comment">// å°† css-in-js ç¼–è¯‘ä¸º css</span></span><br><span class="line">            config: &#123;</span><br><span class="line">              path: <span class="literal">undefined</span>,<span class="comment">// postcss.config.js æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤è‡ªåŠ¨ä» css æ–‡ä»¶ç›®å½•å‘ä¸ŠæŸ¥æ‰¾</span></span><br><span class="line">              ctx: &#123;<span class="comment">// postcss é…ç½®çš„ä¸Šä¸‹æ–‡ï¼Œä¼ å…¥ postcss.config.js</span></span><br><span class="line">                env: <span class="string">'development'</span>,<span class="comment">// process.env.NODE_ENV</span></span><br><span class="line">                file: loader.resourcePath,<span class="comment">// åŒ…å« extnameæ‰©å±•å, dirnameç›®å½•å, basenameæ–‡ä»¶å</span></span><br><span class="line">                options: &#123;&#125;<span class="comment">// é€‰é¡¹</span></span><br><span class="line">                ...<span class="comment">// å…¶ä½™å‚æ•°</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            plugins: [],<span class="comment">// å¯é…ç½®ä¸ºå‡½æ•°å½¢å¼ï¼Œå¦‚(loader) =&gt; [ require('postcss-import')(&#123; root: loader.resourcePath &#125;), require('postcss-cssnext')(), require('autoprefixer')(), require('cssnano')() ]</span></span><br><span class="line">            sourceMap: <span class="literal">false</span><span class="comment">// æ˜¯å¦å¯ç”¨ SourceMapï¼Œå¯é€‰å€¼ true, "inline"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,&#123;</span><br><span class="line"></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// postcss.config.js ä¾æ—§ç”Ÿæˆ postcss-loader é€‰é¡¹</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">&#123; file, options, env &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  parser: file.extname === <span class="string">'.sss'</span> ? <span class="string">'sugarss'</span> : <span class="literal">false</span>,</span><br><span class="line">  plugins: &#123;</span><br><span class="line">    <span class="string">'postcss-import'</span>: &#123; <span class="attr">root</span>: file.dirname &#125;,</span><br><span class="line">    <span class="string">'postcss-cssnext'</span>: options.cssnext ? options.cssnext : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">'autoprefixer'</span>: env == <span class="string">'production'</span> ? options.autoprefixer : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">'cssnano'</span>: env === <span class="string">'production'</span> ? options.cssnano : <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// style.js</span></span><br><span class="line"><span class="keyword">import</span> colors <span class="keyword">from</span> <span class="string">'./styles/colors'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="string">'.menu'</span>: &#123;</span><br><span class="line">      color: colors.main,</span><br><span class="line">      height: <span class="number">25</span>,</span><br><span class="line">      <span class="string">'&amp;_link'</span>: &#123;</span><br><span class="line">      color: <span class="string">'white'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="less-loader"><a href="#less-loader" class="headerlink" title="less-loader"></a>less-loader</h2><p>å°† less æ–‡ä»¶ç¼–è¯‘æˆ css æ–‡ä»¶ã€‚less æ’ä»¶ä¼šä½œä¸º less-loader çš„ peerDependencyï¼Œå› æ­¤å®‰è£… less-loader çš„æ—¶å€™ä¼šè‡ªåŠ¨å®‰è£… less æ’ä»¶ã€‚</p>
<p>less-loader 4 èµ·ï¼ŒæŸ¥è¯¢æ–‡ä»¶å¯é€šè¿‡ webpack resolver æˆ– less å†…ç½®çš„ resolverã€‚less-loader åº”ç”¨ä¸€ä¸ª Less æ’ä»¶ï¼Œå¹¶ä¸”å°†æ‰€æœ‰æŸ¥è¯¢å‚æ•°ä¼ é€’ç»™ webpack resolverã€‚éœ€è¦ä» node_modules å¯¼å…¥ less æ¨¡å—æ—¶ï¼Œåªè¦åŠ ä¸€ä¸ª ~ å‰ç¼€ï¼Œå¦‚ @import â€œ~bootstrap/less/bootstrapâ€; ã€‚ä½¿ç”¨ webpack resolverï¼Œå¯ä»¥å¼•å…¥ä»»ä½•å¯¼å‡º less çš„æ–‡ä»¶ï¼Œå¦‚ â€œjs-to-less-loaderâ€ å¯¼å‡ºçš„æ–‡ä»¶ï¼Œä¸æ­¤åŒæ—¶ï¼Œéœ€è¦ä½¿ç”¨ issuer å±æ€§çº¦å®šè¯·æ±‚èµ„æºçš„è„šæœ¬æ–‡ä»¶åï¼Œå¦‚ issuer: /.less$/ã€‚</p>
<p>å½“ options é…ç½® paths å±æ€§æ—¶ï¼Œå°†ä½¿ç”¨ less å†…ç½®çš„ resolver å»æŸ¥è¯¢æ–‡ä»¶ã€‚paths å±æ€§ä»¥æ•°ç»„å½¢å¼é…ç½®ç»å¯¹è·¯å¾„ã€‚</p>
<p>options é…ç½®å‚è€ƒ <a href="http://lesscss.org/usage/#command-line-usage-options" target="_blank" rel="noopener">less options</a>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">    use: [&#123;</span><br><span class="line">      loader: <span class="string">"style-loader"</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      loader: <span class="string">"css-loader"</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      loader: <span class="string">"less-loader"</span>, </span><br><span class="line">      options: &#123;</span><br><span class="line">        strictMath: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦ç›´æ¥è¾“å‡ºæ•°å­¦è®¡ç®—å€¼</span></span><br><span class="line">        strictUnits: <span class="literal">false</span>,<span class="comment">// æ˜¯å¦æ”¯æŒ 1px * 2px è¿ç®—ï¼Œå•ä½é€šè¿‡çŒœæµ‹è·å¾—</span></span><br><span class="line">        globalVar: &#123;&#125;,<span class="comment">// å…¨å±€å˜é‡</span></span><br><span class="line">        modifyVar: &#123;&#125;,<span class="comment">// åœ¨ less æ–‡ä»¶å¯æ”¹å˜çš„å˜é‡</span></span><br><span class="line">        paths: [],<span class="comment">// less æ–‡ä»¶æŸ¥æ‰¾è·¯å¾„ï¼Œå¦‚ [ path.resolve(__dirname, "node_modules") ]</span></span><br><span class="line">        plugins: [],<span class="comment">// è®¾ç½®æ’ä»¶ï¼Œå¦‚ [ new CleanCSSPlugin(&#123; advanced: true &#125;) ]</span></span><br><span class="line">        sourceMap: <span class="literal">false</span><span class="comment">// æ˜¯å¦å¯ç”¨ SourceMapï¼Œå¯é€‰å€¼ true, "inline"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      issuer: <span class="regexp">/\.less$/</span>,</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">"js-to-less-loader"</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="sass-loader"><a href="#sass-loader" class="headerlink" title="sass-loader"></a>sass-loader</h2><p>å°† scss æ–‡ä»¶ç¼–è¯‘æˆ css æ–‡ä»¶ã€‚node-sass æ’ä»¶ä¼šä½œä¸º sass-loader çš„ peerDependencyï¼Œå› æ­¤å®‰è£… sass-loader çš„æ—¶å€™ä¼šè‡ªåŠ¨å®‰è£… node-sass æ’ä»¶ã€‚</p>
<p>options é…ç½®å‚è€ƒ <a href="http://lesscss.org/usage/#command-line-usage-options" target="_blank" rel="noopener">node-sass</a>ã€‚</p>
<p>sass-loader ä¸­ï¼Œurl(â€¦) è¯­æ³•å°†ç›¸å¯¹äºç½‘ç«™çš„æ ¹ç›®å½•æŸ¥æ‰¾(æ²¡æœ‰ css-loader)ï¼Œæˆ–ç›¸å¯¹ scss æ–‡ä»¶æŸ¥æ‰¾(æœ‰ css-loader)ã€‚æœ‰ css-loader åœºæ™¯ï¼Œå¯é€šè¿‡ resolve-url-loader åŠ è½½å™¨è·å¾—ç›¸å¯¹ scss æ–‡ä»¶çš„ urlã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">"style-loader"</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        loader: <span class="string">"css-loader"</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        loader: <span class="string">"sass-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          includePaths: [],<span class="comment">// æ–‡ä»¶è·¯å¾„ï¼Œå¦‚ ["absolute/path/a", "absolute/path/b"]</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dynamic-css-loader"><a href="#dynamic-css-loader" class="headerlink" title="dynamic-css-loader"></a>dynamic-css-loader</h2><p>å¯¹ css æ–‡ä»¶ä¸­çš„ import è¯­å¥ï¼Œé‡‡ç”¨åŠ¨æ€åŠ è½½çš„æ–¹å¼ã€‚ç»“åˆ extract-text-webpack-plugin, file-loader, extract-loader ä½¿ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/.../</span>,</span><br><span class="line">  use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">    use: [ ... ],</span><br><span class="line">    fallback: [</span><br><span class="line">      <span class="string">'dynamic-css-loader'</span>,</span><br><span class="line">      <span class="string">'file-loader'</span>,</span><br><span class="line">      <span class="string">'extract-loader'</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="file-loader"><a href="#file-loader" class="headerlink" title="file-loader"></a>file-loader</h2><p>æ”¯æŒ import, require åŠ è½½æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶çš„ urlã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'file-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: [hash].[ext],<span class="comment">// æ–‡ä»¶åï¼Œæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œæ”¯æŒå ä½ç¬¦ ext æ‰©å±•åï¼Œname æ–‡ä»¶åï¼Œpath ç›¸å¯¹äº context çš„è·¯å¾„ï¼Œhash å“ˆå¸Œå€¼ï¼ŒN å½“å‰æ–‡ä»¶åæŒ‰ç…§æŸ¥è¯¢å‚æ•° regExp åŒ¹é…åè·å¾—åˆ°ç¬¬ N ä¸ªåŒ¹é…ç»“æœï¼Œç­‰</span></span><br><span class="line">            context: <span class="keyword">this</span>.options.context,<span class="comment">// æ–‡ä»¶æŸ¥æ‰¾çš„åŸºæœ¬è·¯å¾„ï¼Œé»˜è®¤ä¸º webpack é…ç½®é¡¹çš„ context</span></span><br><span class="line">            publicPath: __webpack_public_path__,<span class="comment">// æ–‡ä»¶çš„ public pathï¼Œé»˜è®¤ä¸º webpack é…ç½®é¡¹çš„ publicPath</span></span><br><span class="line">            outputPath: <span class="literal">undefined</span>,<span class="comment">// æ–‡ä»¶å¯¼å‡ºç›®å½•</span></span><br><span class="line">            useRelativePath: <span class="literal">false</span>,<span class="comment">// è®¾ç½®ä¸ºçœŸå€¼æ—¶ï¼Œç”Ÿæˆ url ç›¸å¯¹äº context</span></span><br><span class="line">            emitFile: <span class="literal">true</span><span class="comment">// ä¸ºçœŸå€¼æ—¶å¤„ç†æ–‡ä»¶ï¼Œä¸ºå¦å€¼åªè·å– url</span></span><br><span class="line">          &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="url-loader"><a href="#url-loader" class="headerlink" title="url-loader"></a>url-loader</h2><p>åŸºæœ¬åŠŸèƒ½åŒ file-loaderï¼Œä½†å½“æ–‡ä»¶ä¸å¤§æ—¶ï¼Œä»¥ DataUrl å½¢å¼åµŒå…¥ html é¡µé¢ä¸­ï¼Œé¿å…è¯·æ±‚æœåŠ¡å™¨èµ„æºã€‚DataUrl ä¸»è¦å®ç°ä¸ºï¼Œå°†å›¾ç‰‡ç¼–ç ä¸º base64ï¼Œå­˜å‚¨åœ¨ url ä¸­ï¼Œå¹¶å† ä»¥ mime-typeã€‚base64 ç¼–ç çš„æ•°æ®ä½“ç§¯é€šå¸¸æ˜¯åŸæ•°æ®çš„ä½“ç§¯ 4/3ï¼Œä¸”ä¸ä¼šè¢«æµè§ˆå™¨ç¼“å­˜ã€‚ç¼“å­˜é—®é¢˜å¯é€šè¿‡ css èƒŒæ™¯å›¾ç‰‡è§£å†³ï¼Œå›¾ç‰‡èµ„æºåµŒå…¥ url(â€¦) è¯­å¥ï¼Œéš css æ–‡ä»¶ä¸€åŒç¼“å­˜åœ¨æµè§ˆå™¨ç«¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="literal">undefined</span>,<span class="comment">// æ–‡ä»¶å¤§äº limit å€¼ï¼Œä½¿ç”¨ file-loader åŠ è½½ï¼›å°äºï¼Œä½¿ç”¨ url-loaderï¼Œå¦‚ limit: 8192</span></span><br><span class="line">              mimetype: <span class="string">"extname"</span>,<span class="comment">// è®¾ç½®æ–‡ä»¶çš„ mime-typeï¼Œé»˜è®¤é€šè¿‡æ‰©å±•åè·å–</span></span><br><span class="line">              prefix: <span class="literal">false</span><span class="comment">// æä¾›ç»™ file-loader ä½¿ç”¨</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="html-loader"><a href="#html-loader" class="headerlink" title="html-loader"></a>html-loader</h2><p>å¤„ç† html æ–‡ä»¶ä¸­çš„å›¾ç‰‡é“¾æ¥ img:src ç­‰å±æ€§ï¼Œéœ€è¦ç»“åˆ url-loader, file-loader ä½¿ç”¨ã€‚</p>
<p>html-loader åªä½œå­—ç¬¦å¤„ç†ï¼Œå¦‚ â€˜Text <img src="image.png"><img src="~bootstrap-img"> Textâ€™ å°†è½¬æ¢ä¸º â€˜module.exports = â€œText <img src="\\""" +="" require(".="" image.png")="" "\\"=""><img src="\\""" +="" require("bootstrap-img")="" "\\"=""> Textâ€;â€™</p>
<p>å› æ­¤ï¼Œè‹¥è¦å¯¼å‡º html é¡µé¢ï¼Œéœ€è¦é…åˆ file-loader, extract-loader ä½¿ç”¨ã€‚extract-loader å°† js è½¬æ¢ä¸º htmlï¼Œfile-loader è¾“å‡º html æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html-loader åŠ è½½å™¨é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥è®¾ç½®åœ¨ webpackConfig çš„ htmlLoader, otherHtmlLoaderConfig å±æ€§ä¸­ï¼ŒåŠ è½½æ—¶æŒ‡å®š configï¼Œå¦‚ html-loader?config=otherHtmlLoaderConfig</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(html)$/</span>,</span><br><span class="line">  use: &#123;</span><br><span class="line">    loader: <span class="string">'html-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      attrs: [<span class="string">'img:src'</span>],<span class="comment">// å¾…å¤„ç†çš„æ ‡ç­¾ï¼Œå¦‚ ':data-src'ã€‚è®¾ç½®ä¸º falseï¼Œç¦ç”¨å¯¹æ ‡ç­¾å±æ€§çš„å¤„ç†ã€‚è®¾ç½®ä¸º 'img:src'ï¼Œurl-loader, file-loader å¯¼å‡ºçš„é“¾æ¥èµ‹å€¼ç»™ src å±æ€§ï¼›è®¾ç½®ä¸º ':data-src'ï¼Œurl-loader, file-loader å¯¼å‡ºçš„é“¾æ¥èµ‹å€¼ç»™ data-src å±æ€§</span></span><br><span class="line">      minimize: <span class="literal">false</span>,<span class="comment">// æœ€å°åŒ–è¾“å‡º</span></span><br><span class="line">      removeComments: <span class="literal">false</span>,<span class="comment">// æœ€å°åŒ–é€‰é¡¹</span></span><br><span class="line">      removeCommentsFromCDATA: <span class="literal">false</span>,</span><br><span class="line">      removeCDATASectionsFromCDATA: <span class="literal">false</span>,</span><br><span class="line">      collapseWhitespace: <span class="literal">false</span>,</span><br><span class="line">      conservativeCollapse: <span class="literal">false</span>,</span><br><span class="line">      removeAttributeQuotes: <span class="literal">false</span>,</span><br><span class="line">      useShortDoctype: <span class="literal">false</span>,</span><br><span class="line">      keepClosingSlash: <span class="literal">false</span>,</span><br><span class="line">      minifyJS: <span class="literal">false</span>,</span><br><span class="line">      minifyCSS: <span class="literal">false</span>,</span><br><span class="line">      removeScriptTypeAttributes: <span class="literal">false</span>,</span><br><span class="line">      removeStyleTypeAttributes: <span class="literal">false</span>,</span><br><span class="line">      root: <span class="literal">false</span>,<span class="comment">// è®¾ç½®ä¸º true æ—¶ï¼Œ&lt;img src="/image.jpg"&gt; ä¸­ src å±æ€§å°†è‡ªåŠ¨æ‹¼æ¥ç½‘ç«™æ ¹ç›®å½•</span></span><br><span class="line">      interpolate: <span class="literal">false</span>,<span class="comment">// è®¾ç½®ä¸º true æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢ es6 æ¨¡æ¿å­—ç¬¦ä¸² $&#123;&#125;ï¼›è®¾ç½®ä¸º 'require'ï¼Œåªèƒ½åœ¨æ¨¡æ¿å†…ä½¿ç”¨ requireã€‚å¦‚ &lt;#list list as list&gt;&lt;a href="$&#123;list.href!&#125;" /&gt;$&#123;list.name&#125;&lt;/a&gt;&lt;/#list&gt;</span></span><br><span class="line">      exportAsDefault: <span class="literal">false</span>,<span class="comment">// ä»¥ es5 æ ¼å¼å¯¼å‡º exports.default = "Hello world"; é»˜è®¤å¯¼å‡ºæ ¼å¼ä¸º module.exports = "Hello world";</span></span><br><span class="line">      exportAsEs6Default: <span class="literal">false</span>,<span class="comment">// ä»¥ es6 æ ¼å¼å¯¼å‡º export default "Hello world";</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="raw-loader"><a href="#raw-loader" class="headerlink" title="raw-loader"></a>raw-loader</h2><p>å°†æ–‡ä»¶å¯¼å…¥ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.txt$/</span>,</span><br><span class="line">  loader: <span class="string">'raw-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="i18n-loader"><a href="#i18n-loader" class="headerlink" title="i18n-loader"></a>i18n-loader</h2><p>å°†æ‰€æœ‰è¯­è¨€åŒ…åŠ è½½åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå¹¶æ ¹æ® window.navigator.userLanguage æˆ– window.navigator.language åŒºåˆ†è¯­è¨€åŒ…ã€‚i18n/choose æ¨¡å—ç”¨äºé€‰æ‹©æ­£ç¡®çš„è¯­è¨€åŒ…ï¼Œi18n/concat æ¨¡å—å°†æ‹¼æ¥æ‰€æœ‰åˆé€‚çš„åœ°åŒºï¼Œi18n/merge å°†æ‰€æœ‰è¯­è¨€åŒ…åˆå¹¶åˆ°å¯¹è±¡ä¸­ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> locale = <span class="built_in">require</span>(<span class="string">"./colors.i18.json"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…å‡†å¤‡å°±ç»ªï¼Œåœ¨ä¸€ä¸ª web é¡¹ç›®ä¸­æ‰€æœ‰åœ°åŒºåªéœ€è¦ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">// å› ä¸ºæ‰€æœ‰åœ°åŒºçš„è¯­è¨€è¢«åˆå¹¶åˆ°ä¸€ä¸ªå—ä¸­</span></span><br><span class="line">locale(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(locale);<span class="comment">// æ‰“å°è¯­è¨€åŒ…</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.i18$/</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'i18n-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      locales: [],<span class="comment">// å°†æ‰€æœ‰è¯­è¨€åŒ…æ‰“åŒ…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå¦‚ [ "de", "de-de", "fr" ]ï¼ŒåŒæ—¶å¼€å¯åŒæ­¥åŠ è½½æ¨¡å¼</span></span><br><span class="line">      bundleTogether: <span class="literal">false</span><span class="comment">// æ˜¯å¦ç¦æ­¢æ‰€æœ‰è¯­è¨€åŒ…æ‰“åŒ…åœ¨ä¸€èµ·</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    loader: <span class="string">'json-loader'</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="json-loader"><a href="#json-loader" class="headerlink" title="json-loader"></a>json-loader</h2><p>webpack 2 èµ·ï¼Œå°†è‡ªåŠ¨å¯¼å…¥jsonã€‚è‹¥ä½¿ç”¨ä¸åŒçš„æ‰©å±•åï¼Œä»å¯ä½¿ç”¨ json-loader å¯¼å…¥ json æ•°æ®ã€‚</p>
<h2 id="json5-loader"><a href="#json5-loader" class="headerlink" title="json5-loader"></a>json5-loader</h2><p>ç”¨äºå¯¼å…¥ json5 æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.json5$/</span>,</span><br><span class="line">  loader: <span class="string">'json5-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="svg-inline-loader"><a href="#svg-inline-loader" class="headerlink" title="svg-inline-loader"></a>svg-inline-loader</h2><p>ç”¨äºå¯¼å…¥ svgã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'svg-inline-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      removeTags: <span class="literal">false</span>,<span class="comment">// åˆ é™¤æŒ‡å®šçš„æ ‡ç­¾å’Œå®ƒçš„å­å…ƒç´ ï¼Œå¸ƒå°”å‹</span></span><br><span class="line">      removingTags: [],<span class="comment">// å¾…åˆ é™¤çš„æ ‡ç­¾ï¼Œéœ€è¦ removeTags å±æ€§ç½®ä¸ºçœŸï¼Œå¦‚ ['title', 'desc', 'defs', 'style']</span></span><br><span class="line">      warnTags: [],<span class="comment">// è­¦å‘Šæ ‡ç­¾</span></span><br><span class="line">      removeSVGTagAttrs: <span class="literal">true</span>,<span class="comment">// æ˜¯å¦åˆ é™¤ &lt;svg /&gt; çš„ width å’Œ height å±æ€§</span></span><br><span class="line">      removingTagAttrs: [],<span class="comment">// åˆ é™¤å†…éƒ¨çš„ &lt;svg /&gt;çš„å±æ€§</span></span><br><span class="line">      warnTagAttrs: [],<span class="comment">// åœ¨consoleå‘å‡ºå…³äºå†…éƒ¨ &lt;svg /&gt; å±æ€§çš„è­¦å‘Š</span></span><br><span class="line">      classPrefix: <span class="literal">false</span>,<span class="comment">// svg æ ‡ç­¾ class æ·»åŠ å‰ç¼€ï¼Œé¿å…å‘½åå†²çªï¼Œå¯é€‰å€¼ true æˆ– å­—ç¬¦ä¸²</span></span><br><span class="line">      idPrefix: <span class="literal">false</span><span class="comment">// svg æ ‡ç­¾ id æ·»åŠ å‰ç¼€ï¼Œé¿å…å‘½åå†²çªï¼Œå¯é€‰å€¼ true æˆ– å­—ç¬¦ä¸²</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="null-loader"><a href="#null-loader" class="headerlink" title="null-loader"></a>null-loader</h2><p>ä½¿æ‰“åŒ…æ–‡ä»¶ä¸åŒ…å«éƒ¨åˆ†ç±»åº“é¢å¤–å¼•å…¥çš„ä¾èµ–ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: path.resolve(__dirname, <span class="string">'node_modules/library/polyfill.js'</span>),</span><br><span class="line">  loader: <span class="string">'null-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bundle-loader"><a href="#bundle-loader" class="headerlink" title="bundle-loader"></a>bundle-loader</h2><p>é€šè¿‡ require.ensure æ–¹æ³•å®ç°æ–‡ä»¶çš„å¼‚æ­¥åŠ è½½ï¼Œè®¾ç½®å›è°ƒå¯¹æ–‡ä»¶ä½œå¤„ç†ï¼Œå›è°ƒå¯è®¾ç½®å¤šä¸ªã€‚å½“æ–‡ä»¶åŠ è½½å®Œæˆåï¼Œæ‰§è¡Œå›è°ƒï¼›å½“å›è°ƒåœ¨æ–‡ä»¶åŠ è½½å®Œæˆåæ·»åŠ ï¼Œç«‹å³æ‰§è¡Œå›è°ƒã€‚ä¸ºäº†åŒå…¶ä»–è„šæœ¬ä½œåŒºåˆ†ï¼Œé…ç½®æ—¶ test å±æ€§å¯è®¾ç½®ä¸º /.bundle.js$/ã€‚æ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> load <span class="keyword">from</span> <span class="string">'test.bundle.js'</span>;</span><br><span class="line"></span><br><span class="line">load(<span class="function"><span class="params">file</span> =&gt;</span> &#123;&#125;);<span class="comment">// é¦–æ¬¡è°ƒç”¨æ–‡ä»¶ååŠ è½½å›è°ƒ</span></span><br></pre></td></tr></table></figure>
<h2 id="coffee-loader"><a href="#coffee-loader" class="headerlink" title="coffee-loader"></a>coffee-loader</h2><p>ç¼–è¯‘ CoffeeScriptã€‚é€‰é¡¹åŒ…å« literate = false ç¼–è¯‘åœ¨ Markdown ä¸­ä¹¦å†™çš„ CoffeeScript è„šæœ¬ï¼ŒsourceMap = false æ˜¯å¦å¯ç”¨ source-mapï¼Œtranspile = false é…ç½® babel-preset åŠ babel-pluginã€‚</p>
<h2 id="coffee-redux-loader"><a href="#coffee-redux-loader" class="headerlink" title="coffee-redux-loader"></a>coffee-redux-loader</h2><p>ç¼–è¯‘ CoffeeScriptã€‚ç»ˆæç‰ˆ???</p>
<h2 id="jshint-loader"><a href="#jshint-loader" class="headerlink" title="jshint-loader"></a>jshint-loader</h2><p>jshint è¯­æ³•æ£€æŸ¥ã€‚jshint-loader é€‰é¡¹é…ç½®å‚è€ƒï¼š<a href="http://jshint.com/docs/options/ã€‚" target="_blank" rel="noopener">http://jshint.com/docs/options/ã€‚</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      enforce: <span class="string">"pre"</span>, <span class="comment">// é¢„å…ˆåŠ è½½ jshint loader</span></span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">"jshint-loader"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          camelcase: <span class="literal">true</span>,</span><br><span class="line">          emitErrors: <span class="literal">false</span>,<span class="comment">// jshint é»˜è®¤æ˜¾ç¤ºè­¦å‘Šç±»ä¿¡æ¯ï¼ŒemitErrorsè®¾ä¸º true å°†ç½®ä¸ºé”™è¯¯ç±»ä¿¡æ¯</span></span><br><span class="line">          failOnHint: <span class="literal">false</span>,<span class="comment">// è®¾ç½®ä¸ºçœŸå€¼æ—¶ï¼Œjshint æŠ¥é”™å°†æ‰“æ–­ webpack å‡½æ•°</span></span><br><span class="line">          reporter: <span class="function"><span class="keyword">function</span>(<span class="params">errors</span>) </span>&#123; &#125;<span class="comment">// è‡ªå®šä¹‰æŠ¥å‘Šå‡½æ•°ï¼Œerrors ä¸ºæ•°ç»„å½¢å¼ [&#123; id, code, reason, evidence, line, character, scope &#125;]; å…¶ä¸­ï¼Œreason ä¸ºé”™è¯¯æ¶ˆæ¯ï¼Œevidence ä¸ºé”™è¯¯ç¼–ç ï¼Œscope ä¸ºæ¶ˆæ¯ä½œç”¨åŸŸã€‚å‡½æ•°ä¸­ï¼Œè°ƒç”¨ this.emitWarning(...) æˆ– this.emitError(...) æ˜¾ç¤ºæ¶ˆæ¯ã€‚ç”± webpack æä¾›ä¸Šä¸‹æ–‡ this</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="mocha-loader"><a href="#mocha-loader" class="headerlink" title="mocha-loader"></a>mocha-loader</h2><p>åŠ è½½æ—¶è¿è¡Œ mocha æµ‹è¯•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/test\.js$/</span>,</span><br><span class="line">    use: <span class="string">'mocha-loader'</span>,</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="istanbul-instrumenter-loader"><a href="#istanbul-instrumenter-loader" class="headerlink" title="istanbul-instrumenter-loader"></a>istanbul-instrumenter-loader</h2><p>åŠ è½½æ—¶è¿è¡Œ karam æµ‹è¯•ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<br><a href="https://github.com/webpack-contrib/karma-webpack" target="_blank" rel="noopener">karma-webpack</a><br><a href="https://github.com/mattlewis92/karma-coverage-istanbul-reporter" target="_blank" rel="noopener">karma-coverage-istanbul-reporter</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.js$|\.jsx$/</span>,</span><br><span class="line">  use: &#123;</span><br><span class="line">    loader: <span class="string">'istanbul-instrumenter-loader'</span>,</span><br><span class="line">    options: &#123; </span><br><span class="line">      debug: <span class="literal">false</span>,<span class="comment">// å¼€å¯ debug æ¨¡å¼</span></span><br><span class="line">      compact: <span class="literal">true</span>,<span class="comment">// ç”Ÿæˆå‹ç¼©åä»£ç </span></span><br><span class="line">      autoWrap: <span class="literal">false</span>,<span class="comment">// å‡½æ•°å¤–æ˜¯å¦å…è®¸è¿”å›è¯­å¥</span></span><br><span class="line">      esModules: <span class="literal">false</span>,<span class="comment">// ES2015 ä¹¦å†™ä»£ç </span></span><br><span class="line">      coverageVariable: <span class="string">'__coverage__'</span>,<span class="comment">// å…¨å±€è¦†ç›–ç‡å˜é‡å</span></span><br><span class="line">      preserveComments: <span class="literal">false</span>,<span class="comment">// è¾“å‡ºä¸­ä¿ç•™æ³¨é‡Š</span></span><br><span class="line">      produceSourceMap: <span class="literal">false</span>,<span class="comment">// ç”Ÿæˆ source-map</span></span><br><span class="line">      sourceMapUrlCallback: <span class="literal">null</span><span class="comment">// source-map url æŸ¥è¯¢åçš„å›è°ƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  enforce: <span class="string">'post'</span>,</span><br><span class="line">  exclude: <span class="regexp">/node_modules|\.spec\.js$/</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="coverjs-loader"><a href="#coverjs-loader" class="headerlink" title="coverjs-loader"></a>coverjs-loader</h2><p>ç”¨äºæµ‹è¯•???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cover-my-client-tests.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"./my-client-tests"</span>);</span><br><span class="line"></span><br><span class="line">after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">"cover-loader"</span>).reportHtml();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="exports-loader"><a href="#exports-loader" class="headerlink" title="exports-loader"></a>exports-loader</h2><p>exports æ’å…¥å±æ€§ï¼Œæˆ–è€…èµ‹å€¼ module.exportsã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"exports-loader?file,parse=helpers.parse!./file.js"</span>);</span><br><span class="line"><span class="comment">// adds below code to the file's source:</span></span><br><span class="line"><span class="comment">//  exports["file"] = file;</span></span><br><span class="line"><span class="comment">//  exports["parse"] = helpers.parse;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"exports-loader?file!./file.js"</span>);</span><br><span class="line"><span class="comment">// adds below code to the file's source:</span></span><br><span class="line"><span class="comment">//  module.exports = file;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"exports-loader?[name]!./file.js"</span>);</span><br><span class="line"><span class="comment">// adds below code to the file's source:</span></span><br><span class="line"><span class="comment">//  module.exports = file;</span></span><br></pre></td></tr></table></figure>
<h2 id="expose-loader"><a href="#expose-loader" class="headerlink" title="expose-loader"></a>expose-loader</h2><p>æš´éœ²å…¨å±€å˜é‡ï¼Œæ³¨å…¥åˆ° global å¯¹è±¡ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"expose-loader?$!jquery"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="built_in">require</span>.resolve(<span class="string">'jquery'</span>),</span><br><span class="line">    use: [&#123;</span><br><span class="line">      loader: <span class="string">'expose-loader'</span>,</span><br><span class="line">      options: <span class="string">'jQuery'</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      loader: <span class="string">'expose-loader'</span>,</span><br><span class="line">      options: <span class="string">'$'</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="imports-loader"><a href="#imports-loader" class="headerlink" title="imports-loader"></a>imports-loader</h2><p>è‡ªåŠ¨ä¸ºæ–‡ä»¶æ³¨å…¥å±€éƒ¨å˜é‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/test\/.js/</span></span><br><span class="line">    use: [&#123;</span><br><span class="line">      loader: <span class="string">'imports-loader'</span>,</span><br><span class="line">      options: &#123;&#125;<span class="comment">// æ³¨å…¥å˜é‡ï¼Œå¦‚ &#123; angular: true &#125; å°†æ³¨å…¥ angular ç±»åº“ï¼›&#123; $: 'jquery' &#125; å°†æ³¨å…¥ jqueryï¼›&#123; config: '&gt;&#123; size: 50 &#125;' &#125; å°†èµ‹å€¼ config = &#123; size: 50 &#125; ç­‰</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="gzip-loader"><a href="#gzip-loader" class="headerlink" title="gzip-loader"></a>gzip-loader</h2><p>åŠ è½½ gzip å‹ç¼©èµ„æºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.gz$/</span>,</span><br><span class="line">        enforce: <span class="string">'pre'</span>,</span><br><span class="line">        use: <span class="string">'gzip-loader'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="yaml-frontmatter-loader"><a href="#yaml-frontmatter-loader" class="headerlink" title="yaml-frontmatter-loader"></a>yaml-frontmatter-loader</h2><p>å°† yaml è½¬åŒ–ä¸º jsonã€‚</p>
<h2 id="react-proxy-loader"><a href="#react-proxy-loader" class="headerlink" title="react-proxy-loader"></a>react-proxy-loader</h2><p>é€šè¿‡ require.ensure æŒ‰éœ€åŠ è½½æ–‡ä»¶ç»„ä»¶ã€‚ç»„ä»¶å®ä¾‹ mixins å±æ€§æ³¨å…¥ä»£ç†ç»„ä»¶ require(â€˜react-proxy-loader!./a.jsâ€™).Mixinï¼Œåœ¨å½“å‰ç»„ä»¶ä¸­è°ƒç”¨loadComponent å³å¯è·å– a.js å¯¼å‡ºçš„ç»„ä»¶ï¼Œa.js æ–‡ä»¶å°šæœªåŠ è½½å®Œæˆï¼Œè°ƒç”¨å¼€å‘è€…é…ç½®çš„ renderUnavailable æ–¹æ³•è¿›è¡Œæ¸²æŸ“ã€‚æˆ–è€…ï¼Œç›´æ¥å°† require(â€˜react-proxy-loader!./a.jsâ€™) ä½œä¸ºç»„ä»¶ä½¿ç”¨ï¼Œa.js æ–‡ä»¶å°šæœªåŠ è½½å®Œæˆï¼Œrender æ–¹æ³•è¿”å› nullã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Component = <span class="built_in">require</span>(<span class="string">"react-proxy-loader!./Component"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ComponentProxyMixin = <span class="built_in">require</span>(<span class="string">"react-proxy-loader!./Component"</span>).Mixin;</span><br><span class="line"><span class="keyword">var</span> ComponentProxy = React.createClass(&#123;</span><br><span class="line">	mixins: [ComponentProxyMixin],</span><br><span class="line">	renderUnavailable: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="script-loader"><a href="#script-loader" class="headerlink" title="script-loader"></a>script-loader</h2><p>åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä¸€æ¬¡ js è„šæœ¬ï¼ŒåŠ è½½æ—¶å³æ‰§è¡Œã€‚</p>
<h2 id="source-map-loader"><a href="#source-map-loader" class="headerlink" title="source-map-loader"></a>source-map-loader</h2><p>ä» js å…¥å£æ–‡ä»¶ä¸­æå– source-map æ–‡ä»¶(è¯¥æ–‡ä»¶çš„å†…å®¹ç”± webpackConfig devtool é…ç½®é¡¹é™å®š)ã€‚å¯è®¾ç½® include, exclude é€‰é¡¹ã€‚</p>
<h2 id="cache-loader"><a href="#cache-loader" class="headerlink" title="cache-loader"></a>cache-loader</h2><p>åœ¨æ€§èƒ½å¼€é”€è¾ƒå¤§çš„ loader å‰åŠ è½½ cache-loaderï¼Œå¯ä»¥å°†ç¼–è¯‘ç»“æœç¼“å­˜åˆ°ç£ç›˜ä¸­ï¼Œå¦‚ babel-loader å‰ã€‚options æœ‰ cacheDirectory ç¼“å­˜ç›®å½•ï¼Œé»˜è®¤ä¸º path.resolve(â€˜.cache-loaderâ€™)ã€‚</p>
<h2 id="worker-loader"><a href="#worker-loader" class="headerlink" title="worker-loader"></a>worker-loader</h2><p>å°† js è½¬åŒ–ä¸º webworkerï¼Œçˆ¶å­çº¿ç¨‹é—´é€šä¿¡???</p>
<p>webworker å‚è€ƒæ–‡æ¡£ï¼š<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_APIã€‚" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_APIã€‚</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file.js</span></span><br><span class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = &#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;</span><br><span class="line"></span><br><span class="line">_.has(o, <span class="string">'foo'</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ•°æ®å‘é€åˆ°çˆ¶çº¿ç¨‹(parent thread)</span></span><br><span class="line">self.postMessage(&#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”æ¥è‡ªçˆ¶çº¿ç¨‹(parent thread)çš„æ¶ˆæ¯</span></span><br><span class="line">self.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123; <span class="built_in">console</span>.log(event); &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">var</span> MyWorker = <span class="built_in">require</span>(<span class="string">"worker-loader!./file.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> MyWorker();</span><br><span class="line">worker.postMessage(&#123;<span class="attr">a</span>: <span class="number">1</span>&#125;);</span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;...&#125;;</span><br><span class="line">worker.addEventListener(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;...&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="multi-loader"><a href="#multi-loader" class="headerlink" title="multi-loader"></a>multi-loader</h2><p>æ§åˆ¶å¤šä¸ªåŠ è½½å™¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> multi = <span class="built_in">require</span>(<span class="string">"multi-loader"</span>);</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      loader: multi(<span class="comment">// multi å‚æ•°ä¸­ loader é¡ºåºæ‰§è¡Œï¼Œå³å…ˆè§£æ cssï¼Œå†ä»¥å­—ç¬¦ä¸²è¾“å‡º</span></span><br><span class="line">        <span class="string">"style-loader!css-loader!autoprefixer-loader"</span>,</span><br><span class="line">        <span class="string">"raw-loader"</span></span><br><span class="line">      )</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="thread-loader"><a href="#thread-loader" class="headerlink" title="thread-loader"></a>thread-loader</h2><p>ä½œä¸ºå‰ç½® loaderï¼Œå°†ä½¿ä¹‹åçš„ loader è¿è¡Œåœ¨ç‹¬ç«‹çš„çº¿ç¨‹æ± ä¸­ã€‚ä½†è¿™äº›åç½®çš„ loader ä¸èƒ½äº§ç”Ÿæ–°çš„æ–‡ä»¶ï¼Œä¸èƒ½ä½¿ç”¨å®šåˆ¶çš„ loader APIï¼Œæ— æ³•è·å– webpack çš„é€‰é¡¹è®¾ç½®???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">"thread-loader"</span>,</span><br><span class="line">      options: &#123;<span class="comment">// æœ‰åŒæ ·é…ç½®çš„ loader ä¼šå…±äº«ä¸€ä¸ª worker æ± (worker pool)</span></span><br><span class="line">        workers: <span class="number">2</span>,<span class="comment">// äº§ç”Ÿçš„ worker çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ cpu çš„æ ¸å¿ƒæ•°</span></span><br><span class="line">        workerParallelJobs: <span class="number">50</span>,<span class="comment">// ä¸€ä¸ª worker è¿›ç¨‹ä¸­å¹¶è¡Œæ‰§è¡Œå·¥ä½œçš„æ•°é‡ï¼Œé»˜è®¤ä¸º 20</span></span><br><span class="line">        workerNodeArgs: [<span class="string">'--max-old-space-size'</span>, <span class="string">'1024'</span>],<span class="comment">// é¢å¤–çš„ node.js å‚æ•°</span></span><br><span class="line">        poolTimeout: <span class="number">2000</span>,<span class="comment">// é—²ç½®æ—¶å®šæ—¶åˆ é™¤ worker è¿›ç¨‹ï¼Œé»˜è®¤ä¸º 500msã€‚å¯ä»¥è®¾ç½®ä¸ºæ— ç©·å¤§ï¼Œ è¿™æ ·åœ¨ç›‘è§†æ¨¡å¼(--watch)ä¸‹å¯ä»¥ä¿æŒ worker æŒç»­å­˜åœ¨</span></span><br><span class="line">        poolParallelJobs: <span class="number">50</span>,<span class="comment">// æ± (pool)åˆ†é…ç»™ worker çš„å·¥ä½œæ•°é‡ï¼Œé»˜è®¤ä¸º 200ã€‚é™ä½è¿™ä¸ªæ•°å€¼ä¼šé™ä½æ€»ä½“çš„æ•ˆç‡ï¼Œä½†æ˜¯ä¼šæå‡å·¥ä½œåˆ†å¸ƒæ›´å‡ä¸€</span></span><br><span class="line">        name: <span class="string">"my-pool"</span><span class="comment">// æ± (pool)çš„åç§°ï¼Œå¯ä»¥ä¿®æ”¹åç§°æ¥åˆ›å»ºå…¶ä½™é€‰é¡¹éƒ½ä¸€æ ·çš„æ± (pool)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"expensive-loader"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„çƒ­ worker æ± (worker pool)æ¥é˜²æ­¢å¯åŠ¨ worker æ—¶çš„é«˜å»¶æ—¶ã€‚è¿™ä¼šå¯åŠ¨æ± (pool)å†…æœ€å¤§æ•°é‡çš„ worker å¹¶æŠŠæŒ‡å®šçš„æ¨¡å—è½½å…¥ node.js çš„æ¨¡å—ç¼“å­˜ä¸­</span></span><br><span class="line"><span class="keyword">const</span> threadLoader = <span class="built_in">require</span>(<span class="string">'thread-loader'</span>);</span><br><span class="line">threadLoader.warmup(options, [</span><br><span class="line">  <span class="string">'babel-loader'</span>,</span><br><span class="line">  <span class="string">'babel-preset-es2015'</span>,</span><br><span class="line">  <span class="string">'sass-loader'</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h2 id="transform-loader"><a href="#transform-loader" class="headerlink" title="transform-loader"></a>transform-loader</h2><p>åº”ç”¨ browserify transforms???</p>
<p>browserify transforms å‚è€ƒæ–‡æ¡£ï¼š<a href="https://github.com/browserify/browserify/wiki/list-of-transforms" target="_blank" rel="noopener">https://github.com/browserify/browserify/wiki/list-of-transforms</a></p>
<h2 id="val-loader"><a href="#val-loader" class="headerlink" title="val-loader"></a>val-loader</h2><p>æ ¹æ®è¾“å…¥åŠ è½½ä¸åŒæ–‡ä»¶ï¼Œäº¤ç”±ä¸‹ä¸€ä¸ªä¸­é—´ä»¶???</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ask = <span class="built_in">require</span>(<span class="string">'./ask.js'</span>);</span><br><span class="line"><span class="keyword">const</span> generateResult = <span class="built_in">require</span>(<span class="string">'./generateResult.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findAnswer</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ask(options.question)</span><br><span class="line">    .then(generateResult)</span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> (&#123;</span><br><span class="line">      code: result.code,</span><br><span class="line">      sourceMap: result.sourceMap,</span><br><span class="line">      ast: result.abstractSyntaxTree,<span class="comment">// ä¸‹ä¸€ä¸ª loader ä½¿ç”¨ç›¸åŒçš„ astï¼Œå¯ä»¥æå‡ç¼–è¯‘é€Ÿåº¦</span></span><br><span class="line">      dependencies: [<span class="comment">// é»˜è®¤ä¸º []ï¼Œéœ€è¦ç›‘å¬è¿™äº›æ–‡ä»¶çš„å˜æ›´</span></span><br><span class="line">        <span class="built_in">require</span>.resolve(<span class="string">'./ask.js'</span>),</span><br><span class="line">        <span class="built_in">require</span>.resolve(<span class="string">'./generateResult.js'</span>)</span><br><span class="line">      ],.</span><br><span class="line">      cacheable: <span class="literal">true</span><span class="comment">// ä¾èµ–æ²¡æœ‰å˜æ›´æ—¶ï¼Œä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = findAnswer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: <span class="built_in">require</span>.resolve(<span class="string">'path/to/findAnswer.js'</span>),</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: <span class="string">'val-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          question: <span class="string">'What is the meaning of life?'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/03/æµ…æwebpack-mergeæºç /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/03/æµ…æwebpack-mergeæºç /" itemprop="url">æµ…æwebpack-mergeæºç </a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-03T14:48:30+08:00">2018-02-03</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a></span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/03/æµ…æwebpack-mergeæºç /#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/03/æµ…æwebpack-mergeæºç /" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="mergeæ–¹æ³•"><a href="#mergeæ–¹æ³•" class="headerlink" title="mergeæ–¹æ³•"></a>mergeæ–¹æ³•</h2><p>webpack-merge ç±»åº“çš„ merge æ–¹æ³•åŸºäº lodash ç±»åº“çš„ mergeWith æ–¹æ³•å®ç°ã€‚</p>
<p>mergeWith æ–¹æ³•ç”¨äºéå†æ•°ç»„é¡¹æˆ–å¯¹è±¡å±æ€§ï¼Œé€šè¿‡å°¾å‚ customizer å®šåˆ¶åŒ–æ•°æ®å¤„ç†å‡½æ•°ï¼Œè·å¾—æ–°çš„æ•°ç»„é¡¹æˆ–å¯¹è±¡å±æ€§ã€‚customizer å‡½æ•°çš„å‚æ•°ä¸º (objValue, srcValue, key, object, source, stack)ã€‚</p>
<p>webpack-merge é€šè¿‡ join-arrays æ¨¡å—å¯¼å‡ºçš„ joinArrays å‡½æ•°å°†ç”¨æˆ·é…ç½®é¡¹ { customizeArray, customizeObject } å¯¹è±¡æ„å»ºä¸º customizer å‡½æ•°ç”Ÿæˆå™¨ã€‚customizer å‡½æ•°çš„å¤„ç†é€»è¾‘ä¸ºï¼šå½“ objValue, srcValue ä¸ºå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼ç”± customizer å‡½æ•°å†æ¬¡å¤„ç†ã€‚å½“ objValue, srcValue ä¸ºæ•°ç»„æ—¶ï¼Œé€šè¿‡ customizeArray å‡½æ•°å¤„ç†ï¼Œå‚æ•°ä¸ºï¼ˆobjValue, srcValue, keyï¼‰ï¼›è‹¥ customizeArray å‡½æ•°æœªå®šä¹‰ï¼Œåˆå¹¶æ•°ç»„é¡¹ã€‚å½“ objValue, srcValue ä¸ºå¯¹è±¡æ—¶ï¼Œé€šè¿‡ customizeObject å‡½æ•°å¤„ç†ï¼Œè‹¥æ— è¿”å›å€¼æˆ– customizeObject å‡½æ•°æœªå®šä¹‰ï¼Œæ„å»ºæ–°çš„keyå€¼ï¼Œè°ƒç”¨ joinArrays å‡½æ•°å°† { customizeArray, customizeObject } é…ç½®é¡¹è½¬åŒ–æˆå†…å±‚æ•°æ®å¤„ç†å‡½æ•°ï¼Œå¹¶å¯¹ objValue, srcValue çš„å­å­™å±æ€§æ·±åº¦å¤„ç†ã€‚é™¤æ­¤è€Œå¤–ï¼Œæ·±æ‹·è´ source æˆ–è€…å°† source ä½œä¸ºè¿”å›å€¼ã€‚ç‰¹åˆ«çš„ï¼Œå½“ customizeArray, customizeObject å‡½æ•°å‡æœªä½œé…ç½®æ—¶ï¼Œcustomizer å‡½æ•°ä½œæ·±æ‹·è´å¤„ç†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">joinArrays</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  customizeArray,</span></span></span><br><span class="line"><span class="function"><span class="params">  customizeObject,</span></span></span><br><span class="line"><span class="function"><span class="params">  key</span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">_joinArrays</span>(<span class="params">a, b, k</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newKey = key ? <span class="string">`<span class="subst">$&#123;key&#125;</span>.<span class="subst">$&#123;k&#125;</span>`</span> : k;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isFunction(a) &amp;&amp; isFunction(b)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> _joinArrays(a(...args), b(...args), k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isArray(a) &amp;&amp; isArray(b)) &#123;</span><br><span class="line">      <span class="keyword">const</span> customResult = customizeArray &amp;&amp; customizeArray(a, b, newKey);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> customResult || [...a, ...b];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(a) &amp;&amp; isPlainObject(b)) &#123;</span><br><span class="line">      <span class="keyword">const</span> customResult = customizeObject &amp;&amp; customizeObject(a, b, newKey);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç¬¬äºŒå±‚ä»¥åŒæ ·çš„é€»è¾‘å¤„ç†ï¼Œå¦‚ 'module.rules'ç­‰</span></span><br><span class="line">      <span class="keyword">return</span> customResult || mergeWith(&#123;&#125;, a, b, joinArrays(&#123;</span><br><span class="line">        customizeArray,</span><br><span class="line">        customizeObject,</span><br><span class="line">        key: newKey</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(b)) &#123;</span><br><span class="line">      <span class="keyword">return</span> cloneDeep(b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œwebpack-merge å®ç°äº† merge æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ”¯æŒå•å‚æ•°ï¼Œé€šè¿‡æ¥å—{ customizeArray, customizeObject } å¯¹è±¡ï¼Œè¿”å›å€¼ç”¨äºå¯¹æ•°æ®ï¼ˆæ ¼å¼å¯ä»¥æ˜¯æ•°ç»„ï¼Œæˆ–å¤šå‚æ•°ï¼‰åšå¤„ç†ï¼›ä¹Ÿæ”¯æŒå¤šå‚æ•°ï¼Œæ•°æ®å¤„ç†æ¨¡å¼å³ä¸ºæ·±æ‹·è´ã€‚</p>
<h2 id="multiple-æ–¹æ³•"><a href="#multiple-æ–¹æ³•" class="headerlink" title="multiple æ–¹æ³•"></a>multiple æ–¹æ³•</h2><p>multiple æ–¹æ³•åœ¨ merge æ–¹æ³•çš„åŸºç¡€ä¸Šæ„å»ºï¼Œé¦–å…ˆé€šè¿‡ merge æ–¹æ³•å°†é…ç½®æ•°æ®å¤åˆä¸ºä¸€ï¼Œç„¶åé€šè¿‡ lodash.values æ–¹æ³•ä»¥æ•°ç»„å½¢å¼è¿”å›å¤åˆå¯¹è±¡å„å±æ€§çš„å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> baseConfig = &#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      target: <span class="string">'node'</span>,</span><br><span class="line">      output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'lib.node.js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    client: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'lib.js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// specialized configuration</span></span><br><span class="line"><span class="keyword">var</span> production = &#123;</span><br><span class="line">    client: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].[hash].js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output</span></span><br><span class="line">[&#123;</span><br><span class="line">  target: <span class="string">'node'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'lib.node.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name].[hash].js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<h2 id="unique-æ–¹æ³•"><a href="#unique-æ–¹æ³•" class="headerlink" title="unique æ–¹æ³•"></a>unique æ–¹æ³•</h2><p>unique æ–¹æ³•é€šè¿‡ lodash ç±»åº“çš„ differenceWith æ–¹æ³•å®ç°ã€‚differenceWith æ–¹æ³•æ¥å—å‚æ•°ä¸º (array, values, comparator)ï¼Œé€šè¿‡éå† array æ•°ç»„é¡¹ï¼Œå¹¶è°ƒç”¨ comparator å‡½æ•°å°†æ•°ç»„é¡¹å’Œ values æ•°ç»„æ¯”è¾ƒï¼Œå°†è¿”å›å¦å€¼çš„æ•°ç»„é¡¹æ„å»ºæˆæ–°çš„æ•°ç»„ã€‚unique æ–¹æ³•ç”¨äºæ„å»º customizeArray é…ç½®å‡½æ•°ï¼Œä¸”å…¶æ¥å—å‚æ•°ä¸º (key, uniques, getter)ï¼Œkey å³å±æ€§åï¼Œuniques, getter å‚æ•°ç”¨äºæ„å»º differenceWith æ–¹æ³•ä¸­çš„å‚æ•° comparatorã€‚è‹¥getterè¿”å›å€¼å·²å­˜åœ¨ uniques ä¸­ï¼Œcomparator è¿”å›çœŸå€¼ï¼›å¦åˆ™è¿”å›å¦å€¼ï¼Œå³è¯¥æ•°ç»„é¡¹æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unique æ–¹æ³•æºç </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeUnique</span>(<span class="params">key, uniques, getter = a =&gt; a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a, b, k</span>) =&gt;</span> (</span><br><span class="line">    k === key &amp;&amp; [</span><br><span class="line">      ...a,</span><br><span class="line">      ...differenceWith(</span><br><span class="line">        b, a, item =&gt; uniques.indexOf(getter(item)) &gt;= <span class="number">0</span></span><br><span class="line">      )</span><br><span class="line">    ]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unique æ–¹æ³•ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‹¥é¦–ä¸ª plugins ä¸­æ²¡æœ‰ HotModuleReplacementPlugin æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ª plugins ä¸­çš„HotModuleReplacementPlugin ä¹Ÿä¸ä¼šæ‹·è´åˆ°æ–°æ•°ç»„ä¸­</span></span><br><span class="line"><span class="keyword">const</span> output = merge(&#123;</span><br><span class="line">  customizeArray: merge.unique(</span><br><span class="line">    <span class="string">'plugins'</span>,</span><br><span class="line">    [<span class="string">'HotModuleReplacementPlugin'</span>],</span><br><span class="line">    plugin =&gt; plugin.constructor &amp;&amp; plugin.constructor.name</span><br><span class="line">  )</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="strategy-æ–¹æ³•"><a href="#strategy-æ–¹æ³•" class="headerlink" title="strategy æ–¹æ³•"></a>strategy æ–¹æ³•</h2><p>strategy æ–¹æ³•åœ¨ merge æ–¹æ³•åŸºç¡€ä¸Šå®ç°ï¼Œé€šè¿‡é…ç½®é¡¹ rules æ„å»º { customizeArray, customizeObject } å¯¹è±¡ï¼Œæœ€ç»ˆç”Ÿæˆ customizer æ•°æ®å¤„ç†å‡½æ•°ã€‚rules ä»¥å¯¹è±¡å½¢å¼é…ç½®ï¼Œå®šä¹‰äº†æ•°æ®å¤„ç†ç­–ç•¥ï¼Œå…¶ä¸­ï¼Œâ€™prependâ€™ ä¸ºåå‘æ·±æ‹·è´ï¼Œâ€™replaceâ€™ æ›¿æ¢ï¼Œé»˜è®¤ä¸º â€˜appendâ€™ å³æ­£å‘æ·±æ‹·è´ã€‚ä¸ merge æ–¹æ³•ç›¸åŒï¼Œrules å¯ä»¥è®¾ç½®æ·±åº¦åµŒå¥—å±æ€§çš„å¤„ç†è§„åˆ™ï¼Œå¦‚ â€˜module.rulesâ€™: â€˜prependâ€™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeStrategy = <span class="function">(<span class="params">rules = &#123;&#125;</span>) =&gt;</span> merge(&#123;</span><br><span class="line">  customizeArray: customizeArray(rules),</span><br><span class="line">  customizeObject: customizeObject(rules)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">customizeArray</span>(<span class="params">rules</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (rules[key]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">        <span class="keyword">return</span> [...b, ...a];</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">      <span class="keyword">default</span>: <span class="comment">// append</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">customizeObject</span>(<span class="params">rules</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (rules[key]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">        <span class="keyword">return</span> mergeWith(&#123;&#125;, b, a, joinArrays());</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">      <span class="keyword">default</span>: <span class="comment">// append</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="smart-æ–¹æ³•"><a href="#smart-æ–¹æ³•" class="headerlink" title="smart æ–¹æ³•"></a>smart æ–¹æ³•</h2><p>smart æ–¹æ³•ä¸ºå¤„ç† module.rules é…ç½®é¡¹è€Œè®¾è®¡ã€‚é¦–å…ˆæå– module.rules æ•°ç»„ï¼Œäº¤ç”± lodash æ¨¡å—çš„ unionWith æ–¹æ³•å¤„ç†ã€‚unionWith æ–¹æ³•æ¥å—å‚æ•°ä¸º (â€¦array, compator)ï¼Œcomparator(arrVal, othVal) å‡½æ•°è¿”å› false æ—¶ä¿ç•™ä¸¤ä¸ªæ•°ç»„é¡¹ï¼Œè¿”å›çœŸå€¼åªä¿ç•™ arrValã€‚ç‰¹åˆ«çš„ï¼Œcomparator æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯å¯¹å¼•ç”¨å¯¹è±¡ arrVal è¿›è¡Œå†åº¦æ’å€¼æ“ä½œï¼Œä½¿å…¶å…·æœ‰ othVal çš„ç‰¹æ€§ã€‚ä¸ºæ­¤ï¼Œwebpack-merge ç±»åº“æ„é€ äº† uniteRules å‡½æ•°å¯¹ module.rules æ•°ç»„é¡¹è¿›è¡Œå¤„ç†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeSmart = merge(&#123;</span><br><span class="line">  customizeArray: <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isRule(key.split(<span class="string">'.'</span>).slice(<span class="number">-1</span>)[<span class="number">0</span>])) &#123;</span><br><span class="line">      <span class="keyword">return</span> unionWith(a, b, uniteRules.bind(<span class="literal">null</span>, &#123;&#125;, key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>uniteRules å‡½æ•°æ¥å—å‚æ•°ä¸º {rules, key, newRule, rule}ï¼Œå…¶ä¸­ rules ç”¨äºé…ç½® module.rules åˆå¹¶ç­–ç•¥ï¼Œå¦‚ { rules.use: â€˜prependâ€™ | â€˜appendâ€™ | â€˜replaceâ€™ }ï¼Œkey å³ â€˜rulesâ€™ï¼ŒnewRule, rule ä¸ºå¾…åˆå¹¶çš„ä¸¤ä¸ªåŠ è½½å™¨é…ç½®é¡¹ã€‚uniteRules å‡½æ•°çš„å¤„ç†é€»è¾‘ä¸ºï¼šé¦–å…ˆæ¯”è¾ƒ newRule, rule çš„ test, include, exclude, enforce, query æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæ˜¯å¦è·³è¿‡åˆå¹¶ï¼›å…¶æ¬¡ï¼Œå°† newRule.loader é…ç½®é¡¹èµ‹ç»™ruleï¼Œä½œä¸ºè¿”å›å€¼ï¼Œå› ä¸ºæ— è®º â€˜prependâ€™ | â€˜appendâ€™ | â€˜replaceâ€™ ç­–ç•¥ï¼Œéƒ½å°†è¿”å› newRule.loaderï¼›å…¶æ¬¡å°† rule.loader è½¬æ¢ä¸º [{ loader }]æ•°ç»„ï¼ŒåŒæ—¶newRule.use, rule.use ä¹Ÿè½¬æ¢ä¸º [{ loader }] æ•°ç»„ï¼Œè¯¥æ•°ç»„åŒå loader å°†ä¼šè¢«åˆå¹¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniteRules</span>(<span class="params">rules, key, newRule, rule</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">String</span>(rule.test) !== <span class="built_in">String</span>(newRule.test)</span><br><span class="line">      || ((newRule.enforce || rule.enforce) &amp;&amp; rule.enforce !== newRule.enforce)</span><br><span class="line">      || (newRule.include &amp;&amp; !isSameValue(rule.include, newRule.include))</span><br><span class="line">      || (newRule.exclude &amp;&amp; !isSameValue(rule.exclude, newRule.exclude))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!rule.test &amp;&amp; !rule.include &amp;&amp; !rule.exclude</span><br><span class="line">      &amp;&amp; (rule.loader &amp;&amp; rule.loader.split(<span class="string">'?'</span>)[<span class="number">0</span>]) !== (newRule.loader &amp;&amp; newRule.loader.split(<span class="string">'?'</span>)[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="comment">// Don't merge the rule if there isn't any identifying fields and the loaders don't match</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((rule.include || rule.exclude) &amp;&amp; (!newRule.include &amp;&amp; !newRule.exclude)) &#123;</span><br><span class="line">    <span class="comment">// Don't merge child without include/exclude to parent that has either</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// newRule.loader should always override</span></span><br><span class="line">  <span class="keyword">if</span> (newRule.loader) &#123;</span><br><span class="line">    <span class="keyword">const</span> optionsKey = newRule.options ? <span class="string">'options'</span> : newRule.query &amp;&amp; <span class="string">'query'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> rule.use;</span><br><span class="line">    <span class="keyword">delete</span> rule.loaders;</span><br><span class="line">    rule.loader = newRule.loader;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (optionsKey) &#123;</span><br><span class="line">      rule[optionsKey] = newRule[optionsKey];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((rule.use || rule.loaders || rule.loader) &amp;&amp; (newRule.use || newRule.loaders)) &#123;</span><br><span class="line">    <span class="keyword">const</span> expandEntry = <span class="function"><span class="params">loader</span> =&gt;</span> (</span><br><span class="line">      <span class="keyword">typeof</span> loader === <span class="string">'string'</span> ? &#123; loader &#125; : loader</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// this is only here to avoid breaking existing tests</span></span><br><span class="line">    <span class="keyword">const</span> unwrapEntry = <span class="function"><span class="params">entry</span> =&gt;</span> (</span><br><span class="line">      !entry.options &amp;&amp; !entry.query ? entry.loader : entry</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> entries;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† &#123; loader &#125; è½¬åŒ–æˆ [&#123; loader, option?, query? &#125;]æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (rule.loader) &#123;</span><br><span class="line">      <span class="keyword">const</span> optionsKey = rule.options ? <span class="string">'options'</span> : rule.query &amp;&amp; <span class="string">'query'</span>;</span><br><span class="line">      entries = [&#123; <span class="attr">loader</span>: rule.loader &#125;];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (optionsKey) &#123;</span><br><span class="line">        entries[<span class="number">0</span>][optionsKey] = rule[optionsKey];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">delete</span> rule.loader;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (optionsKey) &#123;</span><br><span class="line">        <span class="keyword">delete</span> rule[optionsKey];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// rule.use, rule.loaders æ•°ç»„é¡¹è‹¥ä¸ºå­—ç¬¦ä¸²ï¼Œè½¬åŒ–ä¸º &#123; loader &#125; å¯¹è±¡</span></span><br><span class="line">      entries = [].concat(rule.use || rule.loaders).map(expandEntry);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> newEntries = [].concat(newRule.use || newRule.loaders).map(expandEntry);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> loadersKey = rule.use || newRule.use ? <span class="string">'use'</span> : <span class="string">'loaders'</span>;</span><br><span class="line">    <span class="keyword">const</span> resolvedKey = <span class="string">`<span class="subst">$&#123;key&#125;</span>.<span class="subst">$&#123;loadersKey&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (rules[resolvedKey]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">        rule[loadersKey] = [</span><br><span class="line">          ...differenceWith(newEntries, entries, uniteEntries),</span><br><span class="line">          ...entries</span><br><span class="line">        ].map(unwrapEntry);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">        rule[loadersKey] = newRule.use || newRule.loaders;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        rule[loadersKey] = unionWith(</span><br><span class="line">          <span class="comment">// Remove existing entries so that we can respect the order of the new</span></span><br><span class="line">          <span class="comment">// entries</span></span><br><span class="line">          differenceWith(entries, newEntries, isEqual),</span><br><span class="line">          newEntries,</span><br><span class="line">          uniteEntries</span><br><span class="line">        ).map(unwrapEntry);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newRule.include) &#123;</span><br><span class="line">    rule.include = newRule.include;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newRule.exclude) &#123;</span><br><span class="line">    rule.exclude = newRule.exclude;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniteEntries</span>(<span class="params">newEntry, entry</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> loaderNameRe = <span class="regexp">/^([^?]+)/ig</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [loaderName] = entry.loader.match(loaderNameRe);</span><br><span class="line">  <span class="keyword">const</span> [newLoaderName] = newEntry.loader.match(loaderNameRe);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loaderName !== newLoaderName) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Replace query values with newer ones</span></span><br><span class="line">  mergeWith(entry, newEntry);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="smartStrategy-æ–¹æ³•"><a href="#smartStrategy-æ–¹æ³•" class="headerlink" title="smartStrategy æ–¹æ³•"></a>smartStrategy æ–¹æ³•</h2><p>smartStrategy æ–¹æ³•ä¸åŒäº smart æ–¹æ³•åªå¤„ç† module.rules é…ç½®é¡¹ï¼ŒsmartStrategy æ–¹æ³•å¯¹æ•´ä¸ª webpack é…ç½®è¿›è¡Œå¤„ç†ã€‚å…¶ä¸­ï¼Œå¯¹ module.rules é…ç½®é¡¹ï¼ŒsmartStrategy æ–¹æ³•å¤„ç†é€»è¾‘é›·åŒ smart æ–¹æ³•ï¼Œå…¶ä»–é…ç½®é¡¹åˆ™åŒ strategy æ–¹æ³•ã€‚é’ˆå¯¹ module.rules é…ç½®é¡¹ï¼Œåˆå¹¶è§„åˆ™ rules é¡»é…ç½®ä¸º { â€˜module.rulesâ€™: â€˜prependâ€™ | â€˜replaceâ€™ | â€˜appendâ€™, â€˜module.rules.useâ€™: â€˜prependâ€™ | â€˜replaceâ€™ | â€˜appendâ€™ } å½¢å¼ã€‚â€™module.rulesâ€™ å±æ€§è®¾å®š module.rules åˆå¹¶ç­–ç•¥ï¼Œâ€™module.rules.useâ€™ å±æ€§è®¾å®š rule.use åˆå¹¶ç­–ç•¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeSmartStrategy = <span class="function">(<span class="params">rules = &#123;&#125;</span>) =&gt;</span> merge(&#123;</span><br><span class="line">  customizeArray: <span class="function">(<span class="params">a, b, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> topKey = key.split(<span class="string">'.'</span>).slice(<span class="number">-1</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isRule(topKey)) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (rules[key]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'prepend'</span>:</span><br><span class="line">          <span class="keyword">return</span> [</span><br><span class="line">            ...differenceWith(b, a, (newRule, seenRule) =&gt; (</span><br><span class="line">              uniteRules(rules, key, newRule, seenRule, <span class="string">'prepend'</span>))</span><br><span class="line">            ),</span><br><span class="line">            ...a</span><br><span class="line">          ];</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'replace'</span>:</span><br><span class="line">          <span class="keyword">return</span> b;</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// append</span></span><br><span class="line">          <span class="keyword">return</span> unionWith(a, b, uniteRules.bind(<span class="literal">null</span>, rules, key));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> customizeArray(rules)(a, b, key);</span><br><span class="line">  &#125;,</span><br><span class="line">  customizeObject: customizeObject(rules)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¤‡æ³¨ï¼šwebpack-mergeç±»åº“ä¸»è¦åº”ç”¨äºwebpacké…ç½®ï¼Œå¯¹äºroadhogç­‰ç±»åº“éœ€è¦æ³¨å…¥babelPluginsã€babelPresetsé…ç½®çš„ï¼Œç¨æ˜¾é­é•¿è«åŠã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://lodash.com/docs" target="_blank" rel="noopener">lodashå®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="https://github.com/survivejs/webpack-merge" target="_blank" rel="noopener">webpack-mergeä»“åº“</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/01/webpacké…ç½®æŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/01/webpacké…ç½®æŒ‡å—/" itemprop="url">webpacké…ç½®æŒ‡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-01T23:14:26+08:00">2018-02-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a></span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯å·¥ç¨‹åŒ–/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/01/webpacké…ç½®æŒ‡å—/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/01/webpacké…ç½®æŒ‡å—/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-10-0"><a href="#3-10-0" class="headerlink" title="3.10.0"></a>3.10.0</h2><p>å‚è€ƒæ–‡æ¡£ï¼š<br><a href="https://webpack.js.org/configuration/" target="_blank" rel="noopener">webpack 3.10.0 å®˜æ–¹æ–‡æ¡£</a><br><a href="http://www.css88.com/doc/webpack" target="_blank" rel="noopener">webpack 3.5.5 ä¸­æ–‡æ–‡æ¡£</a></p>
<h3 id="content-ä¸Šä¸‹æ–‡"><a href="#content-ä¸Šä¸‹æ–‡" class="headerlink" title="content ä¸Šä¸‹æ–‡"></a>content ä¸Šä¸‹æ–‡</h3><p>é…ç½®ç”¨äºå®šä½å…¥å£æ–‡ä»¶ã€loaderçš„ç»å¯¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºå·¥ç¨‹ç›®å½•ã€‚åœ¨åŸºäºwebpackå¼€å‘çš„æ‰“åŒ…å·¥å…·ä¸­ï¼Œcontentå±æ€§å¯è®¾ç½®ä¸ºè¯¥ç±»åº“çš„ç›®å½•è·¯å¾„ï¼Œä»¥ä¾¿äºæŸ¥æ‰¾è¯¥ç±»åº“åŠ è½½çš„loaderï¼Œå…¥å£æ–‡ä»¶é‡‡ç”¨ç»å¯¹è·¯å¾„çš„æ–¹å¼å¼•å…¥ã€‚</p>
<pre><code>context: path.resolve(__dirname, &quot;app&quot;)
</code></pre><h3 id="entry-å…¥å£"><a href="#entry-å…¥å£" class="headerlink" title="entry å…¥å£"></a>entry å…¥å£</h3><p>é…ç½®å…¥å£æ–‡ä»¶ï¼Œå­—ç¬¦ä¸²ã€æ•°ç»„æˆ–å¯¹è±¡å½¢å¼ï¼ˆå¯¹è±¡å±æ€§å¯ä»¥æ˜¯æ•°ç»„å½¢å¼ï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">entry: <span class="string">'./src/app.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡å½¢å¼</span></span><br><span class="line">entry: &#123;</span><br><span class="line">  home: <span class="string">"./home.js"</span>,</span><br><span class="line">  about: <span class="string">"./about.js"</span>,</span><br><span class="line">  contact: <span class="string">"./contact.js"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line">entry: &#123;</span><br><span class="line">  app: <span class="string">'./src/app.js'</span>,</span><br><span class="line">  vendors: [ <span class="string">'react'</span>, <span class="string">'react-dom'</span>, <span class="string">'react-router'</span>, <span class="string">'redux'</span>, <span class="string">'react-redux'</span> ]<span class="comment">// é…ç½®ç¬¬ä¸‰æ–¹åº“</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å½¢å¼ï¼ŒåŠ¨æ€å…¥å£</span></span><br><span class="line">entry: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">'./demo'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">entry: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> resolve([<span class="string">'./demo'</span>, <span class="string">'./demo2'</span>]))</span><br></pre></td></tr></table></figure>
<h3 id="output-è¾“å‡º"><a href="#output-è¾“å‡º" class="headerlink" title="output è¾“å‡º"></a>output è¾“å‡º</h3><h4 id="path"><a href="#path" class="headerlink" title="path"></a>path</h4><p>è¾“å‡ºç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¦‚ path: path.resolve(__dirname, â€˜/distâ€™)ã€‚</p>
<h4 id="pathinfo"><a href="#pathinfo" class="headerlink" title="pathinfo"></a>pathinfo</h4><p>æ‰“åŒ…æ–‡ä»¶æ˜¯å¦æ·»åŠ åŒ…å«æ¨¡å—çš„æ³¨é‡Šï¼Œé»˜è®¤ä¸ºfalseã€‚ç”Ÿäº§ç¯å¢ƒéœ€ç½®ä¸ºfalseã€‚</p>
<h4 id="publicPath"><a href="#publicPath" class="headerlink" title="publicPath"></a>publicPath</h4><p>æµè§ˆå™¨ç«¯è®¿é—®èµ„æºæ—¶çš„å…¬å¼€è·¯å¾„ï¼Œä½œä¸ºå‰ç¼€ã€‚ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„å½¢å¼ï¼Œå¦‚ publicPath: â€˜/assets/â€˜ï¼ˆç›¸å¯¹æœåŠ¡å™¨æ£€ç´¢èµ„æºï¼‰ï¼Œé¡µé¢è®¿é—®èµ„æºä¸ºâ€™/assets/spinner.gifâ€™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">publicPath: <span class="string">"https://cdn.example.com/assets/"</span>, <span class="comment">// CDNï¼ˆæ€»æ˜¯ HTTPS åè®®ï¼‰</span></span><br><span class="line">publicPath: <span class="string">"//cdn.example.com/assets/"</span>, <span class="comment">// CDN (åè®®ç›¸åŒ)</span></span><br><span class="line">publicPath: <span class="string">"/assets/"</span>, <span class="comment">// ç›¸å¯¹äºæœåŠ¡(server-relative)</span></span><br><span class="line">publicPath: <span class="string">"assets/"</span>, <span class="comment">// ç›¸å¯¹äº HTML é¡µé¢</span></span><br><span class="line">publicPath: <span class="string">"../assets/"</span>, <span class="comment">// ç›¸å¯¹äº HTML é¡µé¢</span></span><br><span class="line">publicPath: <span class="string">""</span>, <span class="comment">// ç›¸å¯¹äº HTML é¡µé¢ï¼ˆç›®å½•ç›¸åŒï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="filename"><a href="#filename" class="headerlink" title="filename"></a>filename</h4><p>è¾“å‡ºæ–‡ä»¶åï¼Œå¦‚ filename: â€˜bundle.jsâ€™ æˆ– â€˜[name].jsâ€™ã€‚å…¶ä¸­ï¼Œnameå ä½ç¬¦ä¼šè‡ªåŠ¨å¡«å……ä¸ºå¾…æ‰“åŒ…è„šæœ¬çš„æ–‡ä»¶åã€‚å ä½ç¬¦åŒ…å« name æ–‡ä»¶åï¼Œid æ¨¡å—æ ‡è¯†ç¬¦ï¼Œhash æ¨¡å—æ ‡è¯†ç¬¦çš„hashå€¼ï¼Œchunkhash chunkå†…å®¹çš„hashå€¼ï¼Œquery æ–‡ä»¶å?åé¢çš„å­—ç¬¦ä¸²ï¼Œä¸‹åŒã€‚</p>
<h4 id="chunkFilename"><a href="#chunkFilename" class="headerlink" title="chunkFilename"></a>chunkFilename</h4><p>æŒ‰éœ€åŠ è½½çš„éå…¥å£æ–‡ä»¶ï¼ŒåŒ…å«require.ensureå¼‚æ­¥åŠ è½½çš„è„šæœ¬ï¼Œå¦‚ chunkFilename: â€˜[name].async.jsâ€™ã€‚</p>
<h4 id="chunkLoadTimeout"><a href="#chunkLoadTimeout" class="headerlink" title="chunkLoadTimeout"></a>chunkLoadTimeout</h4><p>è®¿é—®æŒ‰éœ€åŠ è½½èµ„æºçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º120000ã€‚</p>
<h4 id="jsonpFunction"><a href="#jsonpFunction" class="headerlink" title="jsonpFunction"></a>jsonpFunction</h4><p>æŒ‰éœ€åŠ è½½èµ„æºçš„jsonpå‡½æ•°åï¼Œé»˜è®¤å€¼ä¸ºâ€™webpackJsonpâ€™ã€‚æœ‰å¤šä¸ªç¼–è¯‘è¿‡ç¨‹éœ€è¦ä¿®æ”¹ï¼Œé¿å…åŒåå†²çªã€‚</p>
<h4 id="jsonpScriptType"><a href="#jsonpScriptType" class="headerlink" title="jsonpScriptType"></a>jsonpScriptType</h4><p>ä»¥jsonpå½¢å¼æŒ‰éœ€åŠ è½½èµ„æºæ—¶ï¼Œæ³¨å…¥é¡µé¢çš„scriptèŠ‚ç‚¹çš„typeå€¼ï¼Œé»˜è®¤ä¸ºâ€™text/Javascriptâ€™ã€‚å¯é…ç½®ä¸ºâ€™moduleâ€™ï¼Œå³ä»¥es6è¯­æ³•å½¢å¼åŠ è½½è„šæœ¬ã€‚</p>
<h4 id="crossOriginLoading"><a href="#crossOriginLoading" class="headerlink" title="crossOriginLoading"></a>crossOriginLoading</h4><p>å¯ç”¨jsonpè·¨åŸŸåŠ è½½è„šæœ¬ï¼Œé»˜è®¤å€¼ä¸ºfalseï¼Œå³ä¸å…è®¸ï¼›å¯é…ç½®ä¸ºâ€™anonymousâ€™ï¼ˆå…è®¸è·¨åŸŸï¼Œå‘é€ä¸å¸¦å‡­æ®çš„è¯·æ±‚ï¼‰æˆ–â€™use-credentialsâ€™ï¼ˆå…è®¸è·¨åŸŸï¼Œå‘é€å¾…å‡­æ®çš„è¯·æ±‚ï¼‰ã€‚</p>
<h4 id="library"><a href="#library" class="headerlink" title="library"></a>library</h4><p>å¼€å‘ç±»åº“æ—¶é…ç½®ï¼Œé…ç½®ä¸º libaryName ç±»åº“åã€‚å‚è€ƒ <a href="http://www.css88.com/doc/webpack/guides/author-libraries/" target="_blank" rel="noopener">åˆ›å»ºåº“ (Library)</a>ã€‚</p>
<h4 id="libraryTarget"><a href="#libraryTarget" class="headerlink" title="libraryTarget"></a>libraryTarget</h4><p>ç±»åº“å¯¼å‡ºæ ¼å¼ï¼Œé»˜è®¤å€¼ä¸ºâ€™varâ€™ã€‚å¯é€‰å€¼åŒ…å«â€™varâ€™ï¼ˆå¯¼å‡ºä¸ºå˜é‡ï¼‰ï¼Œâ€™thisâ€™ï¼ˆå¯¼å‡ºä¸ºthisçš„å±æ€§ï¼‰ï¼Œâ€™commonjsâ€™ï¼ˆå¯¼å‡ºä¸ºexportsçš„å±æ€§ï¼Œå³nodeè„šæœ¬çš„æ–¹æ³•ï¼‰ï¼Œâ€™commonjs2â€™ï¼ˆé€šè¿‡module.exportså¯¼å‡ºï¼Œå³nodeçš„ä¸€ä¸ªæ¨¡å—ï¼‰ï¼Œâ€™amdâ€™ï¼ˆrequirejsæ¨¡å—åŒ–è§„èŒƒå¯¼å‡ºæ¨¡å—ï¼‰ï¼Œâ€™umdâ€™ï¼ˆä»¥AMDï¼ŒCommonJS2 å½¢å¼å¯¼å‡ºæˆ–è€…å¯¼å‡ºä¸º root çš„å±æ€§ï¼‰ã€‚</p>
<h4 id="libraryExport"><a href="#libraryExport" class="headerlink" title="libraryExport"></a>libraryExport</h4><p>é…ç½®å¯¼å‡ºçš„å†…å®¹ï¼Œé»˜è®¤å€¼ä¸º _entry<em>return</em> ï¼Œå³å°†å®Œå…¨å¯¼å‡ºæ¨¡å—ã€‚è‹¥é…ç½®ä¸º _entry<em>return</em>.default ï¼Œåªå¯¼å‡º default å±æ€§ã€‚è‹¥é…ç½®ä¸º _entry<em>return</em>.methodName ï¼Œåªå¯¼å‡º methodName æ–¹æ³•ã€‚</p>
<h4 id="auxiliaryComment"><a href="#auxiliaryComment" class="headerlink" title="auxiliaryComment"></a>auxiliaryComment</h4><p>åœ¨å¯¼å‡ºç±»åº“æ—¶ï¼Œç”¨äºåœ¨å¯¼å‡ºå®¹å™¨ä¸­æ·»åŠ æ³¨é‡Šï¼Œé…åˆ library, libraryTarget å±æ€§ä¸€èµ·ä½¿ç”¨ã€‚å¦‚ auxiliaryComment: â€˜Test Commentâ€™ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">webpackUniversalModuleDefinition</span>(<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">'object'</span>)</span><br><span class="line">    <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">"lodash"</span>));</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)</span><br><span class="line">    define([<span class="string">"lodash"</span>], factory);</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span>)</span><br><span class="line">    exports[<span class="string">"someLibName"</span>] = factory(<span class="built_in">require</span>(<span class="string">"lodash"</span>));</span><br><span class="line">  <span class="comment">// Test Comment</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    root[<span class="string">"someLibName"</span>] = factory(root[<span class="string">"_"</span>]);</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">__WEBPACK_EXTERNAL_MODULE_1__</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="umdNamedDefine"><a href="#umdNamedDefine" class="headerlink" title="umdNamedDefine"></a>umdNamedDefine</h4><p>å½“ libraryTarget å±æ€§ é…ç½®ä¸º â€˜umdâ€™ æ—¶ï¼Œè®¾ç½® umdNamedDefine ä¸ºçœŸï¼Œå°†å¯¹ UMD æ„å»ºè¿‡ç¨‹ä¸­çš„ AMD æ¨¡å—è¿›è¡Œå‘½åï¼Œå¦åˆ™å°±ä½¿ç”¨åŒ¿åçš„ defineã€‚</p>
<h4 id="sourceMapFilename"><a href="#sourceMapFilename" class="headerlink" title="sourceMapFilename"></a>sourceMapFilename</h4><p>source mapæ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸ºâ€™[file].mapâ€™ã€‚å ä½ç¬¦é™¤åŒ…å«entryçš„æ‰€æœ‰å ä½ç¬¦å¤–ï¼Œè¿˜åŒ…å« file æ¨¡å—æ–‡ä»¶åï¼Œfilebase æ¨¡å—çš„basenameï¼Œå¸¦æ‰©å±•åã€‚</p>
<h4 id="devtoolModuleFilenameTemplate"><a href="#devtoolModuleFilenameTemplate" class="headerlink" title="devtoolModuleFilenameTemplate"></a>devtoolModuleFilenameTemplate</h4><p>å®šä¹‰æ¯ä¸ª source map çš„ sources æ•°ç»„é¡¹çš„åç§°ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²æˆ–å‡½æ•°ã€‚æ¨¡æ¿å ä½ç¬¦åŒ…å« absolute-resource-path ç»å¯¹è·¯å¾„æ–‡ä»¶åï¼Œid æ¨¡å—æ ‡è¯†ç¬¦ï¼Œhash æ¨¡å—æ ‡è¯†ç¬¦çš„hashå€¼ï¼Œall-loaders è‡ªåŠ¨å’Œæ˜¾å¼çš„loaderï¼Œå‚æ•°å–å†³äºç¬¬ä¸€ä¸ªloaderçš„åç§°ï¼Œloaders æ˜¾å¼çš„loaderï¼Œå‚æ•°å–å†³äºç¬¬ä¸€ä¸ªloaderçš„åç§°ï¼Œresource æ–‡ä»¶è·¯å¾„åŠ é¦–ä¸ªloaderçš„æŸ¥è¯¢å‚æ•°ï¼Œresource-path æ–‡ä»¶è·¯å¾„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">devtoolModuleFilenameTemplate: <span class="string">"webpack:///[resource-path]?[loaders]"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line">devtoolModuleFilenameTemplate: <span class="function"><span class="params">info</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`webpack:///<span class="subst">$&#123;info.resourcePath&#125;</span>?<span class="subst">$&#123;info.loaders&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="devtoolFallbackModuleFilenameTemplate"><a href="#devtoolFallbackModuleFilenameTemplate" class="headerlink" title="devtoolFallbackModuleFilenameTemplate"></a>devtoolFallbackModuleFilenameTemplate</h4><p>ä½¿ç”¨devtoolModuleFilenameTemplateä½¿å¤šä¸ªæ¨¡å—äº§ç”Ÿç›¸åŒçš„åç§°æ—¶ï¼ŒdevtoolFallbackModuleFilenameTemplateå±æ€§æ˜¯å¤‡ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œé…ç½®åŒä¸Šã€‚</p>
<h4 id="hotUpdateChunkFilename"><a href="#hotUpdateChunkFilename" class="headerlink" title="hotUpdateChunkFilename"></a>hotUpdateChunkFilename</h4><p>é…ç½®çƒ­æ›´æ–°æ–‡ä»¶åï¼Œé»˜è®¤ä¸ºâ€™[id].[hash].hot-update.jsâ€™ï¼Œæ²¡å¿…è¦ä¿®æ”¹ã€‚</p>
<h4 id="hotUpdateFunction"><a href="#hotUpdateFunction" class="headerlink" title="hotUpdateFunction"></a>hotUpdateFunction</h4><p>çƒ­æ›´æ–°åŠ è½½çš„jsonpå‡½æ•°åï¼Œé»˜è®¤ä¸ºâ€™webpackHotUpdateâ€™ï¼Œåªåœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨ã€‚</p>
<h4 id="hotUpdateMainFilename"><a href="#hotUpdateMainFilename" class="headerlink" title="hotUpdateMainFilename"></a>hotUpdateMainFilename</h4><p>çƒ­æ›´æ–°çš„ä¸»æ–‡ä»¶å ï¼Œé»˜è®¤å€¼ä¸ºâ€™[hash].hot-update.jsonâ€™ï¼Œæ²¡å¿…è¦ä¿®æ”¹ã€‚å ä½ç¬¦åªæœ‰ hashã€‚</p>
<h4 id="hashDigest"><a href="#hashDigest" class="headerlink" title="hashDigest"></a>hashDigest</h4><p>ç”Ÿæˆ hash æ—¶çš„ç¼–ç æ–¹å¼ï¼Œé»˜è®¤ä¸º â€˜hexâ€™ã€‚</p>
<h4 id="hashDigestLength"><a href="#hashDigestLength" class="headerlink" title="hashDigestLength"></a>hashDigestLength</h4><p>æ•£åˆ—æ‘˜è¦çš„å‰ç¼€é•¿åº¦ã€‚</p>
<h4 id="hashFunction"><a href="#hashFunction" class="headerlink" title="hashFunction"></a>hashFunction</h4><p>æ•£åˆ—ç®—æ³•ã€‚</p>
<h4 id="hashSalt"><a href="#hashSalt" class="headerlink" title="hashSalt"></a>hashSalt</h4><p>å¯é€‰çš„åŠ ç›å€¼ã€‚</p>
<h4 id="strictModuleExceptionHandling"><a href="#strictModuleExceptionHandling" class="headerlink" title="strictModuleExceptionHandling"></a>strictModuleExceptionHandling</h4><p>é»˜è®¤ä¸ºå¦å€¼ã€‚å¦‚ä¸ºçœŸå€¼ï¼Œæ¨¡å—æŠ¥é”™åï¼Œå†æ¬¡å¼•ç”¨ï¼Œå°†é‡å¤æŠ¥é”™ï¼Œå› æ­¤æ— éœ€é…ç½®ã€‚</p>
<h4 id="sourcePrefix"><a href="#sourcePrefix" class="headerlink" title="sourcePrefix"></a>sourcePrefix</h4><p>é…ç½®æ‰“åŒ…æ–‡ä»¶æ¯è¡Œçš„å‰ç¼€ï¼Œé»˜è®¤ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ï¼Œæ²¡å¿…è¦é…ç½®ã€‚</p>
<h3 id="module-æ¨¡å—"><a href="#module-æ¨¡å—" class="headerlink" title="module æ¨¡å—"></a>module æ¨¡å—</h3><h4 id="noParse"><a href="#noParse" class="headerlink" title="noParse"></a>noParse</h4><p>æ— éœ€webpackè§£æçš„æ–‡ä»¶åï¼Œæ­£åˆ™æˆ–å‡½æ•°å½¢å¼ï¼Œå¦‚ module.noParse: /jquery|lodash/ æˆ– module.noParse: function(content) { return /jquery|lodash/.test(content); }ã€‚</p>
<h4 id="rules"><a href="#rules" class="headerlink" title="rules"></a>rules</h4><p>ç”¨äºé…ç½®åŠ è½½å™¨ï¼Œå¦‚ module.rules: [{ test: /.ts$/, use: â€˜ts-loaderâ€™ }]ã€‚</p>
<ul>
<li>rule.testï¼Œèµ„æºæ–‡ä»¶åé¡»åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥æ˜¯æ­£åˆ™ï¼Œæˆ–æ­£åˆ™æ•°ç»„ï¼Œæˆ–å­—ç¬¦ä¸²ï¼Œæˆ–å‡½æ•°ï¼ˆè¿”å›çœŸå€¼åŒ¹é…ï¼‰ï¼Œæˆ–å¯¹è±¡ï¼ˆåŒ¹é…æ‰€æœ‰å±æ€§ï¼‰ï¼Œä¸‹åŒã€‚ä¸rule.resourceå±æ€§ç›¸å†²ã€‚</li>
<li>rule.includeï¼Œèµ„æºæ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚</li>
<li>rule.excludeï¼Œèµ„æºæ–‡ä»¶æ’é™¤çš„ç›®å½•ã€‚</li>
<li>rule.andï¼Œèµ„æºæ–‡ä»¶åé¡»åŒ¹é…æ‰€æœ‰æ¡ä»¶ã€‚</li>
<li>rule.orï¼Œèµ„æºæ–‡ä»¶åé¡»åŒ¹é…å…¶ä¸­ä¸€æ¡æ¡ä»¶ã€‚</li>
<li>rule.notï¼Œèµ„æºæ–‡ä»¶åé¡»æ’é™¤çš„æ¡ä»¶ã€‚</li>
<li>rule.resourceQueryï¼ŒåŠ è½½æ–‡ä»¶æ—¶é¡»åŒ¹é…çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¦‚ rule.resourceQuery : /inline/ï¼Œå¯ä½¿ç”¨ import Foo from â€˜./foo.css?inlineâ€™ã€‚</li>
<li>rule.resourceï¼Œèµ„æºæ–‡ä»¶åŒ¹é…çš„è§„åˆ™ï¼Œå¯ä»¥ç”¨rule.test, rule.include, rule.excludeæ›¿ä»£é…ç½®ã€‚</li>
<li>rule.issuerï¼Œè¯·æ±‚èµ„æºçš„è„šæœ¬æ–‡ä»¶åã€‚</li>
<li>rule.useï¼ŒæŒ‡å®šåŠ è½½å™¨ï¼Œæ•°ç»„å½¢å¼ã€‚åŠ è½½å™¨æ‰§è¡Œé¡ºåºä¸ºä»å³åˆ°å·¦ã€‚</li>
<li>rule.use.loaderï¼ŒæŒ‡å®šåŠ è½½å™¨ï¼Œå¦‚ use: [ { loader: â€œstyle-loader â€œ} ]ï¼Œç®€å†™å½¢å¼ä¸ºuse: [ â€œstyle-loaderâ€ ]ã€‚</li>
<li>rule.use.options | rule.use.queryï¼Œä¼ å…¥loaderçš„é…ç½®é¡¹ï¼Œå¦‚ use: [{ loader: â€œcss-loaderâ€, options: { modules: true } }ã€‚</li>
<li><p>rule.parserï¼Œé…ç½®è§£æé€‰é¡¹ï¼Œçº¦å®šæ¨¡å—å¯ä»¥ä½¿ç”¨çš„æ¨¡å—åŒ–åŠ è½½è¯­æ³•ï¼Œé»˜è®¤å€¼ä¸º</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">parser: &#123;</span><br><span class="line">  amd: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ AMD</span></span><br><span class="line">  commonjs: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ CommonJS</span></span><br><span class="line">  system: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ SystemJS</span></span><br><span class="line">  harmony: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ ES2015 Harmony import/export</span></span><br><span class="line">  requireInclude: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ require.include</span></span><br><span class="line">  requireEnsure: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ require.ensure</span></span><br><span class="line">  requireContext: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ require.context</span></span><br><span class="line">  browserify: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ç‰¹æ®Šå¤„ç†çš„ browserify bundle</span></span><br><span class="line">  requireJs: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ requirejs.*</span></span><br><span class="line">  node: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ __dirname, __filename, module, require.extensions, require.main ç­‰ã€‚</span></span><br><span class="line">  node: &#123;...&#125; <span class="comment">// åœ¨æ¨¡å—çº§åˆ«(module level)ä¸Šé‡æ–°é…ç½® [node](/configuration/node) å±‚(layer)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>rule.rulesï¼Œé…ç½®åµŒå¥—è§„åˆ™ã€‚</p>
</li>
<li><p>rule.oneOfï¼Œä»¥æ•°ç»„é¡ºåºä¼˜å…ˆé€‰ç”¨åµŒå¥—è§„åˆ™ï¼Œå¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">use: [&#123;</span><br><span class="line">  test: <span class="regexp">/.css$/</span>,</span><br><span class="line">  oneOf: [</span><br><span class="line">    &#123;</span><br><span class="line">      resourceQuery: <span class="regexp">/inline/</span>, <span class="comment">// foo.css?inline</span></span><br><span class="line">      use: <span class="string">'url-loader'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      resourceQuery: <span class="regexp">/external/</span>, <span class="comment">// foo.css?external</span></span><br><span class="line">      use: <span class="string">'file-loader'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>rule.enforceï¼ŒæŒ‡å®š loader è°ƒç”¨é¡ºåºï¼Œå¯é€‰å€¼ä¸ºâ€™preâ€™ï¼ˆå‰ç½®ï¼‰, â€˜inlineâ€™ï¼ˆè¡Œå†…ï¼‰, â€˜normalâ€™ï¼ˆæ™®é€šï¼‰, â€˜postâ€™ï¼ˆåç½®ï¼‰ï¼Œç•™ç©ºå³ä¸ºé»˜è®¤å€¼â€™normalâ€™ã€‚</p>
</li>
</ul>
<h3 id="resolve-è§£æ"><a href="#resolve-è§£æ" class="headerlink" title="resolve è§£æ"></a>resolve è§£æ</h3><h4 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h4><p>é…ç½®èµ„æºæ–‡ä»¶çš„åˆ«åï¼Œå½±å“ webpack æŸ¥æ‰¾èµ„æºçš„æ–¹å¼ã€‚</p>
<h4 id="enforceExtension"><a href="#enforceExtension" class="headerlink" title="enforceExtension"></a>enforceExtension</h4><p>æ˜¯å¦å…è®¸åŠ è½½æ— æ‰©å±•åçš„æ–‡ä»¶ï¼Œé»˜è®¤ä¸º falseã€‚</p>
<h4 id="extensions"><a href="#extensions" class="headerlink" title="extensions"></a>extensions</h4><p>è‡ªåŠ¨è§£æçš„æ–‡ä»¶æ‰©å±•åï¼Œé»˜è®¤å€¼ä¸º extensions: [â€œ.jsâ€, â€œ.jsonâ€]ã€‚</p>
<h4 id="mainFields"><a href="#mainFields" class="headerlink" title="mainFields"></a>mainFields</h4><p>å†³å®šç±»åº“å¯¼å…¥çš„æ–¹å¼ï¼Œé»˜è®¤å€¼ä¸º mainFields: [â€œbrowserâ€, â€œmoduleâ€, â€œmainâ€]ï¼Œå³ä¼˜å…ˆä»¥ç±»åº“ package.json æ–‡ä»¶ä¸­â€™browserâ€™å±æ€§å¯¼å…¥æ¨¡å—ï¼Œå…¶æ¬¡â€™moduleâ€™ï¼Œå…¶æ¬¡â€™mainâ€™ã€‚</p>
<h4 id="mainFiles"><a href="#mainFiles" class="headerlink" title="mainFiles"></a>mainFiles</h4><p>è§£æç›®å½•æ—¶ä½¿ç”¨çš„æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º mainFiles: [â€œindexâ€]ã€‚</p>
<h4 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h4><p>å‘Šè¯‰ webpack åœ¨å“ªä¸ªç›®å½•ä¸­æŸ¥æ‰¾æ¨¡å—ï¼Œå¦‚ modules: [path.resolve(__dirname, â€œsrcâ€), â€œnode_modulesâ€]ã€‚</p>
<h4 id="unsafeCache"><a href="#unsafeCache" class="headerlink" title="unsafeCache"></a>unsafeCache</h4><p>æŒ‡å®šéœ€è¦ç¼“å­˜çš„æ¨¡å—ï¼Œé»˜è®¤ä¸º unsafeCache: trueã€‚unsafeCache: /src\/utilities/é…ç½®åªç¼“å­˜utilitiesæ¨¡å—ã€‚</p>
<h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><p>é¢å¤–ä½¿ç”¨çš„è§£ææ’ä»¶åˆ—è¡¨ï¼Œå¦‚ plugins: [new DirectoryNamedWebpackPlugin()]ã€‚</p>
<h4 id="cachePredicate"><a href="#cachePredicate" class="headerlink" title="cachePredicate"></a>cachePredicate</h4><p>æŒ‡å®šå¼‚æ­¥åŠ è½½è„šæœ¬æ˜¯å¦éœ€è¦è¢«ç¼“å­˜ï¼Œå‡½æ•°å½¢å¼ï¼Œé»˜è®¤å€¼ä¸º cachePredicate: function() { return true }ã€‚</p>
<h4 id="resolveLoader"><a href="#resolveLoader" class="headerlink" title="resolveLoader"></a>resolveLoader</h4><p>æŒ‡å®š webpack æŸ¥æ‰¾loaderçš„æ–¹å¼ï¼Œå¦‚resolveLoader: {  modules: [â€œnode_modulesâ€], extensions: [â€œ.jsâ€, â€œ.jsonâ€], mainFields: [â€œloaderâ€, â€œmainâ€] }ã€‚</p>
<h4 id="moduleExtensions"><a href="#moduleExtensions" class="headerlink" title="moduleExtensions"></a>moduleExtensions</h4><p>rule.useé…ç½®loaderæ—¶å¾…æ·»åŠ çš„åç¼€ã€‚</p>
<h3 id="plugins-æ’ä»¶"><a href="#plugins-æ’ä»¶" class="headerlink" title="plugins æ’ä»¶"></a>plugins æ’ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="comment">// å¯¼å…¥é webpack é»˜è®¤è‡ªå¸¦æ’ä»¶</span></span><br><span class="line"><span class="keyword">var</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">var</span> DashboardPlugin = <span class="built_in">require</span>(<span class="string">'webpack-dashboard/plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨é…ç½®ä¸­æ·»åŠ æ’ä»¶</span></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="comment">// æ„å»ºä¼˜åŒ–æ’ä»¶</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;<span class="comment">// æå–å…¬å…±èµ„æº</span></span><br><span class="line">    name: <span class="string">'vendor'</span>,</span><br><span class="line">    filename: <span class="string">'vendor-[hash].min.js'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;<span class="comment">// å‹ç¼©ä»£ç </span></span><br><span class="line">    compress: &#123;</span><br><span class="line">      warnings: <span class="literal">false</span>,</span><br><span class="line">      drop_console: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> ExtractTextPlugin(&#123;<span class="comment">// æå–å¹¶å‹ç¼©css</span></span><br><span class="line">    filename: <span class="string">'build.min.css'</span>,</span><br><span class="line">    allChunks: <span class="literal">true</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, /moment$/),</span><br><span class="line">  <span class="comment">// ç¼–è¯‘æ—¶(compile time)æ’ä»¶</span></span><br><span class="line">  <span class="keyword">new</span> webpack.DefinePlugin(&#123;<span class="comment">// å®šä¹‰å…¨å±€å˜é‡</span></span><br><span class="line">    <span class="string">'process.env.NODE_ENV'</span>: <span class="string">'"production"'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// webpack-dev-server å¼ºåŒ–æ’ä»¶</span></span><br><span class="line">  <span class="keyword">new</span> DashboardPlugin(),</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="devServer-å¼€å‘æœåŠ¡å™¨"><a href="#devServer-å¼€å‘æœåŠ¡å™¨" class="headerlink" title="devServer å¼€å‘æœåŠ¡å™¨"></a>devServer å¼€å‘æœåŠ¡å™¨</h3><p>ä½¿ç”¨ webpack-dev-server å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒçš„æœåŠ¡å™¨ã€‚ç”± webpack-dev-server å¯åŠ¨çš„æœåŠ¡ï¼Œè®¿é—® /webpack-dev-server è·¯å¾„å¯æŸ¥çœ‹åŠ è½½çš„èµ„æºã€‚</p>
<h4 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h4><p>dev server ä½¿ç”¨å†…è”æ¨¡å¼å¯åŠ¨ï¼Œå°†å¤„ç†å®æ—¶é‡è½½çš„è„šæœ¬æ³¨å…¥åˆ°æ‰“åŒ…æ–‡ä»¶ä¸­ï¼Œå¼€å‘è€…å¯åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ„å»ºä¿¡æ¯ã€‚å½“é…ç½®ä¸º inline: false æ—¶ï¼Œå°†å¯ç”¨ iframe æ¨¡å¼ï¼Œå¤„ç†å®æ—¶é‡è½½çš„è„šæœ¬å°†æ³¨å…¥åˆ° iframe æ ‡ç­¾ä¸­ã€‚</p>
<h4 id="lazy"><a href="#lazy" class="headerlink" title="lazy"></a>lazy</h4><p>dev server ä½¿ç”¨æƒ°æ€§æ¨¡å¼ï¼Œåœ¨è¯·æ±‚èµ„æºæ—¶é‡æ–°ç¼–è¯‘è„šæœ¬ï¼Œwebpack ä¸ä¼šç›‘å¬ä»»ä½•æ–‡ä»¶çš„å˜åŠ¨ã€‚</p>
<h4 id="hot"><a href="#hot" class="headerlink" title="hot"></a>hot</h4><p>æ˜¯å¦å¯ç”¨ webpack æ¨¡å—çƒ­æ›¿æ¢ç‰¹æ€§ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“hot å¯åŠ¨ã€‚</p>
<h4 id="hotOnly"><a href="#hotOnly" class="headerlink" title="hotOnly"></a>hotOnly</h4><p>å¯ç”¨çƒ­æ›¿æ¢ç‰¹æ€§æ—¶ï¼Œç¼–è¯‘å¤±è´¥æ—¶ï¼Œæ˜¯å¦é¿å…åˆ·æ–°é¡µé¢ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“hot å¯åŠ¨ã€‚</p>
<h4 id="open"><a href="#open" class="headerlink" title="open"></a>open</h4><p>æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“open é…ç½®ã€‚</p>
<h4 id="openPage"><a href="#openPage" class="headerlink" title="openPage"></a>openPage</h4><p>æ‰“å¼€æµè§ˆå™¨æ—¶æŒ‡å®šé¡µé¢ï¼Œå¦‚ openPage: â€˜/different/pageâ€™ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“open-page â€œ/different/pageâ€ é…ç½®ã€‚</p>
<h4 id="overlay"><a href="#overlay" class="headerlink" title="overlay"></a>overlay</h4><p>æµè§ˆå™¨ç«¯æ˜¾ç¤ºæ„å»ºå¤±è´¥å’Œè­¦å‘Šä¿¡æ¯ï¼Œé…ç½®ä¸º overlay: true åªæç¤ºæ„å»ºå¤±è´¥ä¿¡æ¯ï¼Œoverlay: { warnings: true, errors: true } åŒæ—¶æ˜¾ç¤ºå¤±è´¥å’Œè­¦å‘Šä¿¡æ¯ã€‚</p>
<h4 id="useLocalIp"><a href="#useLocalIp" class="headerlink" title="useLocalIp"></a>useLocalIp</h4><p>æµè§ˆå™¨ç«¯ä»¥ ip æ‰“å¼€ç½‘é¡µï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“useLocalIp é…ç½®ã€‚</p>
<h4 id="historyApiFallback"><a href="#historyApiFallback" class="headerlink" title="historyApiFallback"></a>historyApiFallback</h4><p>é€šè¿‡ html5 histroy api æ§åˆ¶è·¯ç”±ï¼Œè®¾ç½®ä¸ºçœŸå€¼ï¼Œ404 é”™è¯¯é¡µé¢å°†é‡å®šå‘åˆ° index.htmlã€‚rewrites é€‰é¡¹å¼€å¯æ›´ç»†ç²’åº¦çš„é‡å®šå‘ï¼›disableDotRule é€‰é¡¹ç”¨äºåœ¨è·¯å¾„ä¸­ä½¿ç”¨â€™.â€™ï¼ˆå¸¸è§äº Angularï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">historyApiFallback: &#123;</span><br><span class="line">  rewrites: [</span><br><span class="line">    &#123; <span class="attr">from</span>: <span class="regexp">/^\/$/</span>, <span class="attr">to</span>: <span class="string">'/views/landing.html'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">from</span>: <span class="regexp">/^\/subpage/</span>, <span class="attr">to</span>: <span class="string">'/views/subpage.html'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">from</span>: <span class="regexp">/./</span>, <span class="attr">to</span>: <span class="string">'/views/404.html'</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h4><p>é€šè¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘è¯·æ±‚ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  <span class="string">"/api"</span>: &#123;</span><br><span class="line">    target: <span class="string">"http://localhost:3000"</span>,<span class="comment">// ä»£ç†æœåŠ¡å™¨è½¬å‘åˆ°çš„ç›®æ ‡æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    secure: <span class="literal">true</span>,<span class="comment">// æ˜¯å¦æ¥å— https æœåŠ¡ï¼Œä¸”ä½¿ç”¨æ— æ•ˆè¯ä¹¦çš„ç›®æ ‡æœåŠ¡å™¨</span></span><br><span class="line">    pathRewrite: &#123;<span class="string">"^/api"</span> : <span class="string">""</span>&#125;,<span class="comment">// é‡å†™è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    bypass: <span class="function"><span class="keyword">function</span>(<span class="params">req, res, proxyOptions</span>) </span>&#123;<span class="comment">// è¯·æ±‚ html é¡µé¢èµ„æºæ—¶ï¼Œè·³è¿‡ä»£ç†</span></span><br><span class="line">      <span class="keyword">if</span> (req.headers.accept.indexOf(<span class="string">"html"</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Skipping proxy for browser request."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"/index.html"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line">proxy: [&#123;<span class="comment">// è®¾ç½®å¤šä¸ªä»£ç†</span></span><br><span class="line">  context: [<span class="string">"/auth"</span>, <span class="string">"/api"</span>],</span><br><span class="line">  target: <span class="string">"http://localhost:3000"</span>,</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<h4 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h4><p>è®¿é—® dev server æœåŠ¡å™¨å®ä¾‹ï¼Œæ·»åŠ é’©å­æˆ–ä¸­é—´ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setup(app)&#123;</span><br><span class="line">  app.get(<span class="string">'/some/path'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.json(&#123; <span class="attr">custom</span>: <span class="string">'response'</span> &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="quiet"><a href="#quiet" class="headerlink" title="quiet"></a>quiet</h4><p>é…ç½®ä¸ºçœŸå€¼æ—¶ï¼Œå°†éšè—æ„å»ºä¿¡æ¯ï¼ŒåŒ…å«é”™è¯¯å’Œè­¦å‘Šæç¤ºã€‚</p>
<h4 id="info"><a href="#info" class="headerlink" title="info"></a>info</h4><p>è¯¥é…ç½®é¡¹åªèƒ½é€šè¿‡å‘½ä»¤è¡Œé…ç½®ï¼Œé»˜è®¤ä¸ºtrueï¼Œæ˜¯å¦è¾“å‡ºæ—¥å¿—ï¼Œå¦‚ â€“info=falseã€‚</p>
<h4 id="noInfo"><a href="#noInfo" class="headerlink" title="noInfo"></a>noInfo</h4><p>æ˜¯å¦éšè—æ„å»ºä¿¡æ¯ï¼Œé”™è¯¯å’Œè­¦å‘Šé™¤å¤–ã€‚</p>
<h4 id="clientLogLevel"><a href="#clientLogLevel" class="headerlink" title="clientLogLevel"></a>clientLogLevel</h4><p>æ§åˆ¶å°æ‰“å°æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ä¸º infoã€‚å¯é€‰é¡¹ none, error, warning æˆ– infoã€‚</p>
<h4 id="color"><a href="#color" class="headerlink" title="color"></a>color</h4><p>æ˜¯å¦å¸¦é¢œè‰²è¾“å‡ºæ—¥å¿—ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“color å¯åŠ¨ã€‚</p>
<h4 id="stats"><a href="#stats" class="headerlink" title="stats"></a>stats</h4><p>ç»†ç²’åº¦æ§åˆ¶å°æ‰“å°çš„ä¿¡æ¯ï¼ŒåŒ webapckConfig.statsã€‚</p>
<h4 id="filename-1"><a href="#filename-1" class="headerlink" title="filename"></a>filename</h4><p>lazy å±æ€§ä¸ºtrueï¼Œæƒ°æ€§æ¨¡å¼å¯åŠ¨æœåŠ¡å™¨æ—¶ï¼Œé…ç½® filename å¯ä½¿èµ„æºè¢«è¯·æ±‚æ—¶æ‰å¯åŠ¨æ‰“åŒ…ï¼Œå¦‚ filename: â€œbundle.jsâ€ã€‚</p>
<h4 id="host"><a href="#host" class="headerlink" title="host"></a>host</h4><p>é…ç½®ä¸»æœºipï¼Œå¦‚ host: â€œ0.0.0.0â€ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“host 0.0.0.0 é…ç½®ã€‚</p>
<h4 id="port"><a href="#port" class="headerlink" title="port"></a>port</h4><p>é…ç½®ç«¯å£å·ï¼Œå¦‚ port: 8080ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“port 8080 é…ç½®ã€‚</p>
<h4 id="public"><a href="#public" class="headerlink" title="public"></a>public</h4><p>ä½¿ç”¨å†…è”æ¨¡å¼ï¼Œä¸”é€šè¿‡ ngnix ä»£ç† dev server æ—¶ï¼Œè®¾ç½® public ä¸»æœºurlï¼Œå¦‚public: â€œmyapp.test:80â€ã€‚å¯é€šè¿‡å‘½ä»¤è¡Œ â€“public myapp.test:80 é…ç½®ã€‚</p>
<h4 id="publicPath-1"><a href="#publicPath-1" class="headerlink" title="publicPath"></a>publicPath</h4><p>æµè§ˆå™¨ç«¯è®¿é—®æ‰“åŒ…æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸ºâ€™/â€˜ï¼Œå¯é…ç½®ä¸ºç›¸å¯¹è·¯å¾„æˆ–å®Œæ•´urlï¼Œå¦‚ publicPath: â€œ<a href="http://localhost:8080/assets/&quot;ï¼Œæ­¤æ—¶è®¿é—®èµ„æº" target="_blank" rel="noopener">http://localhost:8080/assets/&quot;ï¼Œæ­¤æ—¶è®¿é—®èµ„æº</a> bundle.js çš„åœ°å€ä¸º <a href="http://localhost:8080/assets/bundle.jsã€‚" target="_blank" rel="noopener">http://localhost:8080/assets/bundle.jsã€‚</a></p>
<h4 id="contentBase"><a href="#contentBase" class="headerlink" title="contentBase"></a>contentBase</h4><p>æŒ‡å®šæœåŠ¡å™¨ä»å“ªé‡Œè·å–é™æ€èµ„æºï¼Œé»˜è®¤ä¸ºå·¥ç¨‹ç›®å½•ï¼Œå¯é…ç½®ä¸ºå­—ç¬¦ä¸²æˆ–æ•°ç»„ï¼Œfalseè¡¨ç¤ºç¦ç”¨ã€‚publicPath æŒ‡å®šæ‰“åŒ…æ–‡ä»¶åŠ è½½è·¯å¾„ï¼Œä¼˜å…ˆçº§è¾ƒé«˜ã€‚å¯é€šè¿‡å‘½ä»¤è¡Œ â€“content-base /path/to/content/dir é…ç½®ã€‚</p>
<h4 id="watchContentBase"><a href="#watchContentBase" class="headerlink" title="watchContentBase"></a>watchContentBase</h4><p>ç›‘å¬ contentBase é™æ€èµ„æºæ”¹åŠ¨ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“watch-content-base é…ç½®ã€‚</p>
<h4 id="staticOptions"><a href="#staticOptions" class="headerlink" title="staticOptions"></a>staticOptions</h4><p>é…ç½®é€šè¿‡ contentBase è®¿é—®çš„é™æ€èµ„æºé€‰é¡¹ï¼Œå¦‚ staticOptions: { redirect: false }ã€‚</p>
<h4 id="headers"><a href="#headers" class="headerlink" title="headers"></a>headers</h4><p>åœ¨æ‰€æœ‰å“åº”ä¸­æ·»åŠ å¤´éƒ¨é…ç½®ï¼Œå¦‚ headers: { â€œX-Custom-Fooâ€: â€œbarâ€ }ã€‚</p>
<h4 id="disableHostCheck"><a href="#disableHostCheck" class="headerlink" title="disableHostCheck"></a>disableHostCheck</h4><p>æ˜¯å¦ç¦ç”¨è¯·æ±‚å¤´ host æ£€æŸ¥ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“disable-host-check é…ç½®ã€‚</p>
<h4 id="allowedHosts"><a href="#allowedHosts" class="headerlink" title="allowedHosts"></a>allowedHosts</h4><p>allowedHostsé…ç½®å°†æ ¡éªŒè¯·æ±‚å¤´ä¸­çš„ host ä¸»æœºï¼ŒåŒ¹é…çš„äºˆä»¥è®¿é—®æƒé™ï¼Œå¦‚ allowedHosts: [ â€˜.host.comâ€™, â€˜host2.comâ€™ ]ï¼Œä»¥â€™.â€™èµ·å§‹çš„é…ç½®é¡¹å¯ä»¥ä½œä¸ºå­åŸŸåã€‚è¯¥é…ç½®é¡¹å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ â€“allowed-hosts .host.com,host2.com é…ç½®ã€‚</p>
<h4 id="bonjour"><a href="#bonjour" class="headerlink" title="bonjour"></a>bonjour</h4><p>æ˜¯å¦é€šè¿‡é›¶é…ç½®ç½‘ç»œæœåŠ¡è§„èŒƒè‡ªåŠ¨ç”Ÿæˆipåœ°å€ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“bonjour å¯åŠ¨ã€‚</p>
<h4 id="compress"><a href="#compress" class="headerlink" title="compress"></a>compress</h4><p>æœåŠ¡æ˜¯å¦é€šè¿‡ gzip å‹ç¼©ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“compress å¯åŠ¨ã€‚</p>
<h4 id="https"><a href="#https" class="headerlink" title="https"></a>https</h4><p>å¯åŠ¨ https æœåŠ¡ï¼Œé»˜è®¤å¯åŠ¨ http æœåŠ¡ã€‚å¯é€šè¿‡å‘½ä»¤è¡Œ  â€“https â€“key /path/to/server.key â€“cert /path/to/server.crt â€“cacert /path/to/ca.pem é…ç½®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https: &#123;<span class="comment">// é…ç½®è‡ªç­¾åè¯ä¹¦</span></span><br><span class="line">  key: fs.readFileSync(<span class="string">"/path/to/server.key"</span>),</span><br><span class="line">  cert: fs.readFileSync(<span class="string">"/path/to/server.crt"</span>),</span><br><span class="line">  ca: fs.readFileSync(<span class="string">"/path/to/ca.pem"</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h4><p>ä½¿ç”¨Unix socketé€šä¿¡ï¼Œå¦‚ socket: â€˜socketâ€™ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“socket socket é…ç½®ã€‚</p>
<h4 id="pfx"><a href="#pfx" class="headerlink" title="pfx"></a>pfx</h4><p>é…ç½®æ•°å­—è¯ä¹¦ssl pfxçš„è·¯å¾„ï¼Œå¦‚ pfx: â€˜/path/to/file.pfxâ€™ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“pfx /path/to/file.pfx é…ç½®ã€‚</p>
<h4 id="pfxPassphrase"><a href="#pfxPassphrase" class="headerlink" title="pfxPassphrase"></a>pfxPassphrase</h4><p>è®¿é—®æ•°å­—è¯ä¹¦ssl pfxçš„å¯†ç ï¼Œå¦‚ pfxPassphrase: â€˜passphraseâ€™ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œ â€“pfx-passphrase passphrase é…ç½®ã€‚</p>
<h4 id="progress"><a href="#progress" class="headerlink" title="progress"></a>progress</h4><p>å°†è¿è¡Œè¿›åº¦è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œåªèƒ½ä½¿ç”¨å‘½ä»¤è¡Œ â€“progress é…ç½®ã€‚</p>
<h4 id="stdin"><a href="#stdin" class="headerlink" title="stdin"></a>stdin</h4><p>æ ‡å‡†è¾“å…¥åœæ­¢æ—¶å…³é—­ dev serverï¼Œåªèƒ½é€šè¿‡å‘½ä»¤è¡Œ â€“stdin é…ç½®ã€‚</p>
<h4 id="watchOptions"><a href="#watchOptions" class="headerlink" title="watchOptions"></a>watchOptions</h4><p>ç›‘å¬é…ç½®ã€‚</p>
<h3 id="devtool-å¼€å‘å·¥å…·"><a href="#devtool-å¼€å‘å·¥å…·" class="headerlink" title="devtool å¼€å‘å·¥å…·"></a>devtool å¼€å‘å·¥å…·</h3><p>devtoolé…ç½®å½±å“ç”Ÿæˆsource mapçš„æ–¹å¼ï¼Œé»˜è®¤ä¸é…ç½®ï¼Œå³ä¸ç”Ÿæˆsource mapã€‚æ‰“åŒ…è„šæœ¬å¯é€šè¿‡SourceMapæŸ¥æ‰¾å®é™…çš„æŠ¥é”™è¡Œå·ã€‚å¼€å‘ç¯å¢ƒå¯é…ç½®ä¸ºâ€™cheap-module-eval-source-mapâ€™ï¼›ç”Ÿäº§ç¯å¢ƒå¯é…ç½®ä¸ºâ€™nosources-source-mapâ€™ã€‚</p>
<p>devtoolé…ç½®æ€§èƒ½ï¼š</p>
<img src="/2018/02/01/webpacké…ç½®æŒ‡å—/sourceMap.png">
<h3 id="target-æ„å»ºç›®æ ‡"><a href="#target-æ„å»ºç›®æ ‡" class="headerlink" title="target æ„å»ºç›®æ ‡"></a>target æ„å»ºç›®æ ‡</h3><p>æŒ‡å®šæ„å»ºç›®æ ‡ï¼Œå³æ‰“åŒ…æ–‡ä»¶é€‚é…çš„ç¯å¢ƒï¼Œå­—ç¬¦ä¸²æˆ–å‡½æ•°ã€‚å­—ç¬¦ä¸²å¯é€‰å€¼ä¸º web æµè§ˆå™¨ç¯å¢ƒï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œnode ç±»nodeç¯å¢ƒï¼Œä½¿ç”¨requireåŠ è½½æ–‡ä»¶ï¼Œasync-node ç±»nodeç¯å¢ƒï¼Œä½¿ç”¨fså’Œvmå¼‚æ­¥åŠ è½½æ–‡ä»¶ï¼Œelectron-main ç¼–è¯‘ä¸ºElectronä¸»è¿›ç¨‹ï¼Œelectron-renderer ç¼–è¯‘ä¸ºElectronæ¸²æŸ“è¿›ç¨‹ï¼Œnode-webkit ç¼–è¯‘ä¸ºWebkitå¯ç”¨ï¼Œä½¿ç”¨jsonpåŠ è½½ï¼Œwebworker ç¼–è¯‘æˆWebWorkerã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›undefinedï¼Œé¿å…ä½¿ç”¨æ’ä»¶æ„å»ºï¼›è¿”å› 'web'ï¼ŒæŒ‡å®š 'web' æ’ä»¶æ„å»º</span></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  target: <span class="function"><span class="params">()</span> =&gt;</span> <span class="literal">undefined</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®š 'web' æ’ä»¶æ„å»º</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  target: <span class="function">(<span class="params">compiler</span>) =&gt;</span> &#123;</span><br><span class="line">    compiler.apply(</span><br><span class="line">      <span class="keyword">new</span> webpack.JsonpTemplatePlugin(options.output),</span><br><span class="line">      <span class="keyword">new</span> webpack.LoaderTargetPlugin(<span class="string">"web"</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Watch-ç›‘å¬"><a href="#Watch-ç›‘å¬" class="headerlink" title="Watch ç›‘å¬"></a>Watch ç›‘å¬</h3><ul>
<li>watch æ˜¯å¦å¯ç”¨ Watch æ¨¡å¼ç›‘å¬æ–‡ä»¶æ”¹åŠ¨ï¼Œä»¥é‡å¯ç¼–è¯‘è¿‡ç¨‹ã€‚webpack é»˜è®¤ä¸º falseï¼Œwebpack-dev-server å’Œ webpack-dev-middleware é»˜è®¤ä¸º trueã€‚</li>
<li>watchOptions å®šä¹‰ watch ç›‘å¬æ¨¡å¼çš„é€‰é¡¹ã€‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">watchOptions: &#123;</span><br><span class="line">  aggregateTimeout: <span class="number">300</span>,<span class="comment">// ä»¥æ¯«ç§’å€¼ä¸ºå•ä½ï¼Œè¯¥æ—¶é—´æ®µå†…çš„æ–‡ä»¶æ”¹åŠ¨å°†ä¸€æ¬¡æ€§å½±å“ webpack çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œé»˜è®¤ä¸º 300</span></span><br><span class="line">  ignored: <span class="regexp">/node_modules/</span>,<span class="comment">// é¿å…ç›‘å¬æŸäº›æ–‡ä»¶çš„æ”¹åŠ¨ï¼ŒèŠ‚çœå†…å­˜å¼€é”€ï¼Œå¯ä»¥é…ç½®ä¸º "files/**/*.js"</span></span><br><span class="line">  poll: <span class="number">1000</span><span class="comment">// å¸ƒå°”å€¼æˆ–æ•°å€¼ï¼ŒçœŸå€¼å¼€å¯è½®è¯¢ï¼Œç›‘å¬æ–‡ä»¶å˜åŠ¨ï¼›æ•°å€¼æ—¶ï¼Œä»¥è¯¥æ—¶é—´é—´éš”æ£€æŸ¥æ–‡ä»¶å˜åŠ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="externals-å¤–éƒ¨æ‰©å±•"><a href="#externals-å¤–éƒ¨æ‰©å±•" class="headerlink" title="externals å¤–éƒ¨æ‰©å±•"></a>externals å¤–éƒ¨æ‰©å±•</h3><p>ç”¨äºå°†ç¬¬ä¸‰æ–¹ç±»åº“æ‰“åŒ…åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯é€šè¿‡è¿è¡Œæ—¶ç”±å¤–éƒ¨æ³¨å…¥ï¼Œå¦‚externals: { jquery: â€˜jQueryâ€™ }ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦ä¸²</span></span><br><span class="line">externals: <span class="string">'jQuery'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„</span></span><br><span class="line">externals: &#123;</span><br><span class="line">  subtract: [<span class="string">'./math'</span>, <span class="string">'subtract'</span>]<span class="comment">// './math' æ¨¡å—ä¸‹çš„å­æ¨¡å— subtract ç”±å¤–éƒ¨æ³¨å…¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡</span></span><br><span class="line">externals : &#123;</span><br><span class="line">  lodash : &#123;</span><br><span class="line">    commonjs: <span class="string">"lodash"</span>,<span class="comment">// commonjs æˆ– amd æ¨¡å—ç³»ç»Ÿä¸‹ï¼Œé€šè¿‡ lodash è®¿é—®</span></span><br><span class="line">    amd: <span class="string">"lodash"</span>,</span><br><span class="line">    root: <span class="string">"_"</span> <span class="comment">// å…¨å±€å˜é‡ä¸‹ï¼Œé€šè¿‡ _ è®¿é—®</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°</span></span><br><span class="line">externals: [</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">context, request, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^yourregex$/</span>.test(request))&#123;</span><br><span class="line">      <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="string">'commonjs '</span> + request);<span class="comment">// 'commonjs ' + request ç”±å¤–éƒ¨æ³¨å…¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    callback();</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£åˆ™</span></span><br><span class="line">externals: <span class="regexp">/^(jquery|\$)$/i</span></span><br></pre></td></tr></table></figure>
<h3 id="node-æ³¨å…¥node"><a href="#node-æ³¨å…¥node" class="headerlink" title="node æ³¨å…¥node"></a>node æ³¨å…¥node</h3><p>å…¨å±€æ³¨å…¥ node å˜é‡ï¼Œæä¾›ç±» node ç¯å¢ƒçš„åŠŸèƒ½ï¼Œç”± NodeStuffPlugin æ’ä»¶ä¸ºâ€™webâ€™ æˆ– â€˜webworkerâ€™ ç¯å¢ƒæä¾›ployfillã€‚å¯¹è±¡å½¢å¼ï¼Œå±æ€§çš„å€¼å¯ä»¥æ˜¯ true æä¾›plyfillï¼Œâ€mockâ€ æä¾›mockï¼ŒåŠŸèƒ½å¾ˆå°‘æˆ–æ²¡æœ‰ï¼Œâ€emptyâ€ ä¾›ç©ºå¯¹è±¡ï¼Œfalse ä»€ä¹ˆéƒ½ä¸æä¾›ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// é»˜è®¤å€¼</span><br><span class="line">node: &#123;</span><br><span class="line">  console: false,</span><br><span class="line">  global: true,</span><br><span class="line">  process: true,</span><br><span class="line">  __filename: true,// å…¥å£æ–‡ä»¶çš„æ–‡ä»¶åï¼Œç›¸å¯¹äºwebpackConfig.context</span><br><span class="line">  __dirname: true,// å…¥å£æ–‡ä»¶çš„ç›®å½•åï¼Œç›¸å¯¹äºwebpackConfig.context</span><br><span class="line">  Buffer: true,</span><br><span class="line">  setImmediate: true</span><br><span class="line"></span><br><span class="line">  // æ›´å¤šé€‰é¡¹ï¼Œè¯·æŸ¥çœ‹â€œå…¶ä»– Node.js æ ¸å¿ƒåº“â€</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å…¶ä»–</span><br><span class="line">node: &#123;</span><br><span class="line">  dns: &quot;mock&quot;,</span><br><span class="line">  fs: &quot;empty&quot;,</span><br><span class="line">  path: true,</span><br><span class="line">  url: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="performance-æ€§èƒ½"><a href="#performance-æ€§èƒ½" class="headerlink" title="performance æ€§èƒ½"></a>performance æ€§èƒ½</h3><h4 id="hints"><a href="#hints" class="headerlink" title="hints"></a>hints</h4><p>èµ„æºè¿‡å¤§æ—¶ï¼Œæ‰“å¼€/å…³é—­æç¤ºï¼Œé»˜è®¤ä¸ºâ€warningâ€ï¼Œå¯é€‰å€¼ä¸º false | â€œerrorâ€ | â€œwarningâ€ã€‚å¼€å‘ç¯å¢ƒæ¨èä½¿ç”¨â€warningâ€ï¼Œç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨â€errorâ€ã€‚</p>
<h4 id="maxEntrypointSize"><a href="#maxEntrypointSize" class="headerlink" title="maxEntrypointSize"></a>maxEntrypointSize</h4><p>é™åˆ¶å…¥å£æ–‡ä»¶æ‰“åŒ…æ—¶çš„æœ€å¤§ä½“ç§¯ï¼Œé»˜è®¤ä¸º 250000 (bytes)ã€‚</p>
<h4 id="maxAssetSize"><a href="#maxAssetSize" class="headerlink" title="maxAssetSize"></a>maxAssetSize</h4><p>é™åˆ¶æ‰€æœ‰å•ä¸ªèµ„æºçš„æœ€å¤§ä½“ç§¯ï¼Œé»˜è®¤ä¸º 250000 (bytes)ã€‚</p>
<h4 id="assetFilter"><a href="#assetFilter" class="headerlink" title="assetFilter"></a>assetFilter</h4><p>é…ç½®éœ€è¦è®¡ç®—æœ€å¤§ä½“ç§¯ä»¥èŠ‚çœæ€§èƒ½çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">assetFilename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !(<span class="regexp">/\.map$/</span>.test(assetFilename))</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–</span></span><br><span class="line">performance: &#123;</span><br><span class="line">  assetFilter: <span class="function"><span class="keyword">function</span>(<span class="params">assetFilename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> assetFilename.endsWith(<span class="string">'.js'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="stats-ç»Ÿè®¡"><a href="#stats-ç»Ÿè®¡" class="headerlink" title="stats ç»Ÿè®¡"></a>stats ç»Ÿè®¡</h3><p>ç»†ç²’åº¦åœ°æ§åˆ¶è¾“å‡ºæ—¥å¿—ï¼Œå­—ç¬¦ä¸²æˆ–å¯¹è±¡å½¢å¼ã€‚å­—ç¬¦ä¸²å¯é€‰é¡¹åŒ…å«â€errors-onlyâ€ åªåŒ…å«é”™è¯¯ï¼Œâ€minimalâ€ åŒ…å«é”™è¯¯å’Œæ–°çš„ç¼–è¯‘ä¿¡æ¯ï¼Œâ€noneâ€ æ²¡æœ‰è¾“å‡ºï¼Œâ€normalâ€ æ ‡å‡†è¾“å‡ºï¼Œâ€detailedâ€ è¯¦ç»†è¾“å‡ºï¼Œâ€verboseâ€ å…¨éƒ¨è¾“å‡ºã€‚ä¹Ÿå¯é…ç½®ä¸ºå¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">stats: &#123;</span><br><span class="line">  <span class="comment">// å¢åŠ èµ„æºä¿¡æ¯</span></span><br><span class="line">  assets: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¯¹èµ„æºæŒ‰æŒ‡å®šçš„é¡¹è¿›è¡Œæ’åº</span></span><br><span class="line">  assetsSort: <span class="string">"field"</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ ç¼“å­˜äº†çš„ï¼ˆä½†æ²¡æ„å»ºï¼‰æ¨¡å—çš„ä¿¡æ¯</span></span><br><span class="line">  cached: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show cached assets (setting this to `false` only shows emitted files)</span></span><br><span class="line">  cachedAssets: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ å­çº§çš„ä¿¡æ¯</span></span><br><span class="line">  children: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ åŒ…ä¿¡æ¯ï¼ˆè®¾ç½®ä¸º `false` èƒ½å…è®¸è¾ƒå°‘çš„å†—é•¿è¾“å‡ºï¼‰</span></span><br><span class="line">  chunks: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å°†å†…ç½®æ¨¡å—ä¿¡æ¯å¢åŠ åˆ°åŒ…ä¿¡æ¯</span></span><br><span class="line">  chunkModules: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ åŒ… å’Œ åŒ…åˆå¹¶ çš„æ¥æºä¿¡æ¯</span></span><br><span class="line">  chunkOrigins: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¯¹åŒ…æŒ‰æŒ‡å®šçš„é¡¹è¿›è¡Œæ’åº</span></span><br><span class="line">  chunksSort: <span class="string">"field"</span>,</span><br><span class="line">  <span class="comment">// ç”¨äºç¼©çŸ­è¯·æ±‚çš„ä¸Šä¸‹æ–‡ç›®å½•</span></span><br><span class="line">  context: <span class="string">"../src/"</span>,</span><br><span class="line">  <span class="comment">// `webpack --colors` ç­‰åŒäº</span></span><br><span class="line">  colors: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Display the distance from the entry point for each module</span></span><br><span class="line">  depth: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// Display the entry points with the corresponding bundles</span></span><br><span class="line">  entrypoints: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">  errors: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå°±åƒè§£ææ—¥å¿—ä¸€æ ·ï¼‰</span></span><br><span class="line">  errorDetails: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Exclude assets from being displayed in stats</span></span><br><span class="line">  <span class="comment">// This can be done with a String, a RegExp, a Function getting the assets name</span></span><br><span class="line">  <span class="comment">// and returning a boolean or an Array of the above.</span></span><br><span class="line">  excludeAssets: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | <span class="function">(<span class="params">assetName</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span> |</span><br><span class="line">    [<span class="string">"filter"</span>] | [<span class="regexp">/filter/</span>] | [<span class="function">(<span class="params">assetName</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span>],</span><br><span class="line">  <span class="comment">// Exclude modules from being displayed in stats</span></span><br><span class="line">  <span class="comment">// This can be done with a String, a RegExp, a Function getting the modules source</span></span><br><span class="line">  <span class="comment">// and returning a boolean or an Array of the above.</span></span><br><span class="line">  excludeModules: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | <span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span> |</span><br><span class="line">    [<span class="string">"filter"</span>] | [<span class="regexp">/filter/</span>] | [<span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span>],</span><br><span class="line">  <span class="comment">// See excludeModules</span></span><br><span class="line">  exclude: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | <span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span> |</span><br><span class="line">    [<span class="string">"filter"</span>] | [<span class="regexp">/filter/</span>] | [<span class="function">(<span class="params">moduleSource</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span>],</span><br><span class="line">  <span class="comment">// å¢åŠ ç¼–è¯‘çš„å“ˆå¸Œå€¼</span></span><br><span class="line">  hash: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Set the maximum number of modules to be shown</span></span><br><span class="line">  maxModules: <span class="number">15</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ å†…ç½®çš„æ¨¡å—ä¿¡æ¯</span></span><br><span class="line">  modules: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¯¹æ¨¡å—æŒ‰æŒ‡å®šçš„é¡¹è¿›è¡Œæ’åº</span></span><br><span class="line">  modulesSort: <span class="string">"field"</span>,</span><br><span class="line">  <span class="comment">// Show dependencies and origin of warnings/errors (since webpack 2.5.0)</span></span><br><span class="line">  moduleTrace: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show performance hint when file size exceeds `performance.maxAssetSize`</span></span><br><span class="line">  performance: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show the exports of the modules</span></span><br><span class="line">  providedExports: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ  public path çš„ä¿¡æ¯</span></span><br><span class="line">  publicPath: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ æ¨¡å—è¢«å¼•å…¥çš„åŸå› </span></span><br><span class="line">  reasons: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ æ¨¡å—çš„æºç </span></span><br><span class="line">  source: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ æ—¶é—´ä¿¡æ¯</span></span><br><span class="line">  timings: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Show which exports of a module are used</span></span><br><span class="line">  usedExports: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ  webpack ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">  version: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// å¢åŠ æç¤º</span></span><br><span class="line">  warnings: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// Filter warnings to be shown (since webpack 2.4.0),</span></span><br><span class="line">  <span class="comment">// can be a String, Regexp, a function getting the warning and returning a boolean</span></span><br><span class="line">  <span class="comment">// or an Array of a combination of the above. First match wins.</span></span><br><span class="line">  warningsFilter: <span class="string">"filter"</span> | <span class="regexp">/filter/</span> | [<span class="string">"filter"</span>, /filter/] | <span class="function">(<span class="params">warning</span>) =&gt;</span> ... return <span class="literal">true</span>|<span class="literal">false</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/24/æµ…æasync-validatoræºç /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alfred">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¿®å­èŒƒè¯­">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/24/æµ…æasync-validatoræºç /" itemprop="url">æµ…æasync-validatoræºç </a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-24T20:56:01+08:00">2018-01-24</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/library/" itemprop="url" rel="index"><span itemprop="name">library</span></a></span>

                
                
                  ï¼Œ 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/library/validate/" itemprop="url" rel="index"><span itemprop="name">validate</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/24/æµ…æasync-validatoræºç /#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/24/æµ…æasync-validatoræºç /" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™ç¯‡æ–‡ç« æ—¨åœ¨äºåˆ†æasync-validatoræ•°æ®æ ¡éªŒæ¨¡å—(1.8.1ç‰ˆæœ¬)çš„å®ç°ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« ä¹Ÿèƒ½ç»™è¯»è€…å¸¦å»è£¨ç›Šï¼Œé‚£æ˜¯ç¬”è€…çš„è£å¹¸ã€‚</p>
<h2 id="åŸºæœ¬æ ¡éªŒ"><a href="#åŸºæœ¬æ ¡éªŒ" class="headerlink" title="åŸºæœ¬æ ¡éªŒ"></a>åŸºæœ¬æ ¡éªŒ</h2><p>åœ¨async-validatoræºç ä¸­ï¼Œsrc/ruleæ–‡ä»¶å¤¹ä¸‹å„ä»£ç æ–‡ä»¶å®ç°äº†æœ€åŸºç¡€çš„æ•°æ®æ ¡éªŒèƒ½åŠ›ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«ç§°ä¸ºåŸºç¡€æ ¡éªŒè§„åˆ™ã€‚</p>
<h3 id="ç±»å‹æ ¡éªŒ"><a href="#ç±»å‹æ ¡éªŒ" class="headerlink" title="ç±»å‹æ ¡éªŒ"></a>ç±»å‹æ ¡éªŒ</h3><p>è¦åˆ†æasync-validatoræ¨¡å—çš„å®ç°ï¼Œå®¹ç¬”è€…å…ˆä»ç±»å‹æ ¡éªŒè¯´èµ·ã€‚</p>
<p>åœ¨async-validatoræ¨¡å—ä¸­ï¼Œå•ä¸ªæ ¡éªŒå™¨è¢«å®šä¹‰ä¸ºvalidatorå‡½æ•°ã€‚è¯¥validatorå‡½æ•°æ¥å—ruleã€valueã€callbackã€sourceã€optionsä½œä¸ºå‚æ•°ã€‚sourceã€optionsè¿™ä¸¤ä¸ªå‚æ•°å§‘ä¸”æŒ‰ä¸‹ä¸è®ºã€‚å‚æ•°ruleæ˜¯ä»¥å¯¹è±¡å½¢å¼é…ç½®çš„æ ¡éªŒè§„åˆ™ï¼Œvalueæ˜¯å¾…æ ¡éªŒçš„æ•°æ®ï¼Œcallbackæ˜¯ç”±å¼€å‘è€…æ‰‹åŠ¨æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</p>
<p>å®¹æ˜“çŒœæƒ³çš„æ˜¯ï¼Œåœ¨å®ç°ç±»å‹æ ¡éªŒçš„è¿‡ç¨‹ä¸­ï¼Œasync-validatoræ¨¡å—é‡‡ç”¨äº†{ type: â€˜arrayâ€™ }çš„å½¢å¼é…ç½®ruleã€‚å…¶ä¸­typeå¯æ¥å—çš„å€¼åŒ…å«â€™integerâ€™, â€˜floatâ€™, â€˜arrayâ€™, â€˜regexpâ€™, â€˜objectâ€™, â€˜methodâ€™, â€˜emailâ€™, â€˜numberâ€™, â€˜dateâ€™, â€˜urlâ€™, â€˜hexâ€™è¿™å‡ ç§ç±»å‹ã€‚åœ¨å…¶èƒŒåçš„å®ç°æœºåˆ¶ä¸­ï¼Œasync-validatoræ¨¡å—æ²¡æœ‰é‡‡ç”¨switchè¯­å¥åœ¨å•ä¸€çš„å‡½æ•°ä¸­å®Œæˆç±»å‹åˆ¤æ–­ï¼Œè€Œæ˜¯é€šè¿‡typeså¯¹è±¡è®¾å®šæ¯ç§ç±»å‹çš„æ ¡éªŒæ–¹æ³•ï¼Œæ¥ç€é€šè¿‡è°ƒç”¨types<a href="value">type</a>æ–¹æ³•å®ç°ç±»å‹æ ¡éªŒï¼Œè¿™æ ·èƒ½ä½¿ä»£ç çš„ç»“æ„å˜å¾—æ¸…æ™°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/rule/type.js</span></span><br><span class="line"><span class="keyword">const</span> types = &#123;</span><br><span class="line">  integer(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> types.number(value) &amp;&amp; <span class="built_in">parseInt</span>(value, <span class="number">10</span>) === value;</span><br><span class="line">  &#125;,</span><br><span class="line">  float(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> types.number(value) &amp;&amp; !types.integer(value);</span><br><span class="line">  &#125;,</span><br><span class="line">  array(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(value);</span><br><span class="line">  &#125;,</span><br><span class="line">  regexp(value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> !!<span class="keyword">new</span> <span class="built_in">RegExp</span>(value);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  date(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> value.getTime === <span class="string">'function'</span> &amp;&amp;</span><br><span class="line">      <span class="keyword">typeof</span> value.getMonth === <span class="string">'function'</span> &amp;&amp;</span><br><span class="line">      <span class="keyword">typeof</span> value.getYear === <span class="string">'function'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  number(value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> (value) === <span class="string">'number'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  object(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> (value) === <span class="string">'object'</span> &amp;&amp; !types.array(value);</span><br><span class="line">  &#125;,</span><br><span class="line">  method(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> (value) === <span class="string">'function'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  email(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> (value) === <span class="string">'string'</span> &amp;&amp; !!value.match(pattern.email) &amp;&amp; value.length &lt; <span class="number">255</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  url(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> (value) === <span class="string">'string'</span> &amp;&amp; !!value.match(pattern.url);</span><br><span class="line">  &#125;,</span><br><span class="line">  hex(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> (value) === <span class="string">'string'</span> &amp;&amp; !!value.match(pattern.hex);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¯ä»¥å‘ç°typeså¹¶ä¸åŒ…å«â€™booleanâ€™, â€˜stringâ€™ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯async-validatoræ¨¡å—é—æ¼äº†è¿™ä¸¤ç§æ•°æ®ç±»å‹å‘¢ï¼Ÿä¸æ˜¯çš„ã€‚async-validatoré€šè¿‡if-else ifè¯­å¥æ ¡éªŒäº†è¿™ä¸¤ç§æ•°æ®ç±»å‹ï¼ˆæ²¡æœ‰elseè¯­å¥ï¼Œæ„å‘³ç€ä¸æ»¡è¶³æ¡ä»¶çš„è§†ä¸ºæ ¡éªŒé€šè¿‡ï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/rule/type.js</span></span><br><span class="line"><span class="keyword">const</span> custom = [<span class="string">'integer'</span>, <span class="string">'float'</span>, <span class="string">'array'</span>, <span class="string">'regexp'</span>, <span class="string">'object'</span>,</span><br><span class="line">  <span class="string">'method'</span>, <span class="string">'email'</span>, <span class="string">'number'</span>, <span class="string">'date'</span>, <span class="string">'url'</span>, <span class="string">'hex'</span>];</span><br><span class="line"><span class="keyword">const</span> ruleType = rule.type;</span><br><span class="line"><span class="keyword">if</span> (custom.indexOf(ruleType) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!types[ruleType](value)) &#123;</span><br><span class="line">    errors.push(util.format(options.messages.types[ruleType], rule.fullField, rule.type));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// straight typeof check</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ruleType &amp;&amp; <span class="keyword">typeof</span> (value) !== rule.type) &#123;</span><br><span class="line">  errors.push(util.format(options.messages.types[ruleType], rule.fullField, rule.type));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¥‡æ€ªçš„æ˜¯ï¼Œåœ¨async-validatoræ¨¡å—ä¸­ï¼Œæ—¢ç„¶typeçš„ç§ç±»åŒ…å«äº†â€™emailâ€™(é‚®ç®±), â€˜urlâ€™(ç½‘å€)ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰åŒ…å«â€™phoneâ€™(æ‰‹æœºå·)å‘¢ï¼Ÿæˆ–è€…ï¼Œä¸ºä»€ä¹ˆasync-validatoræ¨¡å—ä¸å¯¹å¼€å‘è€…å¼€æ”¾æ³¨å†Œtypeçš„æ–¹æ³•å‘¢ï¼Ÿé‚£æ ·å¼€å‘è€…å¯ä»¥åœ¨typeså¯¹è±¡ä¸­æ·»åŠ æ–¹æ³•ï¼Œä½¿å¾—ç±»å‹æ ¡éªŒæ›´ä¸ºå¤šæ ·ï¼Œä¸æ˜¯å—ï¼Ÿå®é™…ä¸Šï¼Œåœ¨async-validatoræ¨¡å—çš„è®¾è®¡ä¸­ï¼Œè¿™ä¸ªtypeåªæ˜¯å•æ¡æ ¡éªŒè§„åˆ™ï¼Œè¿˜ä¸æ˜¯æ ¡éªŒå™¨ã€‚ä½œä¸ºä¸å¯å˜åŠ¨çš„åº•å±‚ï¼Œå®ƒæ²¡æœ‰æä¾›å‘typeså¯¹è±¡æ³¨å…¥æ–°ç±»å‹çš„æ–¹æ³•ã€‚å…³äºå¯æ³¨å†Œçš„æ ¡éªŒå™¨ç±»å‹ï¼Œå°†åœ¨ä¸‹æ–‡äºˆä»¥åˆ†æã€‚</p>
<h3 id="å…¶ä»–åŸºæœ¬æ ¡éªŒ"><a href="#å…¶ä»–åŸºæœ¬æ ¡éªŒ" class="headerlink" title="å…¶ä»–åŸºæœ¬æ ¡éªŒ"></a>å…¶ä»–åŸºæœ¬æ ¡éªŒ</h3><p>åœ¨async-validatoræ¨¡å—ä¸­ï¼Œå…¶ä»–åŸºæœ¬æ ¡éªŒåŒ…å«â€™requiredâ€™(éç©ºæ ¡éªŒ), â€˜whitespaceâ€™(ç©ºç™½å­—ç¬¦æ ¡éªŒ), â€˜rangeâ€™(èŒƒå›´æ ¡éªŒ), â€˜enumâ€™(æšä¸¾æ ¡éªŒ), â€˜patternâ€™(æ­£åˆ™æ ¡éªŒ)ã€‚â€™requiredâ€™, â€˜whitespaceâ€™æ ¡éªŒè‡ªä¸å¿…å¤šè¯´ï¼Œç¬”è€…å°†ç€é‡ä»‹ç»â€™rangeâ€™, â€˜enumâ€™, â€˜patternâ€™æ ¡éªŒã€‚</p>
<p>å…³äºâ€™rangeâ€™æ ¡éªŒï¼Œå…¶èƒ½åŠ›åŒ…å«æ ¡éªŒæ•°å€¼çš„å¤§å°ã€å­—ç¬¦ä¸²æˆ–æ•°ç»„çš„é•¿åº¦ï¼Œå› æ­¤ruleå¯¹è±¡ç›¸åº”æ·»åŠ äº†minã€maxã€lenå±æ€§ï¼Œå…¶ä¸­lenå±æ€§çš„ä¼˜å…ˆçº§é«˜äºminã€maxå±æ€§ã€‚åœ¨async-validatoræºç çš„å®ç°ä¸­ï¼Œé€šè¿‡å…ˆå°†å­—ç¬¦ä¸²å’Œæ•°ç»„å½¢å¼çš„valueè½¬æ¢æˆå¾…æ ¡éªŒçš„value.lengthï¼Œå†é€šè¿‡ifè¯­å¥åè°ƒlenä¸minã€maxæ ¡éªŒè§„åˆ™çš„ä¼˜å…ˆçº§ã€‚å…·ä½“å¯å‚è¯¦src/rule/range.jsæ–‡ä»¶çš„æºç ã€‚</p>
<p>å…³äºâ€™enumâ€™æ ¡éªŒï¼Œå…¶èƒ½åŠ›ä¸ºæ ¡éªŒæ•°æ®valueæ˜¯å¦æŸä¸ªæšä¸¾æ•°ç»„çš„ä¸€ä»½å­ï¼Œç›¸åº”ruleå¯¹è±¡æ·»åŠ äº†enumå±æ€§ã€‚è‹¥valueåœ¨rule.enumä¸­ï¼Œåˆ™æ ¡éªŒé€šè¿‡ï¼›å¦åˆ™æ ¡éªŒå¤±è´¥ã€‚</p>
<p>å…³äºâ€™patternâ€™æ ¡éªŒï¼Œå…¶èƒ½åŠ›ä¸ºæ ¡éªŒæ•°æ®valueæ˜¯å¦åŒ¹é…æ­£åˆ™å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œç›¸åº”ruleå¯¹è±¡æ·»åŠ äº†patternå±æ€§ã€‚è¯¥patternå±æ€§å¯é…ç½®ä¸ºæ­£åˆ™å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p>ä»‹ç»å®Œäº†å‰è¿°æ ¡éªŒè§„åˆ™ï¼Œç¬”è€…å†åº¦æé—®ï¼Œä¸ºä»€ä¹ˆâ€™rangeâ€™æ ¡éªŒä¸­å¹¶ä¸åŒ…å«æ—¥æœŸå¯¹è±¡çš„èµ·æ­¢æ—¶é—´æ ¡éªŒï¼Œâ€™enumâ€™æ ¡éªŒä¹Ÿä¸åŒ…å«æ•°ç»„valueå°½åœ¨rule.enumé…ç½®æ•°æ®ä¸­çš„æ ¡éªŒï¼Ÿè‹¥è¯´å‰ä¸€æ¡ä¼šä½¿â€™rangeâ€™æ ¡éªŒçš„å®ç°è¿‡äºå¤æ‚ï¼Œåä¸€æ¡é’ˆå¯¹checkboxã€selectå…ƒç´ å´è¾ƒä¸ºå¸¸è§ã€‚å®é™…ä¸Šï¼Œæ—¥æœŸå¯¹è±¡çš„rangeæ ¡éªŒåœ¨dateæ ¡éªŒå™¨ä¸­å®ç°ï¼Œç¬”è€…å°†åœ¨ä¸‹æ–‡äºˆä»¥æè¿°ã€‚</p>
<h2 id="æ ¡éªŒå™¨"><a href="#æ ¡éªŒå™¨" class="headerlink" title="æ ¡éªŒå™¨"></a>æ ¡éªŒå™¨</h2><h3 id="å†…ç½®æ ¡éªŒå™¨"><a href="#å†…ç½®æ ¡éªŒå™¨" class="headerlink" title="å†…ç½®æ ¡éªŒå™¨"></a>å†…ç½®æ ¡éªŒå™¨</h3><p>åœ¨async-validatoræºç ä¸­ï¼Œsrc/validatoræ–‡ä»¶å¤¹ä¸‹å„ä»£ç æ–‡ä»¶å°†åŸºç¡€æ ¡éªŒè§„åˆ™æ•´åˆæˆå•ä¸ªæ ¡éªŒå™¨ï¼ˆå­—é¢ä¸Šæ˜¯å•ä¸ªæ ¡éªŒå™¨ï¼Œå®é™…æ˜¯å¤šä¸ªåŸºç¡€æ ¡éªŒè§„åˆ™æ„æˆçš„ç»„åˆæ ¡éªŒå™¨ï¼‰ã€‚ä¸‹é¢å°†äºˆä»¥ç®€å•çš„ä»‹ç»ï¼Œæºç ä¸å†èµ˜è¿°ã€‚</p>
<p>arrayæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜arrayâ€™, required: true, min: 1 }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºæ•°ç»„ç±»å‹ã€ä¸”é•¿åº¦åŒ¹é…æ ¡éªŒæ¡ä»¶ã€‚requiredä¸ºfalseæ—¶ï¼Œè·³è¿‡éç©ºæ ¡éªŒï¼ŒååŒã€‚</p>
<p>booleanæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜booleanâ€™, required: true }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºå¸ƒå°”ç±»å‹ã€‚</p>
<p>dateæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜dateâ€™, required: true, min: new Date(â€˜2017 12 10â€™).getTime() }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºdateæ—¥æœŸå¯¹è±¡ï¼Œä¸”è¯¥æ—¥æœŸå¯¹è±¡åŒ¹é…èµ·æ­¢æ—¶é—´æ ¡éªŒã€‚åœ¨dateæ ¡éªŒå™¨çš„å®ç°ä¸­ï¼Œé€šè¿‡value.getTime()æ–¹æ³•å°†å…¶è½¬åŒ–ä¸ºæ¯«ç§’æ•°ï¼Œç„¶åå†ä½œrangeåŸºç¡€æ ¡éªŒã€‚</p>
<p>enumæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜enumâ€™, required: true, enum: [â€˜maleâ€™, â€˜femaleâ€™] }çš„æ•°æ®valueéç©ºï¼Œä¸”å…¶å€¼ä¸ºrule.enumä¸­çš„ä¸€ä¸ªã€‚</p>
<p>floatæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜floatâ€™, required: true, min: 1 }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºæµ®ç‚¹å‹æ•°å€¼ã€ä¸”é•¿åº¦åŒ¹é…æ ¡éªŒæ¡ä»¶ã€‚</p>
<p>integeræ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜integerâ€™, required: true, min: 1 }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºæ•´å‹æ•°å€¼ã€ä¸”é•¿åº¦åŒ¹é…æ ¡éªŒæ¡ä»¶ã€‚</p>
<p>methodæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜methodâ€™, required: true }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºå‡½æ•°ã€‚</p>
<p>numberæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜numberâ€™, required: true, min: 1 }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºæ•°å€¼ã€ä¸”é•¿åº¦åŒ¹é…æ ¡éªŒæ¡ä»¶ã€‚</p>
<p>objectæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜objectâ€™, required: true }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºå¯¹è±¡ã€‚</p>
<p>patternæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ pattern: /\s/, required: true }çš„æ•°æ®valueéç©ºã€ä¸”åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æˆ–æ­£åˆ™å­—ç¬¦ä¸²ã€‚</p>
<p>regexpæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜regexpâ€™, required: true }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºæ­£åˆ™è¡¨è¾¾å¼æˆ–æ­£åˆ™å­—ç¬¦ä¸²ã€‚</p>
<p>requiredæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ required: true }çš„æ•°æ®valueéç©ºã€‚</p>
<p>stringæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜stringâ€™, pattern: /\s/, required: true, min: 1, whitespace: true }çš„æ•°æ®valueéç©ºã€ä¸”ä¸ºå­—ç¬¦ä¸²ã€ä¸”å…¶é•¿åº¦åŒ¹é…æ ¡éªŒæ¡ä»¶ã€ä¸”åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æˆ–æ­£åˆ™å­—ç¬¦ä¸²ã€ä¸”ä¸æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</p>
<p>typeæ ¡éªŒå™¨æ ¡éªŒruleä¸º{ type: â€˜email | url | hexâ€™, required: true }çš„æ•°æ®valueéç©ºã€ä¸”æ˜¯â€™emailâ€™æˆ–â€™urlâ€™æˆ–â€™hexâ€™ä¸­çš„ä¸€ç§ã€‚</p>
<h3 id="è‡ªå®šä¹‰æ ¡éªŒ"><a href="#è‡ªå®šä¹‰æ ¡éªŒ" class="headerlink" title="è‡ªå®šä¹‰æ ¡éªŒ"></a>è‡ªå®šä¹‰æ ¡éªŒ</h3><p>å‰è¿°å†…ç½®æ ¡éªŒå™¨æ— æ³•æ»¡è¶³ä¸°å¯Œçš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸ºæ­¤ï¼Œåœ¨async-validatoræ¨¡å—çš„å®ç°ä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½®rule = { validator: function(rule, value, callback, source, options){} }æˆ–rule = function(rule, value, callback, source, options){}çš„æ–¹å¼è®¾ç½®è‡ªå®šä¹‰æ ¡éªŒå™¨ã€‚</p>
<p>ä¸Šæ–‡æœªæåŠåˆ°çš„æ˜¯ï¼Œé”™è¯¯æ–‡æ¡ˆå¯ä½œä¸ºcallbackå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥ã€‚å¹¶ä¸”ï¼Œè¯¥callbackå‡½æ•°å¿…é¡»å¾—åˆ°è°ƒç”¨ï¼Œå…¶ä¸­çš„å› ç”±ï¼Œå°†åœ¨ä¸‹æ–‡äºˆä»¥æè¿°ã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œåœ¨è‡ªå®šä¹‰æ ¡éªŒå™¨å‡½æ•°ä¸­ï¼Œå¯ä»¥é€šè¿‡é¦–å‚è·å¾—å¼€å‘è€…é…ç½®çš„ruleå¯¹è±¡ï¼Œæˆ–è€…è¯´ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ruleå‘è‡ªå®šä¹‰æ ¡éªŒå™¨ä¼ å…¥é¢å¤–çš„å‚æ•°ã€‚æ¯”å¦‚ï¼Œåœ¨async-validatoræ¨¡å—ç»“åˆreactä½¿ç”¨çš„åœºæ™¯ä¸­ï¼Œç¬”è€…åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªvalidateIdçš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡é…ç½®rule = { vaidator: this.validateId, ctx: this }çš„æ ¡éªŒè§„åˆ™ï¼Œä»è€Œåœ¨validateIdæ–¹æ³•çš„å†…éƒ¨ï¼Œé€šè¿‡rule.ctxå°±å¯ä»¥è·å¾—è¯¥ç»„ä»¶å®ä¾‹ã€‚è™½ç„¶ï¼Œå½“éœ€è¦è®¿é—®ç»„ä»¶å®ä¾‹æ—¶ï¼Œå¸¸è§„çš„é…ç½®æ–¹å¼æ˜¯{ validator: this.validateId.bind(this) }ã€‚è¿™ä¸ªä¾‹å­æ—¨åœ¨è¯´æ˜ï¼Œè·Ÿéšå¤–éƒ¨ç¯å¢ƒå˜åŠ¨çš„æ•°æ®å¯ä»¥é€šè¿‡ruleå¯¹è±¡ä¼ å…¥è‡ªå®šä¹‰æ ¡éªŒå™¨å‡½æ•°å†…éƒ¨ï¼Œä¸å¿…é€šè¿‡bindæ–¹æ³•å®ç°ã€‚</p>
<p>å‡ä½¿å¤šä¸ªå­—æ®µå…±ç”¨åŒä¸€ä¸ªè‡ªå®šä¹‰æ ¡éªŒå™¨æ—¶ï¼Œè¦æ€æ ·æ‰èƒ½åŒºåˆ†å½“å‰çš„æ ¡éªŒå­—æ®µæ˜¯å“ªä¸€ä¸ªå‘¢ï¼Ÿåœ¨async-validatoræºç çš„å®ç°ä¸­ï¼Œå¼€å‘è€…é…ç½®çš„ruleæ•°æ®ä¼šæ·»åŠ fieldã€fullFieldå±æ€§ï¼Œå…¶ä¸­fieldå°±æ˜¯å½“å‰æ ¡éªŒçš„å­—æ®µåã€‚fullFieldæ˜¯å½“å‰æ ¡éªŒå­—æ®µçš„å…¨åï¼Œè¿™åœ¨æ·±åº¦æ ¡éªŒçš„æ—¶å€™ç”¨åˆ°ã€‚</p>
<p>å€¼å¾—è¯´æ˜çš„æ˜¯ï¼Œå‚æ•°sourceæ˜¯æ•´ä¸ªå¾…æ ¡éªŒçš„æ•°æ®ï¼Œvalueä¹Ÿæ˜¯sourceçš„ä¸€ä¸ªå±æ€§ã€‚è¿™æ ·ï¼Œasync-validatoræ¨¡å—å°±ä¸ºå¼€å‘è€…æä¾›äº†å…³è”æ ¡éªŒçš„èƒ½åŠ›ã€‚å‡ä½¿æœ‰å­—æ®µminã€maxéœ€è¦æ ¡éªŒï¼Œå¯¹minå­—æ®µï¼Œéœ€è¦æ ¡éªŒå…¶æ•°å€¼ä¸å¤§äºmaxå­—æ®µçš„å€¼ï¼Œå¼€å‘è€…å°±å¯ä»¥é€šè¿‡source[max]å±æ€§è·å–åˆ°maxå­—æ®µçš„å€¼ï¼Œä»è€Œå®ç°å…³è”æ ¡éªŒã€‚</p>
<p>å…³äºå‚æ•°optionsï¼Œç¬”è€…å°†åœ¨åæ–‡äºˆä»¥åˆ†æã€‚</p>
<h3 id="æ³¨å†Œæ ¡éªŒå™¨"><a href="#æ³¨å†Œæ ¡éªŒå™¨" class="headerlink" title="æ³¨å†Œæ ¡éªŒå™¨"></a>æ³¨å†Œæ ¡éªŒå™¨</h3><p>å‰æ–‡å·²ç»æåˆ°ï¼Œasync-validatoræ¨¡å—å¹¶æœªæä¾›æ³¨å…¥åŸºç¡€æ ¡éªŒè§„åˆ™çš„æ–¹æ³•ï¼Œç›¸åº”çš„ï¼Œå®ƒæä¾›äº†æ³¨å†Œå•ä¸ªæ ¡éªŒå™¨çš„èƒ½åŠ›ã€‚é€šè¿‡è°ƒç”¨AsyncValidator.register(type, validator)é™æ€æ–¹æ³•ï¼Œå¼€å‘è€…å³å¯ä»¥æ³¨å†Œä¸€ä¸ªç±»å‹ä¸ºtypeçš„validatoræ ¡éªŒå™¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line">Schema.property = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  getType(rule) &#123;</span><br><span class="line">    <span class="keyword">if</span> (rule.type === <span class="literal">undefined</span> &amp;&amp; (rule.pattern <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>)) &#123;</span><br><span class="line">      rule.type = <span class="string">'pattern'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (rule.validator) !== <span class="string">'function'</span> &amp;&amp;</span><br><span class="line">      (rule.type &amp;&amp; !validators.hasOwnProperty(rule.type))) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(format(<span class="string">'Unknown rule type %s'</span>, rule.type));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rule.type || <span class="string">'string'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  getValidationMethod(rule) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> rule.validator === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> rule.validator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(rule);</span><br><span class="line">    <span class="keyword">const</span> messageIndex = keys.indexOf(<span class="string">'message'</span>);</span><br><span class="line">    <span class="keyword">if</span> (messageIndex !== <span class="number">-1</span>) &#123;</span><br><span class="line">      keys.splice(messageIndex, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keys.length === <span class="number">1</span> &amp;&amp; keys[<span class="number">0</span>] === <span class="string">'required'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> validators.required;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> validators[<span class="keyword">this</span>.getType(rule)] || <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Schema.register = <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params">type, validator</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> validator !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Cannot register a validator by type, validator is not a function'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  validators[type] = validator;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æºç ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¯¥æ ¡éªŒå™¨å’Œå†…ç½®æ ¡éªŒå™¨å¦‚arrayã€booleanæ ¡éªŒå™¨å¹³çº§ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªtypeç±»å‹ä¸ºâ€™remoteâ€™è¿œç¨‹æ ¡éªŒå™¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remoteValidator</span> = (<span class="params">rule, value, callback, source, options</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; field, action, queryData = &#123;&#125;, format &#125; = rule;</span><br><span class="line">  <span class="keyword">if</span> ( !action )&#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(<span class="string">'action is required'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> data = &#123;</span><br><span class="line">    ...queryData,</span><br><span class="line">    [field]: value</span><br><span class="line">  &#125;;</span><br><span class="line">  data = format &amp;&amp; <span class="keyword">typeof</span> format === <span class="string">'function'</span> ? format(data, source, options) : data;</span><br><span class="line"></span><br><span class="line">  fetch(action,queryData).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ( res.model === <span class="literal">true</span> ) callback();</span><br><span class="line">    <span class="keyword">else</span> callback(<span class="string">'error'</span>);</span><br><span class="line">  &#125;); </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šçš„â€™remoteâ€™è¿œç¨‹æ ¡éªŒå™¨ç”¨åˆ°äº†validatorå‡½æ•°èƒ½å¤Ÿè®¿é—®ruleå¯¹è±¡çš„èƒ½åŠ›ã€‚ç›¸åº”çš„ruleå¯¹è±¡ä¹Ÿéœ€è¦{ type: â€˜remoteâ€™, action: url, queryData: {} }ä¹‹ç±»çš„æ•°æ®æ ¼å¼ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œformatå‡½æ•°ä¹Ÿå¯ä»¥é€šè¿‡async-validatoræ¨¡å—å†…ç½®çš„transformé…ç½®å‡½æ•°å®ç°ï¼Œè¯¥transformå‡½æ•°åªæ¥å—valueä½œä¸ºå…¶å‚æ•°ï¼Œè™½ç„¶å®Œæ•´çš„å¾…æ ¡éªŒæ•°æ®sourceéœ€è¦ç”±å¤–éƒ¨æ³¨å…¥transformå‡½æ•°ä½“å†…ã€‚åœ¨async-validatoræ¨¡å—ä¸­ï¼Œruleå¯¹è±¡ä¸­å¯é…ç½®çš„transformå±æ€§å³æä¾›äº†é¢„åˆ¶æ ¡éªŒæ•°æ®è½¬åŒ–çš„èƒ½åŠ›ã€‚</p>
<h3 id="æ ¡éªŒç»„åˆ"><a href="#æ ¡éªŒç»„åˆ" class="headerlink" title="æ ¡éªŒç»„åˆ"></a>æ ¡éªŒç»„åˆ</h3><p>é€šå¸¸ï¼Œå•ä¸ªæ ¡éªŒå™¨æ— æ³•æ»¡è¶³å®é™…çš„å¼€å‘éœ€æ±‚ï¼Œasync-validatoræ¨¡å—ä½¿ç”¨æ ¡éªŒè§„åˆ™æ•°ç»„[ rule ]æ ¡éªŒsourceæ•°æ®çš„æŸä¸ªå±æ€§ã€‚å› æ­¤åœ¨æ ¡éªŒæŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªæ ¡éªŒå™¨å¦‚[{ type: â€˜arrayâ€™, required: true, min: 1 }, { validator: function(rule, value, callback){} }]ã€‚</p>
<h3 id="æ·±åº¦æ ¡éªŒ"><a href="#æ·±åº¦æ ¡éªŒ" class="headerlink" title="æ·±åº¦æ ¡éªŒ"></a>æ·±åº¦æ ¡éªŒ</h3><p>å¯¹äºå¤æ‚çš„å¯¹è±¡ï¼Œasync-validatoræ¨¡å—æä¾›äº†æ·±åº¦æ ¡éªŒçš„èƒ½åŠ›ã€‚å½“rule.typeä¸ºâ€™objectâ€™æˆ–â€™objectâ€™æ—¶ï¼Œé€šè¿‡è®¾ç½®rule.defaultFieldæˆ–rule.fieldså±æ€§(å…¶å€¼ä¸º{ key: [rule] }ç»“æ„)ï¼Œasync-validatoræ¨¡å—å°†ä¼šä»¥rule.defaultFieldä¸rule.fieldsåˆå¹¶å¯¹è±¡ä½œä¸ºæ ¡éªŒè§„åˆ™ï¼Œå¹¶æ ¡éªŒsourceå†…çš„æ·±å±‚å±æ€§ã€‚ç‰¹åˆ«çš„ï¼Œrule.defaultFieldå¯ä»¥ç”¨æ¥æ ¡éªŒæ•°æ®ç»“æ„ç›¸åŒçš„æ•°ç»„é¡¹ï¼›rule.fieldsåªä½œç”¨äºæŸä¸ªå¯¹è±¡å±æ€§æˆ–æŸä¸ªæ•°ç»„é¡¹ã€‚è¯¥æ·±å±‚å±æ€§å¯ä»¥æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼Œé€šè¿‡forâ€¦inè·å¾—æ•°ç»„é¡¹æˆ–å¯¹è±¡å±æ€§ï¼Œå¹¶ä½œç›¸åº”æ ¡éªŒã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œç¬”è€…ä¹Ÿå°†åœ¨æ ¡éªŒæµç¨‹é‚£ä¸€æ®µè½åŠ ä»¥æè¿°ã€‚</p>
<h2 id="æ ¡éªŒæµç¨‹"><a href="#æ ¡éªŒæµç¨‹" class="headerlink" title="æ ¡éªŒæµç¨‹"></a>æ ¡éªŒæµç¨‹</h2><p>æ•´ä½“æ ¡éªŒæµç¨‹ä¸ºï¼š</p>
<ol>
<li>åˆ›å»ºSchemaå®ä¾‹ï¼Œlet schema = new Schema(descriptor)ï¼Œå…¶ä¸­descriptorå³æ ¡éªŒè§„åˆ™rulesï¼›</li>
<li>è°ƒç”¨schema.define(rules)æ–¹æ³•ï¼Œæ³¨å†Œæ ¡éªŒè§„åˆ™rulesï¼›</li>
<li>è°ƒç”¨schema.validate(source, options, callback)æ–¹æ³•ï¼Œæ ¡éªŒæ•°æ®sourceã€‚</li>
</ol>
<p>ç¬”è€…å°†æ·±å…¥è®¨è®ºç¬¬3æ­¥schema.validateæ–¹æ³•çš„å†…éƒ¨æœºç†ï¼Œå³async-validatoræ¨¡å—çš„æ ¡éªŒè¿‡ç¨‹ã€‚</p>
<p>åœ¨schema.validateæ–¹æ³•ï¼Œä¸»è¦çš„å·¥ä½œæµç¨‹ä¸ºï¼š</p>
<ol>
<li>å‚æ•°è½¬æ¢ã€‚è‹¥optionså‚æ•°ä¸å­˜åœ¨ï¼Œcallbackå›è°ƒå–æ¬¡å‚ã€‚</li>
<li>æ£€æŸ¥æ ¡éªŒè§„åˆ™æ˜¯å¦å­˜åœ¨ã€‚è‹¥ä¸å­˜åœ¨ï¼Œæ‰§è¡Œcallbackå›è°ƒã€‚</li>
<li>è®¾ç½®å†…éƒ¨å›è°ƒcompleteå‡½æ•°ï¼Œä¸ºcallbackå›è°ƒä¼ å…¥å‚æ•°errors = [{ field, message }]å’Œå‚æ•°fields = { [fieldName] }ã€‚</li>
<li>è·å–æ ¡éªŒæ–‡æ¡ˆï¼Œå¹¶å†™å…¥options.messagesã€‚</li>
<li>æ ¡éªŒè§„åˆ™è½¬æ¢ã€‚å°†å‚æ•°ruleså¤åˆä¸ºseriesæ•°ç»„ï¼Œå…¶ä¸­ï¼Œseriesæ•°ç»„çš„æ¯ä¸€é¡¹ä¸º{ rule, value, source, field }å½¢å¼ã€‚å…¶ä¸­ï¼Œvalueå€¼ç”±rule.transform(value)æ–¹æ³•è½¬æ¢åè·å¾—ï¼›ruleçš„æ•°æ®æ ¼å¼ä¸º{ type, validator, fullField, field, â€¦ }è¯¸å¦‚æ­¤ç±»ï¼Œrule.typeé€šè¿‡schema.getType(rule)æ–¹æ³•è·å¾—ï¼Œrule.validatoré€šè¿‡schema.getValidationMethod(rule)è·å¾—ã€‚</li>
<li>è°ƒç”¨asyncMap(series, options, singleValidator, completeCallback)å‡½æ•°æ ¡éªŒæ•°æ®ã€‚å…¶ä¸­ï¼Œå‚æ•°singleValidatoræ¥å—ç”¨äºæ‰§è¡Œå•ä¸ªæ ¡éªŒå™¨ï¼Œå¹¶æ“æ§ä¸‹ä¸€ä¸ªæ ¡éªŒå™¨çš„æ‰§è¡Œï¼›completeCallbackä¸ºæœ€ç»ˆå›è°ƒå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œå†…éƒ¨å›è°ƒcompleteå‡½æ•°ã€‚singleValidatorå‡½æ•°æ¥å—å‚æ•°dataå’ŒdoItï¼Œdataå³éå†ç€çš„seriesæ•°ç»„é¡¹ï¼›doItå‡½æ•°ç­‰åŒkoaæ¨¡å—çš„nextå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œä¸‹ä¸€ä¸ªæ ¡éªŒå™¨æˆ–è€…æœ€ç»ˆå›è°ƒã€‚ä¸”ï¼Œè‹¥æ ¡éªŒä¸ºå¹³è¡Œæ ¡éªŒï¼ŒdoItå‡½æ•°è´Ÿè´£ä¼ é€’å‚æ•°é”™è¯¯å¯¹è±¡æ•°ç»„ï¼Œç”±utils.jsæ–‡ä»¶ä¸­çš„asyncParallelArrayå‡½æ•°å°†æ‰€æœ‰æ ¡éªŒå™¨çš„é”™è¯¯å¯¹è±¡æ•°ç»„æ„å»ºæˆå•ä¸€æ•°ç»„ï¼Œä¾›completeCallbackå›è°ƒå¤„ç†ã€‚è‹¥æ ¡éªŒä¸ºæœ‰åºæ ¡éªŒï¼Œä¸”options.firstä¸ºçœŸå€¼ï¼ŒdoItå‡½æ•°æ¥æ”¶åˆ°å‚æ•°é”™è¯¯å¯¹è±¡æ•°ç»„ã€å¹¶äº¤ç”±utils.jsæ–‡ä»¶ä¸­çš„asyncSerialArrayå‡½æ•°å¤„ç†çš„æ—¶å€™ï¼Œå°†ç›´æ¥è°ƒç”¨completeCallbackå›è°ƒï¼Œä¸­æ–­åç»­æ ¡éªŒå™¨çš„æ‰§è¡Œï¼›å½“options.firstä¸ºå¦å€¼ï¼Œå¯¹é”™è¯¯å¯¹è±¡çš„å¤„ç†ä¸å¹³è¡Œæ ¡éªŒç›¸åŒã€‚<ul>
<li>é€šè¿‡rule.typeã€rule.fieldsã€rule.defaultFieldåˆ¤æ–­æ˜¯å¦æ·±åº¦æ ¡éªŒã€‚è‹¥æ˜¯ï¼Œå†…éƒ¨å˜é‡deepç½®ä¸ºçœŸã€‚</li>
<li>å®šä¹‰addFullfieldå‡½æ•°ï¼Œç”¨äºè·å–æ·±åº¦æ ¡éªŒæ—¶åµŒå¥—å¯¹è±¡å±æ€§çš„fullFieldã€‚</li>
<li>å®šä¹‰å•æ¬¡æ ¡éªŒåæ‰§è¡Œçš„å›è°ƒå‡½æ•°cbã€‚cbçš„å®ç°æœºåˆ¶ä¸­ï¼ŒåŒ…å«å°†é”™è¯¯å¯¹è±¡åŠ å·¥ä¸º[{ field, message }]æ•°æ®æ ¼å¼ï¼›é€šè¿‡rule.defaultFieldã€rule.fieldsæ„å»ºæ·±åº¦æ ¡éªŒSchemaå®ä¾‹ï¼Œå¹¶åœ¨è¯¥Schemaå®ä¾‹çš„å›è°ƒä¸­å¯åŠ¨åç»­æ ¡éªŒå™¨ã€‚</li>
<li>æ‰§è¡Œrule.validator(rule, value, cb, source, options)ä½œæ ¡éªŒã€‚è‹¥è¿”å›Promiseå®ä¾‹ï¼Œcbå°†åœ¨è¯¥Promiseå®ä¾‹çš„thenæ–¹æ³•ä¸­æ‰§è¡Œã€‚</li>
</ul>
</li>
</ol>
<p>åˆ¶ä½œæˆç®€æ˜“çš„æµç¨‹å›¾ä¸ºï¼š</p>
<img src="/2018/01/24/æµ…æasync-validatoræºç /async-validator.png">
<h3 id="å¹³è¡Œã€æœ‰åºæ ¡éªŒé€»è¾‘å†æ¢³ç†"><a href="#å¹³è¡Œã€æœ‰åºæ ¡éªŒé€»è¾‘å†æ¢³ç†" class="headerlink" title="å¹³è¡Œã€æœ‰åºæ ¡éªŒé€»è¾‘å†æ¢³ç†"></a>å¹³è¡Œã€æœ‰åºæ ¡éªŒé€»è¾‘å†æ¢³ç†</h3><p>åœ¨async-validatoræºç ä¸­ï¼Œå¹³è¡Œã€æœ‰åºæ ¡éªŒé€»è¾‘ç”±util.jsæ–‡ä»¶ä¸­asyncMapã€asyncSerialArrayã€asyncParallelArrayè¿™ä¸‰ä¸ªå‡½æ•°æ”¯æ’‘ï¼Œå…¶å®ç°åŸç†ç±»ä¼¼äºasyncæ¨¡å—ã€‚å…¶ä¸­ï¼ŒasyncParallelArrayå‡½æ•°ç”¨äºå®ç°å¹³è¡Œæ ¡éªŒï¼Œåœ¨æŸä¸ªå¼‚æ­¥æ ¡éªŒå™¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹³è¡Œè°ƒç”¨ä¸‹ä¸€ä¸ªæ ¡éªŒå™¨ï¼›asyncSerialArrayç”¨äºå®ç°æœ‰åºæ ¡éªŒï¼Œåœ¨å¼‚æ­¥æ ¡éªŒå™¨æ‰§è¡Œå®Œæˆåï¼Œå†å¯ç”¨ä¸‹ä¸€ä¸ªæ ¡éªŒå™¨ã€‚</p>
<p>å…³äºasyncParallelArray(arr, func, callback)å‡½æ•°ï¼Œå…¶å·¥ä½œæµå³éå†æ•°ç»„arrï¼Œå¯¹æ•°ç»„é¡¹åˆ†åˆ«è°ƒç”¨funcå‡½æ•°åŠ ä»¥å¤„ç†ï¼Œå¹¶é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œçš„æ¬¡å‚æ”¶é›†é”™è¯¯å¯¹è±¡æˆ–è°ƒç”¨callbackå›è°ƒã€‚å½“éå†å®Œæˆæ—¶ï¼Œcallbackå›è°ƒå°†è¢«æ‰§è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncParallelArray</span>(<span class="params">arr, func, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> arrLength = arr.length;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params">errors</span>) </span>&#123;</span><br><span class="line">    results.push.apply(results, errors);</span><br><span class="line">    total++;</span><br><span class="line">    <span class="keyword">if</span> (total === arrLength) &#123;</span><br><span class="line">      callback(results);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  arr.forEach(<span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">    func(a, count);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºasyncSerialArray(arr, func, callback)å‡½æ•°ï¼Œå…¶å·¥ä½œæµæ˜¯åœ¨å†…éƒ¨æ„å»ºä¸€ä¸ªnextå‡½æ•°ï¼Œé€šè¿‡è¯¥nextå‡½æ•°è°ƒç”¨funcï¼Œå¹¶å°†arræ•°ç»„é¡¹åŠnextå‡½æ•°æœ¬èº«ä½œä¸ºfuncçš„å‚æ•°ï¼Œç”±æ­¤æœ‰åºéå†arrã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncSerialArray</span>(<span class="params">arr, func, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> arrLength = arr.length;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">errors</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (errors &amp;&amp; errors.length) &#123;</span><br><span class="line">      callback(errors);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> original = index;</span><br><span class="line">    index = index + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (original &lt; arrLength) &#123;</span><br><span class="line">      func(arr[original], next);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      callback([]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  next([]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºasyncMapå‡½æ•°ï¼Œé¦–å…ˆå®ƒåˆ¤æ–­options.firstæ˜¯å¦ä¸ºçœŸå€¼ï¼Œè‹¥ä¸ºçœŸå€¼ï¼Œè°ƒç”¨asyncSerialArrayå¤„ç†seriesæ•°ç»„ï¼Œå½“æŸä¸€è§„åˆ™æ ¡éªŒå¤±è´¥æ—¶ï¼Œå³ç»ˆæ­¢æ ¡éªŒï¼Œæ‰§è¡Œcallbackå›è°ƒã€‚è‹¥options.firstä¸ºå¦å€¼ï¼Œæ„å»ºnextå‡½æ•°åŒ…è£…callbackï¼Œç›®çš„æ˜¯å°†æ‰€æœ‰æ ¡éªŒå™¨çš„å¤±è´¥æ–‡æ¡ˆåˆäºŒä¸ºä¸€ï¼Œåœ¨ä¼ å…¥callbackå›è°ƒä¸­ï¼›å†æ ¹æ®options.firstFieldsæ˜¯å¦ä¸ºçœŸå€¼ï¼Œåˆ†åˆ«æ‰§è¡ŒasyncSerialArrayã€asyncParallelArrayå‡½æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncMap</span>(<span class="params">objArr, option, func, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (option.first) &#123;</span><br><span class="line">    <span class="keyword">const</span> flattenArr = flattenObjArr(objArr);</span><br><span class="line">    <span class="keyword">return</span> asyncSerialArray(flattenArr, func, callback);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> firstFields = option.firstFields || [];</span><br><span class="line">  <span class="keyword">if</span> (firstFields === <span class="literal">true</span>) &#123;</span><br><span class="line">    firstFields = <span class="built_in">Object</span>.keys(objArr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> objArrKeys = <span class="built_in">Object</span>.keys(objArr);</span><br><span class="line">  <span class="keyword">const</span> objArrLength = objArrKeys.length;</span><br><span class="line">  <span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="keyword">const</span> next = <span class="function">(<span class="params">errors</span>) =&gt;</span> &#123;</span><br><span class="line">    results.push.apply(results, errors);</span><br><span class="line">    total++;</span><br><span class="line">    <span class="keyword">if</span> (total === objArrLength) &#123;</span><br><span class="line">      callback(results);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  objArrKeys.forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = objArr[key];</span><br><span class="line">    <span class="keyword">if</span> (firstFields.indexOf(key) !== <span class="number">-1</span>) &#123;</span><br><span class="line">      asyncSerialArray(arr, func, next);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      asyncParallelArray(arr, func, next);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åæ€æ ¡éªŒæµç¨‹"><a href="#åæ€æ ¡éªŒæµç¨‹" class="headerlink" title="åæ€æ ¡éªŒæµç¨‹"></a>åæ€æ ¡éªŒæµç¨‹</h3><p>é¦–å…ˆç¬”è€…éœ€è¦ä»‹ç»çš„æ˜¯æ€æ ·åœ¨è‡ªå®šä¹‰æ ¡éªŒå™¨ä¸­åº”ç”¨promiseã€‚ä»£ç è§ä¸‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">covertErrToPromise</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( err ) reject(err);</span><br><span class="line">    <span class="keyword">else</span> resolve();</span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ValidatorDecorator</span>(<span class="params">validator</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">rule, value, cb, source, options</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = validator(rule, value, cb, source, options);</span><br><span class="line">    <span class="keyword">return</span> covertErrToPromise(result);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@ValidatorDecorator</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">customValidator</span>(<span class="params">rule, value, cb, source, options</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...validate </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸å¾—ä¸è¯´ï¼Œasync-validatoræ¨¡å—æœ‰ä¸ªç¼ºç‚¹ï¼Œå³éœ€è¦è°ƒç”¨è€…è‡ªè¡Œæ„å»ºPromiseå®ä¾‹ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨unjq-ajaxã€react-resourceã€fetchä¹‹ç±»æ¨¡å—è¿”å›çš„Promiseå®ä¾‹ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿”å›çš„Promiseå®ä¾‹å°†é˜»å¡åç»­çš„æ ¡éªŒå™¨ã€‚</p>
<p>å› æ­¤ç¬”è€…æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆasync-validatoræ¨¡å—åœ¨ç»„ç»‡å¼‚æ­¥é€»è¾‘çš„æ—¶å€™ï¼Œæ²¡æœ‰é‡‡ç”¨Promiseçš„å†™æ³•ï¼Ÿ</p>
<p>å¦‚æœasync-validatoræ¨¡å—åœ¨å®ç°ä¸­ç‡å…ˆåˆ¤æ–­rule.validatorçš„è¿”å›å€¼æ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼ˆé€šè¿‡instanceofåˆ¤æ–­æ˜¯å¦Promiseå®ä¾‹ï¼Œæˆ–è€…é€šè¿‡thenableä¹‹ç±»çš„å‡½æ•°åˆ¤æ–­è¿”å›å€¼æ˜¯å¦åŒ…å«thenæ–¹æ³•ï¼‰ï¼Œå¯¹äºåŒæ­¥æ ¡éªŒæ ¡éªŒå™¨ï¼Œå°†å…¶è½¬åŒ–ä¸ºPromiseå®ä¾‹ï¼Œå†å°†cbå›è°ƒæŒ‚è½½åˆ°è¯¥Promiseçš„thenæ–¹æ³•ä¸Šï¼›å¯¹äºå¼‚æ­¥æ ¡éªŒå™¨ï¼Œä¸ä½œä»»ä½•å¤„ç†ã€‚è¿™æ ·å¯ä»¥ç®€åŒ–è‡ªå®šä¹‰æ ¡éªŒå™¨çš„ä¹¦å†™æµç¨‹ï¼Œæ ¡éªŒé€šè¿‡è¿”å›é”™è¯¯æ–‡æ¡ˆï¼ŒæˆåŠŸè¿”å›nullæˆ–ä¸è¿”å›ï¼›å¼‚æ­¥æ ¡éªŒå¯ä»¥é‡‡ç”¨asyncå‡½æ•°ä¹¦å†™ï¼Œä¹Ÿä¸éœ€è¦æ„å»ºPromiseå®ä¾‹ã€‚</p>
<p>åœ¨æ€§èƒ½æ–¹é¢ï¼Œä»æ—§å‚æ•°optionsçš„firstã€firstFieldså±æ€§åˆ¤æ–­æ˜¯å¦è¯¥å¯ç”¨æœ‰åºæ ¡éªŒï¼›é»˜è®¤ä½¿ç”¨å¹³è¡Œæ ¡éªŒã€‚</p>
<h2 id="é”™è¯¯æ–‡æ¡ˆ"><a href="#é”™è¯¯æ–‡æ¡ˆ" class="headerlink" title="é”™è¯¯æ–‡æ¡ˆ"></a>é”™è¯¯æ–‡æ¡ˆ</h2><p>åœ¨async-validatoræ¨¡å—ä¸­ï¼Œé”™è¯¯æ–‡æ¡ˆé€šè¿‡Schemaå®ä¾‹çš„messagesæ–¹æ³•æ·»åŠ ã€‚åœ¨å†…ç½®æˆ–è‡ªå®šä¹‰æ ¡éªŒå™¨ä¸­ï¼Œé€šè¿‡optionså‚æ•°çš„messagesæ–¹æ³•è·å¾—ï¼Œå†ç”±util.jsæ–‡ä»¶é‡Œçš„formatå‡½æ•°æ ¼å¼åŒ–ã€‚ä»‹äºasync-validatoræ¨¡å—ä¸å¯¹å¤–æä¾›formatæ–¹æ³•ï¼Œå¯¹äºä½¿ç”¨è€…æ³¨å†Œçš„typeæ ¡éªŒå™¨ï¼Œéœ€è¦è‡ªè¡Œæ„å»ºformatå‡½æ•°ï¼Œæ‰‹åŠ¨æ ¼å¼åŒ–ã€‚</p>
<p>æ­¤å¤–ï¼Œasync-validatoræ¨¡å—ä¸æä¾›å›½é™…åŒ–çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œåœ¨åˆ‡æ¢è¯­è¨€æ—¶ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªè¡Œè°ƒç”¨Schemaå®ä¾‹çš„messagesæ–¹æ³•åˆ‡æ¢åŠ è½½çš„è¯­è¨€åŒ…ã€‚å…³äºasync-validatoræ¨¡å—çš„è®¾è®¡ï¼Œå®Œå…¨å¯ä»¥ä¸ºSchemaå®ä¾‹æ·»åŠ ä¸€ä¸ªsetLanguageæ–¹æ³•ï¼Œç”¨ä»¥åˆ‡æ¢è¯­è¨€ï¼Œéšåå†è°ƒç”¨messagesæ·»åŠ å½“å‰é¡¹ç›®å®é™…éœ€è¦çš„é”™è¯¯æ–‡æ¡ˆã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">schema.messages(&#123;</span><br><span class="line">  <span class="keyword">default</span>: <span class="string">'å­—æ®µ %s æ ¡éªŒå¤±è´¥'</span>,</span><br><span class="line">  required: <span class="string">'%s å¿…å¡«'</span>,</span><br><span class="line">  enum: <span class="string">'%s å¿…é¡»æ˜¯ %s ä¸­çš„ä¸€ä¸ª'</span>,</span><br><span class="line">  whitespace: <span class="string">'%s ä¸èƒ½ä¸ºç©º'</span>,</span><br><span class="line">  date: &#123;</span><br><span class="line">    format: <span class="string">'%s æ—¥æœŸå¯¹è±¡ %s æ— æ•ˆï¼Œå½“è½¬æ¢ %sæ—¶'</span>,</span><br><span class="line">    parse: <span class="string">'%s æ—¥æœŸå¯¹è±¡ä¸èƒ½è¢«è§£æ, %s æ— æ•ˆ'</span>,</span><br><span class="line">    invalid: <span class="string">'%s æ—¥æœŸå¯¹è±¡ %s æ— æ•ˆ'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  types: &#123;</span><br><span class="line">    string: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    method: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s (function)'</span>,</span><br><span class="line">    array: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    object: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    number: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    date: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    boolean: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    integer: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    float: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ª %s'</span>,</span><br><span class="line">    regexp: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ %s'</span>,</span><br><span class="line">    email: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ %s'</span>,</span><br><span class="line">    url: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ %s'</span>,</span><br><span class="line">    hex: <span class="string">'%s ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ %s'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  string: &#123;</span><br><span class="line">    len: <span class="string">'å­—æ®µ %s é¡»åŒ…å« %s ä¸ªå­—ç¬¦'</span>,</span><br><span class="line">    min: <span class="string">'å­—æ®µ %s é¡»å¤§äº %s ä¸ªå­—ç¬¦'</span>,</span><br><span class="line">    max: <span class="string">'å­—æ®µ %s é¡»å°äº %s ä¸ªå­—ç¬¦'</span>,</span><br><span class="line">    range: <span class="string">'å­—æ®µ %s é¡»å°äº %s åˆ° %s ä¸ªå­—ç¬¦'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  number: &#123;</span><br><span class="line">    len: <span class="string">'å­—æ®µ %s é¡»ç­‰äº %s'</span>,</span><br><span class="line">    min: <span class="string">'å­—æ®µ %s é¡»å¤§äº %s'</span>,</span><br><span class="line">    max: <span class="string">'å­—æ®µ %s é¡»å°äº %s'</span>,</span><br><span class="line">    range: <span class="string">'å­—æ®µ %s é¡»ä»‹äº %s ã€ %s ä¹‹é—´'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  array: &#123;</span><br><span class="line">    len: <span class="string">'å­—æ®µ %s çš„é•¿åº¦é¡»ç­‰äº %s'</span>,</span><br><span class="line">    min: <span class="string">'å­—æ®µ %s çš„é•¿åº¦é¡»å¤§äº %s'</span>,</span><br><span class="line">    max: <span class="string">'å­—æ®µ %s çš„é•¿åº¦é¡»å°äº %s'</span>,</span><br><span class="line">    range: <span class="string">'å­—æ®µ %s çš„é•¿åº¦é¡»ä»‹äº %s ã€ %s ä¹‹é—´'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  pattern: &#123;</span><br><span class="line">    mismatch: <span class="string">'å­—æ®µ %s çš„å€¼ %s ä¸åŒ¹é…æ­£åˆ™ %s'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><h3 id="async-validatoråœ¨rc-formç»„ä»¶ä¸­çš„åº”ç”¨"><a href="#async-validatoråœ¨rc-formç»„ä»¶ä¸­çš„åº”ç”¨" class="headerlink" title="async-validatoråœ¨rc-formç»„ä»¶ä¸­çš„åº”ç”¨"></a>async-validatoråœ¨rc-formç»„ä»¶ä¸­çš„åº”ç”¨</h3><p>rc-formç»„ä»¶æ˜¯ant-designç»„ä»¶åº“ä¸­è¡¨å•ç»„ä»¶çš„åº•å±‚å®ç°ã€‚å…³äºè¯¥è¡¨å•ç»„ä»¶çš„å®ç°ï¼Œç¬”è€…å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­æ¢è®¨ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œç¬”è€…åªæˆªå–rc-formç»„ä»¶(2.1.6ç‰ˆæœ¬)å¯¹async-validatoræ¨¡å—çš„ä½¿ç”¨ã€‚</p>
<p>åœ¨ä¸šåŠ¡ä¸Šï¼Œä¸€åˆ™å½“è¡¨å•å…ƒç´ å¤±å»ç„¦ç‚¹æ—¶éœ€è¦æ ¡éªŒè¯¥è¡¨å•é¡¹ï¼Œå¦ä¸€æ–¹é¢æ•´å¼ è¡¨å•åœ¨æäº¤æ—¶éœ€è¦æ ¡éªŒæ‰€æœ‰æœªéšè—çš„è¡¨å•é¡¹ã€‚ä»¥ä¸Šä¸¤ç‚¹ï¼Œrc-formç»„ä»¶éƒ½åŸºäºvalidateFieldsInternalæ–¹æ³•åˆ›å»ºæ–°çš„AsyncValidatorå®ä¾‹å®ç°ã€‚å‚æ•°actionç”¨äºè¿‡æ»¤æ ¡éªŒæ¡ä»¶ï¼Œé€‚ç”¨äºç¬¬ä¸€ç§æƒ…å½¢ã€‚å‚æ•°options.forceä¸ºçœŸæ—¶ï¼Œåœ¨äº‹ä»¶è¿‡ç¨‹ä¸­å·²è¢«æ ¡éªŒçš„è¡¨å•é¡¹ä»éœ€å†åº¦æ ¡éªŒï¼›options.firstFieldséœ€è¦æ‰§è¡Œé˜»å¡å¼æ ¡éªŒçš„å­—æ®µï¼›å…¶ä»–å±æ€§åŒasync-validatoræ¨¡å—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rc-form/src/createBaseField.js</span></span><br><span class="line">validateFieldsInternal(fields, &#123;</span><br><span class="line">  fieldNames,</span><br><span class="line">  action,</span><br><span class="line">  options = &#123;&#125;,</span><br><span class="line">&#125;, callback) &#123;</span><br><span class="line">  <span class="keyword">const</span> allRules = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> allValues = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> allFields = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> alreadyErrors = &#123;&#125;;</span><br><span class="line">  fields.forEach(<span class="function">(<span class="params">field</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> name = field.name;</span><br><span class="line">    <span class="comment">// è¡¨å•é¡¹åœ¨äº‹ä»¶è¿‡ç¨‹ä¸­å·²è¢«æ ¡éªŒï¼Œå°†ä¸äºˆå†æ¬¡æ ¡éªŒ</span></span><br><span class="line">    <span class="keyword">if</span> (options.force !== <span class="literal">true</span> &amp;&amp; field.dirty === <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (field.errors) &#123;</span><br><span class="line">        set(alreadyErrors, name, &#123; <span class="attr">errors</span>: field.errors &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> fieldMeta = <span class="keyword">this</span>.fieldsStore.getFieldMeta(name);</span><br><span class="line">    <span class="keyword">const</span> newField = &#123;</span><br><span class="line">      ...field,</span><br><span class="line">    &#125;;</span><br><span class="line">    newField.errors = <span class="literal">undefined</span>;</span><br><span class="line">    newField.validating = <span class="literal">true</span>;</span><br><span class="line">    newField.dirty = <span class="literal">true</span>;</span><br><span class="line">    allRules[name] = <span class="keyword">this</span>.getRules(fieldMeta, action);</span><br><span class="line">    allValues[name] = newField.value;</span><br><span class="line">    allFields[name] = newField;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">this</span>.setFields(allFields);</span><br><span class="line">  <span class="comment">// in case normalize</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(allValues).forEach(<span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">    allValues[f] = <span class="keyword">this</span>.fieldsStore.getFieldValue(f);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (callback &amp;&amp; isEmptyObject(allFields)) &#123;</span><br><span class="line">    callback(isEmptyObject(alreadyErrors) ? <span class="literal">null</span> : alreadyErrors,</span><br><span class="line">      <span class="keyword">this</span>.fieldsStore.getFieldsValue(fieldNames));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> validator = <span class="keyword">new</span> AsyncValidator(allRules);</span><br><span class="line">  <span class="keyword">if</span> (validateMessages) &#123;</span><br><span class="line">    validator.messages(validateMessages);</span><br><span class="line">  &#125;</span><br><span class="line">  validator.validate(allValues, options, (errors) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> errorsGroup = &#123;</span><br><span class="line">      ...alreadyErrors,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (errors &amp;&amp; errors.length) &#123;</span><br><span class="line">      errors.forEach(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> fieldName = e.field;</span><br><span class="line">        <span class="keyword">if</span> (!has(errorsGroup, fieldName)) &#123;</span><br><span class="line">          set(errorsGroup, fieldName, &#123; <span class="attr">errors</span>: [] &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> fieldErrors = get(errorsGroup, fieldName.concat(<span class="string">'.errors'</span>));</span><br><span class="line">        fieldErrors.push(e);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> expired = [];</span><br><span class="line">    <span class="keyword">const</span> nowAllFields = &#123;&#125;;</span><br><span class="line">    <span class="built_in">Object</span>.keys(allRules).forEach(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fieldErrors = get(errorsGroup, name);</span><br><span class="line">      <span class="keyword">const</span> nowField = <span class="keyword">this</span>.fieldsStore.getField(name);</span><br><span class="line">      <span class="comment">// avoid concurrency problems</span></span><br><span class="line">      <span class="comment">// æ ¡éªŒè¿‡ç¨‹ä¸­æ•°æ®å˜æ›´ï¼Œæé†’éœ€è¦å†æ¬¡æ ¡éªŒ</span></span><br><span class="line">      <span class="keyword">if</span> (nowField.value !== allValues[name]) &#123;</span><br><span class="line">        expired.push(&#123;</span><br><span class="line">          name,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        nowField.errors = fieldErrors &amp;&amp; fieldErrors.errors;</span><br><span class="line">        nowField.value = allValues[name];</span><br><span class="line">        nowField.validating = <span class="literal">false</span>;</span><br><span class="line">        nowField.dirty = <span class="literal">false</span>;</span><br><span class="line">        nowAllFields[name] = nowField;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.setFields(nowAllFields);</span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      <span class="keyword">if</span> (expired.length) &#123;</span><br><span class="line">        expired.forEach(<span class="function">(<span class="params">&#123; name &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> fieldErrors = [&#123;</span><br><span class="line">            message: <span class="string">`<span class="subst">$&#123;name&#125;</span> need to revalidate`</span>,</span><br><span class="line">            field: name,</span><br><span class="line">          &#125;];</span><br><span class="line">          set(errorsGroup, name, &#123;</span><br><span class="line">            expired: <span class="literal">true</span>,</span><br><span class="line">            errors: fieldErrors,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      callback(isEmptyObject(errorsGroup) ? <span class="literal">null</span> : errorsGroup,</span><br><span class="line">        <span class="keyword">this</span>.fieldsStore.getFieldsValue(fieldNames));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">getRules(fieldMeta, action) &#123;</span><br><span class="line">  <span class="keyword">const</span> actionRules = fieldMeta.validate.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !action || item.trigger.indexOf(action) &gt;= <span class="number">0</span>;</span><br><span class="line">  &#125;).map(<span class="function">(<span class="params">item</span>) =&gt;</span> item.rules);</span><br><span class="line">  <span class="keyword">return</span> flattenArray(actionRules);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="è¡¨å•é¡¹æ ¡éªŒ"><a href="#è¡¨å•é¡¹æ ¡éªŒ" class="headerlink" title="è¡¨å•é¡¹æ ¡éªŒ"></a>è¡¨å•é¡¹æ ¡éªŒ</h4><p>é’ˆå¯¹ç¬¬ä¸€ç‚¹ï¼Œrc-formç»„ä»¶çš„å®ç°ç­–ç•¥æ˜¯é€šè¿‡getFieldPropsæ–¹æ³•ç”Ÿæˆä¼ å…¥è¡¨å•å…ƒç´ çš„äº‹ä»¶ç»‘å®šå‡½æ•°propså¦‚{ onChange: () =&gt; {} }ã€‚ç»‘å®šå‡½æ•°å†…éƒ¨å°†è°ƒç”¨validateFieldsInternalæ–¹æ³•å¯¹å½“å‰çš„è¡¨å•é¡¹è¿›è¡Œæ ¡éªŒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rc-form/src/createBaseField.js</span></span><br><span class="line">getFieldProps(name, usersFieldOption = &#123;&#125;) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> validateRules = normalizeValidateRules(validate, rules, validateTrigger);</span><br><span class="line">  <span class="keyword">const</span> validateTriggers = getValidateTriggers(validateRules);</span><br><span class="line">  validateTriggers.forEach(<span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (inputProps[action]) <span class="keyword">return</span>;</span><br><span class="line">    inputProps[action] = <span class="keyword">this</span>.getCacheBind(name, action, <span class="keyword">this</span>.onCollectValidate);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> inputProps;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œå‚æ•°validate = [{ rules, trigger }]ã€rulesã€validateTriggerå‡ä¸ºusersFieldOptionçš„å±æ€§ã€‚validateå¯ä»¥è®¾ç½®å¤šç»„æ ¡éªŒè§„åˆ™çš„ä¸åŒè§¦å‘æ–¹å¼ï¼Œå¦‚å¤±å»ç„¦ç‚¹(â€˜onBlurâ€™)æˆ–æ•°æ®æ”¹å˜(â€˜onChangeâ€™)ã€‚å‚æ•°validateTriggerå³usersFieldOption.rulesæ ¡éªŒè§„åˆ™çš„è§¦å‘æ–¹å¼ï¼Œé»˜è®¤ä¸ºâ€™onChangeâ€™ã€‚this.getCacheBindæ–¹æ³•ç”¨äºä»¥this.cachedBind = { name: { action: () =&gt; {} } }ç¼“å­˜æ ¡éªŒå‡½æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rc-form/src/createBaseField.js</span></span><br><span class="line">onCollectValidate(name_, action, ...args) &#123;</span><br><span class="line">  <span class="comment">// this.onCollectCommonæ–¹æ³•ç”¨äºæ‰§è¡ŒonChangeç­‰å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶è·å–è¡¨å•é¡¹çš„å€¼</span></span><br><span class="line">  <span class="keyword">const</span> &#123; field, fieldMeta &#125; = <span class="keyword">this</span>.onCollectCommon(name_, action, args);</span><br><span class="line">  <span class="keyword">const</span> newField = &#123;</span><br><span class="line">    ...field,</span><br><span class="line">    dirty: <span class="literal">true</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.validateFieldsInternal([newField], &#123;</span><br><span class="line">    action,</span><br><span class="line">    options: &#123;</span><br><span class="line">      firstFields: !!fieldMeta.validateFirst,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒinputPropsæ³¨å…¥è¡¨å•é¡¹çš„ç»‘å®šå‡½æ•°this.onCollectValidateæ–¹æ³•å°†è°ƒç”¨this.validateFieldsInternalæ ¡éªŒè¡¨å•é¡¹ã€‚ç‰¹åˆ«éœ€è¦æŒ‡æ˜çš„æ˜¯ï¼ŒfieldMetaä¸º{ name, trigger, valuePropName, â€¦usersFieldOption, validate }æ•°æ®æ ¼å¼ã€‚å…¶ä¸­ï¼ŒusersFieldOption.validateFirstå†³å®šå½“å‰æ ¡éªŒå­—æ®µæ˜¯å¦æ‰§è¡Œé˜»å¡å¼æ ¡éªŒï¼›usersFieldOption.getValueFromEventç”¨äºå°†äº‹ä»¶å‚æ•°eventç­‰è½¬åŒ–æˆè¡¨å•é¡¹é¢å€¼ã€‚usersFieldOption.onChangeç­‰æ–¹æ³•å½“åŒåäº‹ä»¶å‘ç”Ÿæ—¶å°†è¢«è°ƒç”¨ã€‚</p>
<h4 id="è¡¨å•æ ¡éªŒ"><a href="#è¡¨å•æ ¡éªŒ" class="headerlink" title="è¡¨å•æ ¡éªŒ"></a>è¡¨å•æ ¡éªŒ</h4><p>rc-formç»„ä»¶ä¸­ï¼Œæ ¡éªŒæ•´å¼ è¡¨å•é€šè¿‡æ˜¾å¼è°ƒç”¨this.validateFieldsæ–¹æ³•å®ç°ã€‚åœ¨è¯¥æ–¹æ³•å†…éƒ¨ï¼Œä¹Ÿå°†è°ƒç”¨this.validateFieldsInternalæ ¡éªŒæ‰€æœ‰è¡¨å•é¡¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rc-form/src/createBaseField.js</span></span><br><span class="line">validateFields(ns, opt, cb) &#123;</span><br><span class="line">  <span class="comment">// getParamsç”¨äºå‚æ•°è½¬åŒ–</span></span><br><span class="line">  <span class="keyword">const</span> &#123; names, callback, options &#125; = getParams(ns, opt, cb);</span><br><span class="line">  <span class="keyword">const</span> fieldNames = names ?</span><br><span class="line">    <span class="keyword">this</span>.fieldsStore.getValidFieldsFullName(names) :</span><br><span class="line">    <span class="keyword">this</span>.fieldsStore.getValidFieldsName();</span><br><span class="line">  <span class="keyword">const</span> fields = fieldNames</span><br><span class="line">    .filter(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fieldMeta = <span class="keyword">this</span>.fieldsStore.getFieldMeta(name);</span><br><span class="line">      <span class="keyword">return</span> hasRules(fieldMeta.validate);</span><br><span class="line">    &#125;).map(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> field = <span class="keyword">this</span>.fieldsStore.getField(name);</span><br><span class="line">      field.value = <span class="keyword">this</span>.fieldsStore.getFieldValue(name);</span><br><span class="line">      <span class="keyword">return</span> field;</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="keyword">if</span> (!fields.length) &#123;</span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="keyword">this</span>.fieldsStore.getFieldsValue(fieldNames));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="string">'firstFields'</span> <span class="keyword">in</span> options)) &#123;</span><br><span class="line">    options.firstFields = fieldNames.filter(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fieldMeta = <span class="keyword">this</span>.fieldsStore.getFieldMeta(name);</span><br><span class="line">      <span class="keyword">return</span> !!fieldMeta.validateFirst;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.validateFieldsInternal(fields, &#123;</span><br><span class="line">    fieldNames,</span><br><span class="line">    options,</span><br><span class="line">  &#125;, callback);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="åå°æ ¡éªŒ"><a href="#åå°æ ¡éªŒ" class="headerlink" title="åå°æ ¡éªŒ"></a>åå°æ ¡éªŒ</h3><p>ç¬”è€…å°†æ¢è®¨çš„æ˜¯async-validatoræ¨¡å—åœ¨koaæ¡†æ¶ä¸­çš„ä½¿ç”¨ã€‚</p>
<p>å› ä¸ºAsyncValidatorå®ä¾‹çš„validateæ–¹æ³•é‡‡ç”¨å›è°ƒçš„æ–¹å¼ç»„ç»‡å¼‚æ­¥é€»è¾‘ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶è½¬åŒ–ä¸ºPromiseå®ä¾‹ï¼Œè¿™ä¸ªè¿‡ç¨‹åˆå¯ä»¥é€šè¿‡åœ¨ä¸­é—´ä»¶ä¸­æä¾›ctx.validateæ–¹æ³•å®ç°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> asyncValidatorMiddleware = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">ctx, next</span>)</span>&#123;</span><br><span class="line">  ctx.validate = <span class="function">(<span class="params">rules, values, opts</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> options = <span class="built_in">Object</span>.assign(opts);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> validator = <span class="keyword">new</span> AsyncValidator(rules);</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      validator.validate(values, options, errs =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> ( errs )&#123;</span><br><span class="line">          resolve();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> msgs = errs.map(<span class="function"><span class="params">err</span>=&gt;</span>err.message).join(<span class="string">'; '</span>);</span><br><span class="line">          ctx.throw(<span class="number">400</span>, msgs);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="åˆ¶ä½œæ ¡éªŒå™¨å›¾å½¢ç•Œé¢"><a href="#åˆ¶ä½œæ ¡éªŒå™¨å›¾å½¢ç•Œé¢" class="headerlink" title="åˆ¶ä½œæ ¡éªŒå™¨å›¾å½¢ç•Œé¢"></a>åˆ¶ä½œæ ¡éªŒå™¨å›¾å½¢ç•Œé¢</h3><p>åœ¨æœ¬å°èŠ‚ï¼Œç¬”è€…å°†ç»“åˆå®é™…çš„é¡¹ç›®ç»éªŒï¼Œæ¦‚è¦åœ°è®¾è®¡ä¸€ä¸ªå¯è®¢åˆ¶æ ¡éªŒè§„åˆ™çš„å›¾å½¢ç•Œé¢ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢æ¿é¢„è®¾å•ç»„æ ¡éªŒå™¨çš„æ ¡éªŒæ¨¡å¼ï¼Œæ¯”å¦‚é™åˆ¶æŸå­—æ®µå¿…é¡»ä»‹äº1åˆ°10ä¹‹é—´ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™å—é¢æ¿ä¸­é™å®šè¯¥å­—æ®µçš„å€¼åªèƒ½ä¸ºæ•°å€¼ï¼Œä¸”å¼€å¯â€™rangeâ€™èŒƒå›´æ ¡éªŒï¼›æ¥ç€ï¼Œåœ¨å¦ä¸€å—é¢æ¿é…ç½®å®é™…çš„æ ¡éªŒæ•°æ®ï¼Œå¦‚min = 1, max = 10ï¼Œç”±æ­¤ç”Ÿæˆå®é™…çš„æ ¡éªŒè§„åˆ™ã€‚</p>
<p>åœ¨ç¬¬ä¸€å—é¢æ¿ä¸­ï¼Œé¢„è®¾çš„æ ¡éªŒæ¨¡å¼æœ€ç»ˆå°†ä¼šåå‡º{ validatorCode, validatorName, validatorDescription, validatorRules }å½¢å¼çš„æ•°æ®ç»“æ„ã€‚å…¶ä¸­validatorCodeä¸ºæ ¡éªŒå™¨codeï¼ŒvalidatorNameä¸ºæ ¡éªŒå™¨åç§°ï¼ŒvalidatorDesriptionä¸ºæ ¡éªŒå™¨æè¿°ï¼ŒvalidatorRules = [ rule ]ä»¥æ•°ç»„å½¢å¼å­˜å‚¨å„å­—æ®µçš„æ ¡éªŒè§„åˆ™ã€‚ruleå¯¹è±¡çš„æ•°æ®ç»“æ„è­¬å¦‚{ fieldCode, fieldName, fieldDecription, type, validateStrategy, renderType }ã€‚åœ¨ruleå¯¹è±¡ä¸­ï¼ŒfieldCodeä¸ºæ ¡éªŒå­—æ®µcodeï¼›fieldNameä¸ºæ ¡éªŒå­—æ®µåç§°ï¼›fieldDecriptionä¸ºæ ¡éªŒå­—æ®µæè¿°ï¼›typeä¸ºç±»å‹ï¼Œå¯é€‰â€™numberâ€™, â€˜stringâ€™, â€˜dateâ€™, â€˜enumâ€™, â€˜arrayâ€™, â€˜objectâ€™, â€˜customâ€™ï¼ˆå½“typeä¸ºâ€™arrayâ€™æˆ–â€™objectâ€™æ—¶ï¼ŒåµŒå¥—è®¾ç½®å…¶ä¸‹å±æ•°ç»„é¡¹æˆ–å±æ€§çš„æ ¡éªŒè§„åˆ™ï¼›å½“typeä¸ºâ€™customâ€™æ—¶ï¼Œæ ¡éªŒæ–¹å¼ç”±ç¨‹åºçº¦å®šï¼Œé€šè¿‡fieldCodeæŸ¥æ‰¾ï¼‰ï¼›validateStrategyä¸ºæ ¡éªŒç­–ç•¥ï¼Œå½“typeä¸ºâ€™stringâ€™æ—¶ï¼Œå¯é€‰çš„æ ¡éªŒç­–ç•¥åŒ…å«â€™regexpâ€™ï¼ˆæ­£åˆ™åŒ¹é…ï¼‰, â€˜expiredâ€™ï¼ˆä¸¥æ ¼ç›¸ç­‰ï¼‰, â€˜urlâ€™ç­‰ï¼Œä½™ç•¥ï¼›renderTypeä¸ºæ¸²æŸ“å½¢å¼ï¼Œå½“typeä¸ºâ€™stringâ€™æ—¶ï¼ŒrenderTypeè‡ªç„¶ä¸ºè¾“å…¥æ¡†å½¢å¼ï¼Œè¿™æ„å‘³ç€åœ¨ç¬¬äºŒå—é¢æ¿ä¸­éœ€è¦æ¸²æŸ“ä¸€ä¸ªè¾“å…¥æ¡†ä»¥é…ç½®æ­£åˆ™æˆ–æœŸæœ›å€¼ï¼Œä½™ç•¥ã€‚</p>
<p>å…³äºæ ¡éªŒç±»å‹typeå’Œæ ¡éªŒç­–ç•¥validateStrategyã€æ¸²æŸ“å½¢å¼renderTypeçš„å…³ç³»ï¼Œç¬”è€…ç”¨ä¸‹å›¾ç®€è¦è¯´æ˜ï¼š</p>
<img src="/2018/01/24/æµ…æasync-validatoræºç /yuanxing1.png">
<p>ç‰¹åˆ«çš„ï¼Œæšä¸¾ç±»å‹é¢å¤–éœ€è¦è¾“å…¥æ¡†ï¼Œä»¥é…ç½®æšä¸¾å€¼key-valueé”®å€¼å¯¹ã€‚</p>
<p>ç¬¬ä¸€å—é¢æ¿ç”¨åŸå‹å›¾å±•ç¤ºï¼Œå³ä¸ºï¼š</p>
<img src="/2018/01/24/æµ…æasync-validatoræºç /yuanxing2.png">
<p>è‡³äºå¼¹çª—å½¢å¼çš„å•å­—æ®µæ ¡éªŒè§„åˆ™é…ç½®ï¼Œç¬”è€…ä¸å†èµ˜è¿°ã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œé’ˆå¯¹typeç±»å‹ä¸ºâ€™arrayâ€™æˆ–â€™objectâ€™ç±»å‹çš„æ ¡éªŒè§„åˆ™ï¼Œå› å…¶é…ç½®ç¹çï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨type = â€˜customâ€™ç±»å‹äºˆä»¥æ ¡éªŒï¼Œé€šè¿‡validatorCodeä¸fieldCodeè·å–åå°å†™æ­»çš„æ ¡éªŒå™¨ï¼Œè¿™æ ·æ—¢å¯¹ç”¨æˆ·é€æ˜ï¼Œä¹Ÿä¸å®¹æ˜“å‡ºé”™ã€‚</p>
<p>æœ‰äº†ç¬¬ä¸€å—é¢æ¿ï¼Œæˆ‘ä»¬å†è®¾è®¡ç¬¬äºŒå—é¢æ¿ï¼Œå³å®é™…æ ¡éªŒæ•°æ®é…ç½®é¢æ¿ã€‚è¿™é‡Œæˆ‘ä»¬å¼•å…¥æ ¡éªŒç»„åˆçš„æ¦‚å¿µï¼Œå³å•ä¸ªæ ¡éªŒç»„åˆä¸‹å¯é…ç½®å¤šä¸ªæ ¡éªŒå™¨ï¼Œæ ¡éªŒç»„åˆä¹‹é—´æœ‰åºæ’åˆ—ï¼Œé€ä¸ªæ ¡éªŒï¼Œå…¶ä¸­ä¸€ä¸ªå‡ºé”™ï¼Œå³ä¸ºæ ¡éªŒå¤±è´¥ã€‚è‡³äºæ ¡éªŒå™¨é…ç½®å¼¹çª—ï¼Œå…¶æ¸²æŸ“æ–¹å¼å®Œå…¨ç”±ç¬¬ä¸€å—é¢æ¿å¡«å……çš„æ•°æ®å†³å®šï¼Œå¦‚æˆ‘ä»¬é…ç½®äº†validateRules = [{ fieldCode: â€˜field1â€™, fieldName: â€˜field1â€™, type: â€˜stringâ€™, validateStragery: â€˜expiredâ€™, renderType: â€˜inputâ€™ }, { fieldCode: â€˜field2â€™, fieldName: â€˜field2â€™, type: â€˜enumâ€™, validateStragery: â€˜multipleâ€™, renderType: â€˜selectâ€™ }]ï¼Œæ ¡éªŒå™¨çš„é…ç½®å¼¹çª—å³æ˜¾ç¤ºä¸€ä¸ªè¾“å…¥æ¡†å’Œä¸€ä¸ªå¤šé€‰ä¸‹æ‹‰æ¡†ï¼Œå‰è€…ç”¨äºå†³å®šç¬¬ä¸€ä¸ªå­—æ®µçš„æœŸæœ›å€¼ï¼Œåè€…ç”¨äºå†³å®šç¬¬äºŒä¸ªå­—æ®µé¡»ä¸ºä¸‹æ‹‰æ¡†é€‰ä¸­é¡¹ä¸­çš„ä¸€ä¸ªã€‚åœ¨è¿™é‡Œï¼Œç¬”è€…åªç»™å‡ºæ ¡éªŒç»„åˆçš„åŸå‹å›¾ï¼Œè‡³äºæ ¡éªŒå™¨çš„é…ç½®å¼¹çª—ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<p><img src="/Users/alfred/Desktop/æµ…æasync-validatoræºç /imgs/3.png" alt=""></p>
<p>æœ‰äº†ä»¥ä¸Šä¸¤å—é¢æ¿åŠå…¶è¾“å…¥æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¼è£…å®é™…çš„æ ¡éªŒè§„åˆ™ã€‚ç¬”è€…ä¾ç„¶ä»¥å‰è¿°çš„validatorRulesä¸ºä¾‹ï¼Œå½“ç”¨æˆ·é…ç½®äº†å¦‚ä¸‹çš„æ ¡éªŒç»„åˆï¼ŒvalidatorCombinations = [[{ field1: â€˜aaaâ€™, field2: [â€˜1â€™, â€˜2â€™, â€˜3â€™] }]]ã€‚ç”Ÿæˆçš„å®é™…æ ¡éªŒå™¨å³ä¸º{ type: â€˜expiredâ€™, expired: â€˜aaaâ€™ }åŠ{ type: â€˜enumâ€™, enum: [â€˜1â€™, â€˜2â€™, â€˜3â€™] }ã€‚é’ˆå¯¹typeå€¼ä¸ºâ€™expiredâ€™çš„æ ¡éªŒè§„åˆ™ï¼Œé¢„å…ˆéœ€è¦åœ¨AsyncValidatoræ„é€ å‡½æ•°ä¸­æ³¨å†ŒexpiredValidatoræ ¡éªŒå™¨å¦‚let expiredValidator = (val, rule) =&gt; { if ( val === rule.expired ) cb(); else cb(util.format(â€˜value %s is not valid, %s expiredâ€™, val, rule.expired)) }ã€‚</p>
<p>å€¼å¾—åæ€çš„æ˜¯ï¼Œä»¥ä¸Šçš„å›¾å½¢ç•Œé¢ï¼Œå¹¶æ²¡æœ‰æä¾›å…³è”æ ¡éªŒçš„èƒ½åŠ›ã€‚</p>
<h2 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h2><h3 id="jquery-validate"><a href="#jquery-validate" class="headerlink" title="jquery-validate"></a>jquery-validate</h3><p>ç›¸æ¯”async-validatoræ¨¡å—ä¸“å¸äºæ•°æ®æ ¡éªŒï¼Œjquery-validateæ¨¡å—è¿˜æ‰¿æ‹…ç€è§†å›¾å±‚çš„å·¥ä½œã€‚å› æ­¤æ•°æ®åœ¨æµå…¥æµå‡ºæ ¡éªŒå™¨æ—¶ï¼Œéƒ½å¯èƒ½éœ€è¦åˆ¤æ–­æ•°æ®æ‰€å±èŠ‚ç‚¹çš„æ ‡ç­¾åã€‚åœ¨è¿™é‡Œï¼Œç¬”è€…åªæ¦‚è¦åœ°ä»‹ç»è¯¥æ’ä»¶æ•°æ®æ ¡éªŒæ–¹é¢çš„æµç¨‹ã€‚</p>
<h4 id="å†…ç½®æ ¡éªŒå™¨-1"><a href="#å†…ç½®æ ¡éªŒå™¨-1" class="headerlink" title="å†…ç½®æ ¡éªŒå™¨"></a>å†…ç½®æ ¡éªŒå™¨</h4><p>åœ¨jquery-validateæ¨¡å—æºç ä¸­ï¼Œæ ¡éªŒæ–¹æ³•æ³¨å†Œåœ¨$.validator.prototype.methodsï¼ˆåæ–‡å°†ç”¨methodsä»£æ›¿ï¼‰å±æ€§ä¸­ã€‚æ ¡éªŒæ–¹æ³•çš„å‡½æ•°å½¢å¼å‡ä¸ºfunction(value, element, param)ï¼Œå‚æ•°valueä¸ºå¾…æ ¡éªŒçš„å€¼ï¼Œelementä¸ºå¾…æ ¡éªŒçš„å…ƒç´ ï¼Œparamä¸ºç›¸åº”æ ¡éªŒè§„åˆ™çš„å€¼ã€‚æ ¡éªŒæ–¹æ³•åˆåŒ…å«requiredéç©ºæ£€éªŒï¼Œemailæ ¡éªŒï¼Œurlæ ¡éªŒï¼Œdateæ ¡éªŒï¼ŒdateISOå¹´-æœˆ-æ—¥æ ¡éªŒï¼Œnumberæ•°å€¼ï¼ˆåŒ…å«å°æ•°ï¼‰æ ¡éªŒï¼Œdigitsæ­£æ•´æ•°æ ¡éªŒï¼Œcreditcardä¿¡ç”¨å¡å·æ ¡éªŒï¼Œminlengthæœ€å°é•¿åº¦æ ¡éªŒï¼Œmaxlengthæœ€å¤§é•¿åº¦æ ¡éªŒï¼Œrangelengthé•¿åº¦èŒƒå›´æ ¡éªŒï¼Œminæœ€å°å€¼æ ¡éªŒï¼Œmaxæœ€å¤§å€¼æ ¡éªŒï¼ŒrangeèŒƒå›´æ ¡éªŒï¼ŒequalToå…³è”å…ƒç´ ç­‰å€¼æ ¡éªŒï¼Œremoteè¿œç¨‹æ ¡éªŒã€‚</p>
<p>æŒ‚è½½åœ¨å…ƒç´ ä¸Šçš„æ ¡éªŒè§„åˆ™é€šè¿‡let rules = { fieldName:{ required: true, min: 1 } }; $(â€œ#formâ€).validate({ rules })å½¢å¼è®¾å®šã€‚å› æ­¤å„æ ¡éªŒæ–¹æ³•è·å¾—çš„paramå‚æ•°ä¹Ÿåœ¨äºé…ç½®é¡¹rules.filedNameå¯¹è±¡ï¼Œå¦‚methods.requiredæ ¡éªŒæ–¹æ³•è·å¾—çš„paramä¸ºtrueï¼Œmethods.minæ–¹æ³•è·å¾—çš„paramä¸º1ã€‚ç‰¹åˆ«çš„ï¼Œåœ¨methods.requiredæ ¡éªŒæ–¹æ³•ä¸­ï¼Œé¢„å…ˆè°ƒç”¨this.dependæ–¹æ³•åˆ¤æ–­å…ˆå†³æ¡ä»¶æ˜¯å¦æˆç«‹ï¼ˆå‰ææ˜¯å°†requiredæ ¡éªŒæ–¹æ³•ä½œä¸ºé¢„å…ˆè®¾ç½®çš„æœ€åŸºç¡€çš„æ ¡éªŒå™¨ï¼Œå…¶ä»–æ ¡éªŒæ–¹æ³•éƒ½è°ƒç”¨this.optionalæ–¹æ³•æ ¡éªŒå…ƒç´ çš„å€¼éç©ºåï¼Œæ‰è¿›è¡Œç‰¹å®šçš„æ•°æ®æ ¡éªŒã€‚è¯¥å…ˆå†³æ¡ä»¶çš„æˆç«‹ä¸å¦éƒ½ä¸å½±å“æ ¡éªŒæ˜¾ç¤ºç»“æœï¼‰ï¼Œå½“paramä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦ç›¸åº”å…ƒç´ åœ¨é¡µé¢ä¸­å­˜åœ¨ï¼Œè¿™åœ¨è”åŠ¨æ˜¾ç¤ºéšè—çš„ä¸šåŠ¡åœºæ™¯ç‰¹åˆ«æœ‰ç”¨ï¼›å½“paramä¸ºå‡½æ•°æ—¶ï¼Œéœ€è¦å‡½æ•°è¿”å›çœŸå€¼ï¼Œè¿™å¯ç”¨åœ¨å…³è”æ ¡éªŒç­‰ä¸šåŠ¡åœºæ™¯ä¸­ï¼›å½“paramä¸ºå¸ƒå°”å€¼æ—¶ï¼Œæ— é¡»åˆ¤æ–­å…ˆå†³æ¡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">$.validator.prototype.methods = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  elementValue: <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val,</span><br><span class="line">      $element = $(element),</span><br><span class="line">      type = element.type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">"radio"</span> || type === <span class="string">"checkbox"</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.findByName(element.name).filter(<span class="string">":checked"</span>).val();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">"number"</span> &amp;&amp; <span class="keyword">typeof</span> element.validity !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> element.validity.badInput ? <span class="literal">false</span> : $element.val();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val = $element.val();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> val === <span class="string">"string"</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> val.replace(<span class="regexp">/\r/g</span>, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  checkable: <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="regexp">/radio|checkbox/i</span>).test(element.type);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getLength: <span class="function"><span class="keyword">function</span> (<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (element.nodeName.toLowerCase()) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"select"</span>:</span><br><span class="line">        <span class="keyword">return</span> $(<span class="string">"option:selected"</span>, element).length;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"input"</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.checkable(element)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.findByName(element.name).filter(<span class="string">":checked"</span>).length;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value.length;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  depend: <span class="function"><span class="keyword">function</span> (<span class="params">param, element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dependTypes[<span class="keyword">typeof</span> param] ? <span class="keyword">this</span>.dependTypes[<span class="keyword">typeof</span> param](param, element) : <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  dependTypes: &#123;</span><br><span class="line">    <span class="string">"boolean"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> param;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"string"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">param, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> !!$(param, element.form).length;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"function"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">param, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> param(element);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  optional: <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="keyword">this</span>.elementValue(element);</span><br><span class="line">    <span class="keyword">return</span> !$.validator.methods.required.call(<span class="keyword">this</span>, val, element) &amp;&amp; <span class="string">"dependency-mismatch"</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// &#123;required:true&#125;ã€&#123;required:function()&#123;return $(anotherEle).val()&lt;12&#125;&#125;ä¾èµ–æ¡ä»¶  </span></span><br><span class="line">    required: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123; </span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.depend(param, element)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"dependency-mismatch"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (element.nodeName.toLowerCase() === <span class="string">"select"</span>) &#123;</span><br><span class="line">        <span class="comment">// could be an array for select-multiple or a string, both are fine this way  </span></span><br><span class="line">        <span class="keyword">var</span> val = $(element).val();</span><br><span class="line">        <span class="keyword">return</span> val &amp;&amp; val.length &gt; <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.checkable(element)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getLength(value, element) &gt; <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value.length &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    email: <span class="function"><span class="keyword">function</span>(<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || <span class="regexp">/^[a-zA-Z0-9.!#$%&amp;'*+\/=?^_`&#123;|&#125;~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]&#123;0,61&#125;[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]&#123;0,61&#125;[a-zA-Z0-9])?)*$/</span>.test(value);</span><br><span class="line">    &#125;,</span><br><span class="line">    url: <span class="function"><span class="keyword">function</span>(<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || <span class="regexp">/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d&#123;1,3&#125;)&#123;3&#125;)(?!(?:169\.254|192\.168)(?:\.\d&#123;1,3&#125;)&#123;2&#125;)(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d&#123;1,3&#125;)&#123;2&#125;)(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d&#123;1,2&#125;|2[0-4]\d|25[0-5]))&#123;2&#125;(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]&#123;2,&#125;)).?)(?::\d&#123;2,5&#125;)?(?:[/?#]\S*)?$/i</span>.test(value);</span><br><span class="line">    &#125;,</span><br><span class="line">    date: <span class="function"><span class="keyword">function</span>(<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || !<span class="regexp">/Invalid|NaN/</span>.test(<span class="keyword">new</span> <span class="built_in">Date</span>(value).toString());</span><br><span class="line">    &#125;,</span><br><span class="line">    dateISO: <span class="function"><span class="keyword">function</span>(<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || <span class="regexp">/^\d&#123;4&#125;[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/</span>.test(value);</span><br><span class="line">    &#125;,</span><br><span class="line">    number: <span class="function"><span class="keyword">function</span>(<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || <span class="regexp">/^(?:-?\d+|-?\d&#123;1,3&#125;(?:,\d&#123;3&#125;)+)?(?:\.\d+)?$/</span>.test(value);</span><br><span class="line">    &#125;,</span><br><span class="line">    digits: <span class="function"><span class="keyword">function</span>(<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || <span class="regexp">/^\d+$/</span>.test(value);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// http://jqueryvalidation.org/creditcard-method/  </span></span><br><span class="line">    <span class="comment">// based on http://en.wikipedia.org/wiki/Luhn_algorithm  </span></span><br><span class="line">    creditcard: <span class="function"><span class="keyword">function</span>(<span class="params">value, element</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.optional(element)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"dependency-mismatch"</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/[^0-9 \-]+/</span>.test(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> nCheck = <span class="number">0</span>,</span><br><span class="line">        nDigit = <span class="number">0</span>,</span><br><span class="line">        bEven = <span class="literal">false</span>,</span><br><span class="line">        n, cDigit;</span><br><span class="line"></span><br><span class="line">      value = value.replace(<span class="regexp">/\D/g</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// http://developer.ean.com/general_info/Valid_Credit_Card_Types  </span></span><br><span class="line">      <span class="keyword">if</span> (value.length &lt; <span class="number">13</span> || value.length &gt; <span class="number">19</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (n = value.length - <span class="number">1</span>; n &gt;= <span class="number">0</span>; n--) &#123;</span><br><span class="line">        cDigit = value.charAt(n);</span><br><span class="line">        nDigit = <span class="built_in">parseInt</span>(cDigit, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (bEven) &#123;</span><br><span class="line">          <span class="keyword">if</span> ((nDigit *= <span class="number">2</span>) &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            nDigit -= <span class="number">9</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        nCheck += nDigit;</span><br><span class="line">        bEven = !bEven;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> (nCheck % <span class="number">10</span>) === <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    minlength: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> length = $.isArray(value) ? value.length : <span class="keyword">this</span>.getLength(value, element);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || length &gt;= param;</span><br><span class="line">    &#125;,</span><br><span class="line">    maxlength: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> length = $.isArray(value) ? value.length : <span class="keyword">this</span>.getLength(value, element);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || length &lt;= param;</span><br><span class="line">    &#125;,</span><br><span class="line">    rangelength: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> length = $.isArray(value) ? value.length : <span class="keyword">this</span>.getLength(value, element);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || (length &gt;= param[<span class="number">0</span>] &amp;&amp; length &lt;= param[<span class="number">1</span>]);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    min: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || value &gt;= param;</span><br><span class="line">    &#125;,</span><br><span class="line">    max: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || value &lt;= param;</span><br><span class="line">    &#125;,</span><br><span class="line">    range: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.optional(element) || (value &gt;= param[<span class="number">0</span>] &amp;&amp; value &lt;= param[<span class="number">1</span>]);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    equalTo: <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// bind to the blur event of the target in order to revalidate whenever the target field is updated  </span></span><br><span class="line">      <span class="comment">// TODO find a way to bind the event just once, avoiding the unbind-rebind overhead  </span></span><br><span class="line">      <span class="keyword">var</span> target = $(param);</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.settings.onfocusout) &#123;</span><br><span class="line">        target.off(<span class="string">".validate-equalTo"</span>).on(<span class="string">"blur.validate-equalTo"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          $(element).valid();<span class="comment">// æ‰§è¡ŒéªŒè¯  </span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value === target.val();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è¿œç¨‹æ ¡éªŒ"><a href="#è¿œç¨‹æ ¡éªŒ" class="headerlink" title="è¿œç¨‹æ ¡éªŒ"></a>è¿œç¨‹æ ¡éªŒ</h4><p>å…³äºmethods.remoteè¿œç¨‹æ ¡éªŒã€‚ä¸async-validadtoræ¨¡å—ä¸åŒçš„æ˜¯ï¼Œé¦–å…ˆasync-validadtoræ¨¡å—å¹¶æ²¡æœ‰æä¾›è¿œç¨‹æ ¡éªŒæ–¹æ³•ï¼Œå…¶æ¬¡async-validadtoræ¨¡å—æœ‰å¼‚æ­¥æµç¨‹æ§åˆ¶ï¼Œjquery-validateæ¨¡å—æ²¡æœ‰ï¼Œè€Œæ˜¯é€šè¿‡è¿œç¨‹æ ¡éªŒèµ·å§‹æ—¶è‡ªå¢1ã€ç»“æŸæ—¶è‡ªå‡1çš„æ ‡è¯†ç¬¦this.pendingRequestï¼Œä»¥åŠè¿œç¨‹æ ¡éªŒä¸­å…ƒç´ çš„é›†åˆthis.pendingæ¥æ„ŸçŸ¥è¿œç¨‹æ ¡éªŒçš„çŠ¶æ€ï¼Œéšåæ‰èƒ½æäº¤è¡¨å•ã€‚</p>
<p>åœ¨jquery-validateæ¨¡å—ä¸­ï¼Œè¿œç¨‹æ ¡éªŒçš„æ ¡éªŒè§„åˆ™é…ç½®å½¢å¼ä¸ºrule = { remote: url }æˆ–rule = { url, â€¦params }ã€‚å‚æ•°urlä¸ºè¯·æ±‚åœ°å€ï¼Œå…¶ä½™å‚æ•°paramsä»¥æ·±æ‹·è´çš„å½¢å¼æ”¹å˜$.ajaxæ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥åŒ…å«dataå±æ€§æ”¹å˜è¯·æ±‚æ•°æ®ï¼ˆé»˜è®¤å€¼ä¸ºè¡¨å•é¡¹nameå€¼å’Œè¡¨å•é¡¹æ•°æ®ç»„æˆçš„é”®å€¼å¯¹ï¼‰ï¼Œsuccessæ”¹å˜æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°ã€‚é»˜è®¤çš„æˆåŠŸå›è°ƒsuccessä¸­ï¼Œå½“å“åº”ä¸ºçœŸå€¼ï¼Œå³ä¸ºæ ¡éªŒæˆåŠŸï¼›ä¸ºå¦å€¼ï¼Œå³ä¸ºæ ¡éªŒå¤±è´¥ã€‚æ”¹å†™è¿™ä¸ªæˆåŠŸå›è°ƒï¼Œéœ€è¦è°ƒç”¨è€…å¯¹jquery-validateæ¨¡å—çš„æœºåˆ¶æ¯”è¾ƒç†è§£ã€‚</p>
<p>åœ¨æ€§èƒ½æ–¹é¢ï¼Œjquery-validateæ¨¡å—ä¼šåœ¨æ ¡éªŒå…ƒç´ çš„â€™data-previousValueâ€™å±æ€§ä¸­ç¼“å­˜ä¸Šæ¬¡çš„æ ¡éªŒæ•°æ®åŠç»“æœã€‚å½“å…ƒç´ çš„å½“å‰å€¼å’Œç¼“å­˜æ•°æ®ç›¸åŒæ—¶ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„æ ¡éªŒç»“æœã€‚ä¸ºé¿å…åŒä¸€ä¸ªæ ¡éªŒå…ƒç´ è¿ç»­å‘é€å¤šæ¬¡è¯·æ±‚ï¼Œjquery-validateæ¨¡å—é€šè¿‡æ‰©å±•$.ajaxå®ç°ï¼Œå½“æœ‰æ–°ä¸€è½®è¯·æ±‚æ—¶ï¼Œå°†å‰ä¸€è½®è¯·æ±‚abortç»ˆç»“æ‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">$.validator.prototype = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  previousValue: <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.data(element, <span class="string">"previousValue"</span>) || $.data(element, <span class="string">"previousValue"</span>, &#123;</span><br><span class="line">      old: <span class="literal">null</span>,</span><br><span class="line">      valid: <span class="literal">true</span>,</span><br><span class="line">      message: <span class="keyword">this</span>.defaultMessage(element, <span class="string">"remote"</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  startRequest: <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.pending[element.name]) &#123;</span><br><span class="line">      <span class="keyword">this</span>.pendingRequest++;</span><br><span class="line">      <span class="keyword">this</span>.pending[element.name] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  stopRequest: <span class="function"><span class="keyword">function</span> (<span class="params">element, valid</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.pendingRequest--;</span><br><span class="line">    <span class="comment">// sometimes synchronization fails, make sure pendingRequest is never &lt; 0  </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.pendingRequest &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.pendingRequest = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.pending[element.name];</span><br><span class="line">    <span class="keyword">if</span> (valid &amp;&amp; <span class="keyword">this</span>.pendingRequest === <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.formSubmitted &amp;&amp; <span class="keyword">this</span>.form()) &#123;</span><br><span class="line">      $(<span class="keyword">this</span>.currentForm).submit();</span><br><span class="line">      <span class="keyword">this</span>.formSubmitted = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!valid &amp;&amp; <span class="keyword">this</span>.pendingRequest === <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.formSubmitted) &#123;</span><br><span class="line">      $(<span class="keyword">this</span>.currentForm).triggerHandler(<span class="string">"invalid-form"</span>, [<span class="keyword">this</span>]);</span><br><span class="line">      <span class="keyword">this</span>.formSubmitted = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://jqueryvalidation.org/remote-method/</span></span><br><span class="line">$.validator.prototype.methods.remote = <span class="function"><span class="keyword">function</span>(<span class="params">value, element, param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.optional(element)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"dependency-mismatch"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> previous = <span class="keyword">this</span>.previousValue(element),<span class="comment">// è·å–ä¸Šä¸€æ¬¡çš„éªŒè¯ç»“æœã€å€¼ã€‚æç¤ºæ–‡æœ¬  </span></span><br><span class="line">    validator, data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.settings.messages[element.name]) &#123;</span><br><span class="line">    <span class="keyword">this</span>.settings.messages[element.name] = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  previous.originalMessage = <span class="keyword">this</span>.settings.messages[element.name].remote;</span><br><span class="line">  <span class="keyword">this</span>.settings.messages[element.name].remote = previous.message;</span><br><span class="line"></span><br><span class="line">  param = <span class="keyword">typeof</span> param === <span class="string">"string"</span> &amp;&amp; &#123; <span class="attr">url</span>: param &#125; || param;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“å‰éªŒè¯ä¸ä¸Šä¸€æ¬¡æƒ…å½¢ç›¸åŒï¼Œè¿”å›å‰ä¸€æ¬¡éªŒè¯ç»“æœ  </span></span><br><span class="line">  <span class="keyword">if</span> (previous.old === value) &#123;</span><br><span class="line">    <span class="keyword">return</span> previous.valid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  previous.old = value;</span><br><span class="line">  validator = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.startRequest(element);</span><br><span class="line">  data = &#123;&#125;;</span><br><span class="line">  data[element.name] = value;</span><br><span class="line">  $.ajax($.extend(<span class="literal">true</span>, &#123;</span><br><span class="line">    mode: <span class="string">"abort"</span>,</span><br><span class="line">    port: <span class="string">"validate"</span> + element.name,<span class="comment">// portå’Œå…ƒç´ nameç›¸å…³ï¼Œå‘é€ajaxåpendingRequests[port]æ ‡è®°ä¸ºæœ‰å€¼ï¼Œé˜»æ­¢åŒä¸€ä¸ªå…ƒç´ å‘é€ä¸¤æ¬¡ajax  </span></span><br><span class="line">    dataType: <span class="string">"json"</span>,</span><br><span class="line">    data: data, </span><br><span class="line">    context: validator.currentForm,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> valid = response === <span class="literal">true</span> || response === <span class="string">"true"</span>,</span><br><span class="line">        errors, message, submitted;</span><br><span class="line"></span><br><span class="line">      validator.settings.messages[element.name].remote = previous.originalMessage;</span><br><span class="line">      <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">        submitted = validator.formSubmitted;</span><br><span class="line">        validator.prepareElement(element);</span><br><span class="line">        validator.formSubmitted = submitted;</span><br><span class="line">        validator.successList.push(element);</span><br><span class="line">        <span class="keyword">delete</span> validator.invalid[element.name];</span><br><span class="line">        validator.showErrors();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        errors = &#123;&#125;;</span><br><span class="line">        message = response || validator.defaultMessage(element, <span class="string">"remote"</span>);</span><br><span class="line">        errors[element.name] = previous.message = $.isFunction(message) ? message(value) : message;</span><br><span class="line">        validator.invalid[element.name] = <span class="literal">true</span>;</span><br><span class="line">        validator.showErrors(errors);</span><br><span class="line">      &#125;</span><br><span class="line">      previous.valid = valid;</span><br><span class="line">      validator.stopRequest(element, valid);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, param));</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"pending"</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pendingRequests = &#123;&#125;,</span><br><span class="line">  ajax;</span><br><span class="line"><span class="comment">// Use a prefilter if available (1.5+)  </span></span><br><span class="line"><span class="comment">// ä¸ºajaxæ–¹æ³•æ·»åŠ abortã€portæ ‡å¿—ï¼Œé˜»æ­¢åŒä¸€éªŒè¯å…ƒç´ åœ¨å‰ä¸€æ¬¡ajaxæœªå®Œæˆæ—¶ï¼Œå†åº¦å‘èµ·ajaxè¯·æ±‚</span></span><br><span class="line"><span class="keyword">if</span> ($.ajaxPrefilter) &#123;</span><br><span class="line">  <span class="comment">// ajaxPrefilterå‘é€å‰çš„é¢„å¤„ç†ï¼Œsettingè¯·æ±‚çš„æ‰€æœ‰å‚æ•°ï¼Œxhrç»è¿‡jqueryå°è£…çš„XMLHttpRequestå¯¹è±¡  </span></span><br><span class="line">  $.ajaxPrefilter(<span class="function"><span class="keyword">function</span> (<span class="params">settings, _, xhr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> port = settings.port;</span><br><span class="line">    <span class="keyword">if</span> (settings.mode === <span class="string">"abort"</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (pendingRequests[port]) &#123;</span><br><span class="line">        pendingRequests[port].abort();</span><br><span class="line">      &#125;</span><br><span class="line">      pendingRequests[port] = xhr;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  ajax = $.ajax; </span><br><span class="line">  $.ajax = <span class="function"><span class="keyword">function</span> (<span class="params">settings</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> mode = (<span class="string">"mode"</span> <span class="keyword">in</span> settings ? settings : $.ajaxSettings).mode,</span><br><span class="line">      port = (<span class="string">"port"</span> <span class="keyword">in</span> settings ? settings : $.ajaxSettings).port;</span><br><span class="line">    <span class="keyword">if</span> (mode === <span class="string">"abort"</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (pendingRequests[port]) &#123;</span><br><span class="line">        pendingRequests[port].abort();<span class="comment">// abort()ç”¨æ¥ç»ˆæ­¢ajaxè¯·æ±‚ï¼Œè¿˜æ˜¯ä¼šæ‰§è¡Œsuccesså›è°ƒï¼Œè¿”å›å€¼ä¸ºç©º  </span></span><br><span class="line">      &#125;</span><br><span class="line">      pendingRequests[port] = ajax.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      <span class="keyword">return</span> pendingRequests[port];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ajax.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ³¨å†Œæ ¡éªŒå™¨-1"><a href="#æ³¨å†Œæ ¡éªŒå™¨-1" class="headerlink" title="æ³¨å†Œæ ¡éªŒå™¨"></a>æ³¨å†Œæ ¡éªŒå™¨</h4><p>åœ¨jquery-validateæ¨¡å—ä¸­ï¼Œæ³¨å†Œæ ¡éªŒæ–¹æ³•é€šè¿‡è°ƒç”¨addMethodå®ç°ã€‚ä¸async-validadtoræ¨¡å—ç›¸æ¯”è¾ƒï¼Œjquery-validateæ¨¡å—ç¨æ˜¾å¾—ä¸å¤Ÿçµæ´»ï¼Œåªèƒ½å°†è‡ªå®šä¹‰æ ¡éªŒå™¨æ³¨å†Œä¸ºmethodsä¸‹å±çš„æ–¹æ³•ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨å¤–éƒ¨å‡½æ•°ã€‚</p>
<p>$.validator = {<br>  // â€¦</p>
<p>  addMethod: function (name, method, message) {<br>    $.validator.methods[name] = method;<br>    $.validator.messages[name] = message !== undefined ? message : $.validator.messages[name];<br>    if (method.length &lt; 3) {<br>      $.validator.addClassRules(name, $.validator.normalizeRule(name));<br>    }<br>  },<br>}</p>
<h4 id="æ ¡éªŒ"><a href="#æ ¡éªŒ" class="headerlink" title="æ ¡éªŒ"></a>æ ¡éªŒ</h4><p>åœ¨jquery-validateæ¨¡å—ä¸­ï¼Œå®é™…çš„æ ¡éªŒè¿‡ç¨‹é€šè¿‡è°ƒç”¨this.checkæ–¹æ³•æ‰§è¡Œï¼Œæ— è®ºæ˜¯æ•´å¼ è¡¨å•æ ¡éªŒï¼Œè¿˜æ˜¯å•ä¸ªè¡¨å•é¡¹æ ¡éªŒã€‚åœ¨checkæ–¹æ³•å†…éƒ¨ï¼Œä¹Ÿå³éå†æ ¡éªŒè§„åˆ™ï¼Œè°ƒç”¨methodsä¸‹å±çš„æ–¹æ³•å®Œæˆæ ¡éªŒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">$.validator.prototype = &#123;</span><br><span class="line">  <span class="comment">// ... </span></span><br><span class="line"></span><br><span class="line">  check: <span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    element = <span class="keyword">this</span>.validationTargetFor(<span class="keyword">this</span>.clean(element));<span class="comment">// è·å–å½“å‰éªŒè¯å…ƒç´   </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rules = $(element).rules(),<span class="comment">// è·å–å…ƒç´ çš„éªŒè¯è§„åˆ™  </span></span><br><span class="line">      rulesCount = $.map(rules, <span class="function"><span class="keyword">function</span> (<span class="params">n, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">      &#125;).length,</span><br><span class="line">      dependencyMismatch = <span class="literal">false</span>,</span><br><span class="line">      val = <span class="keyword">this</span>.elementValue(element),</span><br><span class="line">      result, method, rule;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (method <span class="keyword">in</span> rules) &#123;</span><br><span class="line">      rule = &#123; <span class="attr">method</span>: method, <span class="attr">parameters</span>: rules[method] &#125;;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        result = $.validator.methods[method].call(<span class="keyword">this</span>, val, element, rule.parameters);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¾èµ–æ¡ä»¶ä¸æˆç«‹ï¼Œè·³è¿‡éªŒè¯  </span></span><br><span class="line">        <span class="keyword">if</span> (result === <span class="string">"dependency-mismatch"</span> &amp;&amp; rulesCount === <span class="number">1</span>) &#123;</span><br><span class="line">          dependencyMismatch = <span class="literal">true</span>;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dependencyMismatch = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result === <span class="string">"pending"</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.toHide = <span class="keyword">this</span>.toHide.not(<span class="keyword">this</span>.errorsFor(element));</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">          <span class="keyword">this</span>.formatAndAdd(element, rule);<span class="comment">// è·å–é”™è¯¯æ–‡æ¡ˆï¼Œå¹¶å‘this.errorListå¡å€¼</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.settings.debug &amp;&amp; <span class="built_in">window</span>.console) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"Exception occurred when checking element "</span> + element.id + <span class="string">", check the '"</span> + rule.method + <span class="string">"' method."</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="built_in">TypeError</span>) &#123;</span><br><span class="line">          e.message += <span class="string">".  Exception occurred when checking element "</span> + element.id + <span class="string">", check the '"</span> + rule.method + <span class="string">"' method."</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dependencyMismatch) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.objectLength(rules)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.successList.push(element);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="é”™è¯¯æ–‡æ¡ˆ-1"><a href="#é”™è¯¯æ–‡æ¡ˆ-1" class="headerlink" title="é”™è¯¯æ–‡æ¡ˆ"></a>é”™è¯¯æ–‡æ¡ˆ</h4><p>åœ¨jquery-validateæ¨¡å—ä¸­ï¼Œé”™è¯¯æ–‡æ¡ˆçš„å®ç°ä¸async-validatoræ¨¡å—åŸºæœ¬ç›¸åŒã€‚å› ä¸ºjquery-validateæ¨¡å—æ²¡æœ‰çµæ´»çš„è‡ªå®šä¹‰æ ¡éªŒå™¨æ¦‚å¿µï¼Œé”™è¯¯æ–‡æ¡ˆéƒ½é€šè¿‡é…ç½®é¡¹æ³¨å…¥ï¼Œå¯ä»¥ç”¨é€šç”¨çš„formatæ–¹æ³•å¯¹å…¶æ ¼å¼åŒ–ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">$.validator = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  format: <span class="function"><span class="keyword">function</span> (<span class="params">source, params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> args = $.makeArray(<span class="built_in">arguments</span>);</span><br><span class="line">        args.unshift(source);</span><br><span class="line">        <span class="keyword">return</span> $.validator.format.apply(<span class="keyword">this</span>, args);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &gt; <span class="number">2</span> &amp;&amp; params.constructor !== <span class="built_in">Array</span>) &#123;</span><br><span class="line">      params = $.makeArray(<span class="built_in">arguments</span>).slice(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (params.constructor !== <span class="built_in">Array</span>) &#123;</span><br><span class="line">      params = [params];</span><br><span class="line">    &#125;</span><br><span class="line">    $.each(params, <span class="function"><span class="keyword">function</span> (<span class="params">i, n</span>) </span>&#123;</span><br><span class="line">      source = source.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"\\&#123;"</span> + i + <span class="string">"\\&#125;"</span>, <span class="string">"g"</span>), <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  messages: &#123;</span><br><span class="line">    required: <span class="string">"This field is required."</span>,</span><br><span class="line">    remote: <span class="string">"Please fix this field."</span>,</span><br><span class="line">    email: <span class="string">"Please enter a valid email address."</span>,</span><br><span class="line">    url: <span class="string">"Please enter a valid URL."</span>,</span><br><span class="line">    date: <span class="string">"Please enter a valid date."</span>,</span><br><span class="line">    dateISO: <span class="string">"Please enter a valid date ( ISO )."</span>,</span><br><span class="line">    number: <span class="string">"Please enter a valid number."</span>,</span><br><span class="line">    digits: <span class="string">"Please enter only digits."</span>,</span><br><span class="line">    creditcard: <span class="string">"Please enter a valid credit card number."</span>,</span><br><span class="line">    equalTo: <span class="string">"Please enter the same value again."</span>,</span><br><span class="line">    maxlength: $.validator.format(<span class="string">"Please enter no more than &#123;0&#125; characters."</span>),</span><br><span class="line">    minlength: $.validator.format(<span class="string">"Please enter at least &#123;0&#125; characters."</span>),</span><br><span class="line">    rangelength: $.validator.format(<span class="string">"Please enter a value between &#123;0&#125; and &#123;1&#125; characters long."</span>),</span><br><span class="line">    range: $.validator.format(<span class="string">"Please enter a value between &#123;0&#125; and &#123;1&#125;."</span>),</span><br><span class="line">    max: $.validator.format(<span class="string">"Please enter a value less than or equal to &#123;0&#125;."</span>),</span><br><span class="line">    min: $.validator.format(<span class="string">"Please enter a value greater than or equal to &#123;0&#125;."</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$.validator.prototype = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  defaultMessage: <span class="function"><span class="keyword">function</span> (<span class="params">element, method</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.findDefined(<span class="comment">// this.findDefinedè¾“å‡ºé¦–ä¸ªçœŸå€¼çš„å‚æ•°</span></span><br><span class="line">      <span class="keyword">this</span>.customMessage(element.name, method),<span class="comment">// htmlè®¾ç½®çš„é”™è¯¯æ–‡æ¡ˆï¼Œå­—ç¬¦ä¸²</span></span><br><span class="line">      <span class="keyword">this</span>.customDataMessage(element, method),<span class="comment">// jsä»£ç è®¾ç½®çš„é”™è¯¯æ–‡æ¡ˆï¼Œå­—ç¬¦ä¸²æˆ–å‡½æ•°</span></span><br><span class="line">      <span class="comment">// title is never undefined, so handle empty string as undefined  </span></span><br><span class="line">      !<span class="keyword">this</span>.settings.ignoreTitle &amp;&amp; element.title || <span class="literal">undefined</span>,</span><br><span class="line">      $.validator.messages[method],</span><br><span class="line">      <span class="string">"&lt;strong&gt;Warning: No message defined for "</span> + element.name + <span class="string">"&lt;/strong&gt;"</span></span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  formatAndAdd: <span class="function"><span class="keyword">function</span> (<span class="params">element, rule</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> message = <span class="keyword">this</span>.defaultMessage(element, rule.method),<span class="comment">// è·å–é”™è¯¯æ–‡æ¡ˆ</span></span><br><span class="line">      theregex = <span class="regexp">/\$?\&#123;(\d+)\&#125;/g</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> message === <span class="string">"function"</span>) &#123;</span><br><span class="line">      message = message.call(<span class="keyword">this</span>, rule.parameters, element);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (theregex.test(message)) &#123;</span><br><span class="line">      message = $.validator.format(message.replace(theregex, <span class="string">"&#123;$1&#125;"</span>), rule.parameters);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.errorList.push(&#123;</span><br><span class="line">      message: message,</span><br><span class="line">      element: element,</span><br><span class="line">      method: rule.method</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.errorMap[element.name] = message;</span><br><span class="line">    <span class="keyword">this</span>.submitted[element.name] = message;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="jquery-validation"><a href="#jquery-validation" class="headerlink" title="jquery-validation"></a>jquery-validation</h3><p>jquery-validationæ¨¡å—çš„æ ¡éªŒæµç¨‹å®Œå…¨ä»¿ç…§jquery-validateï¼Œåªæ˜¯å¢åŠ äº†é¢å¤–çš„æ ¡éªŒæ–¹æ³•å’Œè¯­è¨€åŒ…ã€‚ç¬”è€…æ‰¼è¦è¯´æ˜ä¸€ä¸‹éƒ¨åˆ†æ ¡éªŒæ–¹æ³•çš„åŠŸèƒ½ï¼Œä»£ç ä¸å†èµ˜è¿°ã€‚</p>
<p>require_from_groupæ–¹æ³•æ ¡éªŒæŒ‡å®šç›¸å…³å…ƒç´ (nameå€¼æŸ¥æ‰¾)é€‰ä¸­é¡¹çš„ä¸ªæ•°ä¸å°äºæŒ‡å®šå€¼æ—¶ï¼Œäºˆä»¥æ ¡éªŒé€šè¿‡<br>skip_or_fill_minimumæ–¹æ³•æ ¡éªŒç›¸å…³å…ƒç´ (nameå€¼æŸ¥æ‰¾)æœªèµ‹å€¼æˆ–é€‰ä¸­é¡¹ä¸ªæ•°ä¸å°äºæŒ‡å®šå€¼æ—¶ï¼Œäºˆä»¥æ ¡éªŒé€šè¿‡ã€‚<br>patternæ–¹æ³•æ­£åˆ™åŒ¹é…ã€‚<br>notEqualToæ–¹æ³•æ ¡éªŒä¸ç­‰äºæŒ‡å®šå€¼ã€‚<br>integeræ–¹æ³•æ ¡éªŒæ•´æ•°ï¼Œå¯ä»¥æ—¶è´Ÿæ•´æ•°ã€‚<br>maxWordsã€minWordsã€rangeWordsæ–¹æ³•æ ¡éªŒå­—ç¬¦æ•°é‡ï¼Œå‰”é™¤htmlæ ‡ç­¾å’Œæ ‡ç‚¹ç¬¦å·åã€‚<br>strippedminlengthæ–¹æ³•æ ¡éªŒæ–‡æœ¬é•¿åº¦ä¸èƒ½å°äºæŒ‡å®šå€¼ã€‚<br>nowhitespaceæ–¹æ³•æ ¡éªŒéç©ºå­—ç¬¦ä¸²ã€‚<br>lettersonlyæ–¹æ³•æ ¡éªŒå­—ç¬¦ä¸²ã€‚<br>letterswithbasicpuncæ–¹æ³•æ ¡éªŒå¸¦åŸºæœ¬æ ‡ç‚¹ç¬¦å·çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼  /^[a-z-.,()â€™â€\s]+$/i ã€‚<br>alphanumericæ–¹æ³•æ ¡éªŒå€¼æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ã€ä¸‹åˆ’çº¿ã€æ•°å€¼ä¸­çš„ä¸€ç§ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ /^\w+$/i ã€‚<br>url2æ–¹æ³•æ ¡éªŒç½‘å€ã€‚<br>dateFAã€dateITAã€dateNLæ ¡éªŒæ—¥æœŸã€‚<br>timeã€time12hæ ¡éªŒæ—¶åˆ†ï¼Œ24å°æ—¶åˆ¶æˆ–12å°æ—¶åˆ¶ã€‚<br>acceptæ–¹æ³•æ ¡éªŒä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ã€‚<br>extensionæ–¹æ³•æ ¡éªŒæ–‡ä»¶çš„æ‰©å±•åã€‚<br>ipv4æ–¹æ³•æ ¡éªŒIP v4åœ°å€ã€‚<br>ipv6æ–¹æ³•æ ¡éªŒIP v6åœ°å€ã€‚<br>currencyæ–¹æ³•æ ¡éªŒè´§å¸é‡‘é¢ï¼Œå¯å¸¦æœ‰å¸ç§æ ‡è¯†ã€‚<br>mobileNLã€mobileUKæ–¹æ³•æ ¡éªŒç‰¹å®šåœ°åŒºæˆ–å›½å®¶çš„æ‰‹æœºå·ã€‚<br>phoneNLã€phonesUKã€phoneUKã€phoneUSæ–¹æ³•æ ¡éªŒç‰¹å®šåœ°åŒºæˆ–å›½å®¶çš„ç§»åŠ¨ç”µè¯å·ç ã€‚<br>postalcodeBRã€postalCodeCAã€postalcodeNLã€postcodeUKã€zipcodeUSã€ziprangeæ–¹æ³•æ ¡éªŒç‰¹å®šåœ°åŒºæˆ–å›½å®¶çš„é‚®æ”¿ç¼–ç ã€‚<br>bankaccountNLæ–¹æ³•æ ¡éªŒæ˜¯å¦é“¶è¡Œè´¦å·ã€‚<br>giroaccountNLæ–¹æ³•æ ¡éªŒæ˜¯å¦è½¬è´¦è´¦å·ã€‚<br>bankorgiroaccountNLæ–¹æ³•æ ¡éªŒæ˜¯å¦é“¶è¡Œè´¦å·æˆ–è€…è½¬è´¦è´¦å·ã€‚<br>ibanæ–¹æ³•æ ¡éªŒå›½é™…é“¶è¡Œè´¦å·ã€‚<br>bicæ–¹æ³•æ ¡éªŒæ˜¯å¦å•†ä¸šè¯†åˆ«ç ã€‚<br>cifESæ–¹æ³•æ ¡éªŒæ˜¯å¦è¥¿ç­ç‰™çº³ç¨è¯†åˆ«å·ã€‚<br>cpfBRæ–¹æ³•æ ¡éªŒæ˜¯å¦å·´è¥¿çº³ç¨è¯†åˆ«å·ã€‚<br>creditcardtypesæ–¹æ³•æ ¡éªŒä¿¡ç”¨å¡å·æ˜¯å¦ä¸ºç‰¹å®šç±»å‹ã€‚<br>vinUSæ–¹æ³•æ ¡éªŒæ±½è½¦ç¼–å·ã€‚<br>stateUSæ–¹æ³•æ ¡éªŒç¾å›½çš„å·æˆ–åœ°åŒºã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="Alfred" />
            
              <p class="site-author-name" itemprop="name">Alfred</p>
              <p class="site-description motion-element" itemprop="description">äººè‹¦ä¸çŸ¥è¶³ï¼Œæ—¢å¾—é™‡ï¼Œå¤æœ›èœ€</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Alfred-sg" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/xiu-fan-79/activities" target="_blank" title="çŸ¥ä¹">
                      
                        <i class="fa fa-fw fa-globe"></i>çŸ¥ä¹</a>
                  </span>
                
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alfred</span>

  

  
</div>




  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.0.2</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.2"></script>



  

  
    <script id="dsq-count-scr" src="https://alfred.disqus.com/count.js" async></script>
  

  





	





  












  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
